import{A as jn,B as Rd,C as Dd,a as nd,b as Ca,c as rd,d as id,f as sd,g as od,h as ad,j as md,k as pd,l as Jt,m as gd,n as _d,o as yd,p as vd,q as wd,r as Id,s as Td,t as Ed,u as Ad,v as bd,w as Sd,x as Cd,y as Pd,z as xd}from"./chunk-TOGZK7SH.js";import{c as ud,d as ti,e as Pa,f as cd,g as ld,i as xa,j as ft,k as _s,l as ce,m as hd,n as dd,o as fd,q as Ra,r as ei}from"./chunk-LLRW3BDI.js";import{$ as ds,A as pt,Aa as gs,Ca as Sa,D as Ht,E as Zr,H as jh,I as Gh,L as zh,N as Kh,O as Gt,P as ue,T as Bn,U as $t,W as $h,X,Y as nt,Z as At,_ as Qh,a as qh,aa as fs,ba as Wh,c as Bh,ca as Hh,da as Ct,ea as ms,fa as Jh,g as Jr,h as Aa,ha as Un,i as ee,l as ba,m as Uh,o as us,p as cs,pa as Yh,qa as ps,r as ls,ra as Xh,sa as Zh,x as hs,y as Yr,ya as td,z as Xr,za as ed}from"./chunk-GJEAREQK.js";import{a as Fe,b as Hr,g as Ea,h as x,i as et}from"./chunk-KXCUNDCU.js";et();et();et();var ys=class r{texto=`Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus lacinia eros a enim feugiat, vel euismod dolor dignissim. Integer tincidunt ligula a sem facilisis, ut egestas ligula tincidunt.  Fusce id lectus sit amet felis malesuada convallis. Curabitur sit amet nisl augue, nec fringilla velit. Nam et leo vel sem scelerisque egestas non in sapien.
Sed dapibus venenatis velit, et feugiat sem mollis et. 
Mauris ut tortor vel magna lobortis feugiat. Donec interdum, lorem a feugiat feugiat, libero urna pretium dui, ut volutpat turpis mi ut eros. 
Fusce auctor urna nec nibh varius, id vulputate sapien rhoncus. Proin vestibulum magna vel nibh ultricies sollicitudin.

Mauris dapibus ex et lacus fermentum ultricies. Cras tincidunt metus felis, nec gravida velit consequat in. 
Integer pharetra urna ac lectus vehicula viverra. Donec vehicula libero a lorem tincidunt, et rhoncus turpis gravida. 
Quisque volutpat, mi sit amet pharetra fermentum, tortor felis laoreet dui, vel malesuada lorem turpis vel justo.

Lorem ipsum dolor sit amet, consectetur adipiscing elit. 
Vivamus lacinia eros a enim feugiat, vel euismod dolor dignissim. Integer tincidunt ligula a sem facilisis, ut egestas ligula tincidunt. 
Fusce id lectus sit amet felis malesuada convallis. Curabitur sit amet nisl augue, nec fringilla velit. Nam et leo vel sem scelerisque egestas non in sapien.

Sed dapibus venenatis velit, et feugiat sem mollis et. 
Mauris ut tortor vel magna lobortis feugiat. Donec interdum, lorem a feugiat feugiat, libero urna pretium dui, ut volutpat turpis mi ut eros. 
Fusce auctor urna nec nibh varius, id vulputate sapien rhoncus. Proin vestibulum magna vel nibh ultricies sollicitudin.

Mauris dapibus ex et lacus fermentum ultricies. Cras tincidunt metus felis, nec gravida velit consequat in. 
Integer pharetra urna ac lectus vehicula viverra. Donec vehicula libero a lorem tincidunt, et rhoncus turpis gravida. 
Quisque volutpat, mi sit amet pharetra fermentum, tortor felis laoreet dui, vel malesuada lorem turpis vel justo.
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus lacinia eros a enim feugiat, vel euismod dolor dignissim. Integer tincidunt ligula a sem facilisis, ut egestas ligula tincidunt.  Fusce id lectus sit amet felis malesuada convallis. Curabitur sit amet nisl augue, nec fringilla velit. Nam et leo vel sem scelerisque egestas non in sapien.
Sed dapibus venenatis velit, et feugiat sem mollis et. 
Mauris ut tortor vel magna lobortis feugiat. Donec interdum, lorem a feugiat feugiat, libero urna pretium dui, ut volutpat turpis mi ut eros. 
Fusce auctor urna nec nibh varius, id vulputate sapien rhoncus. Proin vestibulum magna vel nibh ultricies sollicitudin.

Mauris dapibus ex et lacus fermentum ultricies. Cras tincidunt metus felis, nec gravida velit consequat in. 
Integer pharetra urna ac lectus vehicula viverra. Donec vehicula libero a lorem tincidunt, et rhoncus turpis gravida. 
Quisque volutpat, mi sit amet pharetra fermentum, tortor felis laoreet dui, vel malesuada lorem turpis vel justo.

Lorem ipsum dolor sit amet, consectetur adipiscing elit. 
Vivamus lacinia eros a enim feugiat, vel euismod dolor dignissim. Integer tincidunt ligula a sem facilisis, ut egestas ligula tincidunt. 
Fusce id lectus sit amet felis malesuada convallis. Curabitur sit amet nisl augue, nec fringilla velit. Nam et leo vel sem scelerisque egestas non in sapien.

Sed dapibus venenatis velit, et feugiat sem mollis et. 
Mauris ut tortor vel magna lobortis feugiat. Donec interdum, lorem a feugiat feugiat, libero urna pretium dui, ut volutpat turpis mi ut eros. 
Fusce auctor urna nec nibh varius, id vulputate sapien rhoncus. Proin vestibulum magna vel nibh ultricies sollicitudin.

Mauris dapibus ex et lacus fermentum ultricies. Cras tincidunt metus felis, nec gravida velit consequat in. 
Integer pharetra urna ac lectus vehicula viverra. Donec vehicula libero a lorem tincidunt, et rhoncus turpis gravida. 
Quisque volutpat, mi sit amet pharetra fermentum, tortor felis laoreet dui, vel malesuada lorem turpis vel justo.`;static \u0275fac=function(e){return new(e||r)};static \u0275cmp=Ht({type:r,selectors:[["app-dream-view"]],decls:15,vars:1,consts:[["id","DreamCard",1,"card"],["id","DreamCore"],["id","Title"],[1,"scrollbar"],["id","DreamText"],["id","DreamSidebar"],["id","DataInfo"],[1,"iconBtn","editBtn"],[1,"bi","bi-pencil-fill"]],template:function(e,n){e&1&&(X(0,"section",0)(1,"div",1)(2,"header")(3,"div",2)(4,"h3"),Ct(5," Dream\xB4sTitle "),nt()()(),X(6,"main",3)(7,"p",4),Ct(8),nt()()(),X(9,"div",5)(10,"aside")(11,"div",6),Ct(12," dd/mm/yyyy hh/mm "),nt(),X(13,"button",7),At(14,"i",8),nt()()()()),e&2&&(Gt(8),Jh(" ",n.texto," "))},styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;padding:20px;box-sizing:border-box}#DreamCard[_ngcontent-%COMP%]{display:flex;padding:20px;align-content:flex-start;max-height:100%;width:100%}#DreamCard[_ngcontent-%COMP%]   #DreamCore[_ngcontent-%COMP%]{flex:1;gap:20px;display:flex;flex-direction:column;overflow:hidden}#DreamCard[_ngcontent-%COMP%]   #DreamCore[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;align-content:center}#DreamCard[_ngcontent-%COMP%]   #DreamCore[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   #Title[_ngcontent-%COMP%]{flex:1;flex:1 250px}#DreamCard[_ngcontent-%COMP%]   #DreamCore[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   #Title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0}#DreamCard[_ngcontent-%COMP%]   #DreamCore[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{padding:5px;flex:1;display:flex;height:100%;overflow-y:auto;scrollbar-gutter:stable}#DreamCard[_ngcontent-%COMP%]   #DreamCore[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]   #DreamText[_ngcontent-%COMP%]{width:100%;max-width:600px;margin:0;white-space:pre;text-wrap:wrap;font-family:sans-serif}#DreamCard[_ngcontent-%COMP%]   #DreamSidebar[_ngcontent-%COMP%]{flex:0 200px}#DreamCard[_ngcontent-%COMP%]   #DreamSidebar[_ngcontent-%COMP%]   #DataInfo[_ngcontent-%COMP%]{text-align:end;color:var(--colorText2)}#DreamCard[_ngcontent-%COMP%]   .editBtn[_ngcontent-%COMP%]{position:fixed;bottom:40px;right:40px;z-index:2}"]})};et();et();et();et();et();var Vd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Nd={};var Le,Da;(function(){var r;function t(w,g){function v(){}v.prototype=g.prototype,w.D=g.prototype,w.prototype=new v,w.prototype.constructor=w,w.C=function(I,T,A){for(var y=Array(arguments.length-2),we=2;we<arguments.length;we++)y[we-2]=arguments[we];return g.prototype[T].apply(I,y)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(n,e),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(w,g,v){v||(v=0);var I=Array(16);if(typeof g=="string")for(var T=0;16>T;++T)I[T]=g.charCodeAt(v++)|g.charCodeAt(v++)<<8|g.charCodeAt(v++)<<16|g.charCodeAt(v++)<<24;else for(T=0;16>T;++T)I[T]=g[v++]|g[v++]<<8|g[v++]<<16|g[v++]<<24;g=w.g[0],v=w.g[1],T=w.g[2];var A=w.g[3],y=g+(A^v&(T^A))+I[0]+3614090360&4294967295;g=v+(y<<7&4294967295|y>>>25),y=A+(T^g&(v^T))+I[1]+3905402710&4294967295,A=g+(y<<12&4294967295|y>>>20),y=T+(v^A&(g^v))+I[2]+606105819&4294967295,T=A+(y<<17&4294967295|y>>>15),y=v+(g^T&(A^g))+I[3]+3250441966&4294967295,v=T+(y<<22&4294967295|y>>>10),y=g+(A^v&(T^A))+I[4]+4118548399&4294967295,g=v+(y<<7&4294967295|y>>>25),y=A+(T^g&(v^T))+I[5]+1200080426&4294967295,A=g+(y<<12&4294967295|y>>>20),y=T+(v^A&(g^v))+I[6]+2821735955&4294967295,T=A+(y<<17&4294967295|y>>>15),y=v+(g^T&(A^g))+I[7]+4249261313&4294967295,v=T+(y<<22&4294967295|y>>>10),y=g+(A^v&(T^A))+I[8]+1770035416&4294967295,g=v+(y<<7&4294967295|y>>>25),y=A+(T^g&(v^T))+I[9]+2336552879&4294967295,A=g+(y<<12&4294967295|y>>>20),y=T+(v^A&(g^v))+I[10]+4294925233&4294967295,T=A+(y<<17&4294967295|y>>>15),y=v+(g^T&(A^g))+I[11]+2304563134&4294967295,v=T+(y<<22&4294967295|y>>>10),y=g+(A^v&(T^A))+I[12]+1804603682&4294967295,g=v+(y<<7&4294967295|y>>>25),y=A+(T^g&(v^T))+I[13]+4254626195&4294967295,A=g+(y<<12&4294967295|y>>>20),y=T+(v^A&(g^v))+I[14]+2792965006&4294967295,T=A+(y<<17&4294967295|y>>>15),y=v+(g^T&(A^g))+I[15]+1236535329&4294967295,v=T+(y<<22&4294967295|y>>>10),y=g+(T^A&(v^T))+I[1]+4129170786&4294967295,g=v+(y<<5&4294967295|y>>>27),y=A+(v^T&(g^v))+I[6]+3225465664&4294967295,A=g+(y<<9&4294967295|y>>>23),y=T+(g^v&(A^g))+I[11]+643717713&4294967295,T=A+(y<<14&4294967295|y>>>18),y=v+(A^g&(T^A))+I[0]+3921069994&4294967295,v=T+(y<<20&4294967295|y>>>12),y=g+(T^A&(v^T))+I[5]+3593408605&4294967295,g=v+(y<<5&4294967295|y>>>27),y=A+(v^T&(g^v))+I[10]+38016083&4294967295,A=g+(y<<9&4294967295|y>>>23),y=T+(g^v&(A^g))+I[15]+3634488961&4294967295,T=A+(y<<14&4294967295|y>>>18),y=v+(A^g&(T^A))+I[4]+3889429448&4294967295,v=T+(y<<20&4294967295|y>>>12),y=g+(T^A&(v^T))+I[9]+568446438&4294967295,g=v+(y<<5&4294967295|y>>>27),y=A+(v^T&(g^v))+I[14]+3275163606&4294967295,A=g+(y<<9&4294967295|y>>>23),y=T+(g^v&(A^g))+I[3]+4107603335&4294967295,T=A+(y<<14&4294967295|y>>>18),y=v+(A^g&(T^A))+I[8]+1163531501&4294967295,v=T+(y<<20&4294967295|y>>>12),y=g+(T^A&(v^T))+I[13]+2850285829&4294967295,g=v+(y<<5&4294967295|y>>>27),y=A+(v^T&(g^v))+I[2]+4243563512&4294967295,A=g+(y<<9&4294967295|y>>>23),y=T+(g^v&(A^g))+I[7]+1735328473&4294967295,T=A+(y<<14&4294967295|y>>>18),y=v+(A^g&(T^A))+I[12]+2368359562&4294967295,v=T+(y<<20&4294967295|y>>>12),y=g+(v^T^A)+I[5]+4294588738&4294967295,g=v+(y<<4&4294967295|y>>>28),y=A+(g^v^T)+I[8]+2272392833&4294967295,A=g+(y<<11&4294967295|y>>>21),y=T+(A^g^v)+I[11]+1839030562&4294967295,T=A+(y<<16&4294967295|y>>>16),y=v+(T^A^g)+I[14]+4259657740&4294967295,v=T+(y<<23&4294967295|y>>>9),y=g+(v^T^A)+I[1]+2763975236&4294967295,g=v+(y<<4&4294967295|y>>>28),y=A+(g^v^T)+I[4]+1272893353&4294967295,A=g+(y<<11&4294967295|y>>>21),y=T+(A^g^v)+I[7]+4139469664&4294967295,T=A+(y<<16&4294967295|y>>>16),y=v+(T^A^g)+I[10]+3200236656&4294967295,v=T+(y<<23&4294967295|y>>>9),y=g+(v^T^A)+I[13]+681279174&4294967295,g=v+(y<<4&4294967295|y>>>28),y=A+(g^v^T)+I[0]+3936430074&4294967295,A=g+(y<<11&4294967295|y>>>21),y=T+(A^g^v)+I[3]+3572445317&4294967295,T=A+(y<<16&4294967295|y>>>16),y=v+(T^A^g)+I[6]+76029189&4294967295,v=T+(y<<23&4294967295|y>>>9),y=g+(v^T^A)+I[9]+3654602809&4294967295,g=v+(y<<4&4294967295|y>>>28),y=A+(g^v^T)+I[12]+3873151461&4294967295,A=g+(y<<11&4294967295|y>>>21),y=T+(A^g^v)+I[15]+530742520&4294967295,T=A+(y<<16&4294967295|y>>>16),y=v+(T^A^g)+I[2]+3299628645&4294967295,v=T+(y<<23&4294967295|y>>>9),y=g+(T^(v|~A))+I[0]+4096336452&4294967295,g=v+(y<<6&4294967295|y>>>26),y=A+(v^(g|~T))+I[7]+1126891415&4294967295,A=g+(y<<10&4294967295|y>>>22),y=T+(g^(A|~v))+I[14]+2878612391&4294967295,T=A+(y<<15&4294967295|y>>>17),y=v+(A^(T|~g))+I[5]+4237533241&4294967295,v=T+(y<<21&4294967295|y>>>11),y=g+(T^(v|~A))+I[12]+1700485571&4294967295,g=v+(y<<6&4294967295|y>>>26),y=A+(v^(g|~T))+I[3]+2399980690&4294967295,A=g+(y<<10&4294967295|y>>>22),y=T+(g^(A|~v))+I[10]+4293915773&4294967295,T=A+(y<<15&4294967295|y>>>17),y=v+(A^(T|~g))+I[1]+2240044497&4294967295,v=T+(y<<21&4294967295|y>>>11),y=g+(T^(v|~A))+I[8]+1873313359&4294967295,g=v+(y<<6&4294967295|y>>>26),y=A+(v^(g|~T))+I[15]+4264355552&4294967295,A=g+(y<<10&4294967295|y>>>22),y=T+(g^(A|~v))+I[6]+2734768916&4294967295,T=A+(y<<15&4294967295|y>>>17),y=v+(A^(T|~g))+I[13]+1309151649&4294967295,v=T+(y<<21&4294967295|y>>>11),y=g+(T^(v|~A))+I[4]+4149444226&4294967295,g=v+(y<<6&4294967295|y>>>26),y=A+(v^(g|~T))+I[11]+3174756917&4294967295,A=g+(y<<10&4294967295|y>>>22),y=T+(g^(A|~v))+I[2]+718787259&4294967295,T=A+(y<<15&4294967295|y>>>17),y=v+(A^(T|~g))+I[9]+3951481745&4294967295,w.g[0]=w.g[0]+g&4294967295,w.g[1]=w.g[1]+(T+(y<<21&4294967295|y>>>11))&4294967295,w.g[2]=w.g[2]+T&4294967295,w.g[3]=w.g[3]+A&4294967295}n.prototype.u=function(w,g){g===void 0&&(g=w.length);for(var v=g-this.blockSize,I=this.B,T=this.h,A=0;A<g;){if(T==0)for(;A<=v;)i(this,w,A),A+=this.blockSize;if(typeof w=="string"){for(;A<g;)if(I[T++]=w.charCodeAt(A++),T==this.blockSize){i(this,I),T=0;break}}else for(;A<g;)if(I[T++]=w[A++],T==this.blockSize){i(this,I),T=0;break}}this.h=T,this.o+=g},n.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var g=1;g<w.length-8;++g)w[g]=0;var v=8*this.o;for(g=w.length-8;g<w.length;++g)w[g]=v&255,v/=256;for(this.u(w),w=Array(16),g=v=0;4>g;++g)for(var I=0;32>I;I+=8)w[v++]=this.g[g]>>>I&255;return w};function s(w,g){var v=u;return Object.prototype.hasOwnProperty.call(v,w)?v[w]:v[w]=g(w)}function a(w,g){this.h=g;for(var v=[],I=!0,T=w.length-1;0<=T;T--){var A=w[T]|0;I&&A==g||(v[T]=A,I=!1)}this.g=v}var u={};function l(w){return-128<=w&&128>w?s(w,function(g){return new a([g|0],0>g?-1:0)}):new a([w|0],0>w?-1:0)}function d(w){if(isNaN(w)||!isFinite(w))return p;if(0>w)return V(d(-w));for(var g=[],v=1,I=0;w>=v;I++)g[I]=w/v|0,v*=4294967296;return new a(g,0)}function f(w,g){if(w.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(w.charAt(0)=="-")return V(f(w.substring(1),g));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var v=d(Math.pow(g,8)),I=p,T=0;T<w.length;T+=8){var A=Math.min(8,w.length-T),y=parseInt(w.substring(T,T+A),g);8>A?(A=d(Math.pow(g,A)),I=I.j(A).add(d(y))):(I=I.j(v),I=I.add(d(y)))}return I}var p=l(0),_=l(1),b=l(16777216);r=a.prototype,r.m=function(){if(k(this))return-V(this).m();for(var w=0,g=1,v=0;v<this.g.length;v++){var I=this.i(v);w+=(0<=I?I:4294967296+I)*g,g*=4294967296}return w},r.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(N(this))return"0";if(k(this))return"-"+V(this).toString(w);for(var g=d(Math.pow(w,6)),v=this,I="";;){var T=Q(v,g).g;v=j(v,T.j(g));var A=((0<v.g.length?v.g[0]:v.h)>>>0).toString(w);if(v=T,N(v))return A+I;for(;6>A.length;)A="0"+A;I=A+I}},r.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function N(w){if(w.h!=0)return!1;for(var g=0;g<w.g.length;g++)if(w.g[g]!=0)return!1;return!0}function k(w){return w.h==-1}r.l=function(w){return w=j(this,w),k(w)?-1:N(w)?0:1};function V(w){for(var g=w.g.length,v=[],I=0;I<g;I++)v[I]=~w.g[I];return new a(v,~w.h).add(_)}r.abs=function(){return k(this)?V(this):this},r.add=function(w){for(var g=Math.max(this.g.length,w.g.length),v=[],I=0,T=0;T<=g;T++){var A=I+(this.i(T)&65535)+(w.i(T)&65535),y=(A>>>16)+(this.i(T)>>>16)+(w.i(T)>>>16);I=y>>>16,A&=65535,y&=65535,v[T]=y<<16|A}return new a(v,v[v.length-1]&-2147483648?-1:0)};function j(w,g){return w.add(V(g))}r.j=function(w){if(N(this)||N(w))return p;if(k(this))return k(w)?V(this).j(V(w)):V(V(this).j(w));if(k(w))return V(this.j(V(w)));if(0>this.l(b)&&0>w.l(b))return d(this.m()*w.m());for(var g=this.g.length+w.g.length,v=[],I=0;I<2*g;I++)v[I]=0;for(I=0;I<this.g.length;I++)for(var T=0;T<w.g.length;T++){var A=this.i(I)>>>16,y=this.i(I)&65535,we=w.i(T)>>>16,Rr=w.i(T)&65535;v[2*I+2*T]+=y*Rr,G(v,2*I+2*T),v[2*I+2*T+1]+=A*Rr,G(v,2*I+2*T+1),v[2*I+2*T+1]+=y*we,G(v,2*I+2*T+1),v[2*I+2*T+2]+=A*we,G(v,2*I+2*T+2)}for(I=0;I<g;I++)v[I]=v[2*I+1]<<16|v[2*I];for(I=g;I<2*g;I++)v[I]=0;return new a(v,0)};function G(w,g){for(;(w[g]&65535)!=w[g];)w[g+1]+=w[g]>>>16,w[g]&=65535,g++}function B(w,g){this.g=w,this.h=g}function Q(w,g){if(N(g))throw Error("division by zero");if(N(w))return new B(p,p);if(k(w))return g=Q(V(w),g),new B(V(g.g),V(g.h));if(k(g))return g=Q(w,V(g)),new B(V(g.g),g.h);if(30<w.g.length){if(k(w)||k(g))throw Error("slowDivide_ only works with positive integers.");for(var v=_,I=g;0>=I.l(w);)v=H(v),I=H(I);var T=K(v,1),A=K(I,1);for(I=K(I,2),v=K(v,2);!N(I);){var y=A.add(I);0>=y.l(w)&&(T=T.add(v),A=y),I=K(I,1),v=K(v,1)}return g=j(w,T.j(g)),new B(T,g)}for(T=p;0<=w.l(g);){for(v=Math.max(1,Math.floor(w.m()/g.m())),I=Math.ceil(Math.log(v)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),A=d(v),y=A.j(g);k(y)||0<y.l(w);)v-=I,A=d(v),y=A.j(g);N(A)&&(A=_),T=T.add(A),w=j(w,y)}return new B(T,w)}r.A=function(w){return Q(this,w).h},r.and=function(w){for(var g=Math.max(this.g.length,w.g.length),v=[],I=0;I<g;I++)v[I]=this.i(I)&w.i(I);return new a(v,this.h&w.h)},r.or=function(w){for(var g=Math.max(this.g.length,w.g.length),v=[],I=0;I<g;I++)v[I]=this.i(I)|w.i(I);return new a(v,this.h|w.h)},r.xor=function(w){for(var g=Math.max(this.g.length,w.g.length),v=[],I=0;I<g;I++)v[I]=this.i(I)^w.i(I);return new a(v,this.h^w.h)};function H(w){for(var g=w.g.length+1,v=[],I=0;I<g;I++)v[I]=w.i(I)<<1|w.i(I-1)>>>31;return new a(v,w.h)}function K(w,g){var v=g>>5;g%=32;for(var I=w.g.length-v,T=[],A=0;A<I;A++)T[A]=0<g?w.i(A+v)>>>g|w.i(A+v+1)<<32-g:w.i(A+v);return new a(T,w.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Da=Nd.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,Le=Nd.Integer=a}).apply(typeof Vd<"u"?Vd:typeof self<"u"?self:typeof window<"u"?window:{});et();var vs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ae={};var Va,Hg,Gn,Na,ri,ws,ka,Ma,Oa;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,c,h){return o==Array.prototype||o==Object.prototype||(o[c]=h.value),o};function e(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof vs=="object"&&vs];for(var c=0;c<o.length;++c){var h=o[c];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=e(this);function i(o,c){if(c)t:{var h=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var E=o[m];if(!(E in h))break t;h=h[E]}o=o[o.length-1],m=h[o],c=c(m),c!=m&&c!=null&&t(h,o,{configurable:!0,writable:!0,value:c})}}function s(o,c){o instanceof String&&(o+="");var h=0,m=!1,E={next:function(){if(!m&&h<o.length){var C=h++;return{value:c(C,o[C]),done:!1}}return m=!0,{done:!0,value:void 0}}};return E[Symbol.iterator]=function(){return E},E}i("Array.prototype.values",function(o){return o||function(){return s(this,function(c,h){return h})}});var a=a||{},u=this||self;function l(o){var c=typeof o;return c=c!="object"?c:o?Array.isArray(o)?"array":c:"null",c=="array"||c=="object"&&typeof o.length=="number"}function d(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function f(o,c,h){return o.call.apply(o.bind,arguments)}function p(o,c,h){if(!o)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var E=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(E,m),o.apply(c,E)}}return function(){return o.apply(c,arguments)}}function _(o,c,h){return _=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:p,_.apply(null,arguments)}function b(o,c){var h=Array.prototype.slice.call(arguments,1);return function(){var m=h.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function N(o,c){function h(){}h.prototype=c.prototype,o.aa=c.prototype,o.prototype=new h,o.prototype.constructor=o,o.Qb=function(m,E,C){for(var M=Array(arguments.length-2),it=2;it<arguments.length;it++)M[it-2]=arguments[it];return c.prototype[E].apply(m,M)}}function k(o){let c=o.length;if(0<c){let h=Array(c);for(let m=0;m<c;m++)h[m]=o[m];return h}return[]}function V(o,c){for(let h=1;h<arguments.length;h++){let m=arguments[h];if(l(m)){let E=o.length||0,C=m.length||0;o.length=E+C;for(let M=0;M<C;M++)o[E+M]=m[M]}else o.push(m)}}class j{constructor(c,h){this.i=c,this.j=h,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function G(o){return/^[\s\xa0]*$/.test(o)}function B(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function Q(o){return Q[" "](o),o}Q[" "]=function(){};var H=B().indexOf("Gecko")!=-1&&!(B().toLowerCase().indexOf("webkit")!=-1&&B().indexOf("Edge")==-1)&&!(B().indexOf("Trident")!=-1||B().indexOf("MSIE")!=-1)&&B().indexOf("Edge")==-1;function K(o,c,h){for(let m in o)c.call(h,o[m],m,o)}function w(o,c){for(let h in o)c.call(void 0,o[h],h,o)}function g(o){let c={};for(let h in o)c[h]=o[h];return c}let v="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(o,c){let h,m;for(let E=1;E<arguments.length;E++){m=arguments[E];for(h in m)o[h]=m[h];for(let C=0;C<v.length;C++)h=v[C],Object.prototype.hasOwnProperty.call(m,h)&&(o[h]=m[h])}}function T(o){var c=1;o=o.split(":");let h=[];for(;0<c&&o.length;)h.push(o.shift()),c--;return o.length&&h.push(o.join(":")),h}function A(o){u.setTimeout(()=>{throw o},0)}function y(){var o=Xo;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class we{constructor(){this.h=this.g=null}add(c,h){let m=Rr.get();m.set(c,h),this.h?this.h.next=m:this.g=m,this.h=m}}var Rr=new j(()=>new pg,o=>o.reset());class pg{constructor(){this.next=this.g=this.h=null}set(c,h){this.h=c,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let Dr,Vr=!1,Xo=new we,Ll=()=>{let o=u.Promise.resolve(void 0);Dr=()=>{o.then(gg)}};var gg=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(h){A(h)}var c=Rr;c.j(o),100>c.h&&(c.h++,o.next=c.g,c.g=o)}Vr=!1};function Ne(){this.s=this.s,this.C=this.C}Ne.prototype.s=!1,Ne.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ne.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Dt(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}Dt.prototype.h=function(){this.defaultPrevented=!0};var _g=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let h=()=>{};u.addEventListener("test",h,c),u.removeEventListener("test",h,c)}catch{}return o}();function Nr(o,c){if(Dt.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var h=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget){if(H){t:{try{Q(c.nodeName);var E=!0;break t}catch{}E=!1}E||(c=null)}}else h=="mouseover"?c=o.fromElement:h=="mouseout"&&(c=o.toElement);this.relatedTarget=c,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:yg[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&Nr.aa.h.call(this)}}N(Nr,Dt);var yg={2:"touch",3:"pen",4:"mouse"};Nr.prototype.h=function(){Nr.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var kr="closure_listenable_"+(1e6*Math.random()|0),vg=0;function wg(o,c,h,m,E){this.listener=o,this.proxy=null,this.src=c,this.type=h,this.capture=!!m,this.ha=E,this.key=++vg,this.da=this.fa=!1}function Ki(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function $i(o){this.src=o,this.g={},this.h=0}$i.prototype.add=function(o,c,h,m,E){var C=o.toString();o=this.g[C],o||(o=this.g[C]=[],this.h++);var M=ta(o,c,m,E);return-1<M?(c=o[M],h||(c.fa=!1)):(c=new wg(c,this.src,C,!!m,E),c.fa=h,o.push(c)),c};function Zo(o,c){var h=c.type;if(h in o.g){var m=o.g[h],E=Array.prototype.indexOf.call(m,c,void 0),C;(C=0<=E)&&Array.prototype.splice.call(m,E,1),C&&(Ki(c),o.g[h].length==0&&(delete o.g[h],o.h--))}}function ta(o,c,h,m){for(var E=0;E<o.length;++E){var C=o[E];if(!C.da&&C.listener==c&&C.capture==!!h&&C.ha==m)return E}return-1}var ea="closure_lm_"+(1e6*Math.random()|0),na={};function ql(o,c,h,m,E){if(m&&m.once)return Ul(o,c,h,m,E);if(Array.isArray(c)){for(var C=0;C<c.length;C++)ql(o,c[C],h,m,E);return null}return h=oa(h),o&&o[kr]?o.K(c,h,d(m)?!!m.capture:!!m,E):Bl(o,c,h,!1,m,E)}function Bl(o,c,h,m,E,C){if(!c)throw Error("Invalid event type");var M=d(E)?!!E.capture:!!E,it=ia(o);if(it||(o[ea]=it=new $i(o)),h=it.add(c,h,m,M,C),h.proxy)return h;if(m=Ig(),h.proxy=m,m.src=o,m.listener=h,o.addEventListener)_g||(E=M),E===void 0&&(E=!1),o.addEventListener(c.toString(),m,E);else if(o.attachEvent)o.attachEvent(Gl(c.toString()),m);else if(o.addListener&&o.removeListener)o.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return h}function Ig(){function o(h){return c.call(o.src,o.listener,h)}let c=Tg;return o}function Ul(o,c,h,m,E){if(Array.isArray(c)){for(var C=0;C<c.length;C++)Ul(o,c[C],h,m,E);return null}return h=oa(h),o&&o[kr]?o.L(c,h,d(m)?!!m.capture:!!m,E):Bl(o,c,h,!0,m,E)}function jl(o,c,h,m,E){if(Array.isArray(c))for(var C=0;C<c.length;C++)jl(o,c[C],h,m,E);else m=d(m)?!!m.capture:!!m,h=oa(h),o&&o[kr]?(o=o.i,c=String(c).toString(),c in o.g&&(C=o.g[c],h=ta(C,h,m,E),-1<h&&(Ki(C[h]),Array.prototype.splice.call(C,h,1),C.length==0&&(delete o.g[c],o.h--)))):o&&(o=ia(o))&&(c=o.g[c.toString()],o=-1,c&&(o=ta(c,h,m,E)),(h=-1<o?c[o]:null)&&ra(h))}function ra(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[kr])Zo(c.i,o);else{var h=o.type,m=o.proxy;c.removeEventListener?c.removeEventListener(h,m,o.capture):c.detachEvent?c.detachEvent(Gl(h),m):c.addListener&&c.removeListener&&c.removeListener(m),(h=ia(c))?(Zo(h,o),h.h==0&&(h.src=null,c[ea]=null)):Ki(o)}}}function Gl(o){return o in na?na[o]:na[o]="on"+o}function Tg(o,c){if(o.da)o=!0;else{c=new Nr(c,this);var h=o.listener,m=o.ha||o.src;o.fa&&ra(o),o=h.call(m,c)}return o}function ia(o){return o=o[ea],o instanceof $i?o:null}var sa="__closure_events_fn_"+(1e9*Math.random()>>>0);function oa(o){return typeof o=="function"?o:(o[sa]||(o[sa]=function(c){return o.handleEvent(c)}),o[sa])}function Vt(){Ne.call(this),this.i=new $i(this),this.M=this,this.F=null}N(Vt,Ne),Vt.prototype[kr]=!0,Vt.prototype.removeEventListener=function(o,c,h,m){jl(this,o,c,h,m)};function Ft(o,c){var h,m=o.F;if(m)for(h=[];m;m=m.F)h.push(m);if(o=o.M,m=c.type||c,typeof c=="string")c=new Dt(c,o);else if(c instanceof Dt)c.target=c.target||o;else{var E=c;c=new Dt(m,o),I(c,E)}if(E=!0,h)for(var C=h.length-1;0<=C;C--){var M=c.g=h[C];E=Qi(M,m,!0,c)&&E}if(M=c.g=o,E=Qi(M,m,!0,c)&&E,E=Qi(M,m,!1,c)&&E,h)for(C=0;C<h.length;C++)M=c.g=h[C],E=Qi(M,m,!1,c)&&E}Vt.prototype.N=function(){if(Vt.aa.N.call(this),this.i){var o=this.i,c;for(c in o.g){for(var h=o.g[c],m=0;m<h.length;m++)Ki(h[m]);delete o.g[c],o.h--}}this.F=null},Vt.prototype.K=function(o,c,h,m){return this.i.add(String(o),c,!1,h,m)},Vt.prototype.L=function(o,c,h,m){return this.i.add(String(o),c,!0,h,m)};function Qi(o,c,h,m){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();for(var E=!0,C=0;C<c.length;++C){var M=c[C];if(M&&!M.da&&M.capture==h){var it=M.listener,Pt=M.ha||M.src;M.fa&&Zo(o.i,M),E=it.call(Pt,m)!==!1&&E}}return E&&!m.defaultPrevented}function zl(o,c,h){if(typeof o=="function")h&&(o=_(o,h));else if(o&&typeof o.handleEvent=="function")o=_(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(c)?-1:u.setTimeout(o,c||0)}function Kl(o){o.g=zl(()=>{o.g=null,o.i&&(o.i=!1,Kl(o))},o.l);let c=o.h;o.h=null,o.m.apply(null,c)}class Eg extends Ne{constructor(c,h){super(),this.m=c,this.l=h,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Kl(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Mr(o){Ne.call(this),this.h=o,this.g={}}N(Mr,Ne);var $l=[];function Ql(o){K(o.g,function(c,h){this.g.hasOwnProperty(h)&&ra(c)},o),o.g={}}Mr.prototype.N=function(){Mr.aa.N.call(this),Ql(this)},Mr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var aa=u.JSON.stringify,Ag=u.JSON.parse,bg=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function ua(){}ua.prototype.h=null;function Wl(o){return o.h||(o.h=o.i())}function Hl(){}var Or={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ca(){Dt.call(this,"d")}N(ca,Dt);function la(){Dt.call(this,"c")}N(la,Dt);var on={},Jl=null;function Wi(){return Jl=Jl||new Vt}on.La="serverreachability";function Yl(o){Dt.call(this,on.La,o)}N(Yl,Dt);function Fr(o){let c=Wi();Ft(c,new Yl(c))}on.STAT_EVENT="statevent";function Xl(o,c){Dt.call(this,on.STAT_EVENT,o),this.stat=c}N(Xl,Dt);function Lt(o){let c=Wi();Ft(c,new Xl(c,o))}on.Ma="timingevent";function Zl(o,c){Dt.call(this,on.Ma,o),this.size=c}N(Zl,Dt);function Lr(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},c)}function qr(){this.g=!0}qr.prototype.xa=function(){this.g=!1};function Sg(o,c,h,m,E,C){o.info(function(){if(o.g)if(C)for(var M="",it=C.split("&"),Pt=0;Pt<it.length;Pt++){var tt=it[Pt].split("=");if(1<tt.length){var Nt=tt[0];tt=tt[1];var kt=Nt.split("_");M=2<=kt.length&&kt[1]=="type"?M+(Nt+"="+tt+"&"):M+(Nt+"=redacted&")}}else M=null;else M=C;return"XMLHTTP REQ ("+m+") [attempt "+E+"]: "+c+`
`+h+`
`+M})}function Cg(o,c,h,m,E,C,M){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+E+"]: "+c+`
`+h+`
`+C+" "+M})}function On(o,c,h,m){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+xg(o,h)+(m?" "+m:"")})}function Pg(o,c){o.info(function(){return"TIMEOUT: "+c})}qr.prototype.info=function(){};function xg(o,c){if(!o.g)return c;if(!c)return null;try{var h=JSON.parse(c);if(h){for(o=0;o<h.length;o++)if(Array.isArray(h[o])){var m=h[o];if(!(2>m.length)){var E=m[1];if(Array.isArray(E)&&!(1>E.length)){var C=E[0];if(C!="noop"&&C!="stop"&&C!="close")for(var M=1;M<E.length;M++)E[M]=""}}}}return aa(h)}catch{return c}}var Hi={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},th={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ha;function Ji(){}N(Ji,ua),Ji.prototype.g=function(){return new XMLHttpRequest},Ji.prototype.i=function(){return{}},ha=new Ji;function ke(o,c,h,m){this.j=o,this.i=c,this.l=h,this.R=m||1,this.U=new Mr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new eh}function eh(){this.i=null,this.g="",this.h=!1}var nh={},da={};function fa(o,c,h){o.L=1,o.v=ts(Ie(c)),o.m=h,o.P=!0,rh(o,null)}function rh(o,c){o.F=Date.now(),Yi(o),o.A=Ie(o.v);var h=o.A,m=o.R;Array.isArray(m)||(m=[String(m)]),_h(h.i,"t",m),o.C=0,h=o.j.J,o.h=new eh,o.g=Mh(o.j,h?c:null,!o.m),0<o.O&&(o.M=new Eg(_(o.Y,o,o.g),o.O)),c=o.U,h=o.g,m=o.ca;var E="readystatechange";Array.isArray(E)||(E&&($l[0]=E.toString()),E=$l);for(var C=0;C<E.length;C++){var M=ql(h,E[C],m||c.handleEvent,!1,c.h||c);if(!M)break;c.g[M.key]=M}c=o.H?g(o.H):{},o.m?(o.u||(o.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,c)):(o.u="GET",o.g.ea(o.A,o.u,null,c)),Fr(),Sg(o.i,o.u,o.A,o.l,o.R,o.m)}ke.prototype.ca=function(o){o=o.target;let c=this.M;c&&Te(o)==3?c.j():this.Y(o)},ke.prototype.Y=function(o){try{if(o==this.g)t:{let kt=Te(this.g);var c=this.g.Ba();let qn=this.g.Z();if(!(3>kt)&&(kt!=3||this.g&&(this.h.h||this.g.oa()||Ah(this.g)))){this.J||kt!=4||c==7||(c==8||0>=qn?Fr(3):Fr(2)),ma(this);var h=this.g.Z();this.X=h;e:if(ih(this)){var m=Ah(this.g);o="";var E=m.length,C=Te(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){an(this),Br(this);var M="";break e}this.h.i=new u.TextDecoder}for(c=0;c<E;c++)this.h.h=!0,o+=this.h.i.decode(m[c],{stream:!(C&&c==E-1)});m.length=0,this.h.g+=o,this.C=0,M=this.h.g}else M=this.g.oa();if(this.o=h==200,Cg(this.i,this.u,this.A,this.l,this.R,kt,h),this.o){if(this.T&&!this.K){e:{if(this.g){var it,Pt=this.g;if((it=Pt.g?Pt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!G(it)){var tt=it;break e}}tt=null}if(h=tt)On(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,pa(this,h);else{this.o=!1,this.s=3,Lt(12),an(this),Br(this);break t}}if(this.P){h=!0;let te;for(;!this.J&&this.C<M.length;)if(te=Rg(this,M),te==da){kt==4&&(this.s=4,Lt(14),h=!1),On(this.i,this.l,null,"[Incomplete Response]");break}else if(te==nh){this.s=4,Lt(15),On(this.i,this.l,M,"[Invalid Chunk]"),h=!1;break}else On(this.i,this.l,te,null),pa(this,te);if(ih(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),kt!=4||M.length!=0||this.h.h||(this.s=1,Lt(16),h=!1),this.o=this.o&&h,!h)On(this.i,this.l,M,"[Invalid Chunked Response]"),an(this),Br(this);else if(0<M.length&&!this.W){this.W=!0;var Nt=this.j;Nt.g==this&&Nt.ba&&!Nt.M&&(Nt.j.info("Great, no buffering proxy detected. Bytes received: "+M.length),Ia(Nt),Nt.M=!0,Lt(11))}}else On(this.i,this.l,M,null),pa(this,M);kt==4&&an(this),this.o&&!this.J&&(kt==4?Dh(this.j,this):(this.o=!1,Yi(this)))}else Qg(this.g),h==400&&0<M.indexOf("Unknown SID")?(this.s=3,Lt(12)):(this.s=0,Lt(13)),an(this),Br(this)}}}catch{}finally{}};function ih(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function Rg(o,c){var h=o.C,m=c.indexOf(`
`,h);return m==-1?da:(h=Number(c.substring(h,m)),isNaN(h)?nh:(m+=1,m+h>c.length?da:(c=c.slice(m,m+h),o.C=m+h,c)))}ke.prototype.cancel=function(){this.J=!0,an(this)};function Yi(o){o.S=Date.now()+o.I,sh(o,o.I)}function sh(o,c){if(o.B!=null)throw Error("WatchDog timer not null");o.B=Lr(_(o.ba,o),c)}function ma(o){o.B&&(u.clearTimeout(o.B),o.B=null)}ke.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(Pg(this.i,this.A),this.L!=2&&(Fr(),Lt(17)),an(this),this.s=2,Br(this)):sh(this,this.S-o)};function Br(o){o.j.G==0||o.J||Dh(o.j,o)}function an(o){ma(o);var c=o.M;c&&typeof c.ma=="function"&&c.ma(),o.M=null,Ql(o.U),o.g&&(c=o.g,o.g=null,c.abort(),c.ma())}function pa(o,c){try{var h=o.j;if(h.G!=0&&(h.g==o||ga(h.h,o))){if(!o.K&&ga(h.h,o)&&h.G==3){try{var m=h.Da.g.parse(c)}catch{m=null}if(Array.isArray(m)&&m.length==3){var E=m;if(E[0]==0){t:if(!h.u){if(h.g)if(h.g.F+3e3<o.F)ss(h),rs(h);else break t;wa(h),Lt(18)}}else h.za=E[1],0<h.za-h.T&&37500>E[2]&&h.F&&h.v==0&&!h.C&&(h.C=Lr(_(h.Za,h),6e3));if(1>=uh(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else cn(h,11)}else if((o.K||h.g==o)&&ss(h),!G(c))for(E=h.Da.g.parse(c),c=0;c<E.length;c++){let tt=E[c];if(h.T=tt[0],tt=tt[1],h.G==2)if(tt[0]=="c"){h.K=tt[1],h.ia=tt[2];let Nt=tt[3];Nt!=null&&(h.la=Nt,h.j.info("VER="+h.la));let kt=tt[4];kt!=null&&(h.Aa=kt,h.j.info("SVER="+h.Aa));let qn=tt[5];qn!=null&&typeof qn=="number"&&0<qn&&(m=1.5*qn,h.L=m,h.j.info("backChannelRequestTimeoutMs_="+m)),m=h;let te=o.g;if(te){let as=te.g?te.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(as){var C=m.h;C.g||as.indexOf("spdy")==-1&&as.indexOf("quic")==-1&&as.indexOf("h2")==-1||(C.j=C.l,C.g=new Set,C.h&&(_a(C,C.h),C.h=null))}if(m.D){let Ta=te.g?te.g.getResponseHeader("X-HTTP-Session-Id"):null;Ta&&(m.ya=Ta,at(m.I,m.D,Ta))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-o.F,h.j.info("Handshake RTT: "+h.R+"ms")),m=h;var M=o;if(m.qa=kh(m,m.J?m.ia:null,m.W),M.K){ch(m.h,M);var it=M,Pt=m.L;Pt&&(it.I=Pt),it.B&&(ma(it),Yi(it)),m.g=M}else xh(m);0<h.i.length&&is(h)}else tt[0]!="stop"&&tt[0]!="close"||cn(h,7);else h.G==3&&(tt[0]=="stop"||tt[0]=="close"?tt[0]=="stop"?cn(h,7):va(h):tt[0]!="noop"&&h.l&&h.l.ta(tt),h.v=0)}}Fr(4)}catch{}}var Dg=class{constructor(o,c){this.g=o,this.map=c}};function oh(o){this.l=o||10,u.PerformanceNavigationTiming?(o=u.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ah(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function uh(o){return o.h?1:o.g?o.g.size:0}function ga(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function _a(o,c){o.g?o.g.add(c):o.h=c}function ch(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}oh.prototype.cancel=function(){if(this.i=lh(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function lh(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let c=o.i;for(let h of o.g.values())c=c.concat(h.D);return c}return k(o.i)}function Vg(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(l(o)){for(var c=[],h=o.length,m=0;m<h;m++)c.push(o[m]);return c}c=[],h=0;for(m in o)c[h++]=o[m];return c}function Ng(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(l(o)||typeof o=="string"){var c=[];o=o.length;for(var h=0;h<o;h++)c.push(h);return c}c=[],h=0;for(let m in o)c[h++]=m;return c}}}function hh(o,c){if(o.forEach&&typeof o.forEach=="function")o.forEach(c,void 0);else if(l(o)||typeof o=="string")Array.prototype.forEach.call(o,c,void 0);else for(var h=Ng(o),m=Vg(o),E=m.length,C=0;C<E;C++)c.call(void 0,m[C],h&&h[C],o)}var dh=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function kg(o,c){if(o){o=o.split("&");for(var h=0;h<o.length;h++){var m=o[h].indexOf("="),E=null;if(0<=m){var C=o[h].substring(0,m);E=o[h].substring(m+1)}else C=o[h];c(C,E?decodeURIComponent(E.replace(/\+/g," ")):"")}}}function un(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof un){this.h=o.h,Xi(this,o.j),this.o=o.o,this.g=o.g,Zi(this,o.s),this.l=o.l;var c=o.i,h=new Gr;h.i=c.i,c.g&&(h.g=new Map(c.g),h.h=c.h),fh(this,h),this.m=o.m}else o&&(c=String(o).match(dh))?(this.h=!1,Xi(this,c[1]||"",!0),this.o=Ur(c[2]||""),this.g=Ur(c[3]||"",!0),Zi(this,c[4]),this.l=Ur(c[5]||"",!0),fh(this,c[6]||"",!0),this.m=Ur(c[7]||"")):(this.h=!1,this.i=new Gr(null,this.h))}un.prototype.toString=function(){var o=[],c=this.j;c&&o.push(jr(c,mh,!0),":");var h=this.g;return(h||c=="file")&&(o.push("//"),(c=this.o)&&o.push(jr(c,mh,!0),"@"),o.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&o.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(jr(h,h.charAt(0)=="/"?Fg:Og,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",jr(h,qg)),o.join("")};function Ie(o){return new un(o)}function Xi(o,c,h){o.j=h?Ur(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function Zi(o,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);o.s=c}else o.s=null}function fh(o,c,h){c instanceof Gr?(o.i=c,Bg(o.i,o.h)):(h||(c=jr(c,Lg)),o.i=new Gr(c,o.h))}function at(o,c,h){o.i.set(c,h)}function ts(o){return at(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function Ur(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function jr(o,c,h){return typeof o=="string"?(o=encodeURI(o).replace(c,Mg),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Mg(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var mh=/[#\/\?@]/g,Og=/[#\?:]/g,Fg=/[#\?]/g,Lg=/[#\?@]/g,qg=/#/g;function Gr(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function Me(o){o.g||(o.g=new Map,o.h=0,o.i&&kg(o.i,function(c,h){o.add(decodeURIComponent(c.replace(/\+/g," ")),h)}))}r=Gr.prototype,r.add=function(o,c){Me(this),this.i=null,o=Fn(this,o);var h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(c),this.h+=1,this};function ph(o,c){Me(o),c=Fn(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function gh(o,c){return Me(o),c=Fn(o,c),o.g.has(c)}r.forEach=function(o,c){Me(this),this.g.forEach(function(h,m){h.forEach(function(E){o.call(c,E,m,this)},this)},this)},r.na=function(){Me(this);let o=Array.from(this.g.values()),c=Array.from(this.g.keys()),h=[];for(let m=0;m<c.length;m++){let E=o[m];for(let C=0;C<E.length;C++)h.push(c[m])}return h},r.V=function(o){Me(this);let c=[];if(typeof o=="string")gh(this,o)&&(c=c.concat(this.g.get(Fn(this,o))));else{o=Array.from(this.g.values());for(let h=0;h<o.length;h++)c=c.concat(o[h])}return c},r.set=function(o,c){return Me(this),this.i=null,o=Fn(this,o),gh(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},r.get=function(o,c){return o?(o=this.V(o),0<o.length?String(o[0]):c):c};function _h(o,c,h){ph(o,c),0<h.length&&(o.i=null,o.g.set(Fn(o,c),k(h)),o.h+=h.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],c=Array.from(this.g.keys());for(var h=0;h<c.length;h++){var m=c[h];let C=encodeURIComponent(String(m)),M=this.V(m);for(m=0;m<M.length;m++){var E=C;M[m]!==""&&(E+="="+encodeURIComponent(String(M[m]))),o.push(E)}}return this.i=o.join("&")};function Fn(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function Bg(o,c){c&&!o.j&&(Me(o),o.i=null,o.g.forEach(function(h,m){var E=m.toLowerCase();m!=E&&(ph(this,m),_h(this,E,h))},o)),o.j=c}function Ug(o,c){let h=new qr;if(u.Image){let m=new Image;m.onload=b(Oe,h,"TestLoadImage: loaded",!0,c,m),m.onerror=b(Oe,h,"TestLoadImage: error",!1,c,m),m.onabort=b(Oe,h,"TestLoadImage: abort",!1,c,m),m.ontimeout=b(Oe,h,"TestLoadImage: timeout",!1,c,m),u.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else c(!1)}function jg(o,c){let h=new qr,m=new AbortController,E=setTimeout(()=>{m.abort(),Oe(h,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:m.signal}).then(C=>{clearTimeout(E),C.ok?Oe(h,"TestPingServer: ok",!0,c):Oe(h,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(E),Oe(h,"TestPingServer: error",!1,c)})}function Oe(o,c,h,m,E){try{E&&(E.onload=null,E.onerror=null,E.onabort=null,E.ontimeout=null),m(h)}catch{}}function Gg(){this.g=new bg}function zg(o,c,h){let m=h||"";try{hh(o,function(E,C){let M=E;d(E)&&(M=aa(E)),c.push(m+C+"="+encodeURIComponent(M))})}catch(E){throw c.push(m+"type="+encodeURIComponent("_badmap")),E}}function zr(o){this.l=o.Ub||null,this.j=o.eb||!1}N(zr,ua),zr.prototype.g=function(){return new es(this.l,this.j)},zr.prototype.i=function(o){return function(){return o}}({});function es(o,c){Vt.call(this),this.D=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}N(es,Vt),r=es.prototype,r.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=c,this.readyState=1,$r(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(c.body=o),(this.D||u).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Kr(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,$r(this)),this.g&&(this.readyState=3,$r(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;yh(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function yh(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?Kr(this):$r(this),this.readyState==3&&yh(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,Kr(this))},r.Qa=function(o){this.g&&(this.response=o,Kr(this))},r.ga=function(){this.g&&Kr(this)};function Kr(o){o.readyState=4,o.l=null,o.j=null,o.v=null,$r(o)}r.setRequestHeader=function(o,c){this.u.append(o,c)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],c=this.h.entries();for(var h=c.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=c.next();return o.join(`\r
`)};function $r(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(es.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function vh(o){let c="";return K(o,function(h,m){c+=m,c+=":",c+=h,c+=`\r
`}),c}function ya(o,c,h){t:{for(m in h){var m=!1;break t}m=!0}m||(h=vh(h),typeof o=="string"?h!=null&&encodeURIComponent(String(h)):at(o,c,h))}function dt(o){Vt.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}N(dt,Vt);var Kg=/^https?$/i,$g=["POST","PUT"];r=dt.prototype,r.Ha=function(o){this.J=o},r.ea=function(o,c,h,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ha.g(),this.v=this.o?Wl(this.o):Wl(ha),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(C){wh(this,C);return}if(o=h||"",h=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var E in m)h.set(E,m[E]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let C of m.keys())h.set(C,m.get(C));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(h.keys()).find(C=>C.toLowerCase()=="content-type"),E=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call($g,c,void 0))||m||E||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[C,M]of h)this.g.setRequestHeader(C,M);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Eh(this),this.u=!0,this.g.send(o),this.u=!1}catch(C){wh(this,C)}};function wh(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.m=5,Ih(o),ns(o)}function Ih(o){o.A||(o.A=!0,Ft(o,"complete"),Ft(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Ft(this,"complete"),Ft(this,"abort"),ns(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ns(this,!0)),dt.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Th(this):this.bb())},r.bb=function(){Th(this)};function Th(o){if(o.h&&typeof a<"u"&&(!o.v[1]||Te(o)!=4||o.Z()!=2)){if(o.u&&Te(o)==4)zl(o.Ea,0,o);else if(Ft(o,"readystatechange"),Te(o)==4){o.h=!1;try{let M=o.Z();t:switch(M){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break t;default:c=!1}var h;if(!(h=c)){var m;if(m=M===0){var E=String(o.D).match(dh)[1]||null;!E&&u.self&&u.self.location&&(E=u.self.location.protocol.slice(0,-1)),m=!Kg.test(E?E.toLowerCase():"")}h=m}if(h)Ft(o,"complete"),Ft(o,"success");else{o.m=6;try{var C=2<Te(o)?o.g.statusText:""}catch{C=""}o.l=C+" ["+o.Z()+"]",Ih(o)}}finally{ns(o)}}}}function ns(o,c){if(o.g){Eh(o);let h=o.g,m=o.v[0]?()=>{}:null;o.g=null,o.v=null,c||Ft(o,"ready");try{h.onreadystatechange=m}catch{}}}function Eh(o){o.I&&(u.clearTimeout(o.I),o.I=null)}r.isActive=function(){return!!this.g};function Te(o){return o.g?o.g.readyState:0}r.Z=function(){try{return 2<Te(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),Ag(c)}};function Ah(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Qg(o){let c={};o=(o.g&&2<=Te(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<o.length;m++){if(G(o[m]))continue;var h=T(o[m]);let E=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let C=c[E]||[];c[E]=C,C.push(h)}w(c,function(m){return m.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Qr(o,c,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||c}function bh(o){this.Aa=0,this.i=[],this.j=new qr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Qr("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Qr("baseRetryDelayMs",5e3,o),this.cb=Qr("retryDelaySeedMs",1e4,o),this.Wa=Qr("forwardChannelMaxRetries",2,o),this.wa=Qr("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new oh(o&&o.concurrentRequestLimit),this.Da=new Gg,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=bh.prototype,r.la=8,r.G=1,r.connect=function(o,c,h,m){Lt(0),this.W=o,this.H=c||{},h&&m!==void 0&&(this.H.OSID=h,this.H.OAID=m),this.F=this.X,this.I=kh(this,null,this.W),is(this)};function va(o){if(Sh(o),o.G==3){var c=o.U++,h=Ie(o.I);if(at(h,"SID",o.K),at(h,"RID",c),at(h,"TYPE","terminate"),Wr(o,h),c=new ke(o,o.j,c),c.L=2,c.v=ts(Ie(h)),h=!1,u.navigator&&u.navigator.sendBeacon)try{h=u.navigator.sendBeacon(c.v.toString(),"")}catch{}!h&&u.Image&&(new Image().src=c.v,h=!0),h||(c.g=Mh(c.j,null),c.g.ea(c.v)),c.F=Date.now(),Yi(c)}Nh(o)}function rs(o){o.g&&(Ia(o),o.g.cancel(),o.g=null)}function Sh(o){rs(o),o.u&&(u.clearTimeout(o.u),o.u=null),ss(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&u.clearTimeout(o.s),o.s=null)}function is(o){if(!ah(o.h)&&!o.s){o.s=!0;var c=o.Ga;Dr||Ll(),Vr||(Dr(),Vr=!0),Xo.add(c,o),o.B=0}}function Wg(o,c){return uh(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=c.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=Lr(_(o.Ga,o,c),Vh(o,o.B)),o.B++,!0)}r.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let E=new ke(this,this.j,o),C=this.o;if(this.S&&(C?(C=g(C),I(C,this.S)):C=this.S),this.m!==null||this.O||(E.H=C,C=null),this.P)t:{for(var c=0,h=0;h<this.i.length;h++){e:{var m=this.i[h];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break e}m=void 0}if(m===void 0)break;if(c+=m,4096<c){c=h;break t}if(c===4096||h===this.i.length-1){c=h+1;break t}}c=1e3}else c=1e3;c=Ph(this,E,c),h=Ie(this.I),at(h,"RID",o),at(h,"CVER",22),this.D&&at(h,"X-HTTP-Session-Id",this.D),Wr(this,h),C&&(this.O?c="headers="+encodeURIComponent(String(vh(C)))+"&"+c:this.m&&ya(h,this.m,C)),_a(this.h,E),this.Ua&&at(h,"TYPE","init"),this.P?(at(h,"$req",c),at(h,"SID","null"),E.T=!0,fa(E,h,null)):fa(E,h,c),this.G=2}}else this.G==3&&(o?Ch(this,o):this.i.length==0||ah(this.h)||Ch(this))};function Ch(o,c){var h;c?h=c.l:h=o.U++;let m=Ie(o.I);at(m,"SID",o.K),at(m,"RID",h),at(m,"AID",o.T),Wr(o,m),o.m&&o.o&&ya(m,o.m,o.o),h=new ke(o,o.j,h,o.B+1),o.m===null&&(h.H=o.o),c&&(o.i=c.D.concat(o.i)),c=Ph(o,h,1e3),h.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),_a(o.h,h),fa(h,m,c)}function Wr(o,c){o.H&&K(o.H,function(h,m){at(c,m,h)}),o.l&&hh({},function(h,m){at(c,m,h)})}function Ph(o,c,h){h=Math.min(o.i.length,h);var m=o.l?_(o.l.Na,o.l,o):null;t:{var E=o.i;let C=-1;for(;;){let M=["count="+h];C==-1?0<h?(C=E[0].g,M.push("ofs="+C)):C=0:M.push("ofs="+C);let it=!0;for(let Pt=0;Pt<h;Pt++){let tt=E[Pt].g,Nt=E[Pt].map;if(tt-=C,0>tt)C=Math.max(0,E[Pt].g-100),it=!1;else try{zg(Nt,M,"req"+tt+"_")}catch{m&&m(Nt)}}if(it){m=M.join("&");break t}}}return o=o.i.splice(0,h),c.D=o,m}function xh(o){if(!o.g&&!o.u){o.Y=1;var c=o.Fa;Dr||Ll(),Vr||(Dr(),Vr=!0),Xo.add(c,o),o.v=0}}function wa(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=Lr(_(o.Fa,o),Vh(o,o.v)),o.v++,!0)}r.Fa=function(){if(this.u=null,Rh(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=Lr(_(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Lt(10),rs(this),Rh(this))};function Ia(o){o.A!=null&&(u.clearTimeout(o.A),o.A=null)}function Rh(o){o.g=new ke(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var c=Ie(o.qa);at(c,"RID","rpc"),at(c,"SID",o.K),at(c,"AID",o.T),at(c,"CI",o.F?"0":"1"),!o.F&&o.ja&&at(c,"TO",o.ja),at(c,"TYPE","xmlhttp"),Wr(o,c),o.m&&o.o&&ya(c,o.m,o.o),o.L&&(o.g.I=o.L);var h=o.g;o=o.ia,h.L=1,h.v=ts(Ie(c)),h.m=null,h.P=!0,rh(h,o)}r.Za=function(){this.C!=null&&(this.C=null,rs(this),wa(this),Lt(19))};function ss(o){o.C!=null&&(u.clearTimeout(o.C),o.C=null)}function Dh(o,c){var h=null;if(o.g==c){ss(o),Ia(o),o.g=null;var m=2}else if(ga(o.h,c))h=c.D,ch(o.h,c),m=1;else return;if(o.G!=0){if(c.o)if(m==1){h=c.m?c.m.length:0,c=Date.now()-c.F;var E=o.B;m=Wi(),Ft(m,new Zl(m,h)),is(o)}else xh(o);else if(E=c.s,E==3||E==0&&0<c.X||!(m==1&&Wg(o,c)||m==2&&wa(o)))switch(h&&0<h.length&&(c=o.h,c.i=c.i.concat(h)),E){case 1:cn(o,5);break;case 4:cn(o,10);break;case 3:cn(o,6);break;default:cn(o,2)}}}function Vh(o,c){let h=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(h*=2),h*c}function cn(o,c){if(o.j.info("Error code "+c),c==2){var h=_(o.fb,o),m=o.Xa;let E=!m;m=new un(m||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||Xi(m,"https"),ts(m),E?Ug(m.toString(),h):jg(m.toString(),h)}else Lt(2);o.G=0,o.l&&o.l.sa(c),Nh(o),Sh(o)}r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Lt(2)):(this.j.info("Failed to ping google.com"),Lt(1))};function Nh(o){if(o.G=0,o.ka=[],o.l){let c=lh(o.h);(c.length!=0||o.i.length!=0)&&(V(o.ka,c),V(o.ka,o.i),o.h.i.length=0,k(o.i),o.i.length=0),o.l.ra()}}function kh(o,c,h){var m=h instanceof un?Ie(h):new un(h);if(m.g!="")c&&(m.g=c+"."+m.g),Zi(m,m.s);else{var E=u.location;m=E.protocol,c=c?c+"."+E.hostname:E.hostname,E=+E.port;var C=new un(null);m&&Xi(C,m),c&&(C.g=c),E&&Zi(C,E),h&&(C.l=h),m=C}return h=o.D,c=o.ya,h&&c&&at(m,h,c),at(m,"VER",o.la),Wr(o,m),m}function Mh(o,c,h){if(c&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Ca&&!o.pa?new dt(new zr({eb:h})):new dt(o.pa),c.Ha(o.J),c}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Oh(){}r=Oh.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function os(){}os.prototype.g=function(o,c){return new Kt(o,c)};function Kt(o,c){Vt.call(this),this.g=new bh(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(o?o["X-WebChannel-Client-Profile"]=c.va:o={"X-WebChannel-Client-Profile":c.va}),this.g.S=o,(o=c&&c.Sb)&&!G(o)&&(this.g.m=o),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!G(c)&&(this.g.D=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new Ln(this)}N(Kt,Vt),Kt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Kt.prototype.close=function(){va(this.g)},Kt.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.u&&(h={},h.__data__=aa(o),o=h);c.i.push(new Dg(c.Ya++,o)),c.G==3&&is(c)},Kt.prototype.N=function(){this.g.l=null,delete this.j,va(this.g),delete this.g,Kt.aa.N.call(this)};function Fh(o){ca.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){t:{for(let h in c){o=h;break t}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}N(Fh,ca);function Lh(){la.call(this),this.status=1}N(Lh,la);function Ln(o){this.g=o}N(Ln,Oh),Ln.prototype.ua=function(){Ft(this.g,"a")},Ln.prototype.ta=function(o){Ft(this.g,new Fh(o))},Ln.prototype.sa=function(o){Ft(this.g,new Lh)},Ln.prototype.ra=function(){Ft(this.g,"b")},os.prototype.createWebChannel=os.prototype.g,Kt.prototype.send=Kt.prototype.o,Kt.prototype.open=Kt.prototype.m,Kt.prototype.close=Kt.prototype.close,Oa=Ae.createWebChannelTransport=function(){return new os},Ma=Ae.getStatEventTarget=function(){return Wi()},ka=Ae.Event=on,ws=Ae.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Hi.NO_ERROR=0,Hi.TIMEOUT=8,Hi.HTTP_ERROR=6,ri=Ae.ErrorCode=Hi,th.COMPLETE="complete",Na=Ae.EventType=th,Hl.EventType=Or,Or.OPEN="a",Or.CLOSE="b",Or.ERROR="c",Or.MESSAGE="d",Vt.prototype.listen=Vt.prototype.K,Gn=Ae.WebChannel=Hl,Hg=Ae.FetchXmlHttpFactory=zr,dt.prototype.listenOnce=dt.prototype.L,dt.prototype.getLastError=dt.prototype.Ka,dt.prototype.getLastErrorCode=dt.prototype.Ba,dt.prototype.getStatus=dt.prototype.Z,dt.prototype.getResponseJson=dt.prototype.Oa,dt.prototype.getResponseText=dt.prototype.oa,dt.prototype.send=dt.prototype.ea,dt.prototype.setWithCredentials=dt.prototype.Ha,Va=Ae.XhrIo=dt}).apply(typeof vs<"u"?vs:typeof self<"u"?self:typeof window<"u"?window:{});var kd="@firebase/firestore";var Tt=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};Tt.UNAUTHENTICATED=new Tt(null),Tt.GOOGLE_CREDENTIALS=new Tt("google-credentials-uid"),Tt.FIRST_PARTY=new Tt("first-party-uid"),Tt.MOCK_USER=new Tt("mock-user");var wr="10.14.0";var Ke=new hd("@firebase/firestore");function Wn(){return Ke.logLevel}function Lf(r){Ke.setLogLevel(r)}function D(r,...t){if(Ke.logLevel<=ce.DEBUG){let e=t.map(Uc);Ke.debug(`Firestore (${wr}): ${r}`,...e)}}function gt(r,...t){if(Ke.logLevel<=ce.ERROR){let e=t.map(Uc);Ke.error(`Firestore (${wr}): ${r}`,...e)}}function ne(r,...t){if(Ke.logLevel<=ce.WARN){let e=t.map(Uc);Ke.warn(`Firestore (${wr}): ${r}`,...e)}}function Uc(r){if(typeof r=="string")return r;try{return function(e){return JSON.stringify(e)}(r)}catch{return r}}function L(r="Unexpected state"){let t=`FIRESTORE (${wr}) INTERNAL ASSERTION FAILED: `+r;throw gt(t),new Error(t)}function q(r,t){r||L()}function qf(r,t){r||L()}function O(r,t){return r}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},R=class extends ld{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var bt=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var Rs=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},ja=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(Tt.UNAUTHENTICATED))}shutdown(){}},Ga=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},za=class{constructor(t){this.t=t,this.currentUser=Tt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){q(this.o===void 0);let n=this.i,i=l=>this.i!==n?(n=this.i,e(l)):Promise.resolve(),s=new bt;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new bt,t.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let l=s;t.enqueueRetryable(()=>x(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},u=l=>{D("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>u(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?u(l):(D("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new bt)}},0),a()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(n=>this.i!==t?(D("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(q(typeof n.accessToken=="string"),new Rs(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return q(t===null||typeof t=="string"),new Tt(t)}},Ka=class{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=Tt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},$a=class{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new Ka(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(Tt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Qa=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Wa=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){q(this.o===void 0);let n=s=>{s.error!=null&&D("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.R;return this.R=s.token,D("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>n(s))};let i=s=>{D("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):D("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(q(typeof e.token=="string"),this.R=e.token,new Qa(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function Jg(r){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}var Ds=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";for(;n.length<20;){let i=Jg(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<e&&(n+=t.charAt(i[s]%t.length))}return n}};function z(r,t){return r<t?-1:r>t?1:0}function rr(r,t,e){return r.length===t.length&&r.every((n,i)=>e(n,t[i]))}function Bf(r){return r+"\0"}var lt=class r{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new R(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new R(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new R(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new R(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return r.fromMillis(Date.now())}static fromDate(t){return r.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new r(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?z(this.nanoseconds,t.nanoseconds):z(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var U=class r{constructor(t){this.timestamp=t}static fromTimestamp(t){return new r(t)}static min(){return new r(new lt(0,0))}static max(){return new r(new lt(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Vs=class r{constructor(t,e,n){e===void 0?e=0:e>t.length&&L(),n===void 0?n=t.length-e:n>t.length-e&&L(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return r.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof r?t.forEach(n=>{e.push(n)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let n=Math.min(t.length,e.length);for(let i=0;i<n;i++){let s=t.get(i),a=e.get(i);if(s<a)return-1;if(s>a)return 1}return t.length<e.length?-1:t.length>e.length?1:0}},Y=class r extends Vs{construct(t,e,n){return new r(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let n of t){if(n.indexOf("//")>=0)throw new R(P.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(i=>i.length>0))}return new r(e)}static emptyPath(){return new r([])}},Yg=/^[_a-zA-Z][_a-zA-Z0-9]*$/,_t=class r extends Vs{construct(t,e,n){return new r(t,e,n)}static isValidIdentifier(t){return Yg.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new r(["__name__"])}static fromServerFormat(t){let e=[],n="",i=0,s=()=>{if(n.length===0)throw new R(P.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""},a=!1;for(;i<t.length;){let u=t[i];if(u==="\\"){if(i+1===t.length)throw new R(P.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let l=t[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new R(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=l,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(n+=u,i++):(s(),i++)}if(s(),a)throw new R(P.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new r(e)}static emptyPath(){return new r([])}};var F=class r{constructor(t){this.path=t}static fromPath(t){return new r(Y.fromString(t))}static fromName(t){return new r(Y.fromString(t).popFirst(5))}static empty(){return new r(Y.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Y.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return Y.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new r(new Y(t.slice()))}};var ir=class{constructor(t,e,n,i){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=i}};function Ha(r){return r.fields.find(t=>t.kind===2)}function hn(r){return r.fields.filter(t=>t.kind!==2)}ir.UNKNOWN_ID=-1;var tr=class{constructor(t,e){this.fieldPath=t,this.kind=e}};var pi=class r{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new r(0,Xt.min())}};function Uf(r,t){let e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=U.fromTimestamp(n===1e9?new lt(e+1,0):new lt(e,n));return new Xt(i,F.empty(),t)}function jf(r){return new Xt(r.readTime,r.key,-1)}var Xt=class r{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new r(U.min(),F.empty(),-1)}static max(){return new r(U.max(),F.empty(),-1)}};function jc(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=F.comparator(r.documentKey,t.documentKey),e!==0?e:z(r.largestBatchId,t.largestBatchId))}var Gf="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ns=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function en(r){return x(this,null,function*(){if(r.code!==P.FAILED_PRECONDITION||r.message!==Gf)throw r;D("LocalStore","Unexpectedly lost primary lease")})}var S=class r{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&L(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new r((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(e,s).next(n,i)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof r?e:r.resolve(e)}catch(e){return r.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):r.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):r.reject(e)}static resolve(t){return new r((e,n)=>{e(t)})}static reject(t){return new r((e,n)=>{n(t)})}static waitFor(t){return new r((e,n)=>{let i=0,s=0,a=!1;t.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&e()},l=>n(l))}),a=!0,s===i&&e()})}static or(t){let e=r.resolve(!1);for(let n of t)e=e.next(i=>i?r.resolve(i):n());return e}static forEach(t,e){let n=[];return t.forEach((i,s)=>{n.push(e.call(this,i,s))}),this.waitFor(n)}static mapArray(t,e){return new r((n,i)=>{let s=t.length,a=new Array(s),u=0;for(let l=0;l<s;l++){let d=l;e(t[d]).next(f=>{a[d]=f,++u,u===s&&n(a)},f=>i(f))}})}static doWhile(t,e){return new r((n,i)=>{let s=()=>{t()===!0?e().next(()=>{s()},i):n()};s()})}};var ks=class r{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new bt,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new _n(t,e.error)):this.V.resolve()},this.transaction.onerror=n=>{let i=Gc(n.target.error);this.V.reject(new _n(t,i))}}static open(t,e,n,i){try{return new r(e,t.transaction(i,n))}catch(s){throw new _n(e,s)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(D("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new Ya(e)}},$e=class r{constructor(t,e,n){this.name=t,this.version=e,this.p=n,r.S(ti())===12.2&&gt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return D("SimpleDb","Removing database:",t),dn(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!cd())return!1;if(r.v())return!0;let t=ti(),e=r.S(t),n=0<e&&e<10,i=zf(t),s=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)}static v(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.C)==="YES"}static F(t,e){return t.store(e)}static S(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(t){return x(this,null,function*(){return this.db||(D("SimpleDb","Opening database:",this.name),this.db=yield new Promise((e,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let a=s.target.result;e(a)},i.onblocked=()=>{n(new _n(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let a=s.target.error;a.name==="VersionError"?n(new R(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new R(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new _n(t,a))},i.onupgradeneeded=s=>{D("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let a=s.target.result;this.p.O(a,i.transaction,s.oldVersion,this.version).next(()=>{D("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=e=>this.N(e)),this.db})}L(t){this.N=t,this.db&&(this.db.onversionchange=e=>t(e))}runTransaction(t,e,n,i){return x(this,null,function*(){let s=e==="readonly",a=0;for(;;){++a;try{this.db=yield this.M(t);let u=ks.open(this.db,t,s?"readonly":"readwrite",n),l=i(u).next(d=>(u.g(),d)).catch(d=>(u.abort(d),S.reject(d))).toPromise();return l.catch(()=>{}),yield u.m,l}catch(u){let l=u,d=l.name!=="FirebaseError"&&a<3;if(D("SimpleDb","Transaction failed with error:",l.message,"Retrying:",d),this.close(),!d)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function zf(r){let t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}var Ja=class{constructor(t){this.B=t,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(t){this.B=t}done(){this.k=!0}$(t){this.q=t}delete(){return dn(this.B.delete())}},_n=class extends R{constructor(t,e){super(P.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function nn(r){return r.name==="IndexedDbTransactionError"}var Ya=class{constructor(t){this.store=t}put(t,e){let n;return e!==void 0?(D("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(D("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),dn(n)}add(t){return D("SimpleDb","ADD",this.store.name,t,t),dn(this.store.add(t))}get(t){return dn(this.store.get(t)).next(e=>(e===void 0&&(e=null),D("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return D("SimpleDb","DELETE",this.store.name,t),dn(this.store.delete(t))}count(){return D("SimpleDb","COUNT",this.store.name),dn(this.store.count())}U(t,e){let n=this.options(t,e),i=n.index?this.store.index(n.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(n.range);return new S((a,u)=>{s.onerror=l=>{u(l.target.error)},s.onsuccess=l=>{a(l.target.result)}})}{let s=this.cursor(n),a=[];return this.W(s,(u,l)=>{a.push(l)}).next(()=>a)}}G(t,e){let n=this.store.getAll(t,e===null?void 0:e);return new S((i,s)=>{n.onerror=a=>{s(a.target.error)},n.onsuccess=a=>{i(a.target.result)}})}j(t,e){D("SimpleDb","DELETE ALL",this.store.name);let n=this.options(t,e);n.H=!1;let i=this.cursor(n);return this.W(i,(s,a,u)=>u.delete())}J(t,e){let n;e?n=t:(n={},e=t);let i=this.cursor(n);return this.W(i,e)}Y(t){let e=this.cursor({});return new S((n,i)=>{e.onerror=s=>{let a=Gc(s.target.error);i(a)},e.onsuccess=s=>{let a=s.target.result;a?t(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}W(t,e){let n=[];return new S((i,s)=>{t.onerror=a=>{s(a.target.error)},t.onsuccess=a=>{let u=a.target.result;if(!u)return void i();let l=new Ja(u),d=e(u.primaryKey,u.value,l);if(d instanceof S){let f=d.catch(p=>(l.done(),S.reject(p)));n.push(f)}l.isDone?i():l.K===null?u.continue():u.continue(l.K)}}).next(()=>S.waitFor(n))}options(t,e){let n;return t!==void 0&&(typeof t=="string"?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let n=this.store.index(t.index);return t.H?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function dn(r){return new S((t,e)=>{r.onsuccess=n=>{let i=n.target.result;t(i)},r.onerror=n=>{let i=Gc(n.target.error);e(i)}})}var Md=!1;function Gc(r){let t=$e.S(ti());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(e)>=0){let n=new R("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Md||(Md=!0,setTimeout(()=>{throw n},0)),n}}return r}var Xa=class{constructor(t,e){this.asyncQueue=t,this.Z=e,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(t){D("IndexBackfiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,()=>x(this,null,function*(){this.task=null;try{D("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(e){nn(e)?D("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):yield en(e)}yield this.X(6e4)}))}},Za=class{constructor(t,e){this.localStore=t,this.persistence=e}ee(t=50){return x(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.te(e,t))})}te(t,e){let n=new Set,i=e,s=!0;return S.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(a=>{if(a!==null&&!n.has(a))return D("IndexBackfiller",`Processing collection: ${a}`),this.ne(t,a,i).next(u=>{i-=u,n.add(a)});s=!1})).next(()=>e-i)}ne(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(i=>this.localStore.localDocuments.getNextDocuments(t,e,i,n).next(s=>{let a=s.changes;return this.localStore.indexManager.updateIndexEntries(t,a).next(()=>this.re(i,s)).next(u=>(D("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(t,e,u))).next(()=>a.size)}))}re(t,e){let n=t;return e.changes.forEach((i,s)=>{let a=jf(s);jc(a,n)>0&&(n=a)}),new Xt(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}};var Qt=(()=>{class r{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.se&&this.se(e),e}}return r.oe=-1,r})();function Oi(r){return r==null}function gi(r){return r===0&&1/r==-1/0}function Kf(r){return typeof r=="number"&&Number.isInteger(r)&&!gi(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function Bt(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=Od(t)),t=Xg(r.get(e),t);return Od(t)}function Xg(r,t){let e=t,n=r.length;for(let i=0;i<n;i++){let s=r.charAt(i);switch(s){case"\0":e+="";break;case"":e+="";break;default:e+=s}}return e}function Od(r){return r+""}function le(r){let t=r.length;if(q(t>=2),t===2)return q(r.charAt(0)===""&&r.charAt(1)===""),Y.emptyPath();let e=t-2,n=[],i="";for(let s=0;s<t;){let a=r.indexOf("",s);switch((a<0||a>e)&&L(),r.charAt(a+1)){case"":let u=r.substring(s,a),l;i.length===0?l=u:(i+=u,l=i,i=""),n.push(l);break;case"":i+=r.substring(s,a),i+="\0";break;case"":i+=r.substring(s,a+1);break;default:L()}s=a+2}return new Y(n)}var Fd=["userId","batchId"];function bs(r,t){return[r,Bt(t)]}function $f(r,t,e){return[r,Bt(t),e]}var Zg={},t_=["prefixPath","collectionGroup","readTime","documentId"],e_=["prefixPath","collectionGroup","documentId"],n_=["collectionGroup","readTime","prefixPath","documentId"],r_=["canonicalId","targetId"],i_=["targetId","path"],s_=["path","targetId"],o_=["collectionId","parent"],a_=["indexId","uid"],u_=["uid","sequenceNumber"],c_=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],l_=["indexId","uid","orderedDocumentKey"],h_=["userId","collectionPath","documentId"],d_=["userId","collectionPath","largestBatchId"],f_=["userId","collectionGroup","largestBatchId"],Qf=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],m_=[...Qf,"documentOverlays"],Wf=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Hf=Wf,zc=[...Hf,"indexConfiguration","indexState","indexEntries"],p_=zc,g_=[...zc,"globals"];var _i=class extends Ns{constructor(t,e){super(),this._e=t,this.currentSequenceNumber=e}};function St(r,t){let e=O(r);return $e.F(e._e,t)}function Ld(r){let t=0;for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function xn(r,t){for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function Jf(r){for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}var ut=class r{constructor(t,e){this.comparator=t,this.root=e||de.EMPTY}insert(t,e){return new r(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,de.BLACK,null,null))}remove(t){return new r(this.comparator,this.root.remove(t,this.comparator).copy(null,null,de.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(t,n.key);if(i===0)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){let t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Zn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Zn(this.root,t,this.comparator,!1)}getReverseIterator(){return new Zn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Zn(this.root,t,this.comparator,!0)}},Zn=class{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},de=class r{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=n??r.RED,this.left=i??r.EMPTY,this.right=s??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,s){return new r(t??this.key,e??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this,s=n(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):s===0?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),e(t,i.key)===0){if(i.right.isEmpty())return r.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw L();let t=this.left.check();if(t!==this.right.check())throw L();return t+(this.isRed()?0:1)}};de.EMPTY=null,de.RED=!0,de.BLACK=!1;de.EMPTY=new class{constructor(){this.size=0}get key(){throw L()}get value(){throw L()}get color(){throw L()}get left(){throw L()}get right(){throw L()}copy(t,e,n,i,s){return this}insert(t,e,n){return new de(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var st=class r{constructor(t){this.comparator=t,this.data=new ut(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){let n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Ms(this.data.getIterator())}getIteratorFrom(t){return new Ms(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(n=>{e=e.add(n)}),e}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new r(this.comparator);return e.data=t,e}},Ms=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function zn(r){return r.hasNext()?r.getNext():void 0}var Wt=class r{constructor(t){this.fields=t,t.sort(_t.comparator)}static empty(){return new r([])}unionWith(t){let e=new st(_t.comparator);for(let n of this.fields)e=e.add(n);for(let n of t)e=e.add(n);return new r(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return rr(this.fields,t.fields,(e,n)=>e.isEqual(n))}};var Os=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function Yf(){return typeof atob<"u"}var vt=class r{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Os("Invalid base64 string: "+s):s}}(t);return new r(e)}static fromUint8Array(t){let e=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(t);return new r(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let n=new Uint8Array(e.length);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return z(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};vt.EMPTY_BYTE_STRING=new vt("");var __=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ce(r){if(q(!!r),typeof r=="string"){let t=0,e=__.exec(r);if(q(!!e),e[1]){let i=e[1];i=(i+"000000000").substr(0,9),t=Number(i)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:ct(r.seconds),nanos:ct(r.nanos)}}function ct(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Qe(r){return typeof r=="string"?vt.fromBase64String(r):vt.fromUint8Array(r)}function Po(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function Kc(r){let t=r.mapValue.fields.__previous_value__;return Po(t)?Kc(t):t}function yi(r){let t=Ce(r.mapValue.fields.__local_write_time__.timestampValue);return new lt(t.seconds,t.nanos)}var tu=class{constructor(t,e,n,i,s,a,u,l,d){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=l,this.useFetchStreams=d}},We=class r{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new r("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof r&&t.projectId===this.projectId&&t.database===this.database}};var Ge={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ss={nullValue:"NULL_VALUE"};function yn(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Po(r)?4:Xf(r)?9007199254740991:xo(r)?10:11:L()}function pe(r,t){if(r===t)return!0;let e=yn(r);if(e!==yn(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return yi(r).isEqual(yi(t));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let a=Ce(i.timestampValue),u=Ce(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(i,s){return Qe(i.bytesValue).isEqual(Qe(s.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(i,s){return ct(i.geoPointValue.latitude)===ct(s.geoPointValue.latitude)&&ct(i.geoPointValue.longitude)===ct(s.geoPointValue.longitude)}(r,t);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ct(i.integerValue)===ct(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let a=ct(i.doubleValue),u=ct(s.doubleValue);return a===u?gi(a)===gi(u):isNaN(a)&&isNaN(u)}return!1}(r,t);case 9:return rr(r.arrayValue.values||[],t.arrayValue.values||[],pe);case 10:case 11:return function(i,s){let a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(Ld(a)!==Ld(u))return!1;for(let l in a)if(a.hasOwnProperty(l)&&(u[l]===void 0||!pe(a[l],u[l])))return!1;return!0}(r,t);default:return L()}}function vi(r,t){return(r.values||[]).find(e=>pe(e,t))!==void 0}function He(r,t){if(r===t)return 0;let e=yn(r),n=yn(t);if(e!==n)return z(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return z(r.booleanValue,t.booleanValue);case 2:return function(s,a){let u=ct(s.integerValue||s.doubleValue),l=ct(a.integerValue||a.doubleValue);return u<l?-1:u>l?1:u===l?0:isNaN(u)?isNaN(l)?0:-1:1}(r,t);case 3:return qd(r.timestampValue,t.timestampValue);case 4:return qd(yi(r),yi(t));case 5:return z(r.stringValue,t.stringValue);case 6:return function(s,a){let u=Qe(s),l=Qe(a);return u.compareTo(l)}(r.bytesValue,t.bytesValue);case 7:return function(s,a){let u=s.split("/"),l=a.split("/");for(let d=0;d<u.length&&d<l.length;d++){let f=z(u[d],l[d]);if(f!==0)return f}return z(u.length,l.length)}(r.referenceValue,t.referenceValue);case 8:return function(s,a){let u=z(ct(s.latitude),ct(a.latitude));return u!==0?u:z(ct(s.longitude),ct(a.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return Bd(r.arrayValue,t.arrayValue);case 10:return function(s,a){var u,l,d,f;let p=s.fields||{},_=a.fields||{},b=(u=p.value)===null||u===void 0?void 0:u.arrayValue,N=(l=_.value)===null||l===void 0?void 0:l.arrayValue,k=z(((d=b?.values)===null||d===void 0?void 0:d.length)||0,((f=N?.values)===null||f===void 0?void 0:f.length)||0);return k!==0?k:Bd(b,N)}(r.mapValue,t.mapValue);case 11:return function(s,a){if(s===Ge.mapValue&&a===Ge.mapValue)return 0;if(s===Ge.mapValue)return 1;if(a===Ge.mapValue)return-1;let u=s.fields||{},l=Object.keys(u),d=a.fields||{},f=Object.keys(d);l.sort(),f.sort();for(let p=0;p<l.length&&p<f.length;++p){let _=z(l[p],f[p]);if(_!==0)return _;let b=He(u[l[p]],d[f[p]]);if(b!==0)return b}return z(l.length,f.length)}(r.mapValue,t.mapValue);default:throw L()}}function qd(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return z(r,t);let e=Ce(r),n=Ce(t),i=z(e.seconds,n.seconds);return i!==0?i:z(e.nanos,n.nanos)}function Bd(r,t){let e=r.values||[],n=t.values||[];for(let i=0;i<e.length&&i<n.length;++i){let s=He(e[i],n[i]);if(s)return s}return z(e.length,n.length)}function sr(r){return eu(r)}function eu(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(e){let n=Ce(e);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(e){return Qe(e).toBase64()}(r.bytesValue):"referenceValue"in r?function(e){return F.fromName(e).toString()}(r.referenceValue):"geoPointValue"in r?function(e){return`geo(${e.latitude},${e.longitude})`}(r.geoPointValue):"arrayValue"in r?function(e){let n="[",i=!0;for(let s of e.values||[])i?i=!1:n+=",",n+=eu(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(e){let n=Object.keys(e.fields||{}).sort(),i="{",s=!0;for(let a of n)s?s=!1:i+=",",i+=`${a}:${eu(e.fields[a])}`;return i+"}"}(r.mapValue):L()}function vn(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function nu(r){return!!r&&"integerValue"in r}function wi(r){return!!r&&"arrayValue"in r}function Ud(r){return!!r&&"nullValue"in r}function jd(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Cs(r){return!!r&&"mapValue"in r}function xo(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="__vector__"}function li(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let t={mapValue:{fields:{}}};return xn(r.mapValue.fields,(e,n)=>t.mapValue.fields[e]=li(n)),t}if(r.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=li(r.arrayValue.values[e]);return t}return Object.assign({},r)}function Xf(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var Zf={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function y_(r){return"nullValue"in r?Ss:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?vn(We.empty(),F.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?xo(r)?Zf:{mapValue:{}}:L()}function v_(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?vn(We.empty(),F.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?Zf:"mapValue"in r?xo(r)?{mapValue:{}}:Ge:L()}function Gd(r,t){let e=He(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?-1:!r.inclusive&&t.inclusive?1:0}function zd(r,t){let e=He(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?1:!r.inclusive&&t.inclusive?-1:0}var Ot=class r{constructor(t){this.value=t}static empty(){return new r({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Cs(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=li(e)}setAll(t){let e=_t.emptyPath(),n={},i=[];t.forEach((a,u)=>{if(!e.isImmediateParentOf(u)){let l=this.getFieldsMap(e);this.applyChanges(l,n,i),n={},i=[],e=u.popLast()}a?n[u.lastSegment()]=li(a):i.push(u.lastSegment())});let s=this.getFieldsMap(e);this.applyChanges(s,n,i)}delete(t){let e=this.field(t.popLast());Cs(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return pe(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];Cs(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){xn(e,(i,s)=>t[i]=s);for(let i of n)delete t[i]}clone(){return new r(li(this.value))}};function tm(r){let t=[];return xn(r.fields,(e,n)=>{let i=new _t([e]);if(Cs(n)){let s=tm(n.mapValue).fields;if(s.length===0)t.push(i);else for(let a of s)t.push(i.child(a))}else t.push(i)}),new Wt(t)}var Et=class r{constructor(t,e,n,i,s,a,u){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(t){return new r(t,0,U.min(),U.min(),U.min(),Ot.empty(),0)}static newFoundDocument(t,e,n,i){return new r(t,1,e,U.min(),n,i,0)}static newNoDocument(t,e){return new r(t,2,e,U.min(),U.min(),Ot.empty(),0)}static newUnknownDocument(t,e){return new r(t,3,e,U.min(),U.min(),Ot.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(U.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Ot.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Ot.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=U.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof r&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var ge=class{constructor(t,e){this.position=t,this.inclusive=e}};function Kd(r,t,e){let n=0;for(let i=0;i<r.position.length;i++){let s=t[i],a=r.position[i];if(s.field.isKeyField()?n=F.comparator(F.fromName(a.referenceValue),e.key):n=He(a,e.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function $d(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!pe(r.position[e],t.position[e]))return!1;return!0}var wn=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function w_(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}var Fs=class{},W=class r extends Fs{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new su(t,e,n):e==="array-contains"?new uu(t,n):e==="in"?new Ls(t,n):e==="not-in"?new cu(t,n):e==="array-contains-any"?new lu(t,n):new r(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new ou(t,n):new au(t,n)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(He(e,this.value)):e!==null&&yn(this.value)===yn(e)&&this.matchesComparison(He(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return L()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},rt=class r extends Fs{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new r(t,e)}matches(t){return or(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function or(r){return r.op==="and"}function ru(r){return r.op==="or"}function $c(r){return em(r)&&or(r)}function em(r){for(let t of r.filters)if(t instanceof rt)return!1;return!0}function iu(r){if(r instanceof W)return r.field.canonicalString()+r.op.toString()+sr(r.value);if($c(r))return r.filters.map(t=>iu(t)).join(",");{let t=r.filters.map(e=>iu(e)).join(",");return`${r.op}(${t})`}}function nm(r,t){return r instanceof W?function(n,i){return i instanceof W&&n.op===i.op&&n.field.isEqual(i.field)&&pe(n.value,i.value)}(r,t):r instanceof rt?function(n,i){return i instanceof rt&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((s,a,u)=>s&&nm(a,i.filters[u]),!0):!1}(r,t):void L()}function rm(r,t){let e=r.filters.concat(t);return rt.create(e,r.op)}function im(r){return r instanceof W?function(e){return`${e.field.canonicalString()} ${e.op} ${sr(e.value)}`}(r):r instanceof rt?function(e){return e.op.toString()+" {"+e.getFilters().map(im).join(" ,")+"}"}(r):"Filter"}var su=class extends W{constructor(t,e,n){super(t,e,n),this.key=F.fromName(n.referenceValue)}matches(t){let e=F.comparator(t.key,this.key);return this.matchesComparison(e)}},ou=class extends W{constructor(t,e){super(t,"in",e),this.keys=sm("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},au=class extends W{constructor(t,e){super(t,"not-in",e),this.keys=sm("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function sm(r,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(n=>F.fromName(n.referenceValue))}var uu=class extends W{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return wi(e)&&vi(e.arrayValue,this.value)}},Ls=class extends W{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&vi(this.value.arrayValue,e)}},cu=class extends W{constructor(t,e){super(t,"not-in",e)}matches(t){if(vi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&!vi(this.value.arrayValue,e)}},lu=class extends W{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!wi(e)||!e.arrayValue.values)&&e.arrayValue.values.some(n=>vi(this.value.arrayValue,n))}};var hu=class{constructor(t,e=null,n=[],i=[],s=null,a=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.ue=null}};function du(r,t=null,e=[],n=[],i=null,s=null,a=null){return new hu(r,t,e,n,i,s,a)}function In(r){let t=O(r);if(t.ue===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(n=>iu(n)).join(","),e+="|ob:",e+=t.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),Oi(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(n=>sr(n)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(n=>sr(n)).join(",")),t.ue=e}return t.ue}function Fi(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!w_(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!nm(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!$d(r.startAt,t.startAt)&&$d(r.endAt,t.endAt)}function qs(r){return F.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function Bs(r,t){return r.filters.filter(e=>e instanceof W&&e.field.isEqual(t))}function Qd(r,t,e){let n=Ss,i=!0;for(let s of Bs(r,t)){let a=Ss,u=!0;switch(s.op){case"<":case"<=":a=y_(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,u=!1;break;case"!=":case"not-in":a=Ss}Gd({value:n,inclusive:i},{value:a,inclusive:u})<0&&(n=a,i=u)}if(e!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(t)){let a=e.position[s];Gd({value:n,inclusive:i},{value:a,inclusive:e.inclusive})<0&&(n=a,i=e.inclusive);break}}return{value:n,inclusive:i}}function Wd(r,t,e){let n=Ge,i=!0;for(let s of Bs(r,t)){let a=Ge,u=!0;switch(s.op){case">=":case">":a=v_(s.value),u=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,u=!1;break;case"!=":case"not-in":a=Ge}zd({value:n,inclusive:i},{value:a,inclusive:u})>0&&(n=a,i=u)}if(e!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(t)){let a=e.position[s];zd({value:n,inclusive:i},{value:a,inclusive:e.inclusive})>0&&(n=a,i=e.inclusive);break}}return{value:n,inclusive:i}}var re=class{constructor(t,e=null,n=[],i=[],s=null,a="F",u=null,l=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function om(r,t,e,n,i,s,a,u){return new re(r,t,e,n,i,s,a,u)}function Ir(r){return new re(r)}function Hd(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Qc(r){return r.collectionGroup!==null}function er(r){let t=O(r);if(t.ce===null){t.ce=[];let e=new Set;for(let s of t.explicitOrderBy)t.ce.push(s),e.add(s.field.canonicalString());let n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new st(_t.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.ce.push(new wn(s,n))}),e.has(_t.keyField().canonicalString())||t.ce.push(new wn(_t.keyField(),n))}return t.ce}function Ut(r){let t=O(r);return t.le||(t.le=I_(t,er(r))),t.le}function I_(r,t){if(r.limitType==="F")return du(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new wn(i.field,s)});let e=r.endAt?new ge(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new ge(r.startAt.position,r.startAt.inclusive):null;return du(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}function fu(r,t){let e=r.filters.concat([t]);return new re(r.path,r.collectionGroup,r.explicitOrderBy.slice(),e,r.limit,r.limitType,r.startAt,r.endAt)}function Us(r,t,e){return new re(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function Li(r,t){return Fi(Ut(r),Ut(t))&&r.limitType===t.limitType}function am(r){return`${In(Ut(r))}|lt:${r.limitType}`}function Hn(r){return`Query(target=${function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(i=>im(i)).join(", ")}]`),Oi(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(i=>sr(i)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(i=>sr(i)).join(",")),`Target(${n})`}(Ut(r))}; limitType=${r.limitType})`}function qi(r,t){return t.isFoundDocument()&&function(n,i){let s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):F.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,t)&&function(n,i){for(let s of er(n))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(r,t)&&function(n,i){for(let s of n.filters)if(!s.matches(i))return!1;return!0}(r,t)&&function(n,i){return!(n.startAt&&!function(a,u,l){let d=Kd(a,u,l);return a.inclusive?d<=0:d<0}(n.startAt,er(n),i)||n.endAt&&!function(a,u,l){let d=Kd(a,u,l);return a.inclusive?d>=0:d>0}(n.endAt,er(n),i))}(r,t)}function um(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function cm(r){return(t,e)=>{let n=!1;for(let i of er(r)){let s=T_(i,t,e);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}function T_(r,t,e){let n=r.field.isKeyField()?F.comparator(t.key,e.key):function(s,a,u){let l=a.data.field(s),d=u.data.field(s);return l!==null&&d!==null?He(l,d):L()}(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return L()}}var _e=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(let[i,s]of n)if(this.equalsFn(i,t))return s}}has(t){return this.get(t)!==void 0}set(t,e){let n=this.mapKeyFn(t),i=this.inner[n];if(i===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return void(i[s]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return n.length===1?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){xn(this.inner,(e,n)=>{for(let[i,s]of n)t(i,s)})}isEmpty(){return Jf(this.inner)}size(){return this.innerSize}};var E_=new ut(F.comparator);function zt(){return E_}var lm=new ut(F.comparator);function ui(...r){let t=lm;for(let e of r)t=t.insert(e.key,e);return t}function hm(r){let t=lm;return r.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function he(){return hi()}function dm(){return hi()}function hi(){return new _e(r=>r.toString(),(r,t)=>r.isEqual(t))}var A_=new ut(F.comparator),b_=new st(F.comparator);function $(...r){let t=b_;for(let e of r)t=t.add(e);return t}var S_=new st(z);function Wc(){return S_}function Hc(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:gi(t)?"-0":t}}function fm(r){return{integerValue:""+r}}function mm(r,t){return Kf(t)?fm(t):Hc(r,t)}var ar=class{constructor(){this._=void 0}};function C_(r,t,e){return r instanceof Je?function(i,s){let a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Po(s)&&(s=Kc(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(e,t):r instanceof Pe?gm(r,t):r instanceof xe?_m(r,t):function(i,s){let a=pm(i,s),u=Jd(a)+Jd(i.Pe);return nu(a)&&nu(i.Pe)?fm(u):Hc(i.serializer,u)}(r,t)}function P_(r,t,e){return r instanceof Pe?gm(r,t):r instanceof xe?_m(r,t):e}function pm(r,t){return r instanceof Ye?function(n){return nu(n)||function(s){return!!s&&"doubleValue"in s}(n)}(t)?t:{integerValue:0}:null}var Je=class extends ar{},Pe=class extends ar{constructor(t){super(),this.elements=t}};function gm(r,t){let e=ym(t);for(let n of r.elements)e.some(i=>pe(i,n))||e.push(n);return{arrayValue:{values:e}}}var xe=class extends ar{constructor(t){super(),this.elements=t}};function _m(r,t){let e=ym(t);for(let n of r.elements)e=e.filter(i=>!pe(i,n));return{arrayValue:{values:e}}}var Ye=class extends ar{constructor(t,e){super(),this.serializer=t,this.Pe=e}};function Jd(r){return ct(r.integerValue||r.doubleValue)}function ym(r){return wi(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}var Tn=class{constructor(t,e){this.field=t,this.transform=e}};function x_(r,t){return r.field.isEqual(t.field)&&function(n,i){return n instanceof Pe&&i instanceof Pe||n instanceof xe&&i instanceof xe?rr(n.elements,i.elements,pe):n instanceof Ye&&i instanceof Ye?pe(n.Pe,i.Pe):n instanceof Je&&i instanceof Je}(r.transform,t.transform)}var mu=class{constructor(t,e){this.version=t,this.transformResults=e}},mt=class r{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new r}static exists(t){return new r(void 0,t)}static updateTime(t){return new r(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function Ps(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}var ur=class{};function vm(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new Ze(r.key,mt.none()):new Xe(r.key,r.data,mt.none());{let e=r.data,n=Ot.empty(),i=new st(_t.comparator);for(let s of t.fields)if(!i.has(s)){let a=e.field(s);a===null&&s.length>1&&(s=s.popLast(),a=e.field(s)),a===null?n.delete(s):n.set(s,a),i=i.add(s)}return new ie(r.key,n,new Wt(i.toArray()),mt.none())}}function R_(r,t,e){r instanceof Xe?function(i,s,a){let u=i.value.clone(),l=Xd(i.fieldTransforms,s,a.transformResults);u.setAll(l),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,t,e):r instanceof ie?function(i,s,a){if(!Ps(i.precondition,s))return void s.convertToUnknownDocument(a.version);let u=Xd(i.fieldTransforms,s,a.transformResults),l=s.data;l.setAll(wm(i)),l.setAll(u),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(r,t,e):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,t,e)}function di(r,t,e,n){return r instanceof Xe?function(s,a,u,l){if(!Ps(s.precondition,a))return u;let d=s.value.clone(),f=Zd(s.fieldTransforms,l,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(r,t,e,n):r instanceof ie?function(s,a,u,l){if(!Ps(s.precondition,a))return u;let d=Zd(s.fieldTransforms,l,a),f=a.data;return f.setAll(wm(s)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(p=>p.field))}(r,t,e,n):function(s,a,u){return Ps(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(r,t,e)}function D_(r,t){let e=null;for(let n of r.fieldTransforms){let i=t.data.field(n.field),s=pm(n.transform,i||null);s!=null&&(e===null&&(e=Ot.empty()),e.set(n.field,s))}return e||null}function Yd(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&rr(n,i,(s,a)=>x_(s,a))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}var Xe=class extends ur{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},ie=class extends ur{constructor(t,e,n,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function wm(r){let t=new Map;return r.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let n=r.data.field(e);t.set(e,n)}}),t}function Xd(r,t,e){let n=new Map;q(r.length===e.length);for(let i=0;i<e.length;i++){let s=r[i],a=s.transform,u=t.data.field(s.field);n.set(s.field,P_(a,u,e[i]))}return n}function Zd(r,t,e){let n=new Map;for(let i of r){let s=i.transform,a=e.data.field(i.field);n.set(i.field,C_(s,a,t))}return n}var Ze=class extends ur{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Ii=class extends ur{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Ti=class{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){let n=e.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(t.key)&&R_(s,t,n[i])}}applyToLocalView(t,e){for(let n of this.baseMutations)n.key.isEqual(t.key)&&(e=di(n,t,e,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(t.key)&&(e=di(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let n=dm();return this.mutations.forEach(i=>{let s=t.get(i.key),a=s.overlayedDocument,u=this.applyToLocalView(a,s.mutatedFields);u=e.has(i.key)?null:u;let l=vm(a,u);l!==null&&n.set(i.key,l),a.isValidDocument()||a.convertToNoDocument(U.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),$())}isEqual(t){return this.batchId===t.batchId&&rr(this.mutations,t.mutations,(e,n)=>Yd(e,n))&&rr(this.baseMutations,t.baseMutations,(e,n)=>Yd(e,n))}},pu=class r{constructor(t,e,n,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=i}static from(t,e,n){q(t.mutations.length===n.length);let i=function(){return A_}(),s=t.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new r(t,e,n,i)}};var Ei=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var gu=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var wt,J;function Im(r){switch(r){default:return L();case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0}}function Tm(r){if(r===void 0)return gt("GRPC error has no .code"),P.UNKNOWN;switch(r){case wt.OK:return P.OK;case wt.CANCELLED:return P.CANCELLED;case wt.UNKNOWN:return P.UNKNOWN;case wt.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case wt.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case wt.INTERNAL:return P.INTERNAL;case wt.UNAVAILABLE:return P.UNAVAILABLE;case wt.UNAUTHENTICATED:return P.UNAUTHENTICATED;case wt.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case wt.NOT_FOUND:return P.NOT_FOUND;case wt.ALREADY_EXISTS:return P.ALREADY_EXISTS;case wt.PERMISSION_DENIED:return P.PERMISSION_DENIED;case wt.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case wt.ABORTED:return P.ABORTED;case wt.OUT_OF_RANGE:return P.OUT_OF_RANGE;case wt.UNIMPLEMENTED:return P.UNIMPLEMENTED;case wt.DATA_LOSS:return P.DATA_LOSS;default:return L()}}(J=wt||(wt={}))[J.OK=0]="OK",J[J.CANCELLED=1]="CANCELLED",J[J.UNKNOWN=2]="UNKNOWN",J[J.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",J[J.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",J[J.NOT_FOUND=5]="NOT_FOUND",J[J.ALREADY_EXISTS=6]="ALREADY_EXISTS",J[J.PERMISSION_DENIED=7]="PERMISSION_DENIED",J[J.UNAUTHENTICATED=16]="UNAUTHENTICATED",J[J.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",J[J.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",J[J.ABORTED=10]="ABORTED",J[J.OUT_OF_RANGE=11]="OUT_OF_RANGE",J[J.UNIMPLEMENTED=12]="UNIMPLEMENTED",J[J.INTERNAL=13]="INTERNAL",J[J.UNAVAILABLE=14]="UNAVAILABLE",J[J.DATA_LOSS=15]="DATA_LOSS";var tf=null;function Em(){return new TextEncoder}var V_=new Le([4294967295,4294967295],0);function ef(r){let t=Em().encode(r),e=new Da;return e.update(t),new Uint8Array(e.digest())}function nf(r){let t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Le([e,n],0),new Le([i,s],0)]}var _u=class r{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new gn(`Invalid padding: ${e}`);if(n<0)throw new gn(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new gn(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new gn(`Invalid padding when bitmap length is 0: ${e}`);this.Ie=8*t.length-e,this.Te=Le.fromNumber(this.Ie)}Ee(t,e,n){let i=t.add(e.multiply(Le.fromNumber(n)));return i.compare(V_)===1&&(i=new Le([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Ie===0)return!1;let e=ef(t),[n,i]=nf(e);for(let s=0;s<this.hashCount;s++){let a=this.Ee(n,i,s);if(!this.de(a))return!1}return!0}static create(t,e,n){let i=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),a=new r(s,i,e);return n.forEach(u=>a.insert(u)),a}insert(t){if(this.Ie===0)return;let e=ef(t),[n,i]=nf(e);for(let s=0;s<this.hashCount;s++){let a=this.Ee(n,i,s);this.Ae(a)}}Ae(t){let e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}},gn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Ai=class r{constructor(t,e,n,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){let i=new Map;return i.set(t,bi.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new r(U.min(),i,new ut(z),zt(),$())}},bi=class r{constructor(t,e,n,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new r(n,e,$(),$(),$())}};var nr=class{constructor(t,e,n,i){this.Re=t,this.removedTargetIds=e,this.key=n,this.Ve=i}},js=class{constructor(t,e){this.targetId=t,this.me=e}},Gs=class{constructor(t,e,n=vt.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}},zs=class{constructor(){this.fe=0,this.ge=sf(),this.pe=vt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}ve(){let t=$(),e=$(),n=$();return this.ge.forEach((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:n=n.add(i);break;default:L()}}),new bi(this.pe,this.ye,t,e,n)}Ce(){this.we=!1,this.ge=sf()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,q(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},yu=class{constructor(t){this.Le=t,this.Be=new Map,this.ke=zt(),this.qe=rf(),this.Qe=new ut(z)}Ke(t){for(let e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.$e(e,t.Ve):this.Ue(e,t.key,t.Ve);for(let e of t.removedTargetIds)this.Ue(e,t.key,t.Ve)}We(t){this.forEachTarget(t,e=>{let n=this.Ge(e);switch(t.state){case 0:this.ze(e)&&n.De(t.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(t.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(e);break;case 3:this.ze(e)&&(n.Ne(),n.De(t.resumeToken));break;case 4:this.ze(e)&&(this.je(e),n.De(t.resumeToken));break;default:L()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Be.forEach((n,i)=>{this.ze(i)&&e(i)})}He(t){let e=t.targetId,n=t.me.count,i=this.Je(e);if(i){let s=i.target;if(qs(s))if(n===0){let a=new F(s.path);this.Ue(e,a,Et.newNoDocument(a,U.min()))}else q(n===1);else{let a=this.Ye(e);if(a!==n){let u=this.Ze(t),l=u?this.Xe(u,t,a):1;if(l!==0){this.je(e);let d=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(e,d)}tf?.et(function(f,p,_,b,N){var k,V,j,G,B,Q;let H={localCacheCount:f,existenceFilterCount:p.count,databaseId:_.database,projectId:_.projectId},K=p.unchangedNames;return K&&(H.bloomFilter={applied:N===0,hashCount:(k=K?.hashCount)!==null&&k!==void 0?k:0,bitmapLength:(G=(j=(V=K?.bits)===null||V===void 0?void 0:V.bitmap)===null||j===void 0?void 0:j.length)!==null&&G!==void 0?G:0,padding:(Q=(B=K?.bits)===null||B===void 0?void 0:B.padding)!==null&&Q!==void 0?Q:0,mightContain:w=>{var g;return(g=b?.mightContain(w))!==null&&g!==void 0&&g}}),H}(a,t.me,this.Le.tt(),u,l))}}}}Ze(t){let e=t.me.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=e,a,u;try{a=Qe(n).toUint8Array()}catch(l){if(l instanceof Os)return ne("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{u=new _u(a,i,s)}catch(l){return ne(l instanceof gn?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return u.Ie===0?null:u}Xe(t,e,n){return e.me.count===n-this.nt(t,e.targetId)?0:2}nt(t,e){let n=this.Le.getRemoteKeysForTarget(e),i=0;return n.forEach(s=>{let a=this.Le.tt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;t.mightContain(u)||(this.Ue(e,s,null),i++)}),i}rt(t){let e=new Map;this.Be.forEach((s,a)=>{let u=this.Je(a);if(u){if(s.current&&qs(u.target)){let l=new F(u.target.path);this.ke.get(l)!==null||this.it(a,l)||this.Ue(a,l,Et.newNoDocument(l,t))}s.be&&(e.set(a,s.ve()),s.Ce())}});let n=$();this.qe.forEach((s,a)=>{let u=!0;a.forEachWhile(l=>{let d=this.Je(l);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(n=n.add(s))}),this.ke.forEach((s,a)=>a.setReadTime(t));let i=new Ai(t,e,this.Qe,this.ke,n);return this.ke=zt(),this.qe=rf(),this.Qe=new ut(z),i}$e(t,e){if(!this.ze(t))return;let n=this.it(t,e.key)?2:0;this.Ge(t).Fe(e.key,n),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t))}Ue(t,e,n){if(!this.ze(t))return;let i=this.Ge(t);this.it(t,e)?i.Fe(e,1):i.Me(e),this.qe=this.qe.insert(e,this.st(e).delete(t)),n&&(this.ke=this.ke.insert(e,n))}removeTarget(t){this.Be.delete(t)}Ye(t){let e=this.Ge(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.Ge(t).xe()}Ge(t){let e=this.Be.get(t);return e||(e=new zs,this.Be.set(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new st(z),this.qe=this.qe.insert(t,e)),e}ze(t){let e=this.Je(t)!==null;return e||D("WatchChangeAggregator","Detected inactive target",t),e}Je(t){let e=this.Be.get(t);return e&&e.Se?null:this.Le.ot(t)}je(t){this.Be.set(t,new zs),this.Le.getRemoteKeysForTarget(t).forEach(e=>{this.Ue(t,e,null)})}it(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}};function rf(){return new ut(F.comparator)}function sf(){return new ut(F.comparator)}var N_={asc:"ASCENDING",desc:"DESCENDING"},k_={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},M_={and:"AND",or:"OR"},vu=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function wu(r,t){return r.useProto3Json||Oi(t)?t:{value:t}}function cr(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Am(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function O_(r,t){return cr(r,t.toTimestamp())}function yt(r){return q(!!r),U.fromTimestamp(function(e){let n=Ce(e);return new lt(n.seconds,n.nanos)}(r))}function Jc(r,t){return Iu(r,t).canonicalString()}function Iu(r,t){let e=function(i){return new Y(["projects",i.projectId,"databases",i.database])}(r).child("documents");return t===void 0?e:e.child(t)}function bm(r){let t=Y.fromString(r);return q(Mm(t)),t}function Si(r,t){return Jc(r.databaseId,t.path)}function fe(r,t){let e=bm(t);if(e.get(1)!==r.databaseId.projectId)throw new R(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new R(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new F(Pm(e))}function Sm(r,t){return Jc(r.databaseId,t)}function Cm(r){let t=bm(r);return t.length===4?Y.emptyPath():Pm(t)}function Tu(r){return new Y(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Pm(r){return q(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function of(r,t,e){return{name:Si(r,t),fields:e.value.mapValue.fields}}function xm(r,t,e){let n=fe(r,t.name),i=yt(t.updateTime),s=t.createTime?yt(t.createTime):U.min(),a=new Ot({mapValue:{fields:t.fields}}),u=Et.newFoundDocument(n,i,s,a);return e&&u.setHasCommittedMutations(),e?u.setHasCommittedMutations():u}function F_(r,t){return"found"in t?function(n,i){q(!!i.found),i.found.name,i.found.updateTime;let s=fe(n,i.found.name),a=yt(i.found.updateTime),u=i.found.createTime?yt(i.found.createTime):U.min(),l=new Ot({mapValue:{fields:i.found.fields}});return Et.newFoundDocument(s,a,u,l)}(r,t):"missing"in t?function(n,i){q(!!i.missing),q(!!i.readTime);let s=fe(n,i.missing),a=yt(i.readTime);return Et.newNoDocument(s,a)}(r,t):L()}function L_(r,t){let e;if("targetChange"in t){t.targetChange;let n=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:L()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(d,f){return d.useProto3Json?(q(f===void 0||typeof f=="string"),vt.fromBase64String(f||"")):(q(f===void 0||f instanceof Buffer||f instanceof Uint8Array),vt.fromUint8Array(f||new Uint8Array))}(r,t.targetChange.resumeToken),a=t.targetChange.cause,u=a&&function(d){let f=d.code===void 0?P.UNKNOWN:Tm(d.code);return new R(f,d.message||"")}(a);e=new Gs(n,i,s,u||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=fe(r,n.document.name),s=yt(n.document.updateTime),a=n.document.createTime?yt(n.document.createTime):U.min(),u=new Ot({mapValue:{fields:n.document.fields}}),l=Et.newFoundDocument(i,s,a,u),d=n.targetIds||[],f=n.removedTargetIds||[];e=new nr(d,f,l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=fe(r,n.document),s=n.readTime?yt(n.readTime):U.min(),a=Et.newNoDocument(i,s),u=n.removedTargetIds||[];e=new nr([],u,a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=fe(r,n.document),s=n.removedTargetIds||[];e=new nr([],s,i,null)}else{if(!("filter"in t))return L();{t.filter;let n=t.filter;n.targetId;let{count:i=0,unchangedNames:s}=n,a=new gu(i,s),u=n.targetId;e=new js(u,a)}}return e}function Ci(r,t){let e;if(t instanceof Xe)e={update:of(r,t.key,t.value)};else if(t instanceof Ze)e={delete:Si(r,t.key)};else if(t instanceof ie)e={update:of(r,t.key,t.data),updateMask:z_(t.fieldMask)};else{if(!(t instanceof Ii))return L();e={verify:Si(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(n=>function(s,a){let u=a.transform;if(u instanceof Je)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Pe)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof xe)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Ye)return{fieldPath:a.field.canonicalString(),increment:u.Pe};throw L()}(0,n))),t.precondition.isNone||(e.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:O_(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:L()}(r,t.precondition)),e}function Eu(r,t){let e=t.currentDocument?function(s){return s.updateTime!==void 0?mt.updateTime(yt(s.updateTime)):s.exists!==void 0?mt.exists(s.exists):mt.none()}(t.currentDocument):mt.none(),n=t.updateTransforms?t.updateTransforms.map(i=>function(a,u){let l=null;if("setToServerValue"in u)q(u.setToServerValue==="REQUEST_TIME"),l=new Je;else if("appendMissingElements"in u){let f=u.appendMissingElements.values||[];l=new Pe(f)}else if("removeAllFromArray"in u){let f=u.removeAllFromArray.values||[];l=new xe(f)}else"increment"in u?l=new Ye(a,u.increment):L();let d=_t.fromServerFormat(u.fieldPath);return new Tn(d,l)}(r,i)):[];if(t.update){t.update.name;let i=fe(r,t.update.name),s=new Ot({mapValue:{fields:t.update.fields}});if(t.updateMask){let a=function(l){let d=l.fieldPaths||[];return new Wt(d.map(f=>_t.fromServerFormat(f)))}(t.updateMask);return new ie(i,s,a,e,n)}return new Xe(i,s,e,n)}if(t.delete){let i=fe(r,t.delete);return new Ze(i,e)}if(t.verify){let i=fe(r,t.verify);return new Ii(i,e)}return L()}function q_(r,t){return r&&r.length>0?(q(t!==void 0),r.map(e=>function(i,s){let a=i.updateTime?yt(i.updateTime):yt(s);return a.isEqual(U.min())&&(a=yt(s)),new mu(a,i.transformResults||[])}(e,t))):[]}function Rm(r,t){return{documents:[Sm(r,t.path)]}}function Dm(r,t){let e={structuredQuery:{}},n=t.path,i;t.collectionGroup!==null?(i=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=Sm(r,i);let s=function(d){if(d.length!==0)return km(rt.create(d,"and"))}(t.filters);s&&(e.structuredQuery.where=s);let a=function(d){if(d.length!==0)return d.map(f=>function(_){return{field:Jn(_.field),direction:U_(_.dir)}}(f))}(t.orderBy);a&&(e.structuredQuery.orderBy=a);let u=wu(r,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(t.endAt)),{_t:e,parent:i}}function Vm(r){let t=Cm(r.parent),e=r.structuredQuery,n=e.from?e.from.length:0,i=null;if(n>0){q(n===1);let f=e.from[0];f.allDescendants?i=f.collectionId:t=t.child(f.collectionId)}let s=[];e.where&&(s=function(p){let _=Nm(p);return _ instanceof rt&&$c(_)?_.getFilters():[_]}(e.where));let a=[];e.orderBy&&(a=function(p){return p.map(_=>function(N){return new wn(Yn(N.field),function(V){switch(V){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(N.direction))}(_))}(e.orderBy));let u=null;e.limit&&(u=function(p){let _;return _=typeof p=="object"?p.value:p,Oi(_)?null:_}(e.limit));let l=null;e.startAt&&(l=function(p){let _=!!p.before,b=p.values||[];return new ge(b,_)}(e.startAt));let d=null;return e.endAt&&(d=function(p){let _=!p.before,b=p.values||[];return new ge(b,_)}(e.endAt)),om(t,i,a,s,u,"F",l,d)}function B_(r,t){let e=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L()}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Nm(r){return r.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let n=Yn(e.unaryFilter.field);return W.create(n,"==",{doubleValue:NaN});case"IS_NULL":let i=Yn(e.unaryFilter.field);return W.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Yn(e.unaryFilter.field);return W.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=Yn(e.unaryFilter.field);return W.create(a,"!=",{nullValue:"NULL_VALUE"});default:return L()}}(r):r.fieldFilter!==void 0?function(e){return W.create(Yn(e.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return L()}}(e.fieldFilter.op),e.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(e){return rt.create(e.compositeFilter.filters.map(n=>Nm(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return L()}}(e.compositeFilter.op))}(r):L()}function U_(r){return N_[r]}function j_(r){return k_[r]}function G_(r){return M_[r]}function Jn(r){return{fieldPath:r.canonicalString()}}function Yn(r){return _t.fromServerFormat(r.fieldPath)}function km(r){return r instanceof W?function(e){if(e.op==="=="){if(jd(e.value))return{unaryFilter:{field:Jn(e.field),op:"IS_NAN"}};if(Ud(e.value))return{unaryFilter:{field:Jn(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(jd(e.value))return{unaryFilter:{field:Jn(e.field),op:"IS_NOT_NAN"}};if(Ud(e.value))return{unaryFilter:{field:Jn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Jn(e.field),op:j_(e.op),value:e.value}}}(r):r instanceof rt?function(e){let n=e.getFilters().map(i=>km(i));return n.length===1?n[0]:{compositeFilter:{op:G_(e.op),filters:n}}}(r):L()}function z_(r){let t=[];return r.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Mm(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var lr=class r{constructor(t,e,n,i,s=U.min(),a=U.min(),u=vt.EMPTY_BYTE_STRING,l=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=l}withSequenceNumber(t){return new r(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var Ks=class{constructor(t){this.ct=t}};function K_(r,t){let e;if(t.document)e=xm(r.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let n=F.fromSegments(t.noDocument.path),i=An(t.noDocument.readTime);e=Et.newNoDocument(n,i),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return L();{let n=F.fromSegments(t.unknownDocument.path),i=An(t.unknownDocument.version);e=Et.newUnknownDocument(n,i)}}return t.readTime&&e.setReadTime(function(i){let s=new lt(i[0],i[1]);return U.fromTimestamp(s)}(t.readTime)),e}function af(r,t){let e=t.key,n={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:$s(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=function(s,a){return{name:Si(s,a.key),fields:a.data.value.mapValue.fields,updateTime:cr(s,a.version.toTimestamp()),createTime:cr(s,a.createTime.toTimestamp())}}(r.ct,t);else if(t.isNoDocument())n.noDocument={path:e.path.toArray(),readTime:En(t.version)};else{if(!t.isUnknownDocument())return L();n.unknownDocument={path:e.path.toArray(),version:En(t.version)}}return n}function $s(r){let t=r.toTimestamp();return[t.seconds,t.nanoseconds]}function En(r){let t=r.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function An(r){let t=new lt(r.seconds,r.nanoseconds);return U.fromTimestamp(t)}function fn(r,t){let e=(t.baseMutations||[]).map(s=>Eu(r.ct,s));for(let s=0;s<t.mutations.length-1;++s){let a=t.mutations[s];if(s+1<t.mutations.length&&t.mutations[s+1].transform!==void 0){let u=t.mutations[s+1];a.updateTransforms=u.transform.fieldTransforms,t.mutations.splice(s+1,1),++s}}let n=t.mutations.map(s=>Eu(r.ct,s)),i=lt.fromMillis(t.localWriteTimeMs);return new Ti(t.batchId,i,e,n)}function ci(r){let t=An(r.readTime),e=r.lastLimboFreeSnapshotVersion!==void 0?An(r.lastLimboFreeSnapshotVersion):U.min(),n;return n=function(s){return s.documents!==void 0}(r.query)?function(s){return q(s.documents.length===1),Ut(Ir(Cm(s.documents[0])))}(r.query):function(s){return Ut(Vm(s))}(r.query),new lr(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,t,e,vt.fromBase64String(r.resumeToken))}function Om(r,t){let e=En(t.snapshotVersion),n=En(t.lastLimboFreeSnapshotVersion),i;i=qs(t.target)?Rm(r.ct,t.target):Dm(r.ct,t.target)._t;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:In(t.target),readTime:e,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function Yc(r){let t=Vm({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Us(t,t.limit,"L"):t}function Fa(r,t){return new Ei(t.largestBatchId,Eu(r.ct,t.overlayMutation))}function uf(r,t){let e=t.path.lastSegment();return[r,Bt(t.path.popLast()),e]}function cf(r,t,e,n){return{indexId:r,uid:t,sequenceNumber:e,readTime:En(n.readTime),documentKey:Bt(n.documentKey.path),largestBatchId:n.largestBatchId}}var Au=class{getBundleMetadata(t,e){return lf(t).get(e).next(n=>{if(n)return function(s){return{id:s.bundleId,createTime:An(s.createTime),version:s.version}}(n)})}saveBundleMetadata(t,e){return lf(t).put(function(i){return{bundleId:i.id,createTime:En(yt(i.createTime)),version:i.version}}(e))}getNamedQuery(t,e){return hf(t).get(e).next(n=>{if(n)return function(s){return{name:s.name,query:Yc(s.bundledQuery),readTime:An(s.readTime)}}(n)})}saveNamedQuery(t,e){return hf(t).put(function(i){return{name:i.name,readTime:En(yt(i.readTime)),bundledQuery:i.bundledQuery}}(e))}};function lf(r){return St(r,"bundles")}function hf(r){return St(r,"namedQueries")}var Qs=class r{constructor(t,e){this.serializer=t,this.userId=e}static lt(t,e){let n=e.uid||"";return new r(t,n)}getOverlay(t,e){return ii(t).get(uf(this.userId,e)).next(n=>n?Fa(this.serializer,n):null)}getOverlays(t,e){let n=he();return S.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(t,e,n){let i=[];return n.forEach((s,a)=>{let u=new Ei(e,a);i.push(this.ht(t,u))}),S.waitFor(i)}removeOverlaysForBatchId(t,e,n){let i=new Set;e.forEach(a=>i.add(Bt(a.getCollectionPath())));let s=[];return i.forEach(a=>{let u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);s.push(ii(t).j("collectionPathOverlayIndex",u))}),S.waitFor(s)}getOverlaysForCollection(t,e,n){let i=he(),s=Bt(e),a=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return ii(t).U("collectionPathOverlayIndex",a).next(u=>{for(let l of u){let d=Fa(this.serializer,l);i.set(d.getKey(),d)}return i})}getOverlaysForCollectionGroup(t,e,n,i){let s=he(),a,u=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return ii(t).J({index:"collectionGroupOverlayIndex",range:u},(l,d,f)=>{let p=Fa(this.serializer,d);s.size()<i||p.largestBatchId===a?(s.set(p.getKey(),p),a=p.largestBatchId):f.done()}).next(()=>s)}ht(t,e){return ii(t).put(function(i,s,a){let[u,l,d]=uf(s,a.mutation.key);return{userId:s,collectionPath:l,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Ci(i.ct,a.mutation)}}(this.serializer,this.userId,e))}};function ii(r){return St(r,"documentOverlays")}var bu=class{Pt(t){return St(t,"globals")}getSessionToken(t){return this.Pt(t).get("sessionToken").next(e=>{let n=e?.value;return n?vt.fromUint8Array(n):vt.EMPTY_BYTE_STRING})}setSessionToken(t,e){return this.Pt(t).put({name:"sessionToken",value:e.toUint8Array()})}};var be=class{constructor(){}It(t,e){this.Tt(t,e),e.Et()}Tt(t,e){if("nullValue"in t)this.dt(e,5);else if("booleanValue"in t)this.dt(e,10),e.At(t.booleanValue?1:0);else if("integerValue"in t)this.dt(e,15),e.At(ct(t.integerValue));else if("doubleValue"in t){let n=ct(t.doubleValue);isNaN(n)?this.dt(e,13):(this.dt(e,15),gi(n)?e.At(0):e.At(n))}else if("timestampValue"in t){let n=t.timestampValue;this.dt(e,20),typeof n=="string"&&(n=Ce(n)),e.Rt(`${n.seconds||""}`),e.At(n.nanos||0)}else if("stringValue"in t)this.Vt(t.stringValue,e),this.ft(e);else if("bytesValue"in t)this.dt(e,30),e.gt(Qe(t.bytesValue)),this.ft(e);else if("referenceValue"in t)this.yt(t.referenceValue,e);else if("geoPointValue"in t){let n=t.geoPointValue;this.dt(e,45),e.At(n.latitude||0),e.At(n.longitude||0)}else"mapValue"in t?Xf(t)?this.dt(e,Number.MAX_SAFE_INTEGER):xo(t)?this.wt(t.mapValue,e):(this.St(t.mapValue,e),this.ft(e)):"arrayValue"in t?(this.bt(t.arrayValue,e),this.ft(e)):L()}Vt(t,e){this.dt(e,25),this.Dt(t,e)}Dt(t,e){e.Rt(t)}St(t,e){let n=t.fields||{};this.dt(e,55);for(let i of Object.keys(n))this.Vt(i,e),this.Tt(n[i],e)}wt(t,e){var n,i;let s=t.fields||{};this.dt(e,53);let a="value",u=((i=(n=s[a].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.length)||0;this.dt(e,15),e.At(ct(u)),this.Vt(a,e),this.Tt(s[a],e)}bt(t,e){let n=t.values||[];this.dt(e,50);for(let i of n)this.Tt(i,e)}yt(t,e){this.dt(e,37),F.fromName(t).path.forEach(n=>{this.dt(e,60),this.Dt(n,e)})}dt(t,e){t.At(e)}ft(t){t.At(2)}};be.vt=new be;function $_(r){if(r===0)return 8;let t=0;return!(r>>4)&&(t+=4,r<<=4),!(r>>6)&&(t+=2,r<<=2),!(r>>7)&&(t+=1),t}function df(r){let t=64-function(n){let i=0;for(let s=0;s<8;++s){let a=$_(255&n[s]);if(i+=a,a!==8)break}return i}(r);return Math.ceil(t/8)}var Su=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Ft(n.value),n=e.next();this.Mt()}xt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Ot(n.value),n=e.next();this.Nt()}Lt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Ft(n);else if(n<2048)this.Ft(960|n>>>6),this.Ft(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Ft(480|n>>>12),this.Ft(128|63&n>>>6),this.Ft(128|63&n);else{let i=e.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Ot(n);else if(n<2048)this.Ot(960|n>>>6),this.Ot(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Ot(480|n>>>12),this.Ot(128|63&n>>>6),this.Ot(128|63&n);else{let i=e.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(t){let e=this.qt(t),n=df(e);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let i=e.length-n;i<e.length;++i)this.buffer[this.position++]=255&e[i]}Kt(t){let e=this.qt(t),n=df(e);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let i=e.length-n;i<e.length;++i)this.buffer[this.position++]=~(255&e[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(t){this.Qt(t.length),this.buffer.set(t,this.position),this.position+=t.length}zt(){return this.buffer.slice(0,this.position)}qt(t){let e=function(s){let a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(t),n=(128&e[0])!=0;e[0]^=n?255:128;for(let i=1;i<e.length;++i)e[i]^=n?255:0;return e}Ft(t){let e=255&t;e===0?(this.Ut(0),this.Ut(255)):e===255?(this.Ut(255),this.Ut(0)):this.Ut(e)}Ot(t){let e=255&t;e===0?(this.Gt(0),this.Gt(255)):e===255?(this.Gt(255),this.Gt(0)):this.Gt(t)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(t){this.Qt(1),this.buffer[this.position++]=t}Gt(t){this.Qt(1),this.buffer[this.position++]=~t}Qt(t){let e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);let i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}},Cu=class{constructor(t){this.jt=t}gt(t){this.jt.Ct(t)}Rt(t){this.jt.Lt(t)}At(t){this.jt.kt(t)}Et(){this.jt.$t()}},Pu=class{constructor(t){this.jt=t}gt(t){this.jt.xt(t)}Rt(t){this.jt.Bt(t)}At(t){this.jt.Kt(t)}Et(){this.jt.Wt()}},mn=class{constructor(){this.jt=new Su,this.Ht=new Cu(this.jt),this.Jt=new Pu(this.jt)}seed(t){this.jt.seed(t)}Yt(t){return t===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}};var pn=class r{constructor(t,e,n,i){this.indexId=t,this.documentKey=e,this.arrayValue=n,this.directionalValue=i}Zt(){let t=this.directionalValue.length,e=t===0||this.directionalValue[t-1]===255?t+1:t,n=new Uint8Array(e);return n.set(this.directionalValue,0),e!==t?n.set([0],this.directionalValue.length):++n[n.length-1],new r(this.indexId,this.documentKey,this.arrayValue,n)}};function qe(r,t){let e=r.indexId-t.indexId;return e!==0?e:(e=ff(r.arrayValue,t.arrayValue),e!==0?e:(e=ff(r.directionalValue,t.directionalValue),e!==0?e:F.comparator(r.documentKey,t.documentKey)))}function ff(r,t){for(let e=0;e<r.length&&e<t.length;++e){let n=r[e]-t[e];if(n!==0)return n}return r.length-t.length}var Ws=class{constructor(t){this.Xt=new st((e,n)=>_t.comparator(e.field,n.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.en=t.orderBy,this.tn=[];for(let e of t.filters){let n=e;n.isInequality()?this.Xt=this.Xt.add(n):this.tn.push(n)}}get nn(){return this.Xt.size>1}rn(t){if(q(t.collectionGroup===this.collectionId),this.nn)return!1;let e=Ha(t);if(e!==void 0&&!this.sn(e))return!1;let n=hn(t),i=new Set,s=0,a=0;for(;s<n.length&&this.sn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Xt.size>0){let u=this.Xt.getIterator().getNext();if(!i.has(u.field.canonicalString())){let l=n[s];if(!this.on(u,l)||!this._n(this.en[a++],l))return!1}++s}for(;s<n.length;++s){let u=n[s];if(a>=this.en.length||!this._n(this.en[a++],u))return!1}return!0}an(){if(this.nn)return null;let t=new st(_t.comparator),e=[];for(let n of this.tn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")e.push(new tr(n.field,2));else{if(t.has(n.field))continue;t=t.add(n.field),e.push(new tr(n.field,0))}for(let n of this.en)n.field.isKeyField()||t.has(n.field)||(t=t.add(n.field),e.push(new tr(n.field,n.dir==="asc"?0:1)));return new ir(ir.UNKNOWN_ID,this.collectionId,e,pi.empty())}sn(t){for(let e of this.tn)if(this.on(e,t))return!0;return!1}on(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let n=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===n}_n(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};function Fm(r){var t,e;if(q(r instanceof W||r instanceof rt),r instanceof W){if(r instanceof Ls){let i=((e=(t=r.value.arrayValue)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.map(s=>W.create(r.field,"==",s)))||[];return rt.create(i,"or")}return r}let n=r.filters.map(i=>Fm(i));return rt.create(n,r.op)}function Q_(r){if(r.getFilters().length===0)return[];let t=Du(Fm(r));return q(Lm(t)),xu(t)||Ru(t)?[t]:t.getFilters()}function xu(r){return r instanceof W}function Ru(r){return r instanceof rt&&$c(r)}function Lm(r){return xu(r)||Ru(r)||function(e){if(e instanceof rt&&ru(e)){for(let n of e.getFilters())if(!xu(n)&&!Ru(n))return!1;return!0}return!1}(r)}function Du(r){if(q(r instanceof W||r instanceof rt),r instanceof W)return r;if(r.filters.length===1)return Du(r.filters[0]);let t=r.filters.map(n=>Du(n)),e=rt.create(t,r.op);return e=Hs(e),Lm(e)?e:(q(e instanceof rt),q(or(e)),q(e.filters.length>1),e.filters.reduce((n,i)=>Xc(n,i)))}function Xc(r,t){let e;return q(r instanceof W||r instanceof rt),q(t instanceof W||t instanceof rt),e=r instanceof W?t instanceof W?function(i,s){return rt.create([i,s],"and")}(r,t):mf(r,t):t instanceof W?mf(t,r):function(i,s){if(q(i.filters.length>0&&s.filters.length>0),or(i)&&or(s))return rm(i,s.getFilters());let a=ru(i)?i:s,u=ru(i)?s:i,l=a.filters.map(d=>Xc(d,u));return rt.create(l,"or")}(r,t),Hs(e)}function mf(r,t){if(or(t))return rm(t,r.getFilters());{let e=t.filters.map(n=>Xc(r,n));return rt.create(e,"or")}}function Hs(r){if(q(r instanceof W||r instanceof rt),r instanceof W)return r;let t=r.getFilters();if(t.length===1)return Hs(t[0]);if(em(r))return r;let e=t.map(i=>Hs(i)),n=[];return e.forEach(i=>{i instanceof W?n.push(i):i instanceof rt&&(i.op===r.op?n.push(...i.filters):n.push(i))}),n.length===1?n[0]:rt.create(n,r.op)}var Vu=class{constructor(){this.un=new Pi}addToCollectionParentIndex(t,e){return this.un.add(e),S.resolve()}getCollectionParents(t,e){return S.resolve(this.un.getEntries(e))}addFieldIndex(t,e){return S.resolve()}deleteFieldIndex(t,e){return S.resolve()}deleteAllFieldIndexes(t){return S.resolve()}createTargetIndexes(t,e){return S.resolve()}getDocumentsMatchingTarget(t,e){return S.resolve(null)}getIndexType(t,e){return S.resolve(0)}getFieldIndexes(t,e){return S.resolve([])}getNextCollectionGroupToUpdate(t){return S.resolve(null)}getMinOffset(t,e){return S.resolve(Xt.min())}getMinOffsetFromCollectionGroup(t,e){return S.resolve(Xt.min())}updateCollectionGroup(t,e,n){return S.resolve()}updateIndexEntries(t,e){return S.resolve()}},Pi=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new st(Y.comparator),s=!i.has(n);return this.index[e]=i.add(n),s}has(t){let e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new st(Y.comparator)).toArray()}};var Is=new Uint8Array(0),Nu=class{constructor(t,e){this.databaseId=e,this.cn=new Pi,this.ln=new _e(n=>In(n),(n,i)=>Fi(n,i)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.cn.has(e)){let n=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(()=>{this.cn.add(e)});let s={collectionId:n,parent:Bt(i)};return pf(t).put(s)}return S.resolve()}getCollectionParents(t,e){let n=[],i=IDBKeyRange.bound([e,""],[Bf(e),""],!1,!0);return pf(t).U(i).next(s=>{for(let a of s){if(a.collectionId!==e)break;n.push(le(a.parent))}return n})}addFieldIndex(t,e){let n=si(t),i=function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(e);delete i.indexId;let s=n.add(i);if(e.indexState){let a=$n(t);return s.next(u=>{a.put(cf(u,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return s.next()}deleteFieldIndex(t,e){let n=si(t),i=$n(t),s=Kn(t);return n.delete(e.indexId).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=si(t),n=Kn(t),i=$n(t);return e.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(t,e){return S.forEach(this.hn(e),n=>this.getIndexType(t,n).next(i=>{if(i===0||i===1){let s=new Ws(n).an();if(s!=null)return this.addFieldIndex(t,s)}}))}getDocumentsMatchingTarget(t,e){let n=Kn(t),i=!0,s=new Map;return S.forEach(this.hn(e),a=>this.Pn(t,a).next(u=>{i&&(i=!!u),s.set(a,u)})).next(()=>{if(i){let a=$(),u=[];return S.forEach(s,(l,d)=>{D("IndexedDbIndexManager",`Using index ${function(B){return`id=${B.indexId}|cg=${B.collectionGroup}|f=${B.fields.map(Q=>`${Q.fieldPath}:${Q.kind}`).join(",")}`}(l)} to execute ${In(e)}`);let f=function(B,Q){let H=Ha(Q);if(H===void 0)return null;for(let K of Bs(B,H.fieldPath))switch(K.op){case"array-contains-any":return K.value.arrayValue.values||[];case"array-contains":return[K.value]}return null}(d,l),p=function(B,Q){let H=new Map;for(let K of hn(Q))for(let w of Bs(B,K.fieldPath))switch(w.op){case"==":case"in":H.set(K.fieldPath.canonicalString(),w.value);break;case"not-in":case"!=":return H.set(K.fieldPath.canonicalString(),w.value),Array.from(H.values())}return null}(d,l),_=function(B,Q){let H=[],K=!0;for(let w of hn(Q)){let g=w.kind===0?Qd(B,w.fieldPath,B.startAt):Wd(B,w.fieldPath,B.startAt);H.push(g.value),K&&(K=g.inclusive)}return new ge(H,K)}(d,l),b=function(B,Q){let H=[],K=!0;for(let w of hn(Q)){let g=w.kind===0?Wd(B,w.fieldPath,B.endAt):Qd(B,w.fieldPath,B.endAt);H.push(g.value),K&&(K=g.inclusive)}return new ge(H,K)}(d,l),N=this.In(l,d,_),k=this.In(l,d,b),V=this.Tn(l,d,p),j=this.En(l.indexId,f,N,_.inclusive,k,b.inclusive,V);return S.forEach(j,G=>n.G(G,e.limit).next(B=>{B.forEach(Q=>{let H=F.fromSegments(Q.documentKey);a.has(H)||(a=a.add(H),u.push(H))})}))}).next(()=>u)}return S.resolve(null)})}hn(t){let e=this.ln.get(t);return e||(t.filters.length===0?e=[t]:e=Q_(rt.create(t.filters,"and")).map(n=>du(t.path,t.collectionGroup,t.orderBy,n.getFilters(),t.limit,t.startAt,t.endAt)),this.ln.set(t,e),e)}En(t,e,n,i,s,a,u){let l=(e!=null?e.length:1)*Math.max(n.length,s.length),d=l/(e!=null?e.length:1),f=[];for(let p=0;p<l;++p){let _=e?this.dn(e[p/d]):Is,b=this.An(t,_,n[p%d],i),N=this.Rn(t,_,s[p%d],a),k=u.map(V=>this.An(t,_,V,!0));f.push(...this.createRange(b,N,k))}return f}An(t,e,n,i){let s=new pn(t,F.empty(),e,n);return i?s:s.Zt()}Rn(t,e,n,i){let s=new pn(t,F.empty(),e,n);return i?s.Zt():s}Pn(t,e){let n=new Ws(e),i=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,i).next(s=>{let a=null;for(let u of s)n.rn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(t,e){let n=2,i=this.hn(e);return S.forEach(i,s=>this.Pn(t,s).next(a=>{a?n!==0&&a.fields.length<function(l){let d=new st(_t.comparator),f=!1;for(let p of l.filters)for(let _ of p.getFlattenedFilters())_.field.isKeyField()||(_.op==="array-contains"||_.op==="array-contains-any"?f=!0:d=d.add(_.field));for(let p of l.orderBy)p.field.isKeyField()||(d=d.add(p.field));return d.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>function(a){return a.limit!==null}(e)&&i.length>1&&n===2?1:n)}Vn(t,e){let n=new mn;for(let i of hn(t)){let s=e.data.field(i.fieldPath);if(s==null)return null;let a=n.Yt(i.kind);be.vt.It(s,a)}return n.zt()}dn(t){let e=new mn;return be.vt.It(t,e.Yt(0)),e.zt()}mn(t,e){let n=new mn;return be.vt.It(vn(this.databaseId,e),n.Yt(function(s){let a=hn(s);return a.length===0?0:a[a.length-1].kind}(t))),n.zt()}Tn(t,e,n){if(n===null)return[];let i=[];i.push(new mn);let s=0;for(let a of hn(t)){let u=n[s++];for(let l of i)if(this.fn(e,a.fieldPath)&&wi(u))i=this.gn(i,a,u);else{let d=l.Yt(a.kind);be.vt.It(u,d)}}return this.pn(i)}In(t,e,n){return this.Tn(t,e,n.position)}pn(t){let e=[];for(let n=0;n<t.length;++n)e[n]=t[n].zt();return e}gn(t,e,n){let i=[...t],s=[];for(let a of n.arrayValue.values||[])for(let u of i){let l=new mn;l.seed(u.zt()),be.vt.It(a,l.Yt(e.kind)),s.push(l)}return s}fn(t,e){return!!t.filters.find(n=>n instanceof W&&n.field.isEqual(e)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(t,e){let n=si(t),i=$n(t);return(e?n.U("collectionGroupIndex",IDBKeyRange.bound(e,e)):n.U()).next(s=>{let a=[];return S.forEach(s,u=>i.get([u.indexId,this.uid]).next(l=>{a.push(function(f,p){let _=p?new pi(p.sequenceNumber,new Xt(An(p.readTime),new F(le(p.documentKey)),p.largestBatchId)):pi.empty(),b=f.fields.map(([N,k])=>new tr(_t.fromServerFormat(N),k));return new ir(f.indexId,f.collectionGroup,b,_)}(u,l))})).next(()=>a)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((n,i)=>{let s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:z(n.collectionGroup,i.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,n){let i=si(t),s=$n(t);return this.yn(t).next(a=>i.U("collectionGroupIndex",IDBKeyRange.bound(e,e)).next(u=>S.forEach(u,l=>s.put(cf(l.indexId,this.uid,a,n)))))}updateIndexEntries(t,e){let n=new Map;return S.forEach(e,(i,s)=>{let a=n.get(i.collectionGroup);return(a?S.resolve(a):this.getFieldIndexes(t,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),S.forEach(u,l=>this.wn(t,i,l).next(d=>{let f=this.Sn(s,l);return d.isEqual(f)?S.resolve():this.bn(t,s,l,d,f)}))))})}Dn(t,e,n,i){return Kn(t).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(n,e.key),documentKey:e.key.path.toArray()})}vn(t,e,n,i){return Kn(t).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(n,e.key),e.key.path.toArray()])}wn(t,e,n){let i=Kn(t),s=new st(qe);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,e)])},(a,u)=>{s=s.add(new pn(n.indexId,e,u.arrayValue,u.directionalValue))}).next(()=>s)}Sn(t,e){let n=new st(qe),i=this.Vn(e,t);if(i==null)return n;let s=Ha(e);if(s!=null){let a=t.data.field(s.fieldPath);if(wi(a))for(let u of a.arrayValue.values||[])n=n.add(new pn(e.indexId,t.key,this.dn(u),i))}else n=n.add(new pn(e.indexId,t.key,Is,i));return n}bn(t,e,n,i,s){D("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);let a=[];return function(l,d,f,p,_){let b=l.getIterator(),N=d.getIterator(),k=zn(b),V=zn(N);for(;k||V;){let j=!1,G=!1;if(k&&V){let B=f(k,V);B<0?G=!0:B>0&&(j=!0)}else k!=null?G=!0:j=!0;j?(p(V),V=zn(N)):G?(_(k),k=zn(b)):(k=zn(b),V=zn(N))}}(i,s,qe,u=>{a.push(this.Dn(t,e,n,u))},u=>{a.push(this.vn(t,e,n,u))}),S.waitFor(a)}yn(t){let e=1;return $n(t).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),e=i.sequenceNumber+1}).next(()=>e)}createRange(t,e,n){n=n.sort((a,u)=>qe(a,u)).filter((a,u,l)=>!u||qe(a,l[u-1])!==0);let i=[];i.push(t);for(let a of n){let u=qe(a,t),l=qe(a,e);if(u===0)i[0]=t.Zt();else if(u>0&&l<0)i.push(a),i.push(a.Zt());else if(l>0)break}i.push(e);let s=[];for(let a=0;a<i.length;a+=2){if(this.Cn(i[a],i[a+1]))return[];let u=[i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,Is,[]],l=[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,Is,[]];s.push(IDBKeyRange.bound(u,l))}return s}Cn(t,e){return qe(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(gf)}getMinOffset(t,e){return S.mapArray(this.hn(e),n=>this.Pn(t,n).next(i=>i||L())).next(gf)}};function pf(r){return St(r,"collectionParents")}function Kn(r){return St(r,"indexEntries")}function si(r){return St(r,"indexConfiguration")}function $n(r){return St(r,"indexState")}function gf(r){q(r.length!==0);let t=r[0].indexState.offset,e=t.largestBatchId;for(let n=1;n<r.length;n++){let i=r[n].indexState.offset;jc(i,t)<0&&(t=i),e<i.largestBatchId&&(e=i.largestBatchId)}return new Xt(t.readTime,t.documentKey,e)}var _f={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Yt=class r{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new r(t,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function qm(r,t,e){let n=r.store("mutations"),i=r.store("documentMutations"),s=[],a=IDBKeyRange.only(e.batchId),u=0,l=n.J({range:a},(f,p,_)=>(u++,_.delete()));s.push(l.next(()=>{q(u===1)}));let d=[];for(let f of e.mutations){let p=$f(t,f.key.path,e.batchId);s.push(i.delete(p)),d.push(f.key)}return S.waitFor(s).next(()=>d)}function Js(r){if(!r)return 0;let t;if(r.document)t=r.document;else if(r.unknownDocument)t=r.unknownDocument;else{if(!r.noDocument)throw L();t=r.noDocument}return JSON.stringify(t).length}Yt.DEFAULT_COLLECTION_PERCENTILE=10,Yt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Yt.DEFAULT=new Yt(41943040,Yt.DEFAULT_COLLECTION_PERCENTILE,Yt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Yt.DISABLED=new Yt(-1,0,0);var Ys=class r{constructor(t,e,n,i){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=i,this.Fn={}}static lt(t,e,n,i){q(t.uid!=="");let s=t.isAuthenticated()?t.uid:"";return new r(s,e,n,i)}checkEmpty(t){let e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Be(t).J({index:"userMutationsIndex",range:n},(i,s,a)=>{e=!1,a.done()}).next(()=>e)}addMutationBatch(t,e,n,i){let s=Xn(t),a=Be(t);return a.add({}).next(u=>{q(typeof u=="number");let l=new Ti(u,e,n,i),d=function(b,N,k){let V=k.baseMutations.map(G=>Ci(b.ct,G)),j=k.mutations.map(G=>Ci(b.ct,G));return{userId:N,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:V,mutations:j}}(this.serializer,this.userId,l),f=[],p=new st((_,b)=>z(_.canonicalString(),b.canonicalString()));for(let _ of i){let b=$f(this.userId,_.key.path,u);p=p.add(_.key.path.popLast()),f.push(a.put(d)),f.push(s.put(b,Zg))}return p.forEach(_=>{f.push(this.indexManager.addToCollectionParentIndex(t,_))}),t.addOnCommittedListener(()=>{this.Fn[u]=l.keys()}),S.waitFor(f).next(()=>l)})}lookupMutationBatch(t,e){return Be(t).get(e).next(n=>n?(q(n.userId===this.userId),fn(this.serializer,n)):null)}Mn(t,e){return this.Fn[e]?S.resolve(this.Fn[e]):this.lookupMutationBatch(t,e).next(n=>{if(n){let i=n.keys();return this.Fn[e]=i,i}return null})}getNextMutationBatchAfterBatchId(t,e){let n=e+1,i=IDBKeyRange.lowerBound([this.userId,n]),s=null;return Be(t).J({index:"userMutationsIndex",range:i},(a,u,l)=>{u.userId===this.userId&&(q(u.batchId>=n),s=fn(this.serializer,u)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Be(t).J({index:"userMutationsIndex",range:e,reverse:!0},(i,s,a)=>{n=s.batchId,a.done()}).next(()=>n)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Be(t).U("userMutationsIndex",e).next(n=>n.map(i=>fn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(t,e){let n=bs(this.userId,e.path),i=IDBKeyRange.lowerBound(n),s=[];return Xn(t).J({range:i},(a,u,l)=>{let[d,f,p]=a,_=le(f);if(d===this.userId&&e.path.isEqual(_))return Be(t).get(p).next(b=>{if(!b)throw L();q(b.userId===this.userId),s.push(fn(this.serializer,b))});l.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new st(z),i=[];return e.forEach(s=>{let a=bs(this.userId,s.path),u=IDBKeyRange.lowerBound(a),l=Xn(t).J({range:u},(d,f,p)=>{let[_,b,N]=d,k=le(b);_===this.userId&&s.path.isEqual(k)?n=n.add(N):p.done()});i.push(l)}),S.waitFor(i).next(()=>this.xn(t,n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,i=n.length+1,s=bs(this.userId,n),a=IDBKeyRange.lowerBound(s),u=new st(z);return Xn(t).J({range:a},(l,d,f)=>{let[p,_,b]=l,N=le(_);p===this.userId&&n.isPrefixOf(N)?N.length===i&&(u=u.add(b)):f.done()}).next(()=>this.xn(t,u))}xn(t,e){let n=[],i=[];return e.forEach(s=>{i.push(Be(t).get(s).next(a=>{if(a===null)throw L();q(a.userId===this.userId),n.push(fn(this.serializer,a))}))}),S.waitFor(i).next(()=>n)}removeMutationBatch(t,e){return qm(t._e,this.userId,e).next(n=>(t.addOnCommittedListener(()=>{this.On(e.batchId)}),S.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(t,i))))}On(t){delete this.Fn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return S.resolve();let n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return Xn(t).J({range:n},(s,a,u)=>{if(s[0]===this.userId){let l=le(s[1]);i.push(l)}else u.done()}).next(()=>{q(i.length===0)})})}containsKey(t,e){return Bm(t,this.userId,e)}Nn(t){return Um(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function Bm(r,t,e){let n=bs(t,e.path),i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return Xn(r).J({range:s,H:!0},(u,l,d)=>{let[f,p,_]=u;f===t&&p===i&&(a=!0),d.done()}).next(()=>a)}function Be(r){return St(r,"mutations")}function Xn(r){return St(r,"documentMutations")}function Um(r){return St(r,"mutationQueues")}var hr=class r{constructor(t){this.Ln=t}next(){return this.Ln+=2,this.Ln}static Bn(){return new r(0)}static kn(){return new r(-1)}};var ku=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.qn(t).next(e=>{let n=new hr(e.highestTargetId);return e.highestTargetId=n.next(),this.Qn(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.qn(t).next(e=>U.fromTimestamp(new lt(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.qn(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,n){return this.qn(t).next(i=>(i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),this.Qn(t,i)))}addTargetData(t,e){return this.Kn(t,e).next(()=>this.qn(t).next(n=>(n.targetCount+=1,this.$n(e,n),this.Qn(t,n))))}updateTargetData(t,e){return this.Kn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Qn(t).delete(e.targetId)).next(()=>this.qn(t)).next(n=>(q(n.targetCount>0),n.targetCount-=1,this.Qn(t,n)))}removeTargets(t,e,n){let i=0,s=[];return Qn(t).J((a,u)=>{let l=ci(u);l.sequenceNumber<=e&&n.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(t,l)))}).next(()=>S.waitFor(s)).next(()=>i)}forEachTarget(t,e){return Qn(t).J((n,i)=>{let s=ci(i);e(s)})}qn(t){return yf(t).get("targetGlobalKey").next(e=>(q(e!==null),e))}Qn(t,e){return yf(t).put("targetGlobalKey",e)}Kn(t,e){return Qn(t).put(Om(this.serializer,e))}$n(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.qn(t).next(e=>e.targetCount)}getTargetData(t,e){let n=In(e),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),s=null;return Qn(t).J({range:i,index:"queryTargetsIndex"},(a,u,l)=>{let d=ci(u);Fi(e,d.target)&&(s=d,l.done())}).next(()=>s)}addMatchingKeys(t,e,n){let i=[],s=Ue(t);return e.forEach(a=>{let u=Bt(a.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(t,n,a))}),S.waitFor(i)}removeMatchingKeys(t,e,n){let i=Ue(t);return S.forEach(e,s=>{let a=Bt(s.path);return S.waitFor([i.delete([n,a]),this.referenceDelegate.removeReference(t,n,s)])})}removeMatchingKeysForTargetId(t,e){let n=Ue(t),i=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(t,e){let n=IDBKeyRange.bound([e],[e+1],!1,!0),i=Ue(t),s=$();return i.J({range:n,H:!0},(a,u,l)=>{let d=le(a[1]),f=new F(d);s=s.add(f)}).next(()=>s)}containsKey(t,e){let n=Bt(e.path),i=IDBKeyRange.bound([n],[Bf(n)],!1,!0),s=0;return Ue(t).J({index:"documentTargetsIndex",H:!0,range:i},([a,u],l,d)=>{a!==0&&(s++,d.done())}).next(()=>s>0)}ot(t,e){return Qn(t).get(e).next(n=>n?ci(n):null)}};function Qn(r){return St(r,"targets")}function yf(r){return St(r,"targetGlobal")}function Ue(r){return St(r,"targetDocuments")}function vf([r,t],[e,n]){let i=z(r,e);return i===0?z(t,n):i}var Mu=class{constructor(t){this.Un=t,this.buffer=new st(vf),this.Wn=0}Gn(){return++this.Wn}zn(t){let e=[t,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(e);else{let n=this.buffer.last();vf(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}},Ou=class{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(t){D("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>x(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){nn(e)?D("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):yield en(e)}yield this.Hn(3e5)}))}},Fu=class{constructor(t,e){this.Jn=t,this.params=e}calculateTargetCount(t,e){return this.Jn.Yn(t).next(n=>Math.floor(e/100*n))}nthSequenceNumber(t,e){if(e===0)return S.resolve(Qt.oe);let n=new Mu(e);return this.Jn.forEachTarget(t,i=>n.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(t,i=>n.zn(i))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.Jn.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.Jn.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(D("LruGarbageCollector","Garbage collection skipped; disabled"),S.resolve(_f)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),_f):this.Xn(t,e))}getCacheSize(t){return this.Jn.getCacheSize(t)}Xn(t,e){let n,i,s,a,u,l,d,f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,a=Date.now(),this.nthSequenceNumber(t,i))).next(p=>(n=p,u=Date.now(),this.removeTargets(t,n,e))).next(p=>(s=p,l=Date.now(),this.removeOrphanedDocuments(t,n))).next(p=>(d=Date.now(),Wn()<=ce.DEBUG&&D("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${s} targets in `+(l-u)+`ms
	Removed ${p} documents in `+(d-l)+`ms
Total Duration: ${d-f}ms`),S.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:p})))}};function W_(r,t){return new Fu(r,t)}var Lu=class{constructor(t,e){this.db=t,this.garbageCollector=W_(this,e)}Yn(t){let e=this.er(t);return this.db.getTargetCache().getTargetCount(t).next(n=>e.next(i=>n+i))}er(t){let e=0;return this.Zn(t,n=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}Zn(t,e){return this.tr(t,(n,i)=>e(i))}addReference(t,e,n){return Ts(t,n)}removeReference(t,e,n){return Ts(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return Ts(t,e)}nr(t,e){return function(i,s){let a=!1;return Um(i).Y(u=>Bm(i,u,s).next(l=>(l&&(a=!0),S.resolve(!l)))).next(()=>a)}(t,e)}removeOrphanedDocuments(t,e){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.tr(t,(a,u)=>{if(u<=e){let l=this.nr(t,a).next(d=>{if(!d)return s++,n.getEntry(t,a).next(()=>(n.removeEntry(a,U.min()),Ue(t).delete(function(p){return[0,Bt(p.path)]}(a))))});i.push(l)}}).next(()=>S.waitFor(i)).next(()=>n.apply(t)).next(()=>s)}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return Ts(t,e)}tr(t,e){let n=Ue(t),i,s=Qt.oe;return n.J({index:"documentTargetsIndex"},([a,u],{path:l,sequenceNumber:d})=>{a===0?(s!==Qt.oe&&e(new F(le(i)),s),s=d,i=l):s=Qt.oe}).next(()=>{s!==Qt.oe&&e(new F(le(i)),s)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};function Ts(r,t){return Ue(r).put(function(n,i){return{targetId:0,path:Bt(n.path),sequenceNumber:i}}(t,r.currentSequenceNumber))}var Xs=class{constructor(){this.changes=new _e(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Et.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let n=this.changes.get(e);return n!==void 0?S.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var qu=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return ln(t).put(n)}removeEntry(t,e,n){return ln(t).delete(function(s,a){let u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],$s(a),u[u.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.rr(t,n)))}getEntry(t,e){let n=Et.newInvalidDocument(e);return ln(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(oi(e))},(i,s)=>{n=this.ir(e,s)}).next(()=>n)}sr(t,e){let n={size:0,document:Et.newInvalidDocument(e)};return ln(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(oi(e))},(i,s)=>{n={document:this.ir(e,s),size:Js(s)}}).next(()=>n)}getEntries(t,e){let n=zt();return this._r(t,e,(i,s)=>{let a=this.ir(i,s);n=n.insert(i,a)}).next(()=>n)}ar(t,e){let n=zt(),i=new ut(F.comparator);return this._r(t,e,(s,a)=>{let u=this.ir(s,a);n=n.insert(s,u),i=i.insert(s,Js(a))}).next(()=>({documents:n,ur:i}))}_r(t,e,n){if(e.isEmpty())return S.resolve();let i=new st(Tf);e.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound(oi(i.first()),oi(i.last())),a=i.getIterator(),u=a.getNext();return ln(t).J({index:"documentKeyIndex",range:s},(l,d,f)=>{let p=F.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;u&&Tf(u,p)<0;)n(u,null),u=a.getNext();u&&u.isEqual(p)&&(n(u,d),u=a.hasNext()?a.getNext():null),u?f.$(oi(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(t,e,n,i,s){let a=e.path,u=[a.popLast().toArray(),a.lastSegment(),$s(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],l=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ln(t).U(IDBKeyRange.bound(u,l,!0)).next(d=>{s?.incrementDocumentReadCount(d.length);let f=zt();for(let p of d){let _=this.ir(F.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);_.isFoundDocument()&&(qi(e,_)||i.has(_.key))&&(f=f.insert(_.key,_))}return f})}getAllFromCollectionGroup(t,e,n,i){let s=zt(),a=If(e,n),u=If(e,Xt.max());return ln(t).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,u,!0)},(l,d,f)=>{let p=this.ir(F.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);s=s.insert(p.key,p),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(t){return new Bu(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return wf(t).get("remoteDocumentGlobalKey").next(e=>(q(!!e),e))}rr(t,e){return wf(t).put("remoteDocumentGlobalKey",e)}ir(t,e){if(e){let n=K_(this.serializer,e);if(!(n.isNoDocument()&&n.version.isEqual(U.min())))return n}return Et.newInvalidDocument(t)}};function jm(r){return new qu(r)}var Bu=class extends Xs{constructor(t,e){super(),this.cr=t,this.trackRemovals=e,this.lr=new _e(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(t){let e=[],n=0,i=new st((s,a)=>z(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{let u=this.lr.get(s);if(e.push(this.cr.removeEntry(t,s,u.readTime)),a.isValidDocument()){let l=af(this.cr.serializer,a);i=i.add(s.path.popLast());let d=Js(l);n+=d-u.size,e.push(this.cr.addEntry(t,s,l))}else if(n-=u.size,this.trackRemovals){let l=af(this.cr.serializer,a.convertToNoDocument(U.min()));e.push(this.cr.addEntry(t,s,l))}}),i.forEach(s=>{e.push(this.cr.indexManager.addToCollectionParentIndex(t,s))}),e.push(this.cr.updateMetadata(t,n)),S.waitFor(e)}getFromCache(t,e){return this.cr.sr(t,e).next(n=>(this.lr.set(e,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(t,e){return this.cr.ar(t,e).next(({documents:n,ur:i})=>(i.forEach((s,a)=>{this.lr.set(s,{size:a,readTime:n.get(s).readTime})}),n))}};function wf(r){return St(r,"remoteDocumentGlobal")}function ln(r){return St(r,"remoteDocumentsV14")}function oi(r){let t=r.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function If(r,t){let e=t.documentKey.path.toArray();return[r,$s(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function Tf(r,t){let e=r.path.toArray(),n=t.path.toArray(),i=0;for(let s=0;s<e.length-2&&s<n.length-2;++s)if(i=z(e[s],n[s]),i)return i;return i=z(e.length,n.length),i||(i=z(e[e.length-2],n[n.length-2]),i||z(e[e.length-1],n[n.length-1]))}var Uu=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var Zs=class{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(i=>(n=i,this.remoteDocumentCache.getEntry(t,e))).next(i=>(n!==null&&di(n.mutation,i,Wt.empty(),lt.now()),i))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.getLocalViewOfDocuments(t,n,$()).next(()=>n))}getLocalViewOfDocuments(t,e,n=$()){let i=he();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,n).next(s=>{let a=ui();return s.forEach((u,l)=>{a=a.insert(u,l.overlayedDocument)}),a}))}getOverlayedDocuments(t,e){let n=he();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,$()))}populateOverlays(t,e,n){let i=[];return n.forEach(s=>{e.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(t,i).next(s=>{s.forEach((a,u)=>{e.set(a,u)})})}computeViews(t,e,n,i){let s=zt(),a=hi(),u=function(){return hi()}();return e.forEach((l,d)=>{let f=n.get(d.key);i.has(d.key)&&(f===void 0||f.mutation instanceof ie)?s=s.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),di(f.mutation,d,f.mutation.getFieldMask(),lt.now())):a.set(d.key,Wt.empty())}),this.recalculateAndSaveOverlays(t,s).next(l=>(l.forEach((d,f)=>a.set(d,f)),e.forEach((d,f)=>{var p;return u.set(d,new Uu(f,(p=a.get(d))!==null&&p!==void 0?p:null))}),u))}recalculateAndSaveOverlays(t,e){let n=hi(),i=new ut((a,u)=>a-u),s=$();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(a=>{for(let u of a)u.keys().forEach(l=>{let d=e.get(l);if(d===null)return;let f=n.get(l)||Wt.empty();f=u.applyToLocalView(d,f),n.set(l,f);let p=(i.get(u.batchId)||$()).add(l);i=i.insert(u.batchId,p)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let l=u.getNext(),d=l.key,f=l.value,p=dm();f.forEach(_=>{if(!s.has(_)){let b=vm(e.get(_),n.get(_));b!==null&&p.set(_,b),s=s.add(_)}}),a.push(this.documentOverlayCache.saveOverlays(t,d,p))}return S.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.recalculateAndSaveOverlays(t,n))}getDocumentsMatchingQuery(t,e,n,i){return function(a){return F.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Qc(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,i):this.getDocumentsMatchingCollectionQuery(t,e,n,i)}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-s.size):S.resolve(he()),u=-1,l=s;return a.next(d=>S.forEach(d,(f,p)=>(u<p.largestBatchId&&(u=p.largestBatchId),s.get(f)?S.resolve():this.remoteDocumentCache.getEntry(t,f).next(_=>{l=l.insert(f,_)}))).next(()=>this.populateOverlays(t,d,s)).next(()=>this.computeViews(t,l,d,$())).next(f=>({batchId:u,changes:hm(f)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new F(e)).next(n=>{let i=ui();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(t,e,n,i){let s=e.collectionGroup,a=ui();return this.indexManager.getCollectionParents(t,s).next(u=>S.forEach(u,l=>{let d=function(p,_){return new re(_,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(e,l.child(s));return this.getDocumentsMatchingCollectionQuery(t,d,n,i).next(f=>{f.forEach((p,_)=>{a=a.insert(p,_)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s,i))).next(a=>{s.forEach((l,d)=>{let f=d.getKey();a.get(f)===null&&(a=a.insert(f,Et.newInvalidDocument(f)))});let u=ui();return a.forEach((l,d)=>{let f=s.get(l);f!==void 0&&di(f.mutation,d,Wt.empty(),lt.now()),qi(e,d)&&(u=u.insert(l,d))}),u})}};var ju=class{constructor(t){this.serializer=t,this.hr=new Map,this.Pr=new Map}getBundleMetadata(t,e){return S.resolve(this.hr.get(e))}saveBundleMetadata(t,e){return this.hr.set(e.id,function(i){return{id:i.id,version:i.version,createTime:yt(i.createTime)}}(e)),S.resolve()}getNamedQuery(t,e){return S.resolve(this.Pr.get(e))}saveNamedQuery(t,e){return this.Pr.set(e.name,function(i){return{name:i.name,query:Yc(i.bundledQuery),readTime:yt(i.readTime)}}(e)),S.resolve()}};var Gu=class{constructor(){this.overlays=new ut(F.comparator),this.Ir=new Map}getOverlay(t,e){return S.resolve(this.overlays.get(e))}getOverlays(t,e){let n=he();return S.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((i,s)=>{this.ht(t,e,s)}),S.resolve()}removeOverlaysForBatchId(t,e,n){let i=this.Ir.get(n);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(n)),S.resolve()}getOverlaysForCollection(t,e,n){let i=he(),s=e.length+1,a=new F(e.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let l=u.getNext().value,d=l.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===s&&l.largestBatchId>n&&i.set(l.getKey(),l)}return S.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let s=new ut((d,f)=>d-f),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>n){let f=s.get(d.largestBatchId);f===null&&(f=he(),s=s.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}let u=he(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,f)=>u.set(d,f)),!(u.size()>=i)););return S.resolve(u)}ht(t,e,n){let i=this.overlays.get(n.key);if(i!==null){let a=this.Ir.get(i.largestBatchId).delete(n.key);this.Ir.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new Ei(e,n));let s=this.Ir.get(e);s===void 0&&(s=$(),this.Ir.set(e,s)),this.Ir.set(e,s.add(n.key))}};var zu=class{constructor(){this.sessionToken=vt.EMPTY_BYTE_STRING}getSessionToken(t){return S.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,S.resolve()}};var xi=class{constructor(){this.Tr=new st(It.Er),this.dr=new st(It.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(t,e){let n=new It(t,e);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(t,e){t.forEach(n=>this.addReference(n,e))}removeReference(t,e){this.Vr(new It(t,e))}mr(t,e){t.forEach(n=>this.removeReference(n,e))}gr(t){let e=new F(new Y([])),n=new It(e,t),i=new It(e,t+1),s=[];return this.dr.forEachInRange([n,i],a=>{this.Vr(a),s.push(a.key)}),s}pr(){this.Tr.forEach(t=>this.Vr(t))}Vr(t){this.Tr=this.Tr.delete(t),this.dr=this.dr.delete(t)}yr(t){let e=new F(new Y([])),n=new It(e,t),i=new It(e,t+1),s=$();return this.dr.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(t){let e=new It(t,0),n=this.Tr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}},It=class{constructor(t,e){this.key=t,this.wr=e}static Er(t,e){return F.comparator(t.key,e.key)||z(t.wr,e.wr)}static Ar(t,e){return z(t.wr,e.wr)||F.comparator(t.key,e.key)}};var Ku=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.Sr=1,this.br=new st(It.Er)}checkEmpty(t){return S.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,i){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Ti(s,e,n,i);this.mutationQueue.push(a);for(let u of i)this.br=this.br.add(new It(u.key,s)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return S.resolve(a)}lookupMutationBatch(t,e){return S.resolve(this.Dr(e))}getNextMutationBatchAfterBatchId(t,e){let n=e+1,i=this.vr(n),s=i<0?0:i;return S.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return S.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(t){return S.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let n=new It(e,0),i=new It(e,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([n,i],a=>{let u=this.Dr(a.wr);s.push(u)}),S.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new st(z);return e.forEach(i=>{let s=new It(i,0),a=new It(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,a],u=>{n=n.add(u.wr)})}),S.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,i=n.length+1,s=n;F.isDocumentKey(s)||(s=s.child(""));let a=new It(new F(s),0),u=new st(z);return this.br.forEachWhile(l=>{let d=l.key.path;return!!n.isPrefixOf(d)&&(d.length===i&&(u=u.add(l.wr)),!0)},a),S.resolve(this.Cr(u))}Cr(t){let e=[];return t.forEach(n=>{let i=this.Dr(n);i!==null&&e.push(i)}),e}removeMutationBatch(t,e){q(this.Fr(e.batchId,"removed")===0),this.mutationQueue.shift();let n=this.br;return S.forEach(e.mutations,i=>{let s=new It(i.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.br=n})}On(t){}containsKey(t,e){let n=new It(e,0),i=this.br.firstAfterOrEqual(n);return S.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,S.resolve()}Fr(t,e){return this.vr(t)}vr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Dr(t){let e=this.vr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var $u=class{constructor(t){this.Mr=t,this.docs=function(){return new ut(F.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let n=e.key,i=this.docs.get(n),s=i?i.size:0,a=this.Mr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let n=this.docs.get(e);return S.resolve(n?n.document.mutableCopy():Et.newInvalidDocument(e))}getEntries(t,e){let n=zt();return e.forEach(i=>{let s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():Et.newInvalidDocument(i))}),S.resolve(n)}getDocumentsMatchingQuery(t,e,n,i){let s=zt(),a=e.path,u=new F(a.child("")),l=this.docs.getIteratorFrom(u);for(;l.hasNext();){let{key:d,value:{document:f}}=l.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||jc(jf(f),n)<=0||(i.has(f.key)||qi(e,f))&&(s=s.insert(f.key,f.mutableCopy()))}return S.resolve(s)}getAllFromCollectionGroup(t,e,n,i){L()}Or(t,e){return S.forEach(this.docs,n=>e(n))}newChangeBuffer(t){return new Qu(this)}getSize(t){return S.resolve(this.size)}},Qu=class extends Xs{constructor(t){super(),this.cr=t}applyChanges(t){let e=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?e.push(this.cr.addEntry(t,i)):this.cr.removeEntry(n)}),S.waitFor(e)}getFromCache(t,e){return this.cr.getEntry(t,e)}getAllFromCache(t,e){return this.cr.getEntries(t,e)}};var Wu=class{constructor(t){this.persistence=t,this.Nr=new _e(e=>In(e),Fi),this.lastRemoteSnapshotVersion=U.min(),this.highestTargetId=0,this.Lr=0,this.Br=new xi,this.targetCount=0,this.kr=hr.Bn()}forEachTarget(t,e){return this.Nr.forEach((n,i)=>e(i)),S.resolve()}getLastRemoteSnapshotVersion(t){return S.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return S.resolve(this.Lr)}allocateTargetId(t){return this.highestTargetId=this.kr.next(),S.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Lr&&(this.Lr=e),S.resolve()}Kn(t){this.Nr.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.kr=new hr(e),this.highestTargetId=e),t.sequenceNumber>this.Lr&&(this.Lr=t.sequenceNumber)}addTargetData(t,e){return this.Kn(e),this.targetCount+=1,S.resolve()}updateTargetData(t,e){return this.Kn(e),S.resolve()}removeTargetData(t,e){return this.Nr.delete(e.target),this.Br.gr(e.targetId),this.targetCount-=1,S.resolve()}removeTargets(t,e,n){let i=0,s=[];return this.Nr.forEach((a,u)=>{u.sequenceNumber<=e&&n.get(u.targetId)===null&&(this.Nr.delete(a),s.push(this.removeMatchingKeysForTargetId(t,u.targetId)),i++)}),S.waitFor(s).next(()=>i)}getTargetCount(t){return S.resolve(this.targetCount)}getTargetData(t,e){let n=this.Nr.get(e)||null;return S.resolve(n)}addMatchingKeys(t,e,n){return this.Br.Rr(e,n),S.resolve()}removeMatchingKeys(t,e,n){this.Br.mr(e,n);let i=this.persistence.referenceDelegate,s=[];return i&&e.forEach(a=>{s.push(i.markPotentiallyOrphaned(t,a))}),S.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Br.gr(e),S.resolve()}getMatchingKeysForTargetId(t,e){let n=this.Br.yr(e);return S.resolve(n)}containsKey(t,e){return S.resolve(this.Br.containsKey(e))}};var to=class{constructor(t,e){this.qr={},this.overlays={},this.Qr=new Qt(0),this.Kr=!1,this.Kr=!0,this.$r=new zu,this.referenceDelegate=t(this),this.Ur=new Wu(this),this.indexManager=new Vu,this.remoteDocumentCache=function(i){return new $u(i)}(n=>this.referenceDelegate.Wr(n)),this.serializer=new Ks(e),this.Gr=new ju(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Gu,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.qr[t.toKey()];return n||(n=new Ku(e,this.referenceDelegate),this.qr[t.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(t,e,n){D("MemoryPersistence","Starting transaction:",t);let i=new Hu(this.Qr.next());return this.referenceDelegate.zr(),n(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(t,e){return S.or(Object.values(this.qr).map(n=>()=>n.containsKey(t,e)))}},Hu=class extends Ns{constructor(t){super(),this.currentSequenceNumber=t}},eo=class r{constructor(t){this.persistence=t,this.Jr=new xi,this.Yr=null}static Zr(t){return new r(t)}get Xr(){if(this.Yr)return this.Yr;throw L()}addReference(t,e,n){return this.Jr.addReference(n,e),this.Xr.delete(n.toString()),S.resolve()}removeReference(t,e,n){return this.Jr.removeReference(n,e),this.Xr.add(n.toString()),S.resolve()}markPotentiallyOrphaned(t,e){return this.Xr.add(e.toString()),S.resolve()}removeTarget(t,e){this.Jr.gr(e.targetId).forEach(i=>this.Xr.add(i.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>n.removeTargetData(t,e))}zr(){this.Yr=new Set}jr(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return S.forEach(this.Xr,n=>{let i=F.fromPath(n);return this.ei(t,i).next(s=>{s||e.removeEntry(i,U.min())})}).next(()=>(this.Yr=null,e.apply(t)))}updateLimboDocument(t,e){return this.ei(t,e).next(n=>{n?this.Xr.delete(e.toString()):this.Xr.add(e.toString())})}Wr(t){return 0}ei(t,e){return S.or([()=>S.resolve(this.Jr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Hr(t,e)])}};var Ju=class{constructor(t){this.serializer=t}O(t,e,n,i){let s=new ks("createOrUpgrade",e);n<1&&i>=1&&(function(l){l.createObjectStore("owner")}(t),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Fd,{unique:!0}),l.createObjectStore("documentMutations")}(t),Ef(t),function(l){l.createObjectStore("remoteDocuments")}(t));let a=S.resolve();return n<3&&i>=3&&(n!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(t),Ef(t)),a=a.next(()=>function(l){let d=l.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:U.min().toTimestamp(),targetCount:0};return d.put("targetGlobalKey",f)}(s))),n<4&&i>=4&&(n!==0&&(a=a.next(()=>function(l,d){return d.store("mutations").U().next(f=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Fd,{unique:!0});let p=d.store("mutations"),_=f.map(b=>p.put(b));return S.waitFor(_)})}(t,s))),a=a.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(t)})),n<5&&i>=5&&(a=a.next(()=>this.ni(s))),n<6&&i>=6&&(a=a.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(t),this.ri(s)))),n<7&&i>=7&&(a=a.next(()=>this.ii(s))),n<8&&i>=8&&(a=a.next(()=>this.si(t,s))),n<9&&i>=9&&(a=a.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(t)})),n<10&&i>=10&&(a=a.next(()=>this.oi(s))),n<11&&i>=11&&(a=a.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(t),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(t)})),n<12&&i>=12&&(a=a.next(()=>{(function(l){let d=l.createObjectStore("documentOverlays",{keyPath:h_});d.createIndex("collectionPathOverlayIndex",d_,{unique:!1}),d.createIndex("collectionGroupOverlayIndex",f_,{unique:!1})})(t)})),n<13&&i>=13&&(a=a.next(()=>function(l){let d=l.createObjectStore("remoteDocumentsV14",{keyPath:t_});d.createIndex("documentKeyIndex",e_),d.createIndex("collectionGroupIndex",n_)}(t)).next(()=>this._i(t,s)).next(()=>t.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(a=a.next(()=>this.ai(t,s))),n<15&&i>=15&&(a=a.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:a_}).createIndex("sequenceNumberIndex",u_,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:c_}).createIndex("documentKeyIndex",l_,{unique:!1})}(t))),n<16&&i>=16&&(a=a.next(()=>{e.objectStore("indexState").clear()}).next(()=>{e.objectStore("indexEntries").clear()})),n<17&&i>=17&&(a=a.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(t)})),a}ri(t){let e=0;return t.store("remoteDocuments").J((n,i)=>{e+=Js(i)}).next(()=>{let n={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ni(t){let e=t.store("mutationQueues"),n=t.store("mutations");return e.U().next(i=>S.forEach(i,s=>{let a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",a).next(u=>S.forEach(u,l=>{q(l.userId===s.userId);let d=fn(this.serializer,l);return qm(t,s.userId,d).next(()=>{})}))}))}ii(t){let e=t.store("targetDocuments"),n=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return n.J((a,u)=>{let l=new Y(a),d=function(p){return[0,Bt(p)]}(l);s.push(e.get(d).next(f=>f?S.resolve():(p=>e.put({targetId:0,path:Bt(p),sequenceNumber:i.highestListenSequenceNumber}))(l)))}).next(()=>S.waitFor(s))})}si(t,e){t.createObjectStore("collectionParents",{keyPath:o_});let n=e.store("collectionParents"),i=new Pi,s=a=>{if(i.add(a)){let u=a.lastSegment(),l=a.popLast();return n.put({collectionId:u,parent:Bt(l)})}};return e.store("remoteDocuments").J({H:!0},(a,u)=>{let l=new Y(a);return s(l.popLast())}).next(()=>e.store("documentMutations").J({H:!0},([a,u,l],d)=>{let f=le(u);return s(f.popLast())}))}oi(t){let e=t.store("targets");return e.J((n,i)=>{let s=ci(i),a=Om(this.serializer,s);return e.put(a)})}_i(t,e){let n=e.store("remoteDocuments"),i=[];return n.J((s,a)=>{let u=e.store("remoteDocumentsV14"),l=function(p){return p.document?new F(Y.fromString(p.document.name).popFirst(5)):p.noDocument?F.fromSegments(p.noDocument.path):p.unknownDocument?F.fromSegments(p.unknownDocument.path):L()}(a).path.toArray(),d={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};i.push(u.put(d))}).next(()=>S.waitFor(i))}ai(t,e){let n=e.store("mutations"),i=jm(this.serializer),s=new to(eo.Zr,this.serializer.ct);return n.U().next(a=>{let u=new Map;return a.forEach(l=>{var d;let f=(d=u.get(l.userId))!==null&&d!==void 0?d:$();fn(this.serializer,l).keys().forEach(p=>f=f.add(p)),u.set(l.userId,f)}),S.forEach(u,(l,d)=>{let f=new Tt(d),p=Qs.lt(this.serializer,f),_=s.getIndexManager(f),b=Ys.lt(f,this.serializer,_,s.referenceDelegate);return new Zs(i,b,p,_).recalculateAndSaveOverlaysForDocumentKeys(new _i(e,Qt.oe),l).next()})})}};function Ef(r){r.createObjectStore("targetDocuments",{keyPath:i_}).createIndex("documentTargetsIndex",s_,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",r_,{unique:!0}),r.createObjectStore("targetGlobal")}var La="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Yu=class r{constructor(t,e,n,i,s,a,u,l,d,f,p=17){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.ui=s,this.window=a,this.document=u,this.ci=d,this.li=f,this.hi=p,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=_=>Promise.resolve(),!r.D())throw new R(P.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Lu(this,i),this.Ai=e+"main",this.serializer=new Ks(l),this.Ri=new $e(this.Ai,this.hi,new Ju(this.serializer)),this.$r=new bu,this.Ur=new ku(this.referenceDelegate,this.serializer),this.remoteDocumentCache=jm(this.serializer),this.Gr=new Au,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,f===!1&&gt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new R(P.FAILED_PRECONDITION,La);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Ur.getHighestSequenceNumber(t))}).then(t=>{this.Qr=new Qt(t,this.ci)}).then(()=>{this.Kr=!0}).catch(t=>(this.Ri&&this.Ri.close(),Promise.reject(t)))}yi(t){return this.di=e=>x(this,null,function*(){if(this.started)return t(e)}),t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ri.L(e=>x(this,null,function*(){e.newVersion===null&&(yield t())}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.ui.enqueueAndForget(()=>x(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Es(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(t).next(e=>{e||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(t)).next(e=>this.isPrimary&&!e?this.bi(t).next(()=>!1):!!e&&this.Di(t).next(()=>!0))).catch(t=>{if(nn(t))return D("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return D("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.ui.enqueueRetryable(()=>this.di(t)),this.isPrimary=t})}wi(t){return ai(t).get("owner").next(e=>S.resolve(this.vi(e)))}Ci(t){return Es(t).delete(this.clientId)}Fi(){return x(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let t=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let n=St(e,"clientMetadata");return n.U().next(i=>{let s=this.xi(i,18e5),a=i.filter(u=>s.indexOf(u)===-1);return S.forEach(a,u=>n.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Vi)for(let e of t)this.Vi.removeItem(this.Oi(e.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(t){return!!t&&t.ownerId===this.clientId}Si(t){return this.li?S.resolve(!0):ai(t).get("owner").next(e=>{if(e!==null&&this.Mi(e.leaseTimestampMs,5e3)&&!this.Ni(e.ownerId)){if(this.vi(e)&&this.networkEnabled)return!0;if(!this.vi(e)){if(!e.allowTabSynchronization)throw new R(P.FAILED_PRECONDITION,La);return!1}}return!(!this.networkEnabled||!this.inForeground)||Es(t).U().next(n=>this.xi(n,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,a=!this.inForeground&&i.inForeground,u=this.networkEnabled===i.networkEnabled;if(s||a&&u)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&D("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return x(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{let e=new _i(t,Qt.oe);return this.bi(e).next(()=>this.Ci(e))}),this.Ri.close(),this.qi()})}xi(t,e){return t.filter(n=>this.Mi(n.updateTimeMs,e)&&!this.Ni(n.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",t=>Es(t).U().next(e=>this.xi(e,18e5).map(n=>n.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(t,e){return Ys.lt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new Nu(t,this.serializer.ct.databaseId)}getDocumentOverlayCache(t){return Qs.lt(this.serializer,t)}getBundleCache(){return this.Gr}runTransaction(t,e,n){D("IndexedDbPersistence","Starting transaction:",t);let i=e==="readonly"?"readonly":"readwrite",s=function(l){return l===17?g_:l===16?p_:l===15?zc:l===14?Hf:l===13?Wf:l===12?m_:l===11?Qf:void L()}(this.hi),a;return this.Ri.runTransaction(t,i,s,u=>(a=new _i(u,this.Qr?this.Qr.next():Qt.oe),e==="readwrite-primary"?this.wi(a).next(l=>!!l||this.Si(a)).next(l=>{if(!l)throw gt(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new R(P.FAILED_PRECONDITION,Gf);return n(a)}).next(l=>this.Di(a).next(()=>l)):this.Ki(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Ki(t){return ai(t).get("owner").next(e=>{if(e!==null&&this.Mi(e.leaseTimestampMs,5e3)&&!this.Ni(e.ownerId)&&!this.vi(e)&&!(this.li||this.allowTabSynchronization&&e.allowTabSynchronization))throw new R(P.FAILED_PRECONDITION,La)})}Di(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ai(t).put("owner",e)}static D(){return $e.D()}bi(t){let e=ai(t);return e.get("owner").next(n=>this.vi(n)?(D("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):S.resolve())}Mi(t,e){let n=Date.now();return!(t<n-e)&&(!(t>n)||(gt(`Detected an update time that is in the future: ${t} > ${n}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var t;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.Pi=()=>{this.Li();let e=/(?:Version|Mobile)\/1[456]/;Pa()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(t){var e;try{let n=((e=this.Vi)===null||e===void 0?void 0:e.getItem(this.Oi(t)))!==null;return D("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return gt("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(t){gt("Failed to set zombie client id.",t)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};function ai(r){return St(r,"owner")}function Es(r){return St(r,"clientMetadata")}function Zc(r,t){let e=r.projectId;return r.isDefaultDatabase||(e+="."+r.database),"firestore/"+t+"/"+e+"/"}var Xu=class r{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.$i=n,this.Ui=i}static Wi(t,e){let n=$(),i=$();for(let s of e.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new r(t,e.fromCache,n,i)}};var Zu=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var no=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Pa()?8:zf(ti())>0?6:4}()}initialize(t,e){this.Ji=t,this.indexManager=e,this.Gi=!0}getDocumentsMatchingQuery(t,e,n,i){let s={result:null};return this.Yi(t,e).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.Zi(t,e,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new Zu;return this.Xi(t,e,a).next(u=>{if(s.result=u,this.zi)return this.es(t,e,a,u.size)})}).next(()=>s.result)}es(t,e,n,i){return n.documentReadCount<this.ji?(Wn()<=ce.DEBUG&&D("QueryEngine","SDK will not create cache indexes for query:",Hn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),S.resolve()):(Wn()<=ce.DEBUG&&D("QueryEngine","Query:",Hn(e),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Hi*i?(Wn()<=ce.DEBUG&&D("QueryEngine","The SDK decides to create cache indexes for query:",Hn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Ut(e))):S.resolve())}Yi(t,e){if(Hd(e))return S.resolve(null);let n=Ut(e);return this.indexManager.getIndexType(t,n).next(i=>i===0?null:(e.limit!==null&&i===1&&(e=Us(e,null,"F"),n=Ut(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(s=>{let a=$(...s);return this.Ji.getDocuments(t,a).next(u=>this.indexManager.getMinOffset(t,n).next(l=>{let d=this.ts(e,u);return this.ns(e,d,a,l.readTime)?this.Yi(t,Us(e,null,"F")):this.rs(t,d,e,l)}))})))}Zi(t,e,n,i){return Hd(e)||i.isEqual(U.min())?S.resolve(null):this.Ji.getDocuments(t,n).next(s=>{let a=this.ts(e,s);return this.ns(e,a,n,i)?S.resolve(null):(Wn()<=ce.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Hn(e)),this.rs(t,a,e,Uf(i,-1)).next(u=>u))})}ts(t,e){let n=new st(cm(t));return e.forEach((i,s)=>{qi(t,s)&&(n=n.add(s))}),n}ns(t,e,n,i){if(t.limit===null)return!1;if(n.size!==e.size)return!0;let s=t.limitType==="F"?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(t,e,n){return Wn()<=ce.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",Hn(e)),this.Ji.getDocumentsMatchingQuery(t,e,Xt.min(),n)}rs(t,e,n,i){return this.Ji.getDocumentsMatchingQuery(t,n,i).next(s=>(e.forEach(a=>{s=s.insert(a.key,a)}),s))}};var tc=class{constructor(t,e,n,i){this.persistence=t,this.ss=e,this.serializer=i,this.os=new ut(z),this._s=new _e(s=>In(s),Fi),this.us=new Map,this.cs=t.getRemoteDocumentCache(),this.Ur=t.getTargetCache(),this.Gr=t.getBundleCache(),this.ls(n)}ls(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Zs(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.os))}};function Gm(r,t,e,n){return new tc(r,t,e,n)}function zm(r,t){return x(this,null,function*(){let e=O(r);return yield e.persistence.runTransaction("Handle user change","readonly",n=>{let i;return e.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,e.ls(t),e.mutationQueue.getAllMutationBatches(n))).next(s=>{let a=[],u=[],l=$();for(let d of i){a.push(d.batchId);for(let f of d.mutations)l=l.add(f.key)}for(let d of s){u.push(d.batchId);for(let f of d.mutations)l=l.add(f.key)}return e.localDocuments.getDocuments(n,l).next(d=>({hs:d,removedBatchIds:a,addedBatchIds:u}))})})})}function H_(r,t){let e=O(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let i=t.batch.keys(),s=e.cs.newChangeBuffer({trackRemovals:!0});return function(u,l,d,f){let p=d.batch,_=p.keys(),b=S.resolve();return _.forEach(N=>{b=b.next(()=>f.getEntry(l,N)).next(k=>{let V=d.docVersions.get(N);q(V!==null),k.version.compareTo(V)<0&&(p.applyToRemoteDocument(k,d),k.isValidDocument()&&(k.setReadTime(d.commitVersion),f.addEntry(k)))})}),b.next(()=>u.mutationQueue.removeMutationBatch(l,p))}(e,n,t,s).next(()=>s.apply(n)).next(()=>e.mutationQueue.performConsistencyCheck(n)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(n,i,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let l=$();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(l=l.add(u.batch.mutations[d].key));return l}(t))).next(()=>e.localDocuments.getDocuments(n,i))})}function Km(r){let t=O(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Ur.getLastRemoteSnapshotVersion(e))}function J_(r,t){let e=O(r),n=t.snapshotVersion,i=e.os;return e.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=e.cs.newChangeBuffer({trackRemovals:!0});i=e.os;let u=[];t.targetChanges.forEach((f,p)=>{let _=i.get(p);if(!_)return;u.push(e.Ur.removeMatchingKeys(s,f.removedDocuments,p).next(()=>e.Ur.addMatchingKeys(s,f.addedDocuments,p)));let b=_.withSequenceNumber(s.currentSequenceNumber);t.targetMismatches.get(p)!==null?b=b.withResumeToken(vt.EMPTY_BYTE_STRING,U.min()).withLastLimboFreeSnapshotVersion(U.min()):f.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(f.resumeToken,n)),i=i.insert(p,b),function(k,V,j){return k.resumeToken.approximateByteSize()===0||V.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=3e8?!0:j.addedDocuments.size+j.modifiedDocuments.size+j.removedDocuments.size>0}(_,b,f)&&u.push(e.Ur.updateTargetData(s,b))});let l=zt(),d=$();if(t.documentUpdates.forEach(f=>{t.resolvedLimboDocuments.has(f)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push($m(s,a,t.documentUpdates).next(f=>{l=f.Ps,d=f.Is})),!n.isEqual(U.min())){let f=e.Ur.getLastRemoteSnapshotVersion(s).next(p=>e.Ur.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return S.waitFor(u).next(()=>a.apply(s)).next(()=>e.localDocuments.getLocalViewOfDocuments(s,l,d)).next(()=>l)}).then(s=>(e.os=i,s))}function $m(r,t,e){let n=$(),i=$();return e.forEach(s=>n=n.add(s)),t.getEntries(r,n).next(s=>{let a=zt();return e.forEach((u,l)=>{let d=s.get(u);l.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(u)),l.isNoDocument()&&l.version.isEqual(U.min())?(t.removeEntry(u,l.readTime),a=a.insert(u,l)):!d.isValidDocument()||l.version.compareTo(d.version)>0||l.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(l),a=a.insert(u,l)):D("LocalStore","Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",l.version)}),{Ps:a,Is:i}})}function Y_(r,t){let e=O(r);return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}function dr(r,t){let e=O(r);return e.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return e.Ur.getTargetData(n,t).next(s=>s?(i=s,S.resolve(i)):e.Ur.allocateTargetId(n).next(a=>(i=new lr(t,a,"TargetPurposeListen",n.currentSequenceNumber),e.Ur.addTargetData(n,i).next(()=>i))))}).then(n=>{let i=e.os.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(e.os=e.os.insert(n.targetId,n),e._s.set(t,n.targetId)),n})}function fr(r,t,e){return x(this,null,function*(){let n=O(r),i=n.os.get(t),s=e?"readwrite":"readwrite-primary";try{e||(yield n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!nn(a))throw a;D("LocalStore",`Failed to update sequence numbers for target ${t}: ${a}`)}n.os=n.os.remove(t),n._s.delete(i.target)})}function ro(r,t,e){let n=O(r),i=U.min(),s=$();return n.persistence.runTransaction("Execute query","readwrite",a=>function(l,d,f){let p=O(l),_=p._s.get(f);return _!==void 0?S.resolve(p.os.get(_)):p.Ur.getTargetData(d,f)}(n,a,Ut(t)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(a,u.targetId).next(l=>{s=l})}).next(()=>n.ss.getDocumentsMatchingQuery(a,t,e?i:U.min(),e?s:$())).next(u=>(Hm(n,um(t),u),{documents:u,Ts:s})))}function Qm(r,t){let e=O(r),n=O(e.Ur),i=e.os.get(t);return i?Promise.resolve(i.target):e.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,t).next(a=>a?a.target:null))}function Wm(r,t){let e=O(r),n=e.us.get(t)||U.min();return e.persistence.runTransaction("Get new document changes","readonly",i=>e.cs.getAllFromCollectionGroup(i,t,Uf(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(Hm(e,t,i),i))}function Hm(r,t,e){let n=r.us.get(t)||U.min();e.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.us.set(t,n)}function X_(r,t,e,n){return x(this,null,function*(){let i=O(r),s=$(),a=zt();for(let d of e){let f=t.Es(d.metadata.name);d.document&&(s=s.add(f));let p=t.ds(d);p.setReadTime(t.As(d.metadata.readTime)),a=a.insert(f,p)}let u=i.cs.newChangeBuffer({trackRemovals:!0}),l=yield dr(i,function(f){return Ut(Ir(Y.fromString(`__bundle__/docs/${f}`)))}(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",d=>$m(d,u,a).next(f=>(u.apply(d),f)).next(f=>i.Ur.removeMatchingKeysForTargetId(d,l.targetId).next(()=>i.Ur.addMatchingKeys(d,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(d,f.Ps,f.Is)).next(()=>f.Ps)))})}function Z_(n,i){return x(this,arguments,function*(r,t,e=$()){let s=yield dr(r,Ut(Yc(t.bundledQuery))),a=O(r);return a.persistence.runTransaction("Save named query","readwrite",u=>{let l=yt(t.readTime);if(s.snapshotVersion.compareTo(l)>=0)return a.Gr.saveNamedQuery(u,t);let d=s.withResumeToken(vt.EMPTY_BYTE_STRING,l);return a.os=a.os.insert(d.targetId,d),a.Ur.updateTargetData(u,d).next(()=>a.Ur.removeMatchingKeysForTargetId(u,s.targetId)).next(()=>a.Ur.addMatchingKeys(u,e,s.targetId)).next(()=>a.Gr.saveNamedQuery(u,t))})})}function Af(r,t){return`firestore_clients_${r}_${t}`}function bf(r,t,e){let n=`firestore_mutations_${r}_${e}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}function qa(r,t){return`firestore_targets_${r}_${t}`}var io=class r{constructor(t,e,n,i){this.user=t,this.batchId=e,this.state=n,this.error=i}static Rs(t,e,n){let i=JSON.parse(n),s,a=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return a&&i.error&&(a=typeof i.error.message=="string"&&typeof i.error.code=="string",a&&(s=new R(i.error.code,i.error.message))),a?new r(t,e,i.state,s):(gt("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}Vs(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},fi=class r{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Rs(t,e){let n=JSON.parse(e),i,s=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return s&&n.error&&(s=typeof n.error.message=="string"&&typeof n.error.code=="string",s&&(i=new R(n.error.code,n.error.message))),s?new r(t,n.state,i):(gt("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Vs(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},so=class r{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Rs(t,e){let n=JSON.parse(e),i=typeof n=="object"&&n.activeTargetIds instanceof Array,s=Wc();for(let a=0;i&&a<n.activeTargetIds.length;++a)i=Kf(n.activeTargetIds[a]),s=s.add(n.activeTargetIds[a]);return i?new r(t,s):(gt("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}},ec=class r{constructor(t,e){this.clientId=t,this.onlineState=e}static Rs(t){let e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new r(e.clientId,e.onlineState):(gt("SharedClientState",`Failed to parse online state: ${t}`),null)}},Ri=class{constructor(){this.activeTargetIds=Wc()}fs(t){this.activeTargetIds=this.activeTargetIds.add(t)}gs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Vs(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}},mi=class{constructor(t,e,n,i,s){this.window=t,this.ui=e,this.persistenceKey=n,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new ut(z),this.started=!1,this.bs=[];let a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=Af(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Ri),this.Cs=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(t){return!(!t||!t.localStorage)}start(){return x(this,null,function*(){let t=yield this.syncEngine.Qi();for(let n of t){if(n===this.ps)continue;let i=this.getItem(Af(this.persistenceKey,n));if(i){let s=so.Rs(n,i);s&&(this.Ss=this.Ss.insert(s.clientId,s))}}this.Ns();let e=this.storage.getItem(this.xs);if(e){let n=this.Ls(e);n&&this.Bs(n)}for(let n of this.bs)this.ws(n);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(t){this.setItem(this.vs,JSON.stringify(t))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(t){let e=!1;return this.Ss.forEach((n,i)=>{i.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.qs(t,"pending")}updateMutationState(t,e,n){this.qs(t,e,n),this.Qs(t)}addLocalQueryTarget(t,e=!0){let n="not-current";if(this.isActiveQueryTarget(t)){let i=this.storage.getItem(qa(this.persistenceKey,t));if(i){let s=fi.Rs(t,i);s&&(n=s.state)}}return e&&this.Ks.fs(t),this.Ns(),n}removeLocalQueryTarget(t){this.Ks.gs(t),this.Ns()}isLocalQueryTarget(t){return this.Ks.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(qa(this.persistenceKey,t))}updateQueryState(t,e,n){this.$s(t,e,n)}handleUserChange(t,e,n){e.forEach(i=>{this.Qs(i)}),this.currentUser=t,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(t){this.Us(t)}notifyBundleLoaded(t){this.Ws(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(t){let e=this.storage.getItem(t);return D("SharedClientState","READ",t,e),e}setItem(t,e){D("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){D("SharedClientState","REMOVE",t),this.storage.removeItem(t)}ws(t){let e=t;if(e.storageArea===this.storage){if(D("SharedClientState","EVENT",e.key,e.newValue),e.key===this.Ds)return void gt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(()=>x(this,null,function*(){if(this.started){if(e.key!==null){if(this.Cs.test(e.key)){if(e.newValue==null){let n=this.Gs(e.key);return this.zs(n,null)}{let n=this.js(e.key,e.newValue);if(n)return this.zs(n.clientId,n)}}else if(this.Fs.test(e.key)){if(e.newValue!==null){let n=this.Hs(e.key,e.newValue);if(n)return this.Js(n)}}else if(this.Ms.test(e.key)){if(e.newValue!==null){let n=this.Ys(e.key,e.newValue);if(n)return this.Zs(n)}}else if(e.key===this.xs){if(e.newValue!==null){let n=this.Ls(e.newValue);if(n)return this.Bs(n)}}else if(e.key===this.vs){let n=function(s){let a=Qt.oe;if(s!=null)try{let u=JSON.parse(s);q(typeof u=="number"),a=u}catch(u){gt("SharedClientState","Failed to read sequence number from WebStorage",u)}return a}(e.newValue);n!==Qt.oe&&this.sequenceNumberHandler(n)}else if(e.key===this.Os){let n=this.Xs(e.newValue);yield Promise.all(n.map(i=>this.syncEngine.eo(i)))}}}else this.bs.push(e)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(t,e,n){let i=new io(this.currentUser,t,e,n),s=bf(this.persistenceKey,this.currentUser,t);this.setItem(s,i.Vs())}Qs(t){let e=bf(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Us(t){let e={clientId:this.ps,onlineState:t};this.storage.setItem(this.xs,JSON.stringify(e))}$s(t,e,n){let i=qa(this.persistenceKey,t),s=new fi(t,e,n);this.setItem(i,s.Vs())}Ws(t){let e=JSON.stringify(Array.from(t));this.setItem(this.Os,e)}Gs(t){let e=this.Cs.exec(t);return e?e[1]:null}js(t,e){let n=this.Gs(t);return so.Rs(n,e)}Hs(t,e){let n=this.Fs.exec(t),i=Number(n[1]),s=n[2]!==void 0?n[2]:null;return io.Rs(new Tt(s),i,e)}Ys(t,e){let n=this.Ms.exec(t),i=Number(n[1]);return fi.Rs(i,e)}Ls(t){return ec.Rs(t)}Xs(t){return JSON.parse(t)}Js(t){return x(this,null,function*(){if(t.user.uid===this.currentUser.uid)return this.syncEngine.no(t.batchId,t.state,t.error);D("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)})}Zs(t){return this.syncEngine.ro(t.targetId,t.state,t.error)}zs(t,e){let n=e?this.Ss.insert(t,e):this.Ss.remove(t),i=this.ks(this.Ss),s=this.ks(n),a=[],u=[];return s.forEach(l=>{i.has(l)||a.push(l)}),i.forEach(l=>{s.has(l)||u.push(l)}),this.syncEngine.io(a,u).then(()=>{this.Ss=n})}Bs(t){this.Ss.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}ks(t){let e=Wc();return t.forEach((n,i)=>{e=e.unionWith(i.activeTargetIds)}),e}},oo=class{constructor(){this.so=new Ri,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.so.fs(t),this.oo[t]||"not-current"}updateQueryState(t,e,n){this.oo[t]=e}removeLocalQueryTarget(t){this.so.gs(t)}isLocalQueryTarget(t){return this.so.activeTargetIds.has(t)}clearQueryState(t){delete this.oo[t]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(t){return this.so.activeTargetIds.has(t)}start(){return this.so=new Ri,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var nc=class{_o(t){}shutdown(){}};var ao=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(t){this.ho.push(t)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){D("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.ho)t(0)}lo(){D("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.ho)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var As=null;function Ba(){return As===null?As=function(){return 268435456+Math.round(2147483648*Math.random())}():As++,"0x"+As.toString(16)}var ty={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var rc=class{constructor(t){this.Io=t.Io,this.To=t.To}Eo(t){this.Ao=t}Ro(t){this.Vo=t}mo(t){this.fo=t}onMessage(t){this.po=t}close(){this.To()}send(t){this.Io(t)}yo(){this.Ao()}wo(){this.Vo()}So(t){this.fo(t)}bo(t){this.po(t)}};var Mt="WebChannelConnection",ic=class extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let n=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+e.host,this.vo=`projects/${i}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(e,n,i,s,a){let u=Ba(),l=this.xo(e,n.toUriEncodedString());D("RestConnection",`Sending RPC '${e}' ${u}:`,l,i);let d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,s,a),this.No(e,l,d,i).then(f=>(D("RestConnection",`Received RPC '${e}' ${u}: `,f),f),f=>{throw ne("RestConnection",`RPC '${e}' ${u} failed with error: `,f,"url: ",l,"request:",i),f})}Lo(e,n,i,s,a,u){return this.Mo(e,n,i,s,a)}Oo(e,n,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+wr}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,a)=>e[a]=s),i&&i.headers.forEach((s,a)=>e[a]=s)}xo(e,n){let i=ty[e];return`${this.Do}/v1/${n}:${i}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}No(t,e,n,i){let s=Ba();return new Promise((a,u)=>{let l=new Va;l.setWithCredentials(!0),l.listenOnce(Na.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case ri.NO_ERROR:let f=l.getResponseJson();D(Mt,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(f)),a(f);break;case ri.TIMEOUT:D(Mt,`RPC '${t}' ${s} timed out`),u(new R(P.DEADLINE_EXCEEDED,"Request time out"));break;case ri.HTTP_ERROR:let p=l.getStatus();if(D(Mt,`RPC '${t}' ${s} failed with status:`,p,"response text:",l.getResponseText()),p>0){let _=l.getResponseJson();Array.isArray(_)&&(_=_[0]);let b=_?.error;if(b&&b.status&&b.message){let N=function(V){let j=V.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(j)>=0?j:P.UNKNOWN}(b.status);u(new R(N,b.message))}else u(new R(P.UNKNOWN,"Server responded with status "+l.getStatus()))}else u(new R(P.UNAVAILABLE,"Connection failed."));break;default:L()}}finally{D(Mt,`RPC '${t}' ${s} completed.`)}});let d=JSON.stringify(i);D(Mt,`RPC '${t}' ${s} sending request:`,i),l.send(e,"POST",d,n,15)})}Bo(t,e,n){let i=Ba(),s=[this.Do,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Oa(),u=Ma(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(l.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,e,n),l.encodeInitMessageHeaders=!0;let f=s.join("");D(Mt,`Creating RPC '${t}' stream ${i}: ${f}`,l);let p=a.createWebChannel(f,l),_=!1,b=!1,N=new rc({Io:V=>{b?D(Mt,`Not sending because RPC '${t}' stream ${i} is closed:`,V):(_||(D(Mt,`Opening RPC '${t}' stream ${i} transport.`),p.open(),_=!0),D(Mt,`RPC '${t}' stream ${i} sending:`,V),p.send(V))},To:()=>p.close()}),k=(V,j,G)=>{V.listen(j,B=>{try{G(B)}catch(Q){setTimeout(()=>{throw Q},0)}})};return k(p,Gn.EventType.OPEN,()=>{b||(D(Mt,`RPC '${t}' stream ${i} transport opened.`),N.yo())}),k(p,Gn.EventType.CLOSE,()=>{b||(b=!0,D(Mt,`RPC '${t}' stream ${i} transport closed`),N.So())}),k(p,Gn.EventType.ERROR,V=>{b||(b=!0,ne(Mt,`RPC '${t}' stream ${i} transport errored:`,V),N.So(new R(P.UNAVAILABLE,"The operation could not be completed")))}),k(p,Gn.EventType.MESSAGE,V=>{var j;if(!b){let G=V.data[0];q(!!G);let B=G,Q=B.error||((j=B[0])===null||j===void 0?void 0:j.error);if(Q){D(Mt,`RPC '${t}' stream ${i} received error:`,Q);let H=Q.status,K=function(v){let I=wt[v];if(I!==void 0)return Tm(I)}(H),w=Q.message;K===void 0&&(K=P.INTERNAL,w="Unknown error status: "+H+" with message "+Q.message),b=!0,N.So(new R(K,w)),p.close()}else D(Mt,`RPC '${t}' stream ${i} received:`,G),N.bo(G)}}),k(u,ka.STAT_EVENT,V=>{V.stat===ws.PROXY?D(Mt,`RPC '${t}' stream ${i} detected buffering proxy`):V.stat===ws.NOPROXY&&D(Mt,`RPC '${t}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{N.wo()},0),N}};function Jm(){return typeof window<"u"?window:null}function xs(){return typeof document<"u"?document:null}function Bi(r){return new vu(r,!0)}var Di=class{constructor(t,e,n=1e3,i=1.5,s=6e4){this.ui=t,this.timerId=e,this.ko=n,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(t){this.cancel();let e=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),i=Math.max(0,e-n);i>0&&D("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),t())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var uo=class{constructor(t,e,n,i,s,a,u,l){this.ui=t,this.Ho=n,this.Jo=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Di(t,e)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return x(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(t){this.u_(),this.stream.send(t)}__(){return x(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(t,e){return x(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,t!==4?this.t_.reset():e&&e.code===P.RESOURCE_EXHAUSTED?(gt(e.toString()),gt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):e&&e.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.mo(e)})}l_(){}auth(){this.state=1;let t=this.h_(this.Yo),e=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Yo===e&&this.P_(n,i)},n=>{t(()=>{let i=new R(P.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(i)})})}P_(t,e){let n=this.h_(this.Yo);this.stream=this.T_(t,e),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{n(()=>this.I_(i))}),this.stream.onMessage(i=>{n(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(()=>x(this,null,function*(){this.state=0,this.start()}))}I_(t){return D("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}h_(t){return e=>{this.ui.enqueueAndForget(()=>this.Yo===t?e():(D("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},sc=class extends uo{constructor(t,e,n,i,s,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,i,a),this.serializer=s}T_(t,e){return this.connection.Bo("Listen",t,e)}E_(t){return this.onNext(t)}onNext(t){this.t_.reset();let e=L_(this.serializer,t),n=function(s){if(!("targetChange"in s))return U.min();let a=s.targetChange;return a.targetIds&&a.targetIds.length?U.min():a.readTime?yt(a.readTime):U.min()}(t);return this.listener.d_(e,n)}A_(t){let e={};e.database=Tu(this.serializer),e.addTarget=function(s,a){let u,l=a.target;if(u=qs(l)?{documents:Rm(s,l)}:{query:Dm(s,l)._t},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=Am(s,a.resumeToken);let d=wu(s,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(U.min())>0){u.readTime=cr(s,a.snapshotVersion.toTimestamp());let d=wu(s,a.expectedCount);d!==null&&(u.expectedCount=d)}return u}(this.serializer,t);let n=B_(this.serializer,t);n&&(e.labels=n),this.a_(e)}R_(t){let e={};e.database=Tu(this.serializer),e.removeTarget=t,this.a_(e)}},oc=class extends uo{constructor(t,e,n,i,s,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,i,a),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(t,e){return this.connection.Bo("Write",t,e)}E_(t){return q(!!t.streamToken),this.lastStreamToken=t.streamToken,q(!t.writeResults||t.writeResults.length===0),this.listener.f_()}onNext(t){q(!!t.streamToken),this.lastStreamToken=t.streamToken,this.t_.reset();let e=q_(t.writeResults,t.commitTime),n=yt(t.commitTime);return this.listener.g_(n,e)}p_(){let t={};t.database=Tu(this.serializer),this.a_(t)}m_(t){let e={streamToken:this.lastStreamToken,writes:t.map(n=>Ci(this.serializer,n))};this.a_(e)}};var ac=class extends class{}{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new R(P.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(t,e,n,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Mo(t,Iu(e,n),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new R(P.UNKNOWN,s.toString())})}Lo(t,e,n,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Lo(t,Iu(e,n),i,a,u,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new R(P.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},uc=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(t){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.C_("Offline")))}set(t){this.x_(),this.S_=0,t==="Online"&&(this.D_=!1),this.C_(t)}C_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}F_(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(gt(e),this.D_=!1):D("OnlineStateTracker",e)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var cc=class{constructor(t,e,n,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(a=>{n.enqueueAndForget(()=>x(this,null,function*(){rn(this)&&(D("RemoteStore","Restarting streams for network reachability change."),yield function(l){return x(this,null,function*(){let d=O(l);d.L_.add(4),yield Tr(d),d.q_.set("Unknown"),d.L_.delete(4),yield Ui(d)})}(this))}))}),this.q_=new uc(n,i)}};function Ui(r){return x(this,null,function*(){if(rn(r))for(let t of r.B_)yield t(!0)})}function Tr(r){return x(this,null,function*(){for(let t of r.B_)yield t(!1)})}function Ro(r,t){let e=O(r);e.N_.has(t.targetId)||(e.N_.set(t.targetId,t),nl(e)?el(e):Ar(e).r_()&&tl(e,t))}function mr(r,t){let e=O(r),n=Ar(e);e.N_.delete(t),n.r_()&&Ym(e,t),e.N_.size===0&&(n.r_()?n.o_():rn(e)&&e.q_.set("Unknown"))}function tl(r,t){if(r.Q_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(U.min())>0){let e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Ar(r).A_(t)}function Ym(r,t){r.Q_.xe(t),Ar(r).R_(t)}function el(r){r.Q_=new yu({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>r.N_.get(t)||null,tt:()=>r.datastore.serializer.databaseId}),Ar(r).start(),r.q_.v_()}function nl(r){return rn(r)&&!Ar(r).n_()&&r.N_.size>0}function rn(r){return O(r).L_.size===0}function Xm(r){r.Q_=void 0}function ey(r){return x(this,null,function*(){r.q_.set("Online")})}function ny(r){return x(this,null,function*(){r.N_.forEach((t,e)=>{tl(r,t)})})}function ry(r,t){return x(this,null,function*(){Xm(r),nl(r)?(r.q_.M_(t),el(r)):r.q_.set("Unknown")})}function iy(r,t,e){return x(this,null,function*(){if(r.q_.set("Online"),t instanceof Gs&&t.state===2&&t.cause)try{yield function(i,s){return x(this,null,function*(){let a=s.cause;for(let u of s.targetIds)i.N_.has(u)&&(yield i.remoteSyncer.rejectListen(u,a),i.N_.delete(u),i.Q_.removeTarget(u))})}(r,t)}catch(n){D("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),yield co(r,n)}else if(t instanceof nr?r.Q_.Ke(t):t instanceof js?r.Q_.He(t):r.Q_.We(t),!e.isEqual(U.min()))try{let n=yield Km(r.localStore);e.compareTo(n)>=0&&(yield function(s,a){let u=s.Q_.rt(a);return u.targetChanges.forEach((l,d)=>{if(l.resumeToken.approximateByteSize()>0){let f=s.N_.get(d);f&&s.N_.set(d,f.withResumeToken(l.resumeToken,a))}}),u.targetMismatches.forEach((l,d)=>{let f=s.N_.get(l);if(!f)return;s.N_.set(l,f.withResumeToken(vt.EMPTY_BYTE_STRING,f.snapshotVersion)),Ym(s,l);let p=new lr(f.target,l,d,f.sequenceNumber);tl(s,p)}),s.remoteSyncer.applyRemoteEvent(u)}(r,e))}catch(n){D("RemoteStore","Failed to raise snapshot:",n),yield co(r,n)}})}function co(r,t,e){return x(this,null,function*(){if(!nn(t))throw t;r.L_.add(1),yield Tr(r),r.q_.set("Offline"),e||(e=()=>Km(r.localStore)),r.asyncQueue.enqueueRetryable(()=>x(this,null,function*(){D("RemoteStore","Retrying IndexedDB access"),yield e(),r.L_.delete(1),yield Ui(r)}))})}function Zm(r,t){return t().catch(e=>co(r,e,t))}function Er(r){return x(this,null,function*(){let t=O(r),e=tn(t),n=t.O_.length>0?t.O_[t.O_.length-1].batchId:-1;for(;sy(t);)try{let i=yield Y_(t.localStore,n);if(i===null){t.O_.length===0&&e.o_();break}n=i.batchId,oy(t,i)}catch(i){yield co(t,i)}tp(t)&&ep(t)})}function sy(r){return rn(r)&&r.O_.length<10}function oy(r,t){r.O_.push(t);let e=tn(r);e.r_()&&e.V_&&e.m_(t.mutations)}function tp(r){return rn(r)&&!tn(r).n_()&&r.O_.length>0}function ep(r){tn(r).start()}function ay(r){return x(this,null,function*(){tn(r).p_()})}function uy(r){return x(this,null,function*(){let t=tn(r);for(let e of r.O_)t.m_(e.mutations)})}function cy(r,t,e){return x(this,null,function*(){let n=r.O_.shift(),i=pu.from(n,t,e);yield Zm(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield Er(r)})}function ly(r,t){return x(this,null,function*(){t&&tn(r).V_&&(yield function(n,i){return x(this,null,function*(){if(function(a){return Im(a)&&a!==P.ABORTED}(i.code)){let s=n.O_.shift();tn(n).s_(),yield Zm(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Er(n)}})}(r,t)),tp(r)&&ep(r)})}function Sf(r,t){return x(this,null,function*(){let e=O(r);e.asyncQueue.verifyOperationInProgress(),D("RemoteStore","RemoteStore received new credentials");let n=rn(e);e.L_.add(3),yield Tr(e),n&&e.q_.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.L_.delete(3),yield Ui(e)})}function lc(r,t){return x(this,null,function*(){let e=O(r);t?(e.L_.delete(2),yield Ui(e)):t||(e.L_.add(2),yield Tr(e),e.q_.set("Unknown"))})}function Ar(r){return r.K_||(r.K_=function(e,n,i){let s=O(e);return s.w_(),new sc(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:ey.bind(null,r),Ro:ny.bind(null,r),mo:ry.bind(null,r),d_:iy.bind(null,r)}),r.B_.push(t=>x(this,null,function*(){t?(r.K_.s_(),nl(r)?el(r):r.q_.set("Unknown")):(yield r.K_.stop(),Xm(r))}))),r.K_}function tn(r){return r.U_||(r.U_=function(e,n,i){let s=O(e);return s.w_(),new oc(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:ay.bind(null,r),mo:ly.bind(null,r),f_:uy.bind(null,r),g_:cy.bind(null,r)}),r.B_.push(t=>x(this,null,function*(){t?(r.U_.s_(),yield Er(r)):(yield r.U_.stop(),r.O_.length>0&&(D("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))}))),r.U_}var hc=class r{constructor(t,e,n,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new bt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,i,s){let a=Date.now()+n,u=new r(t,e,a,i,s);return u.start(n),u}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new R(P.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function br(r,t){if(gt("AsyncQueue",`${t}: ${r}`),nn(r))return new R(P.UNAVAILABLE,`${t}: ${r}`);throw r}var lo=class r{constructor(t){this.comparator=t?(e,n)=>t(e,n)||F.comparator(e.key,n.key):(e,n)=>F.comparator(e.key,n.key),this.keyedMap=ui(),this.sortedSet=new ut(this.comparator)}static emptySet(t){return new r(t.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let n=new r;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}};var ho=class{constructor(){this.W_=new ut(F.comparator)}track(t){let e=t.doc.key,n=this.W_.get(e);n?t.type!==0&&n.type===3?this.W_=this.W_.insert(e,t):t.type===3&&n.type!==1?this.W_=this.W_.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.W_=this.W_.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.W_=this.W_.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.W_=this.W_.remove(e):t.type===1&&n.type===2?this.W_=this.W_.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.W_=this.W_.insert(e,{type:2,doc:t.doc}):L():this.W_=this.W_.insert(e,t)}G_(){let t=[];return this.W_.inorderTraversal((e,n)=>{t.push(n)}),t}},pr=class r{constructor(t,e,n,i,s,a,u,l,d){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=l,this.hasCachedResults=d}static fromInitialDocuments(t,e,n,i,s){let a=[];return e.forEach(u=>{a.push({type:0,doc:u})}),new r(t,e,lo.emptySet(e),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Li(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i].type!==n[i].type||!e[i].doc.isEqual(n[i].doc))return!1;return!0}};var dc=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(t=>t.J_())}},fc=class{constructor(){this.queries=Cf(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(e,n){let i=O(e),s=i.queries;i.queries=Cf(),s.forEach((a,u)=>{for(let l of u.j_)l.onError(n)})})(this,new R(P.ABORTED,"Firestore shutting down"))}};function Cf(){return new _e(r=>am(r),Li)}function rl(r,t){return x(this,null,function*(){let e=O(r),n=3,i=t.query,s=e.queries.get(i);s?!s.H_()&&t.J_()&&(n=2):(s=new dc,n=t.J_()?0:1);try{switch(n){case 0:s.z_=yield e.onListen(i,!0);break;case 1:s.z_=yield e.onListen(i,!1);break;case 2:yield e.onFirstRemoteStoreListen(i)}}catch(a){let u=br(a,`Initialization of query '${Hn(t.query)}' failed`);return void t.onError(u)}e.queries.set(i,s),s.j_.push(t),t.Z_(e.onlineState),s.z_&&t.X_(s.z_)&&sl(e)})}function il(r,t){return x(this,null,function*(){let e=O(r),n=t.query,i=3,s=e.queries.get(n);if(s){let a=s.j_.indexOf(t);a>=0&&(s.j_.splice(a,1),s.j_.length===0?i=t.J_()?0:1:!s.H_()&&t.J_()&&(i=2))}switch(i){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}})}function hy(r,t){let e=O(r),n=!1;for(let i of t){let s=i.query,a=e.queries.get(s);if(a){for(let u of a.j_)u.X_(i)&&(n=!0);a.z_=i}}n&&sl(e)}function dy(r,t,e){let n=O(r),i=n.queries.get(t);if(i)for(let s of i.j_)s.onError(e);n.queries.delete(t)}function sl(r){r.Y_.forEach(t=>{t.next()})}var mc,Pf;(Pf=mc||(mc={})).ea="default",Pf.Cache="cache";var Vi=class{constructor(t,e,n){this.query=t,this.ta=e,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(t){if(!this.options.includeMetadataChanges){let n=[];for(let i of t.docChanges)i.type!==3&&n.push(i);t=new pr(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.na?this.ia(t)&&(this.ta.next(t),e=!0):this.sa(t,this.onlineState)&&(this.oa(t),e=!0),this.ra=t,e}onError(t){this.ta.error(t)}Z_(t){this.onlineState=t;let e=!1;return this.ra&&!this.na&&this.sa(this.ra,t)&&(this.oa(this.ra),e=!0),e}sa(t,e){if(!t.fromCache||!this.J_())return!0;let n=e!=="Offline";return(!this.options._a||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}ia(t){if(t.docChanges.length>0)return!0;let e=this.ra&&this.ra.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}oa(t){t=pr.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.na=!0,this.ta.next(t)}J_(){return this.options.source!==mc.Cache}};var pc=class{constructor(t,e){this.aa=t,this.byteLength=e}ua(){return"metadata"in this.aa}};var fo=class{constructor(t){this.serializer=t}Es(t){return fe(this.serializer,t)}ds(t){return t.metadata.exists?xm(this.serializer,t.document,!1):Et.newNoDocument(this.Es(t.metadata.name),this.As(t.metadata.readTime))}As(t){return yt(t)}},gc=class{constructor(t,e,n){this.ca=t,this.localStore=e,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=np(t)}la(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.aa.namedQuery)this.queries.push(t.aa.namedQuery);else if(t.aa.documentMetadata){this.documents.push({metadata:t.aa.documentMetadata}),t.aa.documentMetadata.exists||++e;let n=Y.fromString(t.aa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else t.aa.document&&(this.documents[this.documents.length-1].document=t.aa.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}ha(t){let e=new Map,n=new fo(this.serializer);for(let i of t)if(i.metadata.queries){let s=n.Es(i.metadata.name);for(let a of i.metadata.queries){let u=(e.get(a)||$()).add(s);e.set(a,u)}}return e}complete(){return x(this,null,function*(){let t=yield X_(this.localStore,new fo(this.serializer),this.documents,this.ca.id),e=this.ha(this.documents);for(let n of this.queries)yield Z_(this.localStore,n,e.get(n.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:t}})}};function np(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}var mo=class{constructor(t){this.key=t}},po=class{constructor(t){this.key=t}},go=class{constructor(t,e){this.query=t,this.Ta=e,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=$(),this.mutatedKeys=$(),this.Aa=cm(t),this.Ra=new lo(this.Aa)}get Va(){return this.Ta}ma(t,e){let n=e?e.fa:new ho,i=e?e.Ra:this.Ra,s=e?e.mutatedKeys:this.mutatedKeys,a=i,u=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((f,p)=>{let _=i.get(f),b=qi(this.query,p)?p:null,N=!!_&&this.mutatedKeys.has(_.key),k=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations),V=!1;_&&b?_.data.isEqual(b.data)?N!==k&&(n.track({type:3,doc:b}),V=!0):this.ga(_,b)||(n.track({type:2,doc:b}),V=!0,(l&&this.Aa(b,l)>0||d&&this.Aa(b,d)<0)&&(u=!0)):!_&&b?(n.track({type:0,doc:b}),V=!0):_&&!b&&(n.track({type:1,doc:_}),V=!0,(l||d)&&(u=!0)),V&&(b?(a=a.add(b),s=k?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{Ra:a,fa:n,ns:u,mutatedKeys:s}}ga(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,i){let s=this.Ra;this.Ra=t.Ra,this.mutatedKeys=t.mutatedKeys;let a=t.fa.G_();a.sort((f,p)=>function(b,N){let k=V=>{switch(V){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L()}};return k(b)-k(N)}(f.type,p.type)||this.Aa(f.doc,p.doc)),this.pa(n),i=i!=null&&i;let u=e&&!i?this.ya():[],l=this.da.size===0&&this.current&&!i?1:0,d=l!==this.Ea;return this.Ea=l,a.length!==0||d?{snapshot:new pr(this.query,t.Ra,s,a,t.mutatedKeys,l===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:u}:{wa:u}}Z_(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new ho,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(t){return!this.Ta.has(t)&&!!this.Ra.has(t)&&!this.Ra.get(t).hasLocalMutations}pa(t){t&&(t.addedDocuments.forEach(e=>this.Ta=this.Ta.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ta=this.Ta.delete(e)),this.current=t.current)}ya(){if(!this.current)return[];let t=this.da;this.da=$(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});let e=[];return t.forEach(n=>{this.da.has(n)||e.push(new po(n))}),this.da.forEach(n=>{t.has(n)||e.push(new mo(n))}),e}ba(t){this.Ta=t.Ts,this.da=$();let e=this.ma(t.documents);return this.applyChanges(e,!0)}Da(){return pr.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},_c=class{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}},yc=class{constructor(t){this.key=t,this.va=!1}},vc=class{constructor(t,e,n,i,s,a){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new _e(u=>am(u),Li),this.Ma=new Map,this.xa=new Set,this.Oa=new ut(F.comparator),this.Na=new Map,this.La=new xi,this.Ba={},this.ka=new Map,this.qa=hr.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function fy(r,t,e=!0){return x(this,null,function*(){let n=Do(r),i,s=n.Fa.get(t);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield rp(n,t,e,!0),i})}function my(r,t){return x(this,null,function*(){let e=Do(r);yield rp(e,t,!0,!1)})}function rp(r,t,e,n){return x(this,null,function*(){let i=yield dr(r.localStore,Ut(t)),s=i.targetId,a=r.sharedClientState.addLocalQueryTarget(s,e),u;return n&&(u=yield ol(r,t,s,a==="current",i.resumeToken)),r.isPrimaryClient&&e&&Ro(r.remoteStore,i),u})}function ol(r,t,e,n,i){return x(this,null,function*(){r.Ka=(p,_,b)=>function(k,V,j,G){return x(this,null,function*(){let B=V.view.ma(j);B.ns&&(B=yield ro(k.localStore,V.query,!1).then(({documents:w})=>V.view.ma(w,B)));let Q=G&&G.targetChanges.get(V.targetId),H=G&&G.targetMismatches.get(V.targetId)!=null,K=V.view.applyChanges(B,k.isPrimaryClient,Q,H);return wc(k,V.targetId,K.wa),K.snapshot})}(r,p,_,b);let s=yield ro(r.localStore,t,!0),a=new go(t,s.Ts),u=a.ma(s.documents),l=bi.createSynthesizedTargetChangeForCurrentChange(e,n&&r.onlineState!=="Offline",i),d=a.applyChanges(u,r.isPrimaryClient,l);wc(r,e,d.wa);let f=new _c(t,e,a);return r.Fa.set(t,f),r.Ma.has(e)?r.Ma.get(e).push(t):r.Ma.set(e,[t]),d.snapshot})}function py(r,t,e){return x(this,null,function*(){let n=O(r),i=n.Fa.get(t),s=n.Ma.get(i.targetId);if(s.length>1)return n.Ma.set(i.targetId,s.filter(a=>!Li(a,t))),void n.Fa.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield fr(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),e&&mr(n.remoteStore,i.targetId),gr(n,i.targetId)}).catch(en))):(gr(n,i.targetId),yield fr(n.localStore,i.targetId,!0))})}function gy(r,t){return x(this,null,function*(){let e=O(r),n=e.Fa.get(t),i=e.Ma.get(n.targetId);e.isPrimaryClient&&i.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),mr(e.remoteStore,n.targetId))})}function _y(r,t,e){return x(this,null,function*(){let n=ll(r);try{let i=yield function(a,u){let l=O(a),d=lt.now(),f=u.reduce((b,N)=>b.add(N.key),$()),p,_;return l.persistence.runTransaction("Locally write mutations","readwrite",b=>{let N=zt(),k=$();return l.cs.getEntries(b,f).next(V=>{N=V,N.forEach((j,G)=>{G.isValidDocument()||(k=k.add(j))})}).next(()=>l.localDocuments.getOverlayedDocuments(b,N)).next(V=>{p=V;let j=[];for(let G of u){let B=D_(G,p.get(G.key).overlayedDocument);B!=null&&j.push(new ie(G.key,B,tm(B.value.mapValue),mt.exists(!0)))}return l.mutationQueue.addMutationBatch(b,d,j,u)}).next(V=>{_=V;let j=V.applyToLocalDocumentSet(p,k);return l.documentOverlayCache.saveOverlays(b,V.batchId,j)})}).then(()=>({batchId:_.batchId,changes:hm(p)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(i.batchId),function(a,u,l){let d=a.Ba[a.currentUser.toKey()];d||(d=new ut(z)),d=d.insert(u,l),a.Ba[a.currentUser.toKey()]=d}(n,i.batchId,e),yield Ve(n,i.changes),yield Er(n.remoteStore)}catch(i){let s=br(i,"Failed to persist write");e.reject(s)}})}function ip(r,t){return x(this,null,function*(){let e=O(r);try{let n=yield J_(e.localStore,t);t.targetChanges.forEach((i,s)=>{let a=e.Na.get(s);a&&(q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.va=!0:i.modifiedDocuments.size>0?q(a.va):i.removedDocuments.size>0&&(q(a.va),a.va=!1))}),yield Ve(e,n,t)}catch(n){yield en(n)}})}function xf(r,t,e){let n=O(r);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){let i=[];n.Fa.forEach((s,a)=>{let u=a.view.Z_(t);u.snapshot&&i.push(u.snapshot)}),function(a,u){let l=O(a);l.onlineState=u;let d=!1;l.queries.forEach((f,p)=>{for(let _ of p.j_)_.Z_(u)&&(d=!0)}),d&&sl(l)}(n.eventManager,t),i.length&&n.Ca.d_(i),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}function yy(r,t,e){return x(this,null,function*(){let n=O(r);n.sharedClientState.updateQueryState(t,"rejected",e);let i=n.Na.get(t),s=i&&i.key;if(s){let a=new ut(F.comparator);a=a.insert(s,Et.newNoDocument(s,U.min()));let u=$().add(s),l=new Ai(U.min(),new Map,new ut(z),a,u);yield ip(n,l),n.Oa=n.Oa.remove(s),n.Na.delete(t),cl(n)}else yield fr(n.localStore,t,!1).then(()=>gr(n,t,e)).catch(en)})}function vy(r,t){return x(this,null,function*(){let e=O(r),n=t.batch.batchId;try{let i=yield H_(e.localStore,t);ul(e,n,null),al(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),yield Ve(e,i)}catch(i){yield en(i)}})}function wy(r,t,e){return x(this,null,function*(){let n=O(r);try{let i=yield function(a,u){let l=O(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return l.mutationQueue.lookupMutationBatch(d,u).next(p=>(q(p!==null),f=p.keys(),l.mutationQueue.removeMutationBatch(d,p))).next(()=>l.mutationQueue.performConsistencyCheck(d)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(d,f,u)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>l.localDocuments.getDocuments(d,f))})}(n.localStore,t);ul(n,t,e),al(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),yield Ve(n,i)}catch(i){yield en(i)}})}function Iy(r,t){return x(this,null,function*(){let e=O(r);rn(e.remoteStore)||D("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=yield function(a){let u=O(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>u.mutationQueue.getHighestUnacknowledgedBatchId(l))}(e.localStore);if(n===-1)return void t.resolve();let i=e.ka.get(n)||[];i.push(t),e.ka.set(n,i)}catch(n){let i=br(n,"Initialization of waitForPendingWrites() operation failed");t.reject(i)}})}function al(r,t){(r.ka.get(t)||[]).forEach(e=>{e.resolve()}),r.ka.delete(t)}function ul(r,t,e){let n=O(r),i=n.Ba[n.currentUser.toKey()];if(i){let s=i.get(t);s&&(e?s.reject(e):s.resolve(),i=i.remove(t)),n.Ba[n.currentUser.toKey()]=i}}function gr(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(let n of r.Ma.get(t))r.Fa.delete(n),e&&r.Ca.$a(n,e);r.Ma.delete(t),r.isPrimaryClient&&r.La.gr(t).forEach(n=>{r.La.containsKey(n)||sp(r,n)})}function sp(r,t){r.xa.delete(t.path.canonicalString());let e=r.Oa.get(t);e!==null&&(mr(r.remoteStore,e),r.Oa=r.Oa.remove(t),r.Na.delete(e),cl(r))}function wc(r,t,e){for(let n of e)n instanceof mo?(r.La.addReference(n.key,t),Ty(r,n)):n instanceof po?(D("SyncEngine","Document no longer in limbo: "+n.key),r.La.removeReference(n.key,t),r.La.containsKey(n.key)||sp(r,n.key)):L()}function Ty(r,t){let e=t.key,n=e.path.canonicalString();r.Oa.get(e)||r.xa.has(n)||(D("SyncEngine","New document in limbo: "+e),r.xa.add(n),cl(r))}function cl(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){let t=r.xa.values().next().value;r.xa.delete(t);let e=new F(Y.fromString(t)),n=r.qa.next();r.Na.set(n,new yc(e)),r.Oa=r.Oa.insert(e,n),Ro(r.remoteStore,new lr(Ut(Ir(e.path)),n,"TargetPurposeLimboResolution",Qt.oe))}}function Ve(r,t,e){return x(this,null,function*(){let n=O(r),i=[],s=[],a=[];n.Fa.isEmpty()||(n.Fa.forEach((u,l)=>{a.push(n.Ka(l,t,e).then(d=>{var f;if((d||e)&&n.isPrimaryClient){let p=d?!d.fromCache:(f=e?.targetChanges.get(l.targetId))===null||f===void 0?void 0:f.current;n.sharedClientState.updateQueryState(l.targetId,p?"current":"not-current")}if(d){i.push(d);let p=Xu.Wi(l.targetId,d);s.push(p)}}))}),yield Promise.all(a),n.Ca.d_(i),yield function(l,d){return x(this,null,function*(){let f=O(l);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>S.forEach(d,_=>S.forEach(_.$i,b=>f.persistence.referenceDelegate.addReference(p,_.targetId,b)).next(()=>S.forEach(_.Ui,b=>f.persistence.referenceDelegate.removeReference(p,_.targetId,b)))))}catch(p){if(!nn(p))throw p;D("LocalStore","Failed to update sequence numbers: "+p)}for(let p of d){let _=p.targetId;if(!p.fromCache){let b=f.os.get(_),N=b.snapshotVersion,k=b.withLastLimboFreeSnapshotVersion(N);f.os=f.os.insert(_,k)}}})}(n.localStore,s))})}function Ey(r,t){return x(this,null,function*(){let e=O(r);if(!e.currentUser.isEqual(t)){D("SyncEngine","User change. New user:",t.toKey());let n=yield zm(e.localStore,t);e.currentUser=t,function(s,a){s.ka.forEach(u=>{u.forEach(l=>{l.reject(new R(P.CANCELLED,a))})}),s.ka.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),yield Ve(e,n.hs)}})}function Ay(r,t){let e=O(r),n=e.Na.get(t);if(n&&n.va)return $().add(n.key);{let i=$(),s=e.Ma.get(t);if(!s)return i;for(let a of s){let u=e.Fa.get(a);i=i.unionWith(u.view.Va)}return i}}function by(r,t){return x(this,null,function*(){let e=O(r),n=yield ro(e.localStore,t.query,!0),i=t.view.ba(n);return e.isPrimaryClient&&wc(e,t.targetId,i.wa),i})}function Sy(r,t){return x(this,null,function*(){let e=O(r);return Wm(e.localStore,t).then(n=>Ve(e,n))})}function Cy(r,t,e,n){return x(this,null,function*(){let i=O(r),s=yield function(u,l){let d=O(u),f=O(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",p=>f.Mn(p,l).next(_=>_?d.localDocuments.getDocuments(p,_):S.resolve(null)))}(i.localStore,t);s!==null?(e==="pending"?yield Er(i.remoteStore):e==="acknowledged"||e==="rejected"?(ul(i,t,n||null),al(i,t),function(u,l){O(O(u).mutationQueue).On(l)}(i.localStore,t)):L(),yield Ve(i,s)):D("SyncEngine","Cannot apply mutation batch with id: "+t)})}function Py(r,t){return x(this,null,function*(){let e=O(r);if(Do(e),ll(e),t===!0&&e.Qa!==!0){let n=e.sharedClientState.getAllActiveQueryTargets(),i=yield Rf(e,n.toArray());e.Qa=!0,yield lc(e.remoteStore,!0);for(let s of i)Ro(e.remoteStore,s)}else if(t===!1&&e.Qa!==!1){let n=[],i=Promise.resolve();e.Ma.forEach((s,a)=>{e.sharedClientState.isLocalQueryTarget(a)?n.push(a):i=i.then(()=>(gr(e,a),fr(e.localStore,a,!0))),mr(e.remoteStore,a)}),yield i,yield Rf(e,n),function(a){let u=O(a);u.Na.forEach((l,d)=>{mr(u.remoteStore,d)}),u.La.pr(),u.Na=new Map,u.Oa=new ut(F.comparator)}(e),e.Qa=!1,yield lc(e.remoteStore,!1)}})}function Rf(r,t,e){return x(this,null,function*(){let n=O(r),i=[],s=[];for(let a of t){let u,l=n.Ma.get(a);if(l&&l.length!==0){u=yield dr(n.localStore,Ut(l[0]));for(let d of l){let f=n.Fa.get(d),p=yield by(n,f);p.snapshot&&s.push(p.snapshot)}}else{let d=yield Qm(n.localStore,a);u=yield dr(n.localStore,d),yield ol(n,op(d),a,!1,u.resumeToken)}i.push(u)}return n.Ca.d_(s),i})}function op(r){return om(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function xy(r){return function(e){return O(O(e).persistence).Qi()}(O(r).localStore)}function Ry(r,t,e,n){return x(this,null,function*(){let i=O(r);if(i.Qa)return void D("SyncEngine","Ignoring unexpected query state notification.");let s=i.Ma.get(t);if(s&&s.length>0)switch(e){case"current":case"not-current":{let a=yield Wm(i.localStore,um(s[0])),u=Ai.createSynthesizedRemoteEventForCurrentChange(t,e==="current",vt.EMPTY_BYTE_STRING);yield Ve(i,a,u);break}case"rejected":yield fr(i.localStore,t,!0),gr(i,t,n);break;default:L()}})}function Dy(r,t,e){return x(this,null,function*(){let n=Do(r);if(n.Qa){for(let i of t){if(n.Ma.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){D("SyncEngine","Adding an already active target "+i);continue}let s=yield Qm(n.localStore,i),a=yield dr(n.localStore,s);yield ol(n,op(s),a.targetId,!1,a.resumeToken),Ro(n.remoteStore,a)}for(let i of e)n.Ma.has(i)&&(yield fr(n.localStore,i,!1).then(()=>{mr(n.remoteStore,i),gr(n,i)}).catch(en))}})}function Do(r){let t=O(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=ip.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ay.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=yy.bind(null,t),t.Ca.d_=hy.bind(null,t.eventManager),t.Ca.$a=dy.bind(null,t.eventManager),t}function ll(r){let t=O(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=vy.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=wy.bind(null,t),t}function Vy(r,t,e){let n=O(r);(function(s,a,u){return x(this,null,function*(){try{let l=yield a.getMetadata();if(yield function(b,N){let k=O(b),V=yt(N.createTime);return k.persistence.runTransaction("hasNewerBundle","readonly",j=>k.Gr.getBundleMetadata(j,N.id)).then(j=>!!j&&j.createTime.compareTo(V)>=0)}(s.localStore,l))return yield a.close(),u._completeWith(function(b){return{taskState:"Success",documentsLoaded:b.totalDocuments,bytesLoaded:b.totalBytes,totalDocuments:b.totalDocuments,totalBytes:b.totalBytes}}(l)),Promise.resolve(new Set);u._updateProgress(np(l));let d=new gc(l,s.localStore,a.serializer),f=yield a.Ua();for(;f;){let _=yield d.la(f);_&&u._updateProgress(_),f=yield a.Ua()}let p=yield d.complete();return yield Ve(s,p.Ia,void 0),yield function(b,N){let k=O(b);return k.persistence.runTransaction("Save bundle","readwrite",V=>k.Gr.saveBundleMetadata(V,N))}(s.localStore,l),u._completeWith(p.progress),Promise.resolve(p.Pa)}catch(l){return ne("SyncEngine",`Loading bundle failed with ${l}`),u._failWith(l),Promise.resolve(new Set)}})})(n,t,e).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}var Ic=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return x(this,null,function*(){this.serializer=Bi(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),yield this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)})}ja(e,n){return null}Ha(e,n){return null}za(e){return Gm(this.persistence,new no,e.initialUser,this.serializer)}Ga(e){return new to(eo.Zr,this.serializer)}Wa(e){return new oo}terminate(){return x(this,null,function*(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return r.provider={build:()=>new r},r})();var _o=class r extends Ic{constructor(t,e,n){super(),this.Ja=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(t){return x(this,null,function*(){yield Ea(r.prototype,this,"initialize").call(this,t),yield this.Ja.initialize(this,t),yield ll(this.Ja.syncEngine),yield Er(this.Ja.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}za(t){return Gm(this.persistence,new no,t.initialUser,this.serializer)}ja(t,e){let n=this.persistence.referenceDelegate.garbageCollector;return new Ou(n,t.asyncQueue,e)}Ha(t,e){let n=new Za(e,this.persistence);return new Xa(t.asyncQueue,n)}Ga(t){let e=Zc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Yt.withCacheSize(this.cacheSizeBytes):Yt.DEFAULT;return new Yu(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Jm(),xs(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(t){return new oo}},Tc=class r extends _o{constructor(t,e){super(t,e,!1),this.Ja=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}initialize(t){return x(this,null,function*(){yield Ea(r.prototype,this,"initialize").call(this,t);let e=this.Ja.syncEngine;this.sharedClientState instanceof mi&&(this.sharedClientState.syncEngine={no:Cy.bind(null,e),ro:Ry.bind(null,e),io:Dy.bind(null,e),Qi:xy.bind(null,e),eo:Sy.bind(null,e)},yield this.sharedClientState.start()),yield this.persistence.yi(n=>x(this,null,function*(){yield Py(this.Ja.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}Wa(t){let e=Jm();if(!mi.D(e))throw new R(P.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=Zc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new mi(e,t.asyncQueue,n,t.clientId,t.initialUser)}},hl=(()=>{class r{initialize(e,n){return x(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>xf(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=Ey.bind(null,this.syncEngine),yield lc(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new fc}()}createDatastore(e){let n=Bi(e.databaseInfo.databaseId),i=function(a){return new ic(a)}(e.databaseInfo);return function(a,u,l,d){return new ac(a,u,l,d)}(e.authCredentials,e.appCheckCredentials,i,n)}createRemoteStore(e){return function(i,s,a,u,l){return new cc(i,s,a,u,l)}(this.localStore,this.datastore,e.asyncQueue,n=>xf(this.syncEngine,n,0),function(){return ao.D()?new ao:new nc}())}createSyncEngine(e,n){return function(s,a,u,l,d,f,p){let _=new vc(s,a,u,l,d,f);return p&&(_.Qa=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return x(this,null,function*(){var e,n;yield function(s){return x(this,null,function*(){let a=O(s);D("RemoteStore","RemoteStore shutting down."),a.L_.add(5),yield Tr(a),a.k_.shutdown(),a.q_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()})}}return r.provider={build:()=>new r},r})();function Df(r,t=10240){let e=0;return{read(){return x(this,null,function*(){if(e<r.byteLength){let i={value:r.slice(e,e+t),done:!1};return e+=t,i}return{done:!0}})},cancel(){return x(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var _r=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ya(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ya(this.observer.error,t):gt("Uncaught Error in snapshot listener:",t.toString()))}Za(){this.muted=!0}Ya(t,e){setTimeout(()=>{this.muted||t(e)},0)}};var Ec=class{constructor(t,e){this.Xa=t,this.serializer=e,this.metadata=new bt,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(n=>{n&&n.ua()?this.metadata.resolve(n.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.aa)}`))},n=>this.metadata.reject(n))}close(){return this.Xa.cancel()}getMetadata(){return x(this,null,function*(){return this.metadata.promise})}Ua(){return x(this,null,function*(){return yield this.getMetadata(),this.tu()})}tu(){return x(this,null,function*(){let t=yield this.nu();if(t===null)return null;let e=this.eu.decode(t),n=Number(e);isNaN(n)&&this.ru(`length string (${e}) is not valid number`);let i=yield this.iu(n);return new pc(JSON.parse(i),t.length+n)})}su(){return this.buffer.findIndex(t=>t===123)}nu(){return x(this,null,function*(){for(;this.su()<0&&!(yield this.ou()););if(this.buffer.length===0)return null;let t=this.su();t<0&&this.ru("Reached the end of bundle when a length string is expected.");let e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e})}iu(t){return x(this,null,function*(){for(;this.buffer.length<t;)(yield this.ou())&&this.ru("Reached the end of bundle when more is expected.");let e=this.eu.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e})}ru(t){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${t}`)}ou(){return x(this,null,function*(){let t=yield this.Xa.read();if(!t.done){let e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done})}};var Ac=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(t){return x(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new R(P.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let e=yield function(i,s){return x(this,null,function*(){let a=O(i),u={documents:s.map(p=>Si(a.serializer,p))},l=yield a.Lo("BatchGetDocuments",a.serializer.databaseId,Y.emptyPath(),u,s.length),d=new Map;l.forEach(p=>{let _=F_(a.serializer,p);d.set(_.key.toString(),_)});let f=[];return s.forEach(p=>{let _=d.get(p.toString());q(!!_),f.push(_)}),f})}(this.datastore,t);return e.forEach(n=>this.recordVersion(n)),e})}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(t.toString())}delete(t){this.write(new Ze(t,this.precondition(t))),this.writtenDocs.add(t.toString())}commit(){return x(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,n)=>{let i=F.fromPath(n);this.mutations.push(new Ii(i,this.precondition(i)))}),yield function(n,i){return x(this,null,function*(){let s=O(n),a={writes:i.map(u=>Ci(s.serializer,u))};yield s.Mo("Commit",s.serializer.databaseId,Y.emptyPath(),a)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw L();e=U.min()}let n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new R(P.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(U.min())?mt.exists(!1):mt.updateTime(e):mt.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(U.min()))throw new R(P.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return mt.updateTime(e)}return mt.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};var bc=class{constructor(t,e,n,i,s){this.asyncQueue=t,this.datastore=e,this.options=n,this.updateFunction=i,this.deferred=s,this._u=n.maxAttempts,this.t_=new Di(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(()=>x(this,null,function*(){let t=new Ac(this.datastore),e=this.cu(t);e&&e.then(n=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(n)}).catch(i=>{this.lu(i)}))}).catch(n=>{this.lu(n)})}))}cu(t){try{let e=this.updateFunction(t);return!Oi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}lu(t){this._u>0&&this.hu(t)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(t)}hu(t){if(t.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!Im(e)}return!1}};var Sc=class{constructor(t,e,n,i,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=Tt.UNAUTHENTICATED,this.clientId=Ds.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,a=>x(this,null,function*(){D("FirestoreClient","Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(n,a=>(D("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new bt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>x(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let n=br(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}};function Ua(r,t){return x(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),D("FirestoreClient","Initializing OfflineComponentProvider");let e=r.configuration;yield t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener(i=>x(this,null,function*(){n.isEqual(i)||(yield zm(t.localStore,i),n=i)})),t.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=t})}function Vf(r,t){return x(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let e=yield dl(r);D("FirestoreClient","Initializing OnlineComponentProvider"),yield t.initialize(e,r.configuration),r.setCredentialChangeListener(n=>Sf(t.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>Sf(t.remoteStore,i)),r._onlineComponents=t})}function dl(r){return x(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){D("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Ua(r,r._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!function(i){return i.name==="FirebaseError"?i.code===P.FAILED_PRECONDITION||i.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(e))throw e;ne("Error using user provided cache. Falling back to memory cache: "+e),yield Ua(r,new Ic)}}else D("FirestoreClient","Using default OfflineComponentProvider"),yield Ua(r,new Ic);return r._offlineComponents})}function Vo(r){return x(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(D("FirestoreClient","Using user provided OnlineComponentProvider"),yield Vf(r,r._uninitializedComponentsProvider._online)):(D("FirestoreClient","Using default OnlineComponentProvider"),yield Vf(r,new hl))),r._onlineComponents})}function ap(r){return dl(r).then(t=>t.persistence)}function fl(r){return dl(r).then(t=>t.localStore)}function up(r){return Vo(r).then(t=>t.remoteStore)}function ml(r){return Vo(r).then(t=>t.syncEngine)}function Ny(r){return Vo(r).then(t=>t.datastore)}function yr(r){return x(this,null,function*(){let t=yield Vo(r),e=t.eventManager;return e.onListen=fy.bind(null,t.syncEngine),e.onUnlisten=py.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=my.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=gy.bind(null,t.syncEngine),e})}function ky(r){return r.asyncQueue.enqueue(()=>x(this,null,function*(){let t=yield ap(r),e=yield up(r);return t.setNetworkEnabled(!0),function(i){let s=O(i);return s.L_.delete(0),Ui(s)}(e)}))}function My(r){return r.asyncQueue.enqueue(()=>x(this,null,function*(){let t=yield ap(r),e=yield up(r);return t.setNetworkEnabled(!1),function(i){return x(this,null,function*(){let s=O(i);s.L_.add(0),yield Tr(s),s.q_.set("Offline")})}(e)}))}function Oy(r,t){let e=new bt;return r.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(i,s,a){return x(this,null,function*(){try{let u=yield function(d,f){let p=O(d);return p.persistence.runTransaction("read document","readonly",_=>p.localDocuments.getDocument(_,f))}(i,s);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new R(P.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){let l=br(u,`Failed to get document '${s} from cache`);a.reject(l)}})}(yield fl(r),t,e)})),e.promise}function cp(r,t,e={}){let n=new bt;return r.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(s,a,u,l,d){let f=new _r({next:_=>{f.Za(),a.enqueueAndForget(()=>il(s,p));let b=_.docs.has(u);!b&&_.fromCache?d.reject(new R(P.UNAVAILABLE,"Failed to get document because the client is offline.")):b&&_.fromCache&&l&&l.source==="server"?d.reject(new R(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(_)},error:_=>d.reject(_)}),p=new Vi(Ir(u.path),f,{includeMetadataChanges:!0,_a:!0});return rl(s,p)}(yield yr(r),r.asyncQueue,t,e,n)})),n.promise}function Fy(r,t){let e=new bt;return r.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(i,s,a){return x(this,null,function*(){try{let u=yield ro(i,s,!0),l=new go(s,u.Ts),d=l.ma(u.documents),f=l.applyChanges(d,!1);a.resolve(f.snapshot)}catch(u){let l=br(u,`Failed to execute query '${s} against cache`);a.reject(l)}})}(yield fl(r),t,e)})),e.promise}function lp(r,t,e={}){let n=new bt;return r.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(s,a,u,l,d){let f=new _r({next:_=>{f.Za(),a.enqueueAndForget(()=>il(s,p)),_.fromCache&&l.source==="server"?d.reject(new R(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(_)},error:_=>d.reject(_)}),p=new Vi(u,f,{includeMetadataChanges:!0,_a:!0});return rl(s,p)}(yield yr(r),r.asyncQueue,t,e,n)})),n.promise}function Ly(r,t){let e=new _r(t);return r.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(i,s){O(i).Y_.add(s),s.next()}(yield yr(r),e)})),()=>{e.Za(),r.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(i,s){O(i).Y_.delete(s)}(yield yr(r),e)}))}}function qy(r,t,e,n){let i=function(a,u){let l;return l=typeof a=="string"?Em().encode(a):a,function(f,p){return new Ec(f,p)}(function(f,p){if(f instanceof Uint8Array)return Df(f,p);if(f instanceof ArrayBuffer)return Df(new Uint8Array(f),p);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),u)}(e,Bi(t));r.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){Vy(yield ml(r),i,n)}))}function By(r,t){return r.asyncQueue.enqueue(()=>x(this,null,function*(){return function(n,i){let s=O(n);return s.persistence.runTransaction("Get named query","readonly",a=>s.Gr.getNamedQuery(a,i))}(yield fl(r),t)}))}function hp(r){let t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}var Nf=new Map;function pl(r,t,e){if(!e)throw new R(P.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function gl(r,t,e,n){if(t===!0&&n===!0)throw new R(P.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function kf(r){if(!F.isDocumentKey(r))throw new R(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Mf(r){if(F.isDocumentKey(r))throw new R(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function No(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let t=function(n){return n.constructor?n.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":L()}function Z(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new R(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=No(r);throw new R(P.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}function dp(r,t){if(t<=0)throw new R(P.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${t}.`)}var yo=class{constructor(t){var e,n;if(t.host===void 0){if(t.ssl!==void 0)throw new R(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new R(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}gl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=hp((n=t.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new R(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new R(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new R(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},bn=class{constructor(t,e,n,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new yo({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new R(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new R(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new yo(t),t.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new ja;switch(n.type){case"firstParty":return new $a(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new R(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return x(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let n=Nf.get(e);n&&(D("ComponentProvider","Removing Datastore"),Nf.delete(e),n.terminate())}(this),Promise.resolve()}};function fp(r,t,e,n={}){var i;let s=(r=Z(r,bn))._getSettings(),a=`${t}:${e}`;if(s.host!=="firestore.googleapis.com"&&s.host!==a&&ne("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let u,l;if(typeof n.mockUserToken=="string")u=n.mockUserToken,l=Tt.MOCK_USER;else{u=ud(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);let d=n.mockUserToken.sub||n.mockUserToken.user_id;if(!d)throw new R(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Tt(d)}r._authCredentials=new Ga(new Rs(u,l))}}var xt=class r{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new r(this.firestore,t,this._query)}},ot=class r{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new me(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new r(this.firestore,t,this._key)}},me=class r extends xt{constructor(t,e,n){super(t,e,Ir(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new ot(this.firestore,null,new F(t))}withConverter(t){return new r(this.firestore,t,this._path)}};function ji(r,t,...e){if(r=ft(r),pl("collection","path",t),r instanceof bn){let n=Y.fromString(t,...e);return Mf(n),new me(r,null,n)}{if(!(r instanceof ot||r instanceof me))throw new R(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(Y.fromString(t,...e));return Mf(n),new me(r.firestore,null,n)}}function mp(r,t){if(r=Z(r,bn),pl("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new R(P.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new xt(r,null,function(n){return new re(Y.emptyPath(),n)}(t))}function Gi(r,t,...e){if(r=ft(r),arguments.length===1&&(t=Ds.newId()),pl("doc","path",t),r instanceof bn){let n=Y.fromString(t,...e);return kf(n),new ot(r,null,new F(n))}{if(!(r instanceof ot||r instanceof me))throw new R(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(Y.fromString(t,...e));return kf(n),new ot(r.firestore,r instanceof me?r.converter:null,new F(n))}}function _l(r,t){return r=ft(r),t=ft(t),(r instanceof ot||r instanceof me)&&(t instanceof ot||t instanceof me)&&r.firestore===t.firestore&&r.path===t.path&&r.converter===t.converter}function yl(r,t){return r=ft(r),t=ft(t),r instanceof xt&&t instanceof xt&&r.firestore===t.firestore&&Li(r._query,t._query)&&r.converter===t.converter}var vo=class{constructor(t=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Di(this,"async_queue_retry"),this.Vu=()=>{let n=xs();n&&D("AsyncQueue","Visibility state changed to "+n.visibilityState),this.t_.jo()},this.mu=t;let e=xs();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.fu(),this.gu(t)}enterRestrictedMode(t){if(!this.Iu){this.Iu=!0,this.Au=t||!1;let e=xs();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.Vu)}}enqueue(t){if(this.fu(),this.Iu)return new Promise(()=>{});let e=new bt;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Pu.push(t),this.pu()))}pu(){return x(this,null,function*(){if(this.Pu.length!==0){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(t){if(!nn(t))throw t;D("AsyncQueue","Operation failed with retryable error: "+t)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(t){let e=this.mu.then(()=>(this.du=!0,t().catch(n=>{this.Eu=n,this.du=!1;let i=function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),u}(n);throw gt("INTERNAL UNHANDLED ERROR: ",i),n}).then(n=>(this.du=!1,n))));return this.mu=e,e}enqueueAfterDelay(t,e,n){this.fu(),this.Ru.indexOf(t)>-1&&(e=0);let i=hc.createAndSchedule(this,t,e,n,s=>this.yu(s));return this.Tu.push(i),i}fu(){this.Eu&&L()}verifyOperationInProgress(){}wu(){return x(this,null,function*(){let t;do t=this.mu,yield t;while(t!==this.mu)})}Su(t){for(let e of this.Tu)if(e.timerId===t)return!0;return!1}bu(t){return this.wu().then(()=>{this.Tu.sort((e,n)=>e.targetTimeMs-n.targetTimeMs);for(let e of this.Tu)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.wu()})}Du(t){this.Ru.push(t)}yu(t){let e=this.Tu.indexOf(t);this.Tu.splice(e,1)}};function Cc(r){return function(e,n){if(typeof e!="object"||e===null)return!1;let i=e;for(let s of n)if(s in i&&typeof i[s]=="function")return!0;return!1}(r,["next","error","complete"])}var Pc=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new bt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}};var pp=-1,ht=class extends bn{constructor(t,e,n,i){super(t,e,n,i),this.type="firestore",this._queue=new vo,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return x(this,null,function*(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new vo(t),this._firestoreClient=void 0,yield t}})}};function Rt(r){if(r._terminated)throw new R(P.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||gp(r),r._firestoreClient}function gp(r){var t,e,n;let i=r._freezeSettings(),s=function(u,l,d,f){return new tu(u,l,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,hp(f.experimentalLongPollingOptions),f.useFetchStreams)}(r._databaseId,((t=r._app)===null||t===void 0?void 0:t.options.appId)||"",r._persistenceKey,i);r._componentsProvider||!((e=i.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new Sc(r._authCredentials,r._appCheckCredentials,r._queue,s,r._componentsProvider&&function(u){let l=u?._online.build();return{_offline:u?._offline.build(l),_online:l}}(r._componentsProvider))}function _p(r,t){ne("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=r._freezeSettings();return vp(r,hl.provider,{build:n=>new _o(n,e.cacheSizeBytes,t?.forceOwnership)}),Promise.resolve()}function yp(r){return x(this,null,function*(){ne("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=r._freezeSettings();vp(r,hl.provider,{build:e=>new Tc(e,t.cacheSizeBytes)})})}function vp(r,t,e){if((r=Z(r,ht))._firestoreClient||r._terminated)throw new R(P.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(r._componentsProvider||r._getSettings().localCache)throw new R(P.FAILED_PRECONDITION,"SDK cache is already specified.");r._componentsProvider={_online:t,_offline:e},gp(r)}function wp(r){if(r._initialized&&!r._terminated)throw new R(P.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new bt;return r._queue.enqueueAndForgetEvenWhileRestricted(()=>x(this,null,function*(){try{yield function(n){return x(this,null,function*(){if(!$e.D())return Promise.resolve();let i=n+"main";yield $e.delete(i)})}(Zc(r._databaseId,r._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function Ip(r){return function(e){let n=new bt;return e.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return Iy(yield ml(e),n)})),n.promise}(Rt(r=Z(r,ht)))}function Tp(r){return ky(Rt(r=Z(r,ht)))}function Ep(r){return My(Rt(r=Z(r,ht)))}function Ap(r,t){let e=Rt(r=Z(r,ht)),n=new Pc;return qy(e,r._databaseId,t,n),n}function bp(r,t){return By(Rt(r=Z(r,ht)),t).then(e=>e?new xt(r,null,e.query):null)}var ye=class r{constructor(t){this._byteString=t}static fromBase64String(t){try{return new r(vt.fromBase64String(t))}catch(e){throw new R(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new r(vt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var se=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new R(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new _t(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var Re=class{constructor(t){this._methodName=t}};var Sn=class{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new R(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new R(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return z(this._lat,t._lat)||z(this._long,t._long)}};var Ni=class{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,t._values)}};var Uy=/^__.*__$/,xc=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new ie(t,this.data,this.fieldMask,e,this.fieldTransforms):new Xe(t,this.data,e,this.fieldTransforms)}},wo=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new ie(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function Sp(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L()}}var Io=class r{constructor(t,e,n,i,s,a){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(t){return new r(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.Fu({path:n,xu:!1});return i.Ou(t),i}Nu(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.Fu({path:n,xu:!1});return i.vu(),i}Lu(t){return this.Fu({path:void 0,xu:!0})}Bu(t){return To(t,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}vu(){if(this.path)for(let t=0;t<this.path.length;t++)this.Ou(this.path.get(t))}Ou(t){if(t.length===0)throw this.Bu("Document fields must not be empty");if(Sp(this.Cu)&&Uy.test(t))throw this.Bu('Document fields cannot begin and end with "__"')}},Rc=class{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Bi(t)}Qu(t,e,n,i=!1){return new Io({Cu:t,methodName:e,qu:n,path:_t.emptyPath(),xu:!1,ku:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Rn(r){let t=r._freezeSettings(),e=Bi(r._databaseId);return new Rc(r._databaseId,!!t.ignoreUndefinedProperties,e)}function ko(r,t,e,n,i,s={}){let a=r.Qu(s.merge||s.mergeFields?2:0,t,e,i);Il("Data must be an object, but it was:",a,n);let u=xp(n,a),l,d;if(s.merge)l=new Wt(a.fieldMask),d=a.fieldTransforms;else if(s.mergeFields){let f=[];for(let p of s.mergeFields){let _=Mc(t,p,e);if(!a.contains(_))throw new R(P.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);Dp(f,_)||f.push(_)}l=new Wt(f),d=a.fieldTransforms.filter(p=>l.covers(p.field))}else l=null,d=a.fieldTransforms;return new xc(new Ot(u),l,d)}var ki=class r extends Re{_toFieldTransform(t){if(t.Cu!==2)throw t.Cu===1?t.Bu(`${this._methodName}() can only appear at the top level of your update data`):t.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof r}};function Cp(r,t,e){return new Io({Cu:3,qu:t.settings.qu,methodName:r._methodName,xu:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var Dc=class r extends Re{_toFieldTransform(t){return new Tn(t.path,new Je)}isEqual(t){return t instanceof r}},Vc=class r extends Re{constructor(t,e){super(t),this.Ku=e}_toFieldTransform(t){let e=Cp(this,t,!0),n=this.Ku.map(s=>Dn(s,e)),i=new Pe(n);return new Tn(t.path,i)}isEqual(t){return t instanceof r&&xa(this.Ku,t.Ku)}},Nc=class r extends Re{constructor(t,e){super(t),this.Ku=e}_toFieldTransform(t){let e=Cp(this,t,!0),n=this.Ku.map(s=>Dn(s,e)),i=new xe(n);return new Tn(t.path,i)}isEqual(t){return t instanceof r&&xa(this.Ku,t.Ku)}},kc=class r extends Re{constructor(t,e){super(t),this.$u=e}_toFieldTransform(t){let e=new Ye(t.serializer,mm(t.serializer,this.$u));return new Tn(t.path,e)}isEqual(t){return t instanceof r&&this.$u===t.$u}};function vl(r,t,e,n){let i=r.Qu(1,t,e);Il("Data must be an object, but it was:",i,n);let s=[],a=Ot.empty();xn(n,(l,d)=>{let f=Tl(t,l,e);d=ft(d);let p=i.Nu(f);if(d instanceof ki)s.push(f);else{let _=Dn(d,p);_!=null&&(s.push(f),a.set(f,_))}});let u=new Wt(s);return new wo(a,u,i.fieldTransforms)}function wl(r,t,e,n,i,s){let a=r.Qu(1,t,e),u=[Mc(t,n,e)],l=[i];if(s.length%2!=0)throw new R(P.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)u.push(Mc(t,s[_])),l.push(s[_+1]);let d=[],f=Ot.empty();for(let _=u.length-1;_>=0;--_)if(!Dp(d,u[_])){let b=u[_],N=l[_];N=ft(N);let k=a.Nu(b);if(N instanceof ki)d.push(b);else{let V=Dn(N,k);V!=null&&(d.push(b),f.set(b,V))}}let p=new Wt(d);return new wo(f,p,a.fieldTransforms)}function Pp(r,t,e,n=!1){return Dn(e,r.Qu(n?4:3,t))}function Dn(r,t){if(Rp(r=ft(r)))return Il("Unsupported field value:",t,r),xp(r,t);if(r instanceof Re)return function(n,i){if(!Sp(i.Cu))throw i.Bu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Bu(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.xu&&t.Cu!==4)throw t.Bu("Nested arrays are not supported");return function(n,i){let s=[],a=0;for(let u of n){let l=Dn(u,i.Lu(a));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),a++}return{arrayValue:{values:s}}}(r,t)}return function(n,i){if((n=ft(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return mm(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=lt.fromDate(n);return{timestampValue:cr(i.serializer,s)}}if(n instanceof lt){let s=new lt(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:cr(i.serializer,s)}}if(n instanceof Sn)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof ye)return{bytesValue:Am(i.serializer,n._byteString)};if(n instanceof ot){let s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.Bu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Jc(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof Ni)return function(a,u){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(l=>{if(typeof l!="number")throw u.Bu("VectorValues must only contain numeric values.");return Hc(u.serializer,l)})}}}}}}(n,i);throw i.Bu(`Unsupported field value: ${No(n)}`)}(r,t)}function xp(r,t){let e={};return Jf(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):xn(r,(n,i)=>{let s=Dn(i,t.Mu(n));s!=null&&(e[n]=s)}),{mapValue:{fields:e}}}function Rp(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof lt||r instanceof Sn||r instanceof ye||r instanceof ot||r instanceof Re||r instanceof Ni)}function Il(r,t,e){if(!Rp(e)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(e)){let n=No(e);throw n==="an object"?t.Bu(r+" a custom object"):t.Bu(r+" "+n)}}function Mc(r,t,e){if((t=ft(t))instanceof se)return t._internalPath;if(typeof t=="string")return Tl(r,t);throw To("Field path arguments must be of type string or ",r,!1,void 0,e)}var jy=new RegExp("[~\\*/\\[\\]]");function Tl(r,t,e){if(t.search(jy)>=0)throw To(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new se(...t.split("."))._internalPath}catch{throw To(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function To(r,t,e,n,i){let s=n&&!n.isEmpty(),a=i!==void 0,u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new R(P.INVALID_ARGUMENT,u+r+l)}function Dp(r,t){return r.some(e=>e.isEqual(t))}var Cn=class{constructor(t,e,n,i,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ot(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new Oc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(Mo("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},Oc=class extends Cn{data(){return super.data()}};function Mo(r,t){return typeof t=="string"?Tl(r,t):t instanceof se?t._internalPath:t._delegate._internalPath}function Vp(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new R(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Mi=class{},Pn=class extends Mi{};function ae(r,t,...e){let n=[];t instanceof Mi&&n.push(t),n=n.concat(e),function(s){let a=s.filter(l=>l instanceof Fc).length,u=s.filter(l=>l instanceof Eo).length;if(a>1||a>0&&u>0)throw new R(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let i of n)r=i._apply(r);return r}var Eo=class r extends Pn{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=this._parse(t);return Up(t._query,e),new xt(t.firestore,t.converter,fu(t._query,e))}_parse(t){let e=Rn(t.firestore);return function(s,a,u,l,d,f,p){let _;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new R(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){Ff(p,f);let b=[];for(let N of p)b.push(Of(l,s,N));_={arrayValue:{values:b}}}else _=Of(l,s,p)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||Ff(p,f),_=Pp(u,a,p,f==="in"||f==="not-in");return W.create(d,f,_)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function Oo(r,t,e){let n=t,i=Mo("where",r);return Eo._create(i,n,e)}var Fc=class r extends Mi{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new r(t,e)}_parse(t){let e=this._queryConstraints.map(n=>n._parse(t)).filter(n=>n.getFilters().length>0);return e.length===1?e[0]:rt.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(i,s){let a=i,u=s.getFlattenedFilters();for(let l of u)Up(a,l),a=fu(a,l)}(t._query,e),new xt(t.firestore,t.converter,fu(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Lc=class r extends Pn{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new r(t,e)}_apply(t){let e=function(i,s,a){if(i.startAt!==null)throw new R(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new R(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new wn(s,a)}(t._query,this._field,this._direction);return new xt(t.firestore,t.converter,function(i,s){let a=i.explicitOrderBy.concat([s]);return new re(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(t._query,e))}};function Np(r,t="asc"){let e=t,n=Mo("orderBy",r);return Lc._create(n,e)}var Ao=class r extends Pn{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){return new xt(t.firestore,t.converter,Us(t._query,this._limit,this._limitType))}};function kp(r){return dp("limit",r),Ao._create("limit",r,"F")}function Mp(r){return dp("limitToLast",r),Ao._create("limitToLast",r,"L")}var bo=class r extends Pn{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=Bp(t,this.type,this._docOrFields,this._inclusive);return new xt(t.firestore,t.converter,function(i,s){return new re(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(t._query,e))}};function Op(...r){return bo._create("startAt",r,!0)}function Fp(...r){return bo._create("startAfter",r,!1)}var So=class r extends Pn{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=Bp(t,this.type,this._docOrFields,this._inclusive);return new xt(t.firestore,t.converter,function(i,s){return new re(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(t._query,e))}};function Lp(...r){return So._create("endBefore",r,!1)}function qp(...r){return So._create("endAt",r,!0)}function Bp(r,t,e,n){if(e[0]=ft(e[0]),e[0]instanceof Cn)return function(s,a,u,l,d){if(!l)throw new R(P.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);let f=[];for(let p of er(s))if(p.field.isKeyField())f.push(vn(a,l.key));else{let _=l.data.field(p.field);if(Po(_))throw new R(P.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+p.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(_===null){let b=p.field.canonicalString();throw new R(P.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${b}' (used as the orderBy) does not exist.`)}f.push(_)}return new ge(f,d)}(r._query,r.firestore._databaseId,t,e[0]._document,n);{let i=Rn(r.firestore);return function(a,u,l,d,f,p){let _=a.explicitOrderBy;if(f.length>_.length)throw new R(P.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let b=[];for(let N=0;N<f.length;N++){let k=f[N];if(_[N].field.isKeyField()){if(typeof k!="string")throw new R(P.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof k}`);if(!Qc(a)&&k.indexOf("/")!==-1)throw new R(P.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${k}' contains a slash.`);let V=a.path.child(Y.fromString(k));if(!F.isDocumentKey(V))throw new R(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${V}' is not because it contains an odd number of segments.`);let j=new F(V);b.push(vn(u,j))}else{let V=Pp(l,d,k);b.push(V)}}return new ge(b,p)}(r._query,r.firestore._databaseId,i,t,e,n)}}function Of(r,t,e){if(typeof(e=ft(e))=="string"){if(e==="")throw new R(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Qc(t)&&e.indexOf("/")!==-1)throw new R(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let n=t.path.child(Y.fromString(e));if(!F.isDocumentKey(n))throw new R(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return vn(r,new F(n))}if(e instanceof ot)return vn(r,e._key);throw new R(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${No(e)}.`)}function Ff(r,t){if(!Array.isArray(r)||r.length===0)throw new R(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Up(r,t){let e=function(i,s){for(let a of i)for(let u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new R(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new R(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}var vr=class{convertValue(t,e="none"){switch(yn(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ct(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Qe(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw L()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let n={};return xn(t,(i,s)=>{n[i]=this.convertValue(s,e)}),n}convertVectorValue(t){var e,n,i;let s=(i=(n=(e=t.fields)===null||e===void 0?void 0:e.value.arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.map(a=>ct(a.doubleValue));return new Ni(s)}convertGeoPoint(t){return new Sn(ct(t.latitude),ct(t.longitude))}convertArray(t,e){return(t.values||[]).map(n=>this.convertValue(n,e))}convertServerTimestamp(t,e){switch(e){case"previous":let n=Kc(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(yi(t));default:return null}}convertTimestamp(t){let e=Ce(t);return new lt(e.seconds,e.nanos)}convertDocumentKey(t,e){let n=Y.fromString(t);q(Mm(n));let i=new We(n.get(1),n.get(3)),s=new F(n.popFirst(5));return i.isEqual(e)||gt(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}};function Fo(r,t,e){let n;return n=r?e&&(e.merge||e.mergeFields)?r.toFirestore(t,e):r.toFirestore(t):t,n}var qc=class extends vr{constructor(t){super(),this.firestore=t}convertBytes(t){return new ye(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new ot(this.firestore,null,e)}};var Se=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},Zt=class extends Cn{constructor(t,e,n,i,s,a){super(t,e,n,i,a),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new ze(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let n=this._document.data.field(Mo("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}},ze=class extends Zt{data(t={}){return super.data(t)}},oe=class{constructor(t,e,n,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new Se(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new ze(this._firestore,this._userDataWriter,n.key,n,new Se(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new R(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let l=new ze(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Se(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||u.type!==3).map(u=>{let l=new ze(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Se(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,f=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:Gy(u.type),doc:l,oldIndex:d,newIndex:f}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}};function Gy(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L()}}function El(r,t){return r instanceof Zt&&t instanceof Zt?r._firestore===t._firestore&&r._key.isEqual(t._key)&&(r._document===null?t._document===null:r._document.isEqual(t._document))&&r._converter===t._converter:r instanceof oe&&t instanceof oe&&r._firestore===t._firestore&&yl(r.query,t.query)&&r.metadata.isEqual(t.metadata)&&r._snapshot.isEqual(t._snapshot)}function jp(r){r=Z(r,ot);let t=Z(r.firestore,ht);return cp(Rt(t),r._key).then(e=>Cl(t,r,e))}var De=class extends vr{constructor(t){super(),this.firestore=t}convertBytes(t){return new ye(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new ot(this.firestore,null,e)}};function Gp(r){r=Z(r,ot);let t=Z(r.firestore,ht),e=Rt(t),n=new De(t);return Oy(e,r._key).then(i=>new Zt(t,n,r._key,i,new Se(i!==null&&i.hasLocalMutations,!0),r.converter))}function zp(r){r=Z(r,ot);let t=Z(r.firestore,ht);return cp(Rt(t),r._key,{source:"server"}).then(e=>Cl(t,r,e))}function Lo(r){r=Z(r,xt);let t=Z(r.firestore,ht),e=Rt(t),n=new De(t);return Vp(r._query),lp(e,r._query).then(i=>new oe(t,n,r,i))}function Kp(r){r=Z(r,xt);let t=Z(r.firestore,ht),e=Rt(t),n=new De(t);return Fy(e,r._query).then(i=>new oe(t,n,r,i))}function $p(r){r=Z(r,xt);let t=Z(r.firestore,ht),e=Rt(t),n=new De(t);return lp(e,r._query,{source:"server"}).then(i=>new oe(t,n,r,i))}function Al(r,t,e){r=Z(r,ot);let n=Z(r.firestore,ht),i=Fo(r.converter,t,e);return Sr(n,[ko(Rn(n),"setDoc",r._key,i,r.converter!==null,e).toMutation(r._key,mt.none())])}function bl(r,t,e,...n){r=Z(r,ot);let i=Z(r.firestore,ht),s=Rn(i),a;return a=typeof(t=ft(t))=="string"||t instanceof se?wl(s,"updateDoc",r._key,t,e,n):vl(s,"updateDoc",r._key,t),Sr(i,[a.toMutation(r._key,mt.exists(!0))])}function Qp(r){return Sr(Z(r.firestore,ht),[new Ze(r._key,mt.none())])}function Wp(r,t){let e=Z(r.firestore,ht),n=Gi(r),i=Fo(r.converter,t);return Sr(e,[ko(Rn(r.firestore),"addDoc",n._key,i,r.converter!==null,{}).toMutation(n._key,mt.exists(!1))]).then(()=>n)}function Sl(r,...t){var e,n,i;r=ft(r);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof t[a]!="object"||Cc(t[a])||(s=t[a],a++);let u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Cc(t[a])){let p=t[a];t[a]=(e=p.next)===null||e===void 0?void 0:e.bind(p),t[a+1]=(n=p.error)===null||n===void 0?void 0:n.bind(p),t[a+2]=(i=p.complete)===null||i===void 0?void 0:i.bind(p)}let l,d,f;if(r instanceof ot)d=Z(r.firestore,ht),f=Ir(r._key.path),l={next:p=>{t[a]&&t[a](Cl(d,r,p))},error:t[a+1],complete:t[a+2]};else{let p=Z(r,xt);d=Z(p.firestore,ht),f=p._query;let _=new De(d);l={next:b=>{t[a]&&t[a](new oe(d,_,p,b))},error:t[a+1],complete:t[a+2]},Vp(r._query)}return function(_,b,N,k){let V=new _r(k),j=new Vi(b,V,N);return _.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return rl(yield yr(_),j)})),()=>{V.Za(),_.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return il(yield yr(_),j)}))}}(Rt(d),f,u,l)}function Hp(r,t){return Ly(Rt(r=Z(r,ht)),Cc(t)?t:{next:t})}function Sr(r,t){return function(n,i){let s=new bt;return n.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return _y(yield ml(n),i,s)})),s.promise}(Rt(r),t)}function Cl(r,t,e){let n=e.docs.get(t._key),i=new De(r);return new Zt(r,i,t._key,n,new Se(e.hasPendingWrites,e.fromCache),t.converter)}var zy={maxAttempts:5};var Co=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Rn(t)}set(t,e,n){this._verifyNotCommitted();let i=je(t,this._firestore),s=Fo(i.converter,e,n),a=ko(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,n);return this._mutations.push(a.toMutation(i._key,mt.none())),this}update(t,e,n,...i){this._verifyNotCommitted();let s=je(t,this._firestore),a;return a=typeof(e=ft(e))=="string"||e instanceof se?wl(this._dataReader,"WriteBatch.update",s._key,e,n,i):vl(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(a.toMutation(s._key,mt.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=je(t,this._firestore);return this._mutations=this._mutations.concat(new Ze(e._key,mt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new R(P.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function je(r,t){if((r=ft(r)).firestore!==t)throw new R(P.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}var Bc=class extends class{constructor(e,n){this._firestore=e,this._transaction=n,this._dataReader=Rn(e)}get(e){let n=je(e,this._firestore),i=new qc(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||s.length!==1)return L();let a=s[0];if(a.isFoundDocument())return new Cn(this._firestore,i,a.key,a,n.converter);if(a.isNoDocument())return new Cn(this._firestore,i,n._key,null,n.converter);throw L()})}set(e,n,i){let s=je(e,this._firestore),a=Fo(s.converter,n,i),u=ko(this._dataReader,"Transaction.set",s._key,a,s.converter!==null,i);return this._transaction.set(s._key,u),this}update(e,n,i,...s){let a=je(e,this._firestore),u;return u=typeof(n=ft(n))=="string"||n instanceof se?wl(this._dataReader,"Transaction.update",a._key,n,i,s):vl(this._dataReader,"Transaction.update",a._key,n),this._transaction.update(a._key,u),this}delete(e){let n=je(e,this._firestore);return this._transaction.delete(n._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=je(t,this._firestore),n=new De(this._firestore);return super.get(t).then(i=>new Zt(this._firestore,n,e._key,i._document,new Se(!1,!1),e.converter))}};function Jp(r,t,e){r=Z(r,ht);let n=Object.assign(Object.assign({},zy),e);return function(s){if(s.maxAttempts<1)throw new R(P.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,a,u){let l=new bt;return s.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){let d=yield Ny(s);new bc(s.asyncQueue,d,u,a,l).au()})),l.promise}(Rt(r),i=>t(new Bc(r,i)),n)}function Yp(){return new ki("deleteField")}function Xp(){return new Dc("serverTimestamp")}function Zp(...r){return new Vc("arrayUnion",r)}function tg(...r){return new Nc("arrayRemove",r)}function eg(r){return new kc("increment",r)}(function(t,e=!0){(function(i){wr=i})(fd),dd(new _s("firestore",(n,{instanceIdentifier:i,options:s})=>{let a=n.getProvider("app").getImmediate(),u=new ht(new za(n.getProvider("auth-internal")),new Wa(n.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new R(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new We(d.options.projectId,f)}(a,i),a);return s=Object.assign({useFetchStreams:e},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),Ra(kd,"4.7.3",t),Ra(kd,"4.7.3","esm2017")})();et();et();et();var Ky="@firebase/firestore-compat",$y="0.3.38";function Nl(r,t){if(t===void 0)return{merge:!1};if(t.mergeFields!==void 0&&t.merge!==void 0)throw new R("invalid-argument",`Invalid options passed to function ${r}(): You cannot specify both "merge" and "mergeFields".`);return t}function ng(){if(typeof Uint8Array>"u")throw new R("unimplemented","Uint8Arrays are not available in this environment.")}function rg(){if(!Yf())throw new R("unimplemented","Blobs are unavailable in Firestore in this environment.")}var qo=class r{constructor(t){this._delegate=t}static fromBase64String(t){return rg(),new r(ye.fromBase64String(t))}static fromUint8Array(t){return ng(),new r(ye.fromUint8Array(t))}toBase64(){return rg(),this._delegate.toBase64()}toUint8Array(){return ng(),this._delegate.toUint8Array()}isEqual(t){return this._delegate.isEqual(t._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function Pl(r){return Qy(r,["next","error","complete"])}function Qy(r,t){if(typeof r!="object"||r===null)return!1;let e=r;for(let n of t)if(n in e&&typeof e[n]=="function")return!0;return!1}var xl=class{enableIndexedDbPersistence(t,e){return _p(t._delegate,{forceOwnership:e})}enableMultiTabIndexedDbPersistence(t){return yp(t._delegate)}clearIndexedDbPersistence(t){return wp(t._delegate)}},Bo=class{constructor(t,e,n){this._delegate=e,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},t instanceof We||(this._appCompat=t)}get _databaseId(){return this._delegate._databaseId}settings(t){let e=this._delegate._getSettings();!t.merge&&e.host!==t.host&&ne("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&(t=Object.assign(Object.assign({},e),t),delete t.merge),this._delegate._setSettings(t)}useEmulator(t,e,n={}){fp(this._delegate,t,e,n)}enableNetwork(){return Tp(this._delegate)}disableNetwork(){return Ep(this._delegate)}enablePersistence(t){let e=!1,n=!1;return t&&(e=!!t.synchronizeTabs,n=!!t.experimentalForceOwningTab,gl("synchronizeTabs",e,"experimentalForceOwningTab",n)),e?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Ip(this._delegate)}onSnapshotsInSync(t){return Hp(this._delegate,t)}get app(){if(!this._appCompat)throw new R("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(t){try{return new xr(this,ji(this._delegate,t))}catch(e){throw jt(e,"collection()","Firestore.collection()")}}doc(t){try{return new ve(this,Gi(this._delegate,t))}catch(e){throw jt(e,"doc()","Firestore.doc()")}}collectionGroup(t){try{return new Mn(this,mp(this._delegate,t))}catch(e){throw jt(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return Jp(this._delegate,e=>t(new Uo(this,e)))}batch(){return Rt(this._delegate),new jo(new Co(this._delegate,t=>Sr(this._delegate,t)))}loadBundle(t){return Ap(this._delegate,t)}namedQuery(t){return bp(this._delegate,t).then(e=>e?new Mn(this,e):null)}},Cr=class extends vr{constructor(t){super(),this.firestore=t}convertBytes(t){return new qo(new ye(t))}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return ve.forKey(e,this.firestore,null)}};function Wy(r){Lf(r)}var Uo=class{constructor(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Cr(t)}get(t){let e=Vn(t);return this._delegate.get(e).then(n=>new Nn(this._firestore,new Zt(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,e.converter)))}set(t,e,n){let i=Vn(t);return n?(Nl("Transaction.set",n),this._delegate.set(i,e,n)):this._delegate.set(i,e),this}update(t,e,n,...i){let s=Vn(t);return arguments.length===2?this._delegate.update(s,e):this._delegate.update(s,e,n,...i),this}delete(t){let e=Vn(t);return this._delegate.delete(e),this}},jo=class{constructor(t){this._delegate=t}set(t,e,n){let i=Vn(t);return n?(Nl("WriteBatch.set",n),this._delegate.set(i,e,n)):this._delegate.set(i,e),this}update(t,e,n,...i){let s=Vn(t);return arguments.length===2?this._delegate.update(s,e):this._delegate.update(s,e,n,...i),this}delete(t){let e=Vn(t);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}},Pr=class r{constructor(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}fromFirestore(t,e){let n=new ze(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new kn(this._firestore,n),e??{})}toFirestore(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)}static getInstance(t,e){let n=r.INSTANCES,i=n.get(t);i||(i=new WeakMap,n.set(t,i));let s=i.get(e);return s||(s=new r(t,new Cr(t),e),i.set(e,s)),s}};Pr.INSTANCES=new WeakMap;var ve=class r{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Cr(t)}static forPath(t,e,n){if(t.length%2!==0)throw new R("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${t.canonicalString()} has ${t.length}`);return new r(e,new ot(e._delegate,n,new F(t)))}static forKey(t,e,n){return new r(e,new ot(e._delegate,n,t))}get id(){return this._delegate.id}get parent(){return new xr(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(t){try{return new xr(this.firestore,ji(this._delegate,t))}catch(e){throw jt(e,"collection()","DocumentReference.collection()")}}isEqual(t){return t=ft(t),t instanceof ot?_l(this._delegate,t):!1}set(t,e){e=Nl("DocumentReference.set",e);try{return e?Al(this._delegate,t,e):Al(this._delegate,t)}catch(n){throw jt(n,"setDoc()","DocumentReference.set()")}}update(t,e,...n){try{return arguments.length===1?bl(this._delegate,t):bl(this._delegate,t,e,...n)}catch(i){throw jt(i,"updateDoc()","DocumentReference.update()")}}delete(){return Qp(this._delegate)}onSnapshot(...t){let e=ig(t),n=sg(t,i=>new Nn(this.firestore,new Zt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Sl(this._delegate,e,n)}get(t){let e;return t?.source==="cache"?e=Gp(this._delegate):t?.source==="server"?e=zp(this._delegate):e=jp(this._delegate),e.then(n=>new Nn(this.firestore,new Zt(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(t){return new r(this.firestore,t?this._delegate.withConverter(Pr.getInstance(this.firestore,t)):this._delegate.withConverter(null))}};function jt(r,t,e){return r.message=r.message.replace(t,e),r}function ig(r){for(let t of r)if(typeof t=="object"&&!Pl(t))return t;return{}}function sg(r,t){var e,n;let i;return Pl(r[0])?i=r[0]:Pl(r[1])?i=r[1]:typeof r[0]=="function"?i={next:r[0],error:r[1],complete:r[2]}:i={next:r[1],error:r[2],complete:r[3]},{next:s=>{i.next&&i.next(t(s))},error:(e=i.error)===null||e===void 0?void 0:e.bind(i),complete:(n=i.complete)===null||n===void 0?void 0:n.bind(i)}}var Nn=class{constructor(t,e){this._firestore=t,this._delegate=e}get ref(){return new ve(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(t){return this._delegate.data(t)}get(t,e){return this._delegate.get(t,e)}isEqual(t){return El(this._delegate,t._delegate)}},kn=class extends Nn{data(t){let e=this._delegate.data(t);return this._delegate._converter||qf(e!==void 0,"Document in a QueryDocumentSnapshot should exist"),e}},Mn=class r{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Cr(t)}where(t,e,n){try{return new r(this.firestore,ae(this._delegate,Oo(t,e,n)))}catch(i){throw jt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(t,e){try{return new r(this.firestore,ae(this._delegate,Np(t,e)))}catch(n){throw jt(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(t){try{return new r(this.firestore,ae(this._delegate,kp(t)))}catch(e){throw jt(e,"limit()","Query.limit()")}}limitToLast(t){try{return new r(this.firestore,ae(this._delegate,Mp(t)))}catch(e){throw jt(e,"limitToLast()","Query.limitToLast()")}}startAt(...t){try{return new r(this.firestore,ae(this._delegate,Op(...t)))}catch(e){throw jt(e,"startAt()","Query.startAt()")}}startAfter(...t){try{return new r(this.firestore,ae(this._delegate,Fp(...t)))}catch(e){throw jt(e,"startAfter()","Query.startAfter()")}}endBefore(...t){try{return new r(this.firestore,ae(this._delegate,Lp(...t)))}catch(e){throw jt(e,"endBefore()","Query.endBefore()")}}endAt(...t){try{return new r(this.firestore,ae(this._delegate,qp(...t)))}catch(e){throw jt(e,"endAt()","Query.endAt()")}}isEqual(t){return yl(this._delegate,t._delegate)}get(t){let e;return t?.source==="cache"?e=Kp(this._delegate):t?.source==="server"?e=$p(this._delegate):e=Lo(this._delegate),e.then(n=>new zi(this.firestore,new oe(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...t){let e=ig(t),n=sg(t,i=>new zi(this.firestore,new oe(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Sl(this._delegate,e,n)}withConverter(t){return new r(this.firestore,t?this._delegate.withConverter(Pr.getInstance(this.firestore,t)):this._delegate.withConverter(null))}},Rl=class{constructor(t,e){this._firestore=t,this._delegate=e}get type(){return this._delegate.type}get doc(){return new kn(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},zi=class{constructor(t,e){this._firestore=t,this._delegate=e}get query(){return new Mn(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(t=>new kn(this._firestore,t))}docChanges(t){return this._delegate.docChanges(t).map(e=>new Rl(this._firestore,e))}forEach(t,e){this._delegate.forEach(n=>{t.call(e,new kn(this._firestore,n))})}isEqual(t){return El(this._delegate,t._delegate)}},xr=class r extends Mn{constructor(t,e){super(t,e),this.firestore=t,this._delegate=e}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let t=this._delegate.parent;return t?new ve(this.firestore,t):null}doc(t){try{return t===void 0?new ve(this.firestore,Gi(this._delegate)):new ve(this.firestore,Gi(this._delegate,t))}catch(e){throw jt(e,"doc()","CollectionReference.doc()")}}add(t){return Wp(this._delegate,t).then(e=>new ve(this.firestore,e))}isEqual(t){return _l(this._delegate,t._delegate)}withConverter(t){return new r(this.firestore,t?this._delegate.withConverter(Pr.getInstance(this.firestore,t)):this._delegate.withConverter(null))}};function Vn(r){return Z(r,ot)}var Dl=class r{constructor(...t){this._delegate=new se(...t)}static documentId(){return new r(_t.keyField().canonicalString())}isEqual(t){return t=ft(t),t instanceof se?this._delegate._internalPath.isEqual(t._internalPath):!1}};var Vl=class r{constructor(t){this._delegate=t}static serverTimestamp(){let t=Xp();return t._methodName="FieldValue.serverTimestamp",new r(t)}static delete(){let t=Yp();return t._methodName="FieldValue.delete",new r(t)}static arrayUnion(...t){let e=Zp(...t);return e._methodName="FieldValue.arrayUnion",new r(e)}static arrayRemove(...t){let e=tg(...t);return e._methodName="FieldValue.arrayRemove",new r(e)}static increment(t){let e=eg(t);return e._methodName="FieldValue.increment",new r(e)}isEqual(t){return this._delegate.isEqual(t._delegate)}};var Hy={Firestore:Bo,GeoPoint:Sn,Timestamp:lt,Blob:qo,Transaction:Uo,WriteBatch:jo,DocumentReference:ve,DocumentSnapshot:Nn,Query:Mn,QueryDocumentSnapshot:kn,QuerySnapshot:zi,CollectionReference:xr,FieldPath:Dl,FieldValue:Vl,setLogLevel:Wy,CACHE_SIZE_UNLIMITED:pp};function Jy(r,t){r.INTERNAL.registerComponent(new _s("firestore-compat",e=>{let n=e.getProvider("app-compat").getImmediate(),i=e.getProvider("firestore").getImmediate();return t(n,i)},"PUBLIC").setServiceProps(Object.assign({},Hy)))}function Yy(r){Jy(r,(t,e)=>new Bo(t,e,new xl)),r.registerVersion(Ky,$y)}Yy(ei);function Xy(r,t=Bh){return new qh(e=>{let n;return t!=null?t.schedule(()=>{n=r.onSnapshot({includeMetadataChanges:!0},e)}):n=r.onSnapshot({includeMetadataChanges:!0},e),()=>{n?.()}})}function og(r,t){return Xy(r,t)}function Zy(r,t){return og(r,t).pipe(ls(void 0),us(),ee(e=>{let[n,i]=e;return i.exists?n?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function Ol(r,t){return og(r,t).pipe(ee(e=>({payload:e,type:"query"})))}var Go=class{ref;afs;constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){let n=this.ref.collection(t),{ref:i,query:s}=cg(n,e);return new Ko(i,s,this.afs)}snapshotChanges(){return Zy(this.ref,this.afs.schedulers.outsideAngular).pipe(Jt)}valueChanges(t={}){return this.snapshotChanges().pipe(ee(({payload:e})=>t.idField?Hr(Fe({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return Jr(this.ref.get(t)).pipe(Jt)}};function zo(r,t){return Ol(r,t).pipe(ls(void 0),us(),ee(e=>{let[n,i]=e,s=i.payload.docChanges(),a=s.map(u=>({type:u.type,payload:u}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((u,l)=>{let d=s.find(p=>p.doc.ref.isEqual(u.ref)),f=n?.payload.docs.find(p=>p.ref.isEqual(u.ref));d&&JSON.stringify(d.doc.metadata)===JSON.stringify(u.metadata)||!d&&f&&JSON.stringify(f.metadata)===JSON.stringify(u.metadata)||a.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:u}})}),a}))}function ag(r,t,e){return zo(r,e).pipe(cs((n,i)=>tv(n,i.map(s=>s.payload),t),[]),Uh(),ee(n=>n.map(i=>({type:i.type,payload:i}))))}function tv(r,t,e){return t.forEach(n=>{e.indexOf(n.type)>-1&&(r=ev(r,n))}),r}function kl(r,t,e,...n){let i=r.slice();return i.splice(t,e,...n),i}function ev(r,t){switch(t.type){case"added":if(!(r[t.newIndex]&&r[t.newIndex].doc.ref.isEqual(t.doc.ref)))return kl(r,t.newIndex,0,t);break;case"modified":if(r[t.oldIndex]==null||r[t.oldIndex].doc.ref.isEqual(t.doc.ref))if(t.oldIndex!==t.newIndex){let e=r.slice();return e.splice(t.oldIndex,1),e.splice(t.newIndex,0,t),e}else return kl(r,t.newIndex,1,t);break;case"removed":if(r[t.oldIndex]&&r[t.oldIndex].doc.ref.isEqual(t.doc.ref))return kl(r,t.oldIndex,1);break}return r}function ug(r){return(!r||r.length===0)&&(r=["added","removed","modified"]),r}var Ko=class{ref;query;afs;constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=zo(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(ee(n=>n.filter(i=>t.indexOf(i.type)>-1)))),e.pipe(ls(void 0),us(),ba(([n,i])=>i.length>0||!n),ee(([,n])=>n),Jt)}auditTrail(t){return this.stateChanges(t).pipe(cs((e,n)=>[...e,...n],[]))}snapshotChanges(t){let e=ug(t);return ag(this.query,e,this.afs.schedulers.outsideAngular).pipe(Jt)}valueChanges(t={}){return Ol(this.query,this.afs.schedulers.outsideAngular).pipe(ee(e=>e.payload.docs.map(n=>t.idField?Hr(Fe({},n.data()),{[t.idField]:n.id}):n.data())),Jt)}get(t){return Jr(this.query.get(t)).pipe(Jt)}add(t){return this.ref.add(t)}doc(t){return new Go(this.ref.doc(t),this.afs)}},Ml=class{query;afs;constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return!t||t.length===0?zo(this.query,this.afs.schedulers.outsideAngular).pipe(Jt):zo(this.query,this.afs.schedulers.outsideAngular).pipe(ee(e=>e.filter(n=>t.indexOf(n.type)>-1)),ba(e=>e.length>0),Jt)}auditTrail(t){return this.stateChanges(t).pipe(cs((e,n)=>[...e,...n],[]))}snapshotChanges(t){let e=ug(t);return ag(this.query,e,this.afs.schedulers.outsideAngular).pipe(Jt)}valueChanges(t={}){return Ol(this.query,this.afs.schedulers.outsideAngular).pipe(ee(n=>n.payload.docs.map(i=>t.idField?Fe({[t.idField]:i.id},i.data()):i.data())),Jt)}get(t){return Jr(this.query.get(t)).pipe(Jt)}},nv=new Xr("angularfire2.enableFirestorePersistence"),rv=new Xr("angularfire2.firestore.persistenceSettings"),iv=new Xr("angularfire2.firestore.settings"),sv=new Xr("angularfire2.firestore.use-emulator");function cg(r,t=e=>e){return{query:t(r),ref:r}}var lg=(()=>{class r{schedulers;firestore;persistenceEnabled$;constructor(e,n,i,s,a,u,l,d,f,p,_,b,N,k,V,j,G){this.schedulers=l;let B=yd(e,u,n),Q=f;p&&Cd(B,u,_,N,k,V,b,j),[this.firestore,this.persistenceEnabled$]=wd(`${B.name}.firestore`,"AngularFirestore",B.name,()=>{let H=u.runOutsideAngular(()=>B.firestore());if(s&&H.settings(s),Q&&H.useEmulator(...Q),i&&!Zh(a)){let K=()=>{try{return Jr(H.enablePersistence(d||void 0).then(()=>!0,()=>!1))}catch(w){return typeof console<"u"&&console.warn(w),Aa(!1)}};return[H,u.runOutsideAngular(K)]}else return[H,Aa(!1)]},[s,Q,i])}collection(e,n){let i;typeof e=="string"?i=this.firestore.collection(e):i=e;let{ref:s,query:a}=cg(i,n),u=this.schedulers.ngZone.run(()=>s);return new Ko(u,a,this)}collectionGroup(e,n){let i=n||(a=>a),s=this.firestore.collectionGroup(e);return new Ml(i(s),this)}doc(e){let n;typeof e=="string"?n=this.firestore.doc(e):n=e;let i=this.schedulers.ngZone.run(()=>n);return new Go(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(n){return new(n||r)(pt(gd),pt(_d,8),pt(nv,8),pt(iv,8),pt(Kh),pt(zh),pt(pd),pt(rv,8),pt(sv,8),pt(Pd,8),pt(Id,8),pt(Td,8),pt(Ed,8),pt(Ad,8),pt(bd,8),pt(Sd,8),pt(md,8))};static \u0275prov=hs({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})();var sn=class r{constructor(t,e){this.localstorageService=t;this.firestore=e;this.userId=this.localstorageService.uid}userId;saveDream(t){return x(this,null,function*(){return(yield this.firestore.collection("Dreams").add(t).catch(n=>{throw new Error(n.message)})).id})}loadDreams(t){return x(this,null,function*(){let e=ei.firestore(),n=ji(e,"Dreams"),i=ae(n,Oo("user.uid","==",t.uid));return(yield Lo(i)).docs.map(u=>Fe({id:u.id},u.data()))})}static \u0275fac=function(e){return new(e||r)(pt(jn),pt(lg))};static \u0275prov=hs({token:r,factory:r.\u0275fac,providedIn:"root"})};var $o=class r{constructor(t,e,n,i){this.dreamsData=t;this.formBuilder=e;this.router=n;this.localStorageService=i;this.initForm()}formGroup;initForm(){this.formGroup=this.formBuilder.group({title:["",Ca.required],content:["",Ca.required],date:[new Date]})}saveDream(){return x(this,null,function*(){if(this.formGroup.invalid)throw Error("Invalid form");let t=Hr(Fe({},this.formGroup.value),{user:this.localStorageService.userLogged});(yield this.dreamsData.saveDream(t))&&(alert("Sucess!"),this.router.navigate(["app"]))})}static \u0275fac=function(e){return new(e||r)(ue(sn),ue(ad),ue(ed),ue(jn))};static \u0275cmp=Ht({type:r,selectors:[["app-dream-edit"]],decls:14,vars:1,consts:[[1,"card",3,"formGroup"],[1,"inputWrapper"],["type","text","formControlName","title"],["formControlName","content",1,"scrollbar"],["id","ButtonsFooter"],[1,"button",3,"click"]],template:function(e,n){e&1&&(X(0,"section",0)(1,"h3"),Ct(2,"New Dream"),nt(),X(3,"div",1)(4,"label"),Ct(5,"Title"),nt(),At(6,"input",2),nt(),X(7,"div",1)(8,"label"),Ct(9,"Content"),nt(),At(10,"textarea",3),nt(),X(11,"div",4)(12,"button",5),ds("click",function(){return n.saveDream()}),Ct(13,"Save"),nt()()()),e&2&&$t("formGroup",n.formGroup)},dependencies:[nd,rd,id,sd,od],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding:24px;height:100%}section[_ngcontent-%COMP%]{max-width:700px;flex:1;max-height:700px;display:flex;flex-direction:column;padding:12px;gap:8px}.inputWrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.inputWrapper[_ngcontent-%COMP%]:has(textarea){flex:1}.inputWrapper[_ngcontent-%COMP%]:has(textarea)   textarea[_ngcontent-%COMP%]{height:100%}#ButtonsFooter[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}#ButtonsFooter[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px}"]})};et();function av(r,t){if(r&1&&(X(0,"div")(1,"h4"),Ct(2),nt()()),r&2){let e=t.$implicit;Gt(2),ms(e.title)}}var Qo=class r{constructor(t,e){this.dreamsDataService=t;this.localStorageService=e;this.loadDreams()}dreams=[];loadDreams(){return x(this,null,function*(){let t=yield this.dreamsDataService.loadDreams({uid:this.localStorageService.uid});this.dreams=t})}static \u0275fac=function(e){return new(e||r)(ue(sn),ue(jn))};static \u0275cmp=Ht({type:r,selectors:[["app-dream-list"]],decls:24,vars:1,consts:[["id","DreamListHeader"],["id","SearchInput"],[1,"bi","bi-search"],["type","input","placeholder","Search"],["for","search"],["id","DreamList"],[4,"ngFor","ngForOf"],["id","DreamCard",1,"card"],["id","Core"],["id","Options"],["id","MoreOptionsBtn"],[1,"bi","bi-three-dots-vertical"],["id","BottomBar"],[1,"iconBtn"],[1,"bi","bi-share-fill"],[1,"bi","bi-pencil-fill"]],template:function(e,n){e&1&&(X(0,"head",0)(1,"div",1),At(2,"i",2),X(3,"div"),At(4,"input",3),X(5,"label",4),Ct(6,"Search"),nt()()()(),X(7,"main",5)(8,"div"),Bn(9,av,3,1,"div",6),nt(),X(10,"div",7)(11,"div",8)(12,"h3"),Ct(13," Title "),nt(),X(14,"p"),Ct(15," Lorem ipsum dolor sit amet, consectetur adipisicing elit. Assumenda aspernatur, numqm fugiat repellat inventore id eligendi asperiores nostrum eaque qui doloribus obcaecati cupiditate dignissimos. Mollitia incidunt eligendi porro atque repellat. "),nt()(),X(16,"div",9)(17,"button",10),At(18,"i",11),nt(),X(19,"div",12)(20,"button",13),At(21,"i",14),nt(),X(22,"button",13),At(23,"i",15),nt()()()()()),e&2&&(Gt(9),$t("ngForOf",n.dreams))},dependencies:[Yh],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;flex-direction:row;flex-wrap:wrap;padding:20px;box-sizing:border-box;align-content:start}#DreamList[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:flex-start}#DreamList[_ngcontent-%COMP%]   #DreamCard[_ngcontent-%COMP%]{flex:2 400px;height:250px;width:350px;display:flex;flex-direction:column;justify-content:flex-end;overflow:hidden}#DreamList[_ngcontent-%COMP%]   #DreamCard[_ngcontent-%COMP%]   #Core[_ngcontent-%COMP%]{background-color:var(--colorBackground1);color:var(--colorText1);height:60%;padding:15px;display:flex;flex-direction:row;flex-wrap:wrap;gap:20px}#DreamList[_ngcontent-%COMP%]   #DreamCard[_ngcontent-%COMP%]   #Core[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:20px}#DreamList[_ngcontent-%COMP%]   #DreamCard[_ngcontent-%COMP%]   #Core[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{height:100px;margin:0;color:var(--colorText2)}#DreamList[_ngcontent-%COMP%]   #DreamCard[_ngcontent-%COMP%]   #Options[_ngcontent-%COMP%]{display:none;flex-direction:row;flex-wrap:wrap;position:absolute;height:100%;width:100%;align-content:end}#DreamList[_ngcontent-%COMP%]   #DreamCard[_ngcontent-%COMP%]   #Options[_ngcontent-%COMP%]   #MoreOptionsBtn[_ngcontent-%COMP%]{position:absolute;right:10px;top:10px}#DreamList[_ngcontent-%COMP%]   #DreamCard[_ngcontent-%COMP%]   #Options[_ngcontent-%COMP%]   #BottomBar[_ngcontent-%COMP%]{padding:10px;gap:10px;display:flex;flex-direction:row;justify-content:end;flex-wrap:wrap;align-content:center;width:100%;height:50px;background:linear-gradient(to bottom,#2222224d,#222)}#DreamList[_ngcontent-%COMP%]   #DreamCard[_ngcontent-%COMP%]   #Options[_ngcontent-%COMP%]   #BottomBar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:35px;height:35px}#DreamList[_ngcontent-%COMP%]   #DreamCard[_ngcontent-%COMP%]:hover{cursor:pointer;border:solid 2px var(--colorTheme2)}#DreamList[_ngcontent-%COMP%]   #DreamCard[_ngcontent-%COMP%]:hover   #Options[_ngcontent-%COMP%]{display:flex}#DreamListHeader[_ngcontent-%COMP%]{flex:100%;display:flex;flex-direction:row;justify-content:start;padding:5px;width:100%;height:60px}#DreamListHeader[_ngcontent-%COMP%]   #SearchInput[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-content:end;flex-wrap:wrap}#DreamListHeader[_ngcontent-%COMP%]   #SearchInput[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{align-self:end;height:20px;font-size:20px;color:var(--colorTheme1)}#DreamListHeader[_ngcontent-%COMP%]   #SearchInput[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:20px 0 0;position:relative}#DreamListHeader[_ngcontent-%COMP%]   #SearchInput[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{font-family:inherit;font-weight:600;width:100%;border:none;border-bottom:2px solid #9b9b9b;outline:0;font-size:17px;color:#fff;padding:7px 0;background:transparent;transition:border-color .2s}#DreamListHeader[_ngcontent-%COMP%]   #SearchInput[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:transparent}#DreamListHeader[_ngcontent-%COMP%]   #SearchInput[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:placeholder-shown ~ label[_ngcontent-%COMP%]{font-size:17px;cursor:text;top:20px}#DreamListHeader[_ngcontent-%COMP%]   #SearchInput[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{padding-bottom:6px;border-width:3px;border-image:var(--colorTheme2);border-image-slice:1}#DreamListHeader[_ngcontent-%COMP%]   #SearchInput[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus ~ label[_ngcontent-%COMP%]{position:absolute;margin-top:8px;top:0;display:block;transition:.2s;font-size:18px;color:var(--colorTheme1)}#DreamListHeader[_ngcontent-%COMP%]   #SearchInput[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{position:absolute;top:0;margin-top:8px;display:block;transition:.2s;font-size:17px;color:var(--colorTheme1);pointer-events:none}"]})};et();et();var uv=["*"],cv=()=>["","app"],lv=()=>[""];function hv(r,t){if(r&1){let e=Qh();X(0,"button",6),ds("click",function(){jh(e);let i=fs();return Gh(i.logout())}),At(1,"i",7),X(2,"span"),Ct(3,"Logout"),nt()()}}var Wo=class r{constructor(t){this.firebaseAuth=t;localStorage.getItem("user")&&(this.flgUserWithLogin=!0)}flgUserWithLogin=!1;logout(){this.firebaseAuth.logout()}static \u0275fac=function(e){return new(e||r)(ue(Rd))};static \u0275cmp=Ht({type:r,selectors:[["app-topbar"]],ngContentSelectors:uv,decls:7,vars:4,consts:[["id","Logo"],[3,"routerLink"],["src","/svg/logo.svg"],["id","Buttons"],[1,"navBtn"],[3,"click",4,"ngIf"],[3,"click"],[1,"bi","bi-door-closed"]],template:function(e,n){e&1&&(Wh(),X(0,"div",0)(1,"a",1),At(2,"img",2),nt()(),X(3,"div",3),Hh(4),nt(),X(5,"nav",4),Bn(6,hv,4,0,"button",5),nt()),e&2&&(Gt(),$t("routerLink",n.flgUserWithLogin?Un(2,cv):Un(3,lv)),Gt(5),$t("ngIf",n.flgUserWithLogin))},dependencies:[ps,gs],styles:["[_nghost-%COMP%]{background-color:var(--colorBackground1);display:flex;justify-content:space-between;align-items:center;height:auto;color:var(--colorText2)}#Logo[_ngcontent-%COMP%]{height:min-content;padding:4px;opacity:.4;cursor:pointer;transition:opacity var(--timeHoverAnimation)}#Logo[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}#Logo[_ngcontent-%COMP%]:hover{opacity:1}#Logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:30px;object-fit:scale-down}.navBtn[_ngcontent-%COMP%]{cursor:pointer;padding:10px;transition:color var(--timeHoverAnimation),background-color var(--timeHoverAnimation)}.navBtn[_ngcontent-%COMP%]:hover{background-color:var(--colorBackground2);color:var(--colorText1)}.navBtn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;gap:4px}#Buttons[_ngcontent-%COMP%]{display:flex;flex:1}"]})};et();function fv(r,t){if(r&1&&At(0,"i"),r&2){let e=fs();$h("bi ",e.icon,"")}}var Ho=class r{title;link;icon;static \u0275fac=function(e){return new(e||r)};static \u0275cmp=Ht({type:r,selectors:[["app-topbar-button"]],inputs:{title:"title",link:"link",icon:"icon"},decls:4,vars:3,consts:[[1,"navBtn",3,"routerLink"],[3,"class",4,"ngIf"]],template:function(e,n){e&1&&(X(0,"a",0),Bn(1,fv,1,3,"i",1),X(2,"span"),Ct(3),nt()()),e&2&&($t("routerLink",n.link),Gt(),$t("ngIf",n.icon),Gt(2),ms(n.title))},dependencies:[ps,gs],styles:[".navBtn[_ngcontent-%COMP%]{cursor:pointer;text-decoration:none;padding:10px;transition:color var(--timeHoverAnimation),background-color var(--timeHoverAnimation)}.navBtn[_ngcontent-%COMP%]:hover{background-color:var(--colorBackground2);color:var(--colorText1)}.navBtn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;gap:4px}"]})};var pv=()=>["list"],gv=()=>["edit"],Jo=class r{static \u0275fac=function(e){return new(e||r)};static \u0275cmp=Ht({type:r,selectors:[["app-core"]],decls:7,vars:4,consts:[["title","My Dreams","icon","",3,"link"],["title","New Dream","icon","",3,"link"],["id","ContentWrapper"]],template:function(e,n){e&1&&(X(0,"header")(1,"app-topbar"),At(2,"app-topbar-button",0)(3,"app-topbar-button",1),nt()(),X(4,"div",2)(5,"main"),At(6,"router-outlet"),nt()()),e&2&&(Gt(2),$t("link",Un(2,pv)),Gt(),$t("link",Un(3,gv)))},dependencies:[td,Wo,Ho],styles:["[_nghost-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column;background-color:var(--colorBackground1);-webkit-backdrop-filter:blur 12px;backdrop-filter:blur 12px;background-image:var(--imgBgCore);background-size:cover}[_nghost-%COMP%]   header[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   #ContentWrapper[_ngcontent-%COMP%]{height:100%;display:flex;position:relative;overflow:hidden}[_nghost-%COMP%]   #ContentWrapper[_ngcontent-%COMP%]   aside[_ngcontent-%COMP%]{position:absolute;width:40px;left:0;height:100%}[_nghost-%COMP%]   #ContentWrapper[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{margin-left:40px;width:100%;height:100%}"]})};var _v=[{path:"",component:Jo,children:[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:Qo},{path:"view",component:ys},{path:"edit",component:$o}]}],Yo=class r{static \u0275fac=function(e){return new(e||r)};static \u0275mod=Zr({type:r});static \u0275inj=Yr({imports:[Sa.forChild(_v),Sa]})};var mg=class r{static \u0275fac=function(e){return new(e||r)};static \u0275mod=Zr({type:r});static \u0275inj=Yr({providers:[sn],imports:[Xh,Yo,Dd,vd.initializeApp(xd.firebaseConfig,{})]})};export{mg as CoreModule};
