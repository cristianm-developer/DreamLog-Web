import{a as Ed}from"./chunk-OX7BTZDV.js";import{A as Bn,C as Ad,a as Hh,b as Ta,c as Jh,d as Yh,f as Xh,g as Zh,h as td,j as ad,k as ud,l as Qt,m as cd,n as ld,o as hd,p as dd,q as fd,r as md,s as gd,t as pd,u as _d,v as yd,w as vd,x as wd,y as Id,z as Td}from"./chunk-6KQRCHWF.js";import{c as ed,d as Xr,e as Ea,f as nd,g as rd,i as Aa,j as ft,k as hs,l as ue,m as id,n as sd,o as od,q as ba,r as Zr}from"./chunk-LLRW3BDI.js";import{$ as qh,A as gt,Aa as Wh,Ca as Ia,D as oe,E as Yr,L as Oh,N as Fh,O as Zt,P as Oe,T as cs,U as ae,W as Lh,X as rt,Y as st,Z as Nt,a as Nh,aa as Bh,c as kh,da as kt,ea as ls,fa as Uh,g as Wr,h as ya,ha as wa,i as Xt,l as va,m as Mh,o as ss,p as os,pa as jh,qa as Gh,r as as,ra as zh,sa as Kh,x as us,y as Hr,ya as $h,z as Jr,za as Qh}from"./chunk-GJEAREQK.js";import{a as Me,b as Qr,g as _a,h as R,i as tt}from"./chunk-KXCUNDCU.js";tt();tt();tt();var ds=class r{texto=`Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus lacinia eros a enim feugiat, vel euismod dolor dignissim. Integer tincidunt ligula a sem facilisis, ut egestas ligula tincidunt.  Fusce id lectus sit amet felis malesuada convallis. Curabitur sit amet nisl augue, nec fringilla velit. Nam et leo vel sem scelerisque egestas non in sapien.
Sed dapibus venenatis velit, et feugiat sem mollis et. 
Mauris ut tortor vel magna lobortis feugiat. Donec interdum, lorem a feugiat feugiat, libero urna pretium dui, ut volutpat turpis mi ut eros. 
Fusce auctor urna nec nibh varius, id vulputate sapien rhoncus. Proin vestibulum magna vel nibh ultricies sollicitudin.

Mauris dapibus ex et lacus fermentum ultricies. Cras tincidunt metus felis, nec gravida velit consequat in. 
Integer pharetra urna ac lectus vehicula viverra. Donec vehicula libero a lorem tincidunt, et rhoncus turpis gravida. 
Quisque volutpat, mi sit amet pharetra fermentum, tortor felis laoreet dui, vel malesuada lorem turpis vel justo.

Lorem ipsum dolor sit amet, consectetur adipiscing elit. 
Vivamus lacinia eros a enim feugiat, vel euismod dolor dignissim. Integer tincidunt ligula a sem facilisis, ut egestas ligula tincidunt. 
Fusce id lectus sit amet felis malesuada convallis. Curabitur sit amet nisl augue, nec fringilla velit. Nam et leo vel sem scelerisque egestas non in sapien.

Sed dapibus venenatis velit, et feugiat sem mollis et. 
Mauris ut tortor vel magna lobortis feugiat. Donec interdum, lorem a feugiat feugiat, libero urna pretium dui, ut volutpat turpis mi ut eros. 
Fusce auctor urna nec nibh varius, id vulputate sapien rhoncus. Proin vestibulum magna vel nibh ultricies sollicitudin.

Mauris dapibus ex et lacus fermentum ultricies. Cras tincidunt metus felis, nec gravida velit consequat in. 
Integer pharetra urna ac lectus vehicula viverra. Donec vehicula libero a lorem tincidunt, et rhoncus turpis gravida. 
Quisque volutpat, mi sit amet pharetra fermentum, tortor felis laoreet dui, vel malesuada lorem turpis vel justo.
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus lacinia eros a enim feugiat, vel euismod dolor dignissim. Integer tincidunt ligula a sem facilisis, ut egestas ligula tincidunt.  Fusce id lectus sit amet felis malesuada convallis. Curabitur sit amet nisl augue, nec fringilla velit. Nam et leo vel sem scelerisque egestas non in sapien.
Sed dapibus venenatis velit, et feugiat sem mollis et. 
Mauris ut tortor vel magna lobortis feugiat. Donec interdum, lorem a feugiat feugiat, libero urna pretium dui, ut volutpat turpis mi ut eros. 
Fusce auctor urna nec nibh varius, id vulputate sapien rhoncus. Proin vestibulum magna vel nibh ultricies sollicitudin.

Mauris dapibus ex et lacus fermentum ultricies. Cras tincidunt metus felis, nec gravida velit consequat in. 
Integer pharetra urna ac lectus vehicula viverra. Donec vehicula libero a lorem tincidunt, et rhoncus turpis gravida. 
Quisque volutpat, mi sit amet pharetra fermentum, tortor felis laoreet dui, vel malesuada lorem turpis vel justo.

Lorem ipsum dolor sit amet, consectetur adipiscing elit. 
Vivamus lacinia eros a enim feugiat, vel euismod dolor dignissim. Integer tincidunt ligula a sem facilisis, ut egestas ligula tincidunt. 
Fusce id lectus sit amet felis malesuada convallis. Curabitur sit amet nisl augue, nec fringilla velit. Nam et leo vel sem scelerisque egestas non in sapien.

Sed dapibus venenatis velit, et feugiat sem mollis et. 
Mauris ut tortor vel magna lobortis feugiat. Donec interdum, lorem a feugiat feugiat, libero urna pretium dui, ut volutpat turpis mi ut eros. 
Fusce auctor urna nec nibh varius, id vulputate sapien rhoncus. Proin vestibulum magna vel nibh ultricies sollicitudin.

Mauris dapibus ex et lacus fermentum ultricies. Cras tincidunt metus felis, nec gravida velit consequat in. 
Integer pharetra urna ac lectus vehicula viverra. Donec vehicula libero a lorem tincidunt, et rhoncus turpis gravida. 
Quisque volutpat, mi sit amet pharetra fermentum, tortor felis laoreet dui, vel malesuada lorem turpis vel justo.`;static \u0275fac=function(e){return new(e||r)};static \u0275cmp=oe({type:r,selectors:[["app-dream-view"]],decls:15,vars:1,consts:[["id","DreamCard",1,"card"],["id","DreamCore"],["id","Title"],[1,"scrollbar"],["id","DreamText"],["id","DreamSidebar"],["id","DataInfo"],[1,"iconBtn","editBtn"],[1,"bi","bi-pencil-fill"]],template:function(e,n){e&1&&(rt(0,"section",0)(1,"div",1)(2,"header")(3,"div",2)(4,"h3"),kt(5," Dream\xB4sTitle "),st()()(),rt(6,"main",3)(7,"p",4),kt(8),st()()(),rt(9,"div",5)(10,"aside")(11,"div",6),kt(12," dd/mm/yyyy hh/mm "),st(),rt(13,"button",7),Nt(14,"i",8),st()()()()),e&2&&(Zt(8),Uh(" ",n.texto," "))},styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;padding:20px;box-sizing:border-box}#DreamCard[_ngcontent-%COMP%]{display:flex;padding:20px;align-content:flex-start;max-height:100%;width:100%}#DreamCard[_ngcontent-%COMP%]   #DreamCore[_ngcontent-%COMP%]{flex:1;gap:20px;display:flex;flex-direction:column;overflow:hidden}#DreamCard[_ngcontent-%COMP%]   #DreamCore[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;align-content:center}#DreamCard[_ngcontent-%COMP%]   #DreamCore[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   #Title[_ngcontent-%COMP%]{flex:1;flex:1 250px}#DreamCard[_ngcontent-%COMP%]   #DreamCore[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   #Title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0}#DreamCard[_ngcontent-%COMP%]   #DreamCore[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{padding:5px;flex:1;display:flex;height:100%;overflow-y:auto;scrollbar-gutter:stable}#DreamCard[_ngcontent-%COMP%]   #DreamCore[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]   #DreamText[_ngcontent-%COMP%]{width:100%;max-width:600px;margin:0;white-space:pre;text-wrap:wrap;font-family:sans-serif}#DreamCard[_ngcontent-%COMP%]   #DreamSidebar[_ngcontent-%COMP%]{flex:0 200px}#DreamCard[_ngcontent-%COMP%]   #DreamSidebar[_ngcontent-%COMP%]   #DataInfo[_ngcontent-%COMP%]{text-align:end;color:var(--colorText2)}#DreamCard[_ngcontent-%COMP%]   .editBtn[_ngcontent-%COMP%]{position:fixed;bottom:40px;right:40px;z-index:2}"]})};tt();tt();tt();tt();tt();var bd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Sd={};var Le,Sa;(function(){var r;function t(w,p){function v(){}v.prototype=p.prototype,w.D=p.prototype,w.prototype=new v,w.prototype.constructor=w,w.C=function(I,T,A){for(var y=Array(arguments.length-2),ve=2;ve<arguments.length;ve++)y[ve-2]=arguments[ve];return p.prototype[T].apply(I,y)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(n,e),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(w,p,v){v||(v=0);var I=Array(16);if(typeof p=="string")for(var T=0;16>T;++T)I[T]=p.charCodeAt(v++)|p.charCodeAt(v++)<<8|p.charCodeAt(v++)<<16|p.charCodeAt(v++)<<24;else for(T=0;16>T;++T)I[T]=p[v++]|p[v++]<<8|p[v++]<<16|p[v++]<<24;p=w.g[0],v=w.g[1],T=w.g[2];var A=w.g[3],y=p+(A^v&(T^A))+I[0]+3614090360&4294967295;p=v+(y<<7&4294967295|y>>>25),y=A+(T^p&(v^T))+I[1]+3905402710&4294967295,A=p+(y<<12&4294967295|y>>>20),y=T+(v^A&(p^v))+I[2]+606105819&4294967295,T=A+(y<<17&4294967295|y>>>15),y=v+(p^T&(A^p))+I[3]+3250441966&4294967295,v=T+(y<<22&4294967295|y>>>10),y=p+(A^v&(T^A))+I[4]+4118548399&4294967295,p=v+(y<<7&4294967295|y>>>25),y=A+(T^p&(v^T))+I[5]+1200080426&4294967295,A=p+(y<<12&4294967295|y>>>20),y=T+(v^A&(p^v))+I[6]+2821735955&4294967295,T=A+(y<<17&4294967295|y>>>15),y=v+(p^T&(A^p))+I[7]+4249261313&4294967295,v=T+(y<<22&4294967295|y>>>10),y=p+(A^v&(T^A))+I[8]+1770035416&4294967295,p=v+(y<<7&4294967295|y>>>25),y=A+(T^p&(v^T))+I[9]+2336552879&4294967295,A=p+(y<<12&4294967295|y>>>20),y=T+(v^A&(p^v))+I[10]+4294925233&4294967295,T=A+(y<<17&4294967295|y>>>15),y=v+(p^T&(A^p))+I[11]+2304563134&4294967295,v=T+(y<<22&4294967295|y>>>10),y=p+(A^v&(T^A))+I[12]+1804603682&4294967295,p=v+(y<<7&4294967295|y>>>25),y=A+(T^p&(v^T))+I[13]+4254626195&4294967295,A=p+(y<<12&4294967295|y>>>20),y=T+(v^A&(p^v))+I[14]+2792965006&4294967295,T=A+(y<<17&4294967295|y>>>15),y=v+(p^T&(A^p))+I[15]+1236535329&4294967295,v=T+(y<<22&4294967295|y>>>10),y=p+(T^A&(v^T))+I[1]+4129170786&4294967295,p=v+(y<<5&4294967295|y>>>27),y=A+(v^T&(p^v))+I[6]+3225465664&4294967295,A=p+(y<<9&4294967295|y>>>23),y=T+(p^v&(A^p))+I[11]+643717713&4294967295,T=A+(y<<14&4294967295|y>>>18),y=v+(A^p&(T^A))+I[0]+3921069994&4294967295,v=T+(y<<20&4294967295|y>>>12),y=p+(T^A&(v^T))+I[5]+3593408605&4294967295,p=v+(y<<5&4294967295|y>>>27),y=A+(v^T&(p^v))+I[10]+38016083&4294967295,A=p+(y<<9&4294967295|y>>>23),y=T+(p^v&(A^p))+I[15]+3634488961&4294967295,T=A+(y<<14&4294967295|y>>>18),y=v+(A^p&(T^A))+I[4]+3889429448&4294967295,v=T+(y<<20&4294967295|y>>>12),y=p+(T^A&(v^T))+I[9]+568446438&4294967295,p=v+(y<<5&4294967295|y>>>27),y=A+(v^T&(p^v))+I[14]+3275163606&4294967295,A=p+(y<<9&4294967295|y>>>23),y=T+(p^v&(A^p))+I[3]+4107603335&4294967295,T=A+(y<<14&4294967295|y>>>18),y=v+(A^p&(T^A))+I[8]+1163531501&4294967295,v=T+(y<<20&4294967295|y>>>12),y=p+(T^A&(v^T))+I[13]+2850285829&4294967295,p=v+(y<<5&4294967295|y>>>27),y=A+(v^T&(p^v))+I[2]+4243563512&4294967295,A=p+(y<<9&4294967295|y>>>23),y=T+(p^v&(A^p))+I[7]+1735328473&4294967295,T=A+(y<<14&4294967295|y>>>18),y=v+(A^p&(T^A))+I[12]+2368359562&4294967295,v=T+(y<<20&4294967295|y>>>12),y=p+(v^T^A)+I[5]+4294588738&4294967295,p=v+(y<<4&4294967295|y>>>28),y=A+(p^v^T)+I[8]+2272392833&4294967295,A=p+(y<<11&4294967295|y>>>21),y=T+(A^p^v)+I[11]+1839030562&4294967295,T=A+(y<<16&4294967295|y>>>16),y=v+(T^A^p)+I[14]+4259657740&4294967295,v=T+(y<<23&4294967295|y>>>9),y=p+(v^T^A)+I[1]+2763975236&4294967295,p=v+(y<<4&4294967295|y>>>28),y=A+(p^v^T)+I[4]+1272893353&4294967295,A=p+(y<<11&4294967295|y>>>21),y=T+(A^p^v)+I[7]+4139469664&4294967295,T=A+(y<<16&4294967295|y>>>16),y=v+(T^A^p)+I[10]+3200236656&4294967295,v=T+(y<<23&4294967295|y>>>9),y=p+(v^T^A)+I[13]+681279174&4294967295,p=v+(y<<4&4294967295|y>>>28),y=A+(p^v^T)+I[0]+3936430074&4294967295,A=p+(y<<11&4294967295|y>>>21),y=T+(A^p^v)+I[3]+3572445317&4294967295,T=A+(y<<16&4294967295|y>>>16),y=v+(T^A^p)+I[6]+76029189&4294967295,v=T+(y<<23&4294967295|y>>>9),y=p+(v^T^A)+I[9]+3654602809&4294967295,p=v+(y<<4&4294967295|y>>>28),y=A+(p^v^T)+I[12]+3873151461&4294967295,A=p+(y<<11&4294967295|y>>>21),y=T+(A^p^v)+I[15]+530742520&4294967295,T=A+(y<<16&4294967295|y>>>16),y=v+(T^A^p)+I[2]+3299628645&4294967295,v=T+(y<<23&4294967295|y>>>9),y=p+(T^(v|~A))+I[0]+4096336452&4294967295,p=v+(y<<6&4294967295|y>>>26),y=A+(v^(p|~T))+I[7]+1126891415&4294967295,A=p+(y<<10&4294967295|y>>>22),y=T+(p^(A|~v))+I[14]+2878612391&4294967295,T=A+(y<<15&4294967295|y>>>17),y=v+(A^(T|~p))+I[5]+4237533241&4294967295,v=T+(y<<21&4294967295|y>>>11),y=p+(T^(v|~A))+I[12]+1700485571&4294967295,p=v+(y<<6&4294967295|y>>>26),y=A+(v^(p|~T))+I[3]+2399980690&4294967295,A=p+(y<<10&4294967295|y>>>22),y=T+(p^(A|~v))+I[10]+4293915773&4294967295,T=A+(y<<15&4294967295|y>>>17),y=v+(A^(T|~p))+I[1]+2240044497&4294967295,v=T+(y<<21&4294967295|y>>>11),y=p+(T^(v|~A))+I[8]+1873313359&4294967295,p=v+(y<<6&4294967295|y>>>26),y=A+(v^(p|~T))+I[15]+4264355552&4294967295,A=p+(y<<10&4294967295|y>>>22),y=T+(p^(A|~v))+I[6]+2734768916&4294967295,T=A+(y<<15&4294967295|y>>>17),y=v+(A^(T|~p))+I[13]+1309151649&4294967295,v=T+(y<<21&4294967295|y>>>11),y=p+(T^(v|~A))+I[4]+4149444226&4294967295,p=v+(y<<6&4294967295|y>>>26),y=A+(v^(p|~T))+I[11]+3174756917&4294967295,A=p+(y<<10&4294967295|y>>>22),y=T+(p^(A|~v))+I[2]+718787259&4294967295,T=A+(y<<15&4294967295|y>>>17),y=v+(A^(T|~p))+I[9]+3951481745&4294967295,w.g[0]=w.g[0]+p&4294967295,w.g[1]=w.g[1]+(T+(y<<21&4294967295|y>>>11))&4294967295,w.g[2]=w.g[2]+T&4294967295,w.g[3]=w.g[3]+A&4294967295}n.prototype.u=function(w,p){p===void 0&&(p=w.length);for(var v=p-this.blockSize,I=this.B,T=this.h,A=0;A<p;){if(T==0)for(;A<=v;)i(this,w,A),A+=this.blockSize;if(typeof w=="string"){for(;A<p;)if(I[T++]=w.charCodeAt(A++),T==this.blockSize){i(this,I),T=0;break}}else for(;A<p;)if(I[T++]=w[A++],T==this.blockSize){i(this,I),T=0;break}}this.h=T,this.o+=p},n.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var p=1;p<w.length-8;++p)w[p]=0;var v=8*this.o;for(p=w.length-8;p<w.length;++p)w[p]=v&255,v/=256;for(this.u(w),w=Array(16),p=v=0;4>p;++p)for(var I=0;32>I;I+=8)w[v++]=this.g[p]>>>I&255;return w};function s(w,p){var v=u;return Object.prototype.hasOwnProperty.call(v,w)?v[w]:v[w]=p(w)}function a(w,p){this.h=p;for(var v=[],I=!0,T=w.length-1;0<=T;T--){var A=w[T]|0;I&&A==p||(v[T]=A,I=!1)}this.g=v}var u={};function l(w){return-128<=w&&128>w?s(w,function(p){return new a([p|0],0>p?-1:0)}):new a([w|0],0>w?-1:0)}function d(w){if(isNaN(w)||!isFinite(w))return g;if(0>w)return V(d(-w));for(var p=[],v=1,I=0;w>=v;I++)p[I]=w/v|0,v*=4294967296;return new a(p,0)}function f(w,p){if(w.length==0)throw Error("number format error: empty string");if(p=p||10,2>p||36<p)throw Error("radix out of range: "+p);if(w.charAt(0)=="-")return V(f(w.substring(1),p));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var v=d(Math.pow(p,8)),I=g,T=0;T<w.length;T+=8){var A=Math.min(8,w.length-T),y=parseInt(w.substring(T,T+A),p);8>A?(A=d(Math.pow(p,A)),I=I.j(A).add(d(y))):(I=I.j(v),I=I.add(d(y)))}return I}var g=l(0),_=l(1),b=l(16777216);r=a.prototype,r.m=function(){if(k(this))return-V(this).m();for(var w=0,p=1,v=0;v<this.g.length;v++){var I=this.i(v);w+=(0<=I?I:4294967296+I)*p,p*=4294967296}return w},r.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(N(this))return"0";if(k(this))return"-"+V(this).toString(w);for(var p=d(Math.pow(w,6)),v=this,I="";;){var T=Q(v,p).g;v=j(v,T.j(p));var A=((0<v.g.length?v.g[0]:v.h)>>>0).toString(w);if(v=T,N(v))return A+I;for(;6>A.length;)A="0"+A;I=A+I}},r.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function N(w){if(w.h!=0)return!1;for(var p=0;p<w.g.length;p++)if(w.g[p]!=0)return!1;return!0}function k(w){return w.h==-1}r.l=function(w){return w=j(this,w),k(w)?-1:N(w)?0:1};function V(w){for(var p=w.g.length,v=[],I=0;I<p;I++)v[I]=~w.g[I];return new a(v,~w.h).add(_)}r.abs=function(){return k(this)?V(this):this},r.add=function(w){for(var p=Math.max(this.g.length,w.g.length),v=[],I=0,T=0;T<=p;T++){var A=I+(this.i(T)&65535)+(w.i(T)&65535),y=(A>>>16)+(this.i(T)>>>16)+(w.i(T)>>>16);I=y>>>16,A&=65535,y&=65535,v[T]=y<<16|A}return new a(v,v[v.length-1]&-2147483648?-1:0)};function j(w,p){return w.add(V(p))}r.j=function(w){if(N(this)||N(w))return g;if(k(this))return k(w)?V(this).j(V(w)):V(V(this).j(w));if(k(w))return V(this.j(V(w)));if(0>this.l(b)&&0>w.l(b))return d(this.m()*w.m());for(var p=this.g.length+w.g.length,v=[],I=0;I<2*p;I++)v[I]=0;for(I=0;I<this.g.length;I++)for(var T=0;T<w.g.length;T++){var A=this.i(I)>>>16,y=this.i(I)&65535,ve=w.i(T)>>>16,Cr=w.i(T)&65535;v[2*I+2*T]+=y*Cr,G(v,2*I+2*T),v[2*I+2*T+1]+=A*Cr,G(v,2*I+2*T+1),v[2*I+2*T+1]+=y*ve,G(v,2*I+2*T+1),v[2*I+2*T+2]+=A*ve,G(v,2*I+2*T+2)}for(I=0;I<p;I++)v[I]=v[2*I+1]<<16|v[2*I];for(I=p;I<2*p;I++)v[I]=0;return new a(v,0)};function G(w,p){for(;(w[p]&65535)!=w[p];)w[p+1]+=w[p]>>>16,w[p]&=65535,p++}function B(w,p){this.g=w,this.h=p}function Q(w,p){if(N(p))throw Error("division by zero");if(N(w))return new B(g,g);if(k(w))return p=Q(V(w),p),new B(V(p.g),V(p.h));if(k(p))return p=Q(w,V(p)),new B(V(p.g),p.h);if(30<w.g.length){if(k(w)||k(p))throw Error("slowDivide_ only works with positive integers.");for(var v=_,I=p;0>=I.l(w);)v=H(v),I=H(I);var T=K(v,1),A=K(I,1);for(I=K(I,2),v=K(v,2);!N(I);){var y=A.add(I);0>=y.l(w)&&(T=T.add(v),A=y),I=K(I,1),v=K(v,1)}return p=j(w,T.j(p)),new B(T,p)}for(T=g;0<=w.l(p);){for(v=Math.max(1,Math.floor(w.m()/p.m())),I=Math.ceil(Math.log(v)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),A=d(v),y=A.j(p);k(y)||0<y.l(w);)v-=I,A=d(v),y=A.j(p);N(A)&&(A=_),T=T.add(A),w=j(w,y)}return new B(T,w)}r.A=function(w){return Q(this,w).h},r.and=function(w){for(var p=Math.max(this.g.length,w.g.length),v=[],I=0;I<p;I++)v[I]=this.i(I)&w.i(I);return new a(v,this.h&w.h)},r.or=function(w){for(var p=Math.max(this.g.length,w.g.length),v=[],I=0;I<p;I++)v[I]=this.i(I)|w.i(I);return new a(v,this.h|w.h)},r.xor=function(w){for(var p=Math.max(this.g.length,w.g.length),v=[],I=0;I<p;I++)v[I]=this.i(I)^w.i(I);return new a(v,this.h^w.h)};function H(w){for(var p=w.g.length+1,v=[],I=0;I<p;I++)v[I]=w.i(I)<<1|w.i(I-1)>>>31;return new a(v,w.h)}function K(w,p){var v=p>>5;p%=32;for(var I=w.g.length-v,T=[],A=0;A<I;A++)T[A]=0<p?w.i(A+v)>>>p|w.i(A+v+1)<<32-p:w.i(A+v);return new a(T,w.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Sa=Sd.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,Le=Sd.Integer=a}).apply(typeof bd<"u"?bd:typeof self<"u"?self:typeof window<"u"?window:{});tt();var ms=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Te={};var Pa,jp,Un,Ca,ti,gs,Ra,xa,Da;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,c,h){return o==Array.prototype||o==Object.prototype||(o[c]=h.value),o};function e(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof ms=="object"&&ms];for(var c=0;c<o.length;++c){var h=o[c];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=e(this);function i(o,c){if(c)t:{var h=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var E=o[m];if(!(E in h))break t;h=h[E]}o=o[o.length-1],m=h[o],c=c(m),c!=m&&c!=null&&t(h,o,{configurable:!0,writable:!0,value:c})}}function s(o,c){o instanceof String&&(o+="");var h=0,m=!1,E={next:function(){if(!m&&h<o.length){var P=h++;return{value:c(P,o[P]),done:!1}}return m=!0,{done:!0,value:void 0}}};return E[Symbol.iterator]=function(){return E},E}i("Array.prototype.values",function(o){return o||function(){return s(this,function(c,h){return h})}});var a=a||{},u=this||self;function l(o){var c=typeof o;return c=c!="object"?c:o?Array.isArray(o)?"array":c:"null",c=="array"||c=="object"&&typeof o.length=="number"}function d(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function f(o,c,h){return o.call.apply(o.bind,arguments)}function g(o,c,h){if(!o)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var E=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(E,m),o.apply(c,E)}}return function(){return o.apply(c,arguments)}}function _(o,c,h){return _=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:g,_.apply(null,arguments)}function b(o,c){var h=Array.prototype.slice.call(arguments,1);return function(){var m=h.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function N(o,c){function h(){}h.prototype=c.prototype,o.aa=c.prototype,o.prototype=new h,o.prototype.constructor=o,o.Qb=function(m,E,P){for(var M=Array(arguments.length-2),nt=2;nt<arguments.length;nt++)M[nt-2]=arguments[nt];return c.prototype[E].apply(m,M)}}function k(o){let c=o.length;if(0<c){let h=Array(c);for(let m=0;m<c;m++)h[m]=o[m];return h}return[]}function V(o,c){for(let h=1;h<arguments.length;h++){let m=arguments[h];if(l(m)){let E=o.length||0,P=m.length||0;o.length=E+P;for(let M=0;M<P;M++)o[E+M]=m[M]}else o.push(m)}}class j{constructor(c,h){this.i=c,this.j=h,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function G(o){return/^[\s\xa0]*$/.test(o)}function B(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function Q(o){return Q[" "](o),o}Q[" "]=function(){};var H=B().indexOf("Gecko")!=-1&&!(B().toLowerCase().indexOf("webkit")!=-1&&B().indexOf("Edge")==-1)&&!(B().indexOf("Trident")!=-1||B().indexOf("MSIE")!=-1)&&B().indexOf("Edge")==-1;function K(o,c,h){for(let m in o)c.call(h,o[m],m,o)}function w(o,c){for(let h in o)c.call(void 0,o[h],h,o)}function p(o){let c={};for(let h in o)c[h]=o[h];return c}let v="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(o,c){let h,m;for(let E=1;E<arguments.length;E++){m=arguments[E];for(h in m)o[h]=m[h];for(let P=0;P<v.length;P++)h=v[P],Object.prototype.hasOwnProperty.call(m,h)&&(o[h]=m[h])}}function T(o){var c=1;o=o.split(":");let h=[];for(;0<c&&o.length;)h.push(o.shift()),c--;return o.length&&h.push(o.join(":")),h}function A(o){u.setTimeout(()=>{throw o},0)}function y(){var o=$o;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class ve{constructor(){this.h=this.g=null}add(c,h){let m=Cr.get();m.set(c,h),this.h?this.h.next=m:this.g=m,this.h=m}}var Cr=new j(()=>new up,o=>o.reset());class up{constructor(){this.next=this.g=this.h=null}set(c,h){this.h=c,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let Rr,xr=!1,$o=new ve,Vl=()=>{let o=u.Promise.resolve(void 0);Rr=()=>{o.then(cp)}};var cp=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(h){A(h)}var c=Cr;c.j(o),100>c.h&&(c.h++,o.next=c.g,c.g=o)}xr=!1};function De(){this.s=this.s,this.C=this.C}De.prototype.s=!1,De.prototype.ma=function(){this.s||(this.s=!0,this.N())},De.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Rt(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}Rt.prototype.h=function(){this.defaultPrevented=!0};var lp=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let h=()=>{};u.addEventListener("test",h,c),u.removeEventListener("test",h,c)}catch{}return o}();function Dr(o,c){if(Rt.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var h=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget){if(H){t:{try{Q(c.nodeName);var E=!0;break t}catch{}E=!1}E||(c=null)}}else h=="mouseover"?c=o.fromElement:h=="mouseout"&&(c=o.toElement);this.relatedTarget=c,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:hp[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&Dr.aa.h.call(this)}}N(Dr,Rt);var hp={2:"touch",3:"pen",4:"mouse"};Dr.prototype.h=function(){Dr.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Vr="closure_listenable_"+(1e6*Math.random()|0),dp=0;function fp(o,c,h,m,E){this.listener=o,this.proxy=null,this.src=c,this.type=h,this.capture=!!m,this.ha=E,this.key=++dp,this.da=this.fa=!1}function ji(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Gi(o){this.src=o,this.g={},this.h=0}Gi.prototype.add=function(o,c,h,m,E){var P=o.toString();o=this.g[P],o||(o=this.g[P]=[],this.h++);var M=Wo(o,c,m,E);return-1<M?(c=o[M],h||(c.fa=!1)):(c=new fp(c,this.src,P,!!m,E),c.fa=h,o.push(c)),c};function Qo(o,c){var h=c.type;if(h in o.g){var m=o.g[h],E=Array.prototype.indexOf.call(m,c,void 0),P;(P=0<=E)&&Array.prototype.splice.call(m,E,1),P&&(ji(c),o.g[h].length==0&&(delete o.g[h],o.h--))}}function Wo(o,c,h,m){for(var E=0;E<o.length;++E){var P=o[E];if(!P.da&&P.listener==c&&P.capture==!!h&&P.ha==m)return E}return-1}var Ho="closure_lm_"+(1e6*Math.random()|0),Jo={};function Nl(o,c,h,m,E){if(m&&m.once)return Ml(o,c,h,m,E);if(Array.isArray(c)){for(var P=0;P<c.length;P++)Nl(o,c[P],h,m,E);return null}return h=ta(h),o&&o[Vr]?o.K(c,h,d(m)?!!m.capture:!!m,E):kl(o,c,h,!1,m,E)}function kl(o,c,h,m,E,P){if(!c)throw Error("Invalid event type");var M=d(E)?!!E.capture:!!E,nt=Xo(o);if(nt||(o[Ho]=nt=new Gi(o)),h=nt.add(c,h,m,M,P),h.proxy)return h;if(m=mp(),h.proxy=m,m.src=o,m.listener=h,o.addEventListener)lp||(E=M),E===void 0&&(E=!1),o.addEventListener(c.toString(),m,E);else if(o.attachEvent)o.attachEvent(Fl(c.toString()),m);else if(o.addListener&&o.removeListener)o.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return h}function mp(){function o(h){return c.call(o.src,o.listener,h)}let c=gp;return o}function Ml(o,c,h,m,E){if(Array.isArray(c)){for(var P=0;P<c.length;P++)Ml(o,c[P],h,m,E);return null}return h=ta(h),o&&o[Vr]?o.L(c,h,d(m)?!!m.capture:!!m,E):kl(o,c,h,!0,m,E)}function Ol(o,c,h,m,E){if(Array.isArray(c))for(var P=0;P<c.length;P++)Ol(o,c[P],h,m,E);else m=d(m)?!!m.capture:!!m,h=ta(h),o&&o[Vr]?(o=o.i,c=String(c).toString(),c in o.g&&(P=o.g[c],h=Wo(P,h,m,E),-1<h&&(ji(P[h]),Array.prototype.splice.call(P,h,1),P.length==0&&(delete o.g[c],o.h--)))):o&&(o=Xo(o))&&(c=o.g[c.toString()],o=-1,c&&(o=Wo(c,h,m,E)),(h=-1<o?c[o]:null)&&Yo(h))}function Yo(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[Vr])Qo(c.i,o);else{var h=o.type,m=o.proxy;c.removeEventListener?c.removeEventListener(h,m,o.capture):c.detachEvent?c.detachEvent(Fl(h),m):c.addListener&&c.removeListener&&c.removeListener(m),(h=Xo(c))?(Qo(h,o),h.h==0&&(h.src=null,c[Ho]=null)):ji(o)}}}function Fl(o){return o in Jo?Jo[o]:Jo[o]="on"+o}function gp(o,c){if(o.da)o=!0;else{c=new Dr(c,this);var h=o.listener,m=o.ha||o.src;o.fa&&Yo(o),o=h.call(m,c)}return o}function Xo(o){return o=o[Ho],o instanceof Gi?o:null}var Zo="__closure_events_fn_"+(1e9*Math.random()>>>0);function ta(o){return typeof o=="function"?o:(o[Zo]||(o[Zo]=function(c){return o.handleEvent(c)}),o[Zo])}function xt(){De.call(this),this.i=new Gi(this),this.M=this,this.F=null}N(xt,De),xt.prototype[Vr]=!0,xt.prototype.removeEventListener=function(o,c,h,m){Ol(this,o,c,h,m)};function Ft(o,c){var h,m=o.F;if(m)for(h=[];m;m=m.F)h.push(m);if(o=o.M,m=c.type||c,typeof c=="string")c=new Rt(c,o);else if(c instanceof Rt)c.target=c.target||o;else{var E=c;c=new Rt(m,o),I(c,E)}if(E=!0,h)for(var P=h.length-1;0<=P;P--){var M=c.g=h[P];E=zi(M,m,!0,c)&&E}if(M=c.g=o,E=zi(M,m,!0,c)&&E,E=zi(M,m,!1,c)&&E,h)for(P=0;P<h.length;P++)M=c.g=h[P],E=zi(M,m,!1,c)&&E}xt.prototype.N=function(){if(xt.aa.N.call(this),this.i){var o=this.i,c;for(c in o.g){for(var h=o.g[c],m=0;m<h.length;m++)ji(h[m]);delete o.g[c],o.h--}}this.F=null},xt.prototype.K=function(o,c,h,m){return this.i.add(String(o),c,!1,h,m)},xt.prototype.L=function(o,c,h,m){return this.i.add(String(o),c,!0,h,m)};function zi(o,c,h,m){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();for(var E=!0,P=0;P<c.length;++P){var M=c[P];if(M&&!M.da&&M.capture==h){var nt=M.listener,St=M.ha||M.src;M.fa&&Qo(o.i,M),E=nt.call(St,m)!==!1&&E}}return E&&!m.defaultPrevented}function Ll(o,c,h){if(typeof o=="function")h&&(o=_(o,h));else if(o&&typeof o.handleEvent=="function")o=_(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(c)?-1:u.setTimeout(o,c||0)}function ql(o){o.g=Ll(()=>{o.g=null,o.i&&(o.i=!1,ql(o))},o.l);let c=o.h;o.h=null,o.m.apply(null,c)}class pp extends De{constructor(c,h){super(),this.m=c,this.l=h,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:ql(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Nr(o){De.call(this),this.h=o,this.g={}}N(Nr,De);var Bl=[];function Ul(o){K(o.g,function(c,h){this.g.hasOwnProperty(h)&&Yo(c)},o),o.g={}}Nr.prototype.N=function(){Nr.aa.N.call(this),Ul(this)},Nr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ea=u.JSON.stringify,_p=u.JSON.parse,yp=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function na(){}na.prototype.h=null;function jl(o){return o.h||(o.h=o.i())}function Gl(){}var kr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ra(){Rt.call(this,"d")}N(ra,Rt);function ia(){Rt.call(this,"c")}N(ia,Rt);var on={},zl=null;function Ki(){return zl=zl||new xt}on.La="serverreachability";function Kl(o){Rt.call(this,on.La,o)}N(Kl,Rt);function Mr(o){let c=Ki();Ft(c,new Kl(c))}on.STAT_EVENT="statevent";function $l(o,c){Rt.call(this,on.STAT_EVENT,o),this.stat=c}N($l,Rt);function Lt(o){let c=Ki();Ft(c,new $l(c,o))}on.Ma="timingevent";function Ql(o,c){Rt.call(this,on.Ma,o),this.size=c}N(Ql,Rt);function Or(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},c)}function Fr(){this.g=!0}Fr.prototype.xa=function(){this.g=!1};function vp(o,c,h,m,E,P){o.info(function(){if(o.g)if(P)for(var M="",nt=P.split("&"),St=0;St<nt.length;St++){var Z=nt[St].split("=");if(1<Z.length){var Dt=Z[0];Z=Z[1];var Vt=Dt.split("_");M=2<=Vt.length&&Vt[1]=="type"?M+(Dt+"="+Z+"&"):M+(Dt+"=redacted&")}}else M=null;else M=P;return"XMLHTTP REQ ("+m+") [attempt "+E+"]: "+c+`
`+h+`
`+M})}function wp(o,c,h,m,E,P,M){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+E+"]: "+c+`
`+h+`
`+P+" "+M})}function On(o,c,h,m){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+Tp(o,h)+(m?" "+m:"")})}function Ip(o,c){o.info(function(){return"TIMEOUT: "+c})}Fr.prototype.info=function(){};function Tp(o,c){if(!o.g)return c;if(!c)return null;try{var h=JSON.parse(c);if(h){for(o=0;o<h.length;o++)if(Array.isArray(h[o])){var m=h[o];if(!(2>m.length)){var E=m[1];if(Array.isArray(E)&&!(1>E.length)){var P=E[0];if(P!="noop"&&P!="stop"&&P!="close")for(var M=1;M<E.length;M++)E[M]=""}}}}return ea(h)}catch{return c}}var $i={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Wl={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},sa;function Qi(){}N(Qi,na),Qi.prototype.g=function(){return new XMLHttpRequest},Qi.prototype.i=function(){return{}},sa=new Qi;function Ve(o,c,h,m){this.j=o,this.i=c,this.l=h,this.R=m||1,this.U=new Nr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Hl}function Hl(){this.i=null,this.g="",this.h=!1}var Jl={},oa={};function aa(o,c,h){o.L=1,o.v=Yi(we(c)),o.m=h,o.P=!0,Yl(o,null)}function Yl(o,c){o.F=Date.now(),Wi(o),o.A=we(o.v);var h=o.A,m=o.R;Array.isArray(m)||(m=[String(m)]),hh(h.i,"t",m),o.C=0,h=o.j.J,o.h=new Hl,o.g=Rh(o.j,h?c:null,!o.m),0<o.O&&(o.M=new pp(_(o.Y,o,o.g),o.O)),c=o.U,h=o.g,m=o.ca;var E="readystatechange";Array.isArray(E)||(E&&(Bl[0]=E.toString()),E=Bl);for(var P=0;P<E.length;P++){var M=Nl(h,E[P],m||c.handleEvent,!1,c.h||c);if(!M)break;c.g[M.key]=M}c=o.H?p(o.H):{},o.m?(o.u||(o.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,c)):(o.u="GET",o.g.ea(o.A,o.u,null,c)),Mr(),vp(o.i,o.u,o.A,o.l,o.R,o.m)}Ve.prototype.ca=function(o){o=o.target;let c=this.M;c&&Ie(o)==3?c.j():this.Y(o)},Ve.prototype.Y=function(o){try{if(o==this.g)t:{let Vt=Ie(this.g);var c=this.g.Ba();let qn=this.g.Z();if(!(3>Vt)&&(Vt!=3||this.g&&(this.h.h||this.g.oa()||yh(this.g)))){this.J||Vt!=4||c==7||(c==8||0>=qn?Mr(3):Mr(2)),ua(this);var h=this.g.Z();this.X=h;e:if(Xl(this)){var m=yh(this.g);o="";var E=m.length,P=Ie(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){an(this),Lr(this);var M="";break e}this.h.i=new u.TextDecoder}for(c=0;c<E;c++)this.h.h=!0,o+=this.h.i.decode(m[c],{stream:!(P&&c==E-1)});m.length=0,this.h.g+=o,this.C=0,M=this.h.g}else M=this.g.oa();if(this.o=h==200,wp(this.i,this.u,this.A,this.l,this.R,Vt,h),this.o){if(this.T&&!this.K){e:{if(this.g){var nt,St=this.g;if((nt=St.g?St.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!G(nt)){var Z=nt;break e}}Z=null}if(h=Z)On(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ca(this,h);else{this.o=!1,this.s=3,Lt(12),an(this),Lr(this);break t}}if(this.P){h=!0;let Yt;for(;!this.J&&this.C<M.length;)if(Yt=Ep(this,M),Yt==oa){Vt==4&&(this.s=4,Lt(14),h=!1),On(this.i,this.l,null,"[Incomplete Response]");break}else if(Yt==Jl){this.s=4,Lt(15),On(this.i,this.l,M,"[Invalid Chunk]"),h=!1;break}else On(this.i,this.l,Yt,null),ca(this,Yt);if(Xl(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Vt!=4||M.length!=0||this.h.h||(this.s=1,Lt(16),h=!1),this.o=this.o&&h,!h)On(this.i,this.l,M,"[Invalid Chunked Response]"),an(this),Lr(this);else if(0<M.length&&!this.W){this.W=!0;var Dt=this.j;Dt.g==this&&Dt.ba&&!Dt.M&&(Dt.j.info("Great, no buffering proxy detected. Bytes received: "+M.length),ga(Dt),Dt.M=!0,Lt(11))}}else On(this.i,this.l,M,null),ca(this,M);Vt==4&&an(this),this.o&&!this.J&&(Vt==4?bh(this.j,this):(this.o=!1,Wi(this)))}else Bp(this.g),h==400&&0<M.indexOf("Unknown SID")?(this.s=3,Lt(12)):(this.s=0,Lt(13)),an(this),Lr(this)}}}catch{}finally{}};function Xl(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function Ep(o,c){var h=o.C,m=c.indexOf(`
`,h);return m==-1?oa:(h=Number(c.substring(h,m)),isNaN(h)?Jl:(m+=1,m+h>c.length?oa:(c=c.slice(m,m+h),o.C=m+h,c)))}Ve.prototype.cancel=function(){this.J=!0,an(this)};function Wi(o){o.S=Date.now()+o.I,Zl(o,o.I)}function Zl(o,c){if(o.B!=null)throw Error("WatchDog timer not null");o.B=Or(_(o.ba,o),c)}function ua(o){o.B&&(u.clearTimeout(o.B),o.B=null)}Ve.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(Ip(this.i,this.A),this.L!=2&&(Mr(),Lt(17)),an(this),this.s=2,Lr(this)):Zl(this,this.S-o)};function Lr(o){o.j.G==0||o.J||bh(o.j,o)}function an(o){ua(o);var c=o.M;c&&typeof c.ma=="function"&&c.ma(),o.M=null,Ul(o.U),o.g&&(c=o.g,o.g=null,c.abort(),c.ma())}function ca(o,c){try{var h=o.j;if(h.G!=0&&(h.g==o||la(h.h,o))){if(!o.K&&la(h.h,o)&&h.G==3){try{var m=h.Da.g.parse(c)}catch{m=null}if(Array.isArray(m)&&m.length==3){var E=m;if(E[0]==0){t:if(!h.u){if(h.g)if(h.g.F+3e3<o.F)ns(h),ts(h);else break t;ma(h),Lt(18)}}else h.za=E[1],0<h.za-h.T&&37500>E[2]&&h.F&&h.v==0&&!h.C&&(h.C=Or(_(h.Za,h),6e3));if(1>=nh(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else cn(h,11)}else if((o.K||h.g==o)&&ns(h),!G(c))for(E=h.Da.g.parse(c),c=0;c<E.length;c++){let Z=E[c];if(h.T=Z[0],Z=Z[1],h.G==2)if(Z[0]=="c"){h.K=Z[1],h.ia=Z[2];let Dt=Z[3];Dt!=null&&(h.la=Dt,h.j.info("VER="+h.la));let Vt=Z[4];Vt!=null&&(h.Aa=Vt,h.j.info("SVER="+h.Aa));let qn=Z[5];qn!=null&&typeof qn=="number"&&0<qn&&(m=1.5*qn,h.L=m,h.j.info("backChannelRequestTimeoutMs_="+m)),m=h;let Yt=o.g;if(Yt){let is=Yt.g?Yt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(is){var P=m.h;P.g||is.indexOf("spdy")==-1&&is.indexOf("quic")==-1&&is.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(ha(P,P.h),P.h=null))}if(m.D){let pa=Yt.g?Yt.g.getResponseHeader("X-HTTP-Session-Id"):null;pa&&(m.ya=pa,at(m.I,m.D,pa))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-o.F,h.j.info("Handshake RTT: "+h.R+"ms")),m=h;var M=o;if(m.qa=Ch(m,m.J?m.ia:null,m.W),M.K){rh(m.h,M);var nt=M,St=m.L;St&&(nt.I=St),nt.B&&(ua(nt),Wi(nt)),m.g=M}else Eh(m);0<h.i.length&&es(h)}else Z[0]!="stop"&&Z[0]!="close"||cn(h,7);else h.G==3&&(Z[0]=="stop"||Z[0]=="close"?Z[0]=="stop"?cn(h,7):fa(h):Z[0]!="noop"&&h.l&&h.l.ta(Z),h.v=0)}}Mr(4)}catch{}}var Ap=class{constructor(o,c){this.g=o,this.map=c}};function th(o){this.l=o||10,u.PerformanceNavigationTiming?(o=u.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function eh(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function nh(o){return o.h?1:o.g?o.g.size:0}function la(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function ha(o,c){o.g?o.g.add(c):o.h=c}function rh(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}th.prototype.cancel=function(){if(this.i=ih(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function ih(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let c=o.i;for(let h of o.g.values())c=c.concat(h.D);return c}return k(o.i)}function bp(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(l(o)){for(var c=[],h=o.length,m=0;m<h;m++)c.push(o[m]);return c}c=[],h=0;for(m in o)c[h++]=o[m];return c}function Sp(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(l(o)||typeof o=="string"){var c=[];o=o.length;for(var h=0;h<o;h++)c.push(h);return c}c=[],h=0;for(let m in o)c[h++]=m;return c}}}function sh(o,c){if(o.forEach&&typeof o.forEach=="function")o.forEach(c,void 0);else if(l(o)||typeof o=="string")Array.prototype.forEach.call(o,c,void 0);else for(var h=Sp(o),m=bp(o),E=m.length,P=0;P<E;P++)c.call(void 0,m[P],h&&h[P],o)}var oh=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Pp(o,c){if(o){o=o.split("&");for(var h=0;h<o.length;h++){var m=o[h].indexOf("="),E=null;if(0<=m){var P=o[h].substring(0,m);E=o[h].substring(m+1)}else P=o[h];c(P,E?decodeURIComponent(E.replace(/\+/g," ")):"")}}}function un(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof un){this.h=o.h,Hi(this,o.j),this.o=o.o,this.g=o.g,Ji(this,o.s),this.l=o.l;var c=o.i,h=new Ur;h.i=c.i,c.g&&(h.g=new Map(c.g),h.h=c.h),ah(this,h),this.m=o.m}else o&&(c=String(o).match(oh))?(this.h=!1,Hi(this,c[1]||"",!0),this.o=qr(c[2]||""),this.g=qr(c[3]||"",!0),Ji(this,c[4]),this.l=qr(c[5]||"",!0),ah(this,c[6]||"",!0),this.m=qr(c[7]||"")):(this.h=!1,this.i=new Ur(null,this.h))}un.prototype.toString=function(){var o=[],c=this.j;c&&o.push(Br(c,uh,!0),":");var h=this.g;return(h||c=="file")&&(o.push("//"),(c=this.o)&&o.push(Br(c,uh,!0),"@"),o.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&o.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(Br(h,h.charAt(0)=="/"?xp:Rp,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",Br(h,Vp)),o.join("")};function we(o){return new un(o)}function Hi(o,c,h){o.j=h?qr(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function Ji(o,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);o.s=c}else o.s=null}function ah(o,c,h){c instanceof Ur?(o.i=c,Np(o.i,o.h)):(h||(c=Br(c,Dp)),o.i=new Ur(c,o.h))}function at(o,c,h){o.i.set(c,h)}function Yi(o){return at(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function qr(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Br(o,c,h){return typeof o=="string"?(o=encodeURI(o).replace(c,Cp),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Cp(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var uh=/[#\/\?@]/g,Rp=/[#\?:]/g,xp=/[#\?]/g,Dp=/[#\?@]/g,Vp=/#/g;function Ur(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function Ne(o){o.g||(o.g=new Map,o.h=0,o.i&&Pp(o.i,function(c,h){o.add(decodeURIComponent(c.replace(/\+/g," ")),h)}))}r=Ur.prototype,r.add=function(o,c){Ne(this),this.i=null,o=Fn(this,o);var h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(c),this.h+=1,this};function ch(o,c){Ne(o),c=Fn(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function lh(o,c){return Ne(o),c=Fn(o,c),o.g.has(c)}r.forEach=function(o,c){Ne(this),this.g.forEach(function(h,m){h.forEach(function(E){o.call(c,E,m,this)},this)},this)},r.na=function(){Ne(this);let o=Array.from(this.g.values()),c=Array.from(this.g.keys()),h=[];for(let m=0;m<c.length;m++){let E=o[m];for(let P=0;P<E.length;P++)h.push(c[m])}return h},r.V=function(o){Ne(this);let c=[];if(typeof o=="string")lh(this,o)&&(c=c.concat(this.g.get(Fn(this,o))));else{o=Array.from(this.g.values());for(let h=0;h<o.length;h++)c=c.concat(o[h])}return c},r.set=function(o,c){return Ne(this),this.i=null,o=Fn(this,o),lh(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},r.get=function(o,c){return o?(o=this.V(o),0<o.length?String(o[0]):c):c};function hh(o,c,h){ch(o,c),0<h.length&&(o.i=null,o.g.set(Fn(o,c),k(h)),o.h+=h.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],c=Array.from(this.g.keys());for(var h=0;h<c.length;h++){var m=c[h];let P=encodeURIComponent(String(m)),M=this.V(m);for(m=0;m<M.length;m++){var E=P;M[m]!==""&&(E+="="+encodeURIComponent(String(M[m]))),o.push(E)}}return this.i=o.join("&")};function Fn(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function Np(o,c){c&&!o.j&&(Ne(o),o.i=null,o.g.forEach(function(h,m){var E=m.toLowerCase();m!=E&&(ch(this,m),hh(this,E,h))},o)),o.j=c}function kp(o,c){let h=new Fr;if(u.Image){let m=new Image;m.onload=b(ke,h,"TestLoadImage: loaded",!0,c,m),m.onerror=b(ke,h,"TestLoadImage: error",!1,c,m),m.onabort=b(ke,h,"TestLoadImage: abort",!1,c,m),m.ontimeout=b(ke,h,"TestLoadImage: timeout",!1,c,m),u.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else c(!1)}function Mp(o,c){let h=new Fr,m=new AbortController,E=setTimeout(()=>{m.abort(),ke(h,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:m.signal}).then(P=>{clearTimeout(E),P.ok?ke(h,"TestPingServer: ok",!0,c):ke(h,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(E),ke(h,"TestPingServer: error",!1,c)})}function ke(o,c,h,m,E){try{E&&(E.onload=null,E.onerror=null,E.onabort=null,E.ontimeout=null),m(h)}catch{}}function Op(){this.g=new yp}function Fp(o,c,h){let m=h||"";try{sh(o,function(E,P){let M=E;d(E)&&(M=ea(E)),c.push(m+P+"="+encodeURIComponent(M))})}catch(E){throw c.push(m+"type="+encodeURIComponent("_badmap")),E}}function jr(o){this.l=o.Ub||null,this.j=o.eb||!1}N(jr,na),jr.prototype.g=function(){return new Xi(this.l,this.j)},jr.prototype.i=function(o){return function(){return o}}({});function Xi(o,c){xt.call(this),this.D=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}N(Xi,xt),r=Xi.prototype,r.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=c,this.readyState=1,zr(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(c.body=o),(this.D||u).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Gr(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,zr(this)),this.g&&(this.readyState=3,zr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;dh(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function dh(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?Gr(this):zr(this),this.readyState==3&&dh(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,Gr(this))},r.Qa=function(o){this.g&&(this.response=o,Gr(this))},r.ga=function(){this.g&&Gr(this)};function Gr(o){o.readyState=4,o.l=null,o.j=null,o.v=null,zr(o)}r.setRequestHeader=function(o,c){this.u.append(o,c)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],c=this.h.entries();for(var h=c.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=c.next();return o.join(`\r
`)};function zr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Xi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function fh(o){let c="";return K(o,function(h,m){c+=m,c+=":",c+=h,c+=`\r
`}),c}function da(o,c,h){t:{for(m in h){var m=!1;break t}m=!0}m||(h=fh(h),typeof o=="string"?h!=null&&encodeURIComponent(String(h)):at(o,c,h))}function dt(o){xt.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}N(dt,xt);var Lp=/^https?$/i,qp=["POST","PUT"];r=dt.prototype,r.Ha=function(o){this.J=o},r.ea=function(o,c,h,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():sa.g(),this.v=this.o?jl(this.o):jl(sa),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(P){mh(this,P);return}if(o=h||"",h=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var E in m)h.set(E,m[E]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let P of m.keys())h.set(P,m.get(P));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(h.keys()).find(P=>P.toLowerCase()=="content-type"),E=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(qp,c,void 0))||m||E||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[P,M]of h)this.g.setRequestHeader(P,M);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{_h(this),this.u=!0,this.g.send(o),this.u=!1}catch(P){mh(this,P)}};function mh(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.m=5,gh(o),Zi(o)}function gh(o){o.A||(o.A=!0,Ft(o,"complete"),Ft(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Ft(this,"complete"),Ft(this,"abort"),Zi(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Zi(this,!0)),dt.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?ph(this):this.bb())},r.bb=function(){ph(this)};function ph(o){if(o.h&&typeof a<"u"&&(!o.v[1]||Ie(o)!=4||o.Z()!=2)){if(o.u&&Ie(o)==4)Ll(o.Ea,0,o);else if(Ft(o,"readystatechange"),Ie(o)==4){o.h=!1;try{let M=o.Z();t:switch(M){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break t;default:c=!1}var h;if(!(h=c)){var m;if(m=M===0){var E=String(o.D).match(oh)[1]||null;!E&&u.self&&u.self.location&&(E=u.self.location.protocol.slice(0,-1)),m=!Lp.test(E?E.toLowerCase():"")}h=m}if(h)Ft(o,"complete"),Ft(o,"success");else{o.m=6;try{var P=2<Ie(o)?o.g.statusText:""}catch{P=""}o.l=P+" ["+o.Z()+"]",gh(o)}}finally{Zi(o)}}}}function Zi(o,c){if(o.g){_h(o);let h=o.g,m=o.v[0]?()=>{}:null;o.g=null,o.v=null,c||Ft(o,"ready");try{h.onreadystatechange=m}catch{}}}function _h(o){o.I&&(u.clearTimeout(o.I),o.I=null)}r.isActive=function(){return!!this.g};function Ie(o){return o.g?o.g.readyState:0}r.Z=function(){try{return 2<Ie(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),_p(c)}};function yh(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Bp(o){let c={};o=(o.g&&2<=Ie(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<o.length;m++){if(G(o[m]))continue;var h=T(o[m]);let E=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let P=c[E]||[];c[E]=P,P.push(h)}w(c,function(m){return m.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Kr(o,c,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||c}function vh(o){this.Aa=0,this.i=[],this.j=new Fr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Kr("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Kr("baseRetryDelayMs",5e3,o),this.cb=Kr("retryDelaySeedMs",1e4,o),this.Wa=Kr("forwardChannelMaxRetries",2,o),this.wa=Kr("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new th(o&&o.concurrentRequestLimit),this.Da=new Op,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=vh.prototype,r.la=8,r.G=1,r.connect=function(o,c,h,m){Lt(0),this.W=o,this.H=c||{},h&&m!==void 0&&(this.H.OSID=h,this.H.OAID=m),this.F=this.X,this.I=Ch(this,null,this.W),es(this)};function fa(o){if(wh(o),o.G==3){var c=o.U++,h=we(o.I);if(at(h,"SID",o.K),at(h,"RID",c),at(h,"TYPE","terminate"),$r(o,h),c=new Ve(o,o.j,c),c.L=2,c.v=Yi(we(h)),h=!1,u.navigator&&u.navigator.sendBeacon)try{h=u.navigator.sendBeacon(c.v.toString(),"")}catch{}!h&&u.Image&&(new Image().src=c.v,h=!0),h||(c.g=Rh(c.j,null),c.g.ea(c.v)),c.F=Date.now(),Wi(c)}Ph(o)}function ts(o){o.g&&(ga(o),o.g.cancel(),o.g=null)}function wh(o){ts(o),o.u&&(u.clearTimeout(o.u),o.u=null),ns(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&u.clearTimeout(o.s),o.s=null)}function es(o){if(!eh(o.h)&&!o.s){o.s=!0;var c=o.Ga;Rr||Vl(),xr||(Rr(),xr=!0),$o.add(c,o),o.B=0}}function Up(o,c){return nh(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=c.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=Or(_(o.Ga,o,c),Sh(o,o.B)),o.B++,!0)}r.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let E=new Ve(this,this.j,o),P=this.o;if(this.S&&(P?(P=p(P),I(P,this.S)):P=this.S),this.m!==null||this.O||(E.H=P,P=null),this.P)t:{for(var c=0,h=0;h<this.i.length;h++){e:{var m=this.i[h];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break e}m=void 0}if(m===void 0)break;if(c+=m,4096<c){c=h;break t}if(c===4096||h===this.i.length-1){c=h+1;break t}}c=1e3}else c=1e3;c=Th(this,E,c),h=we(this.I),at(h,"RID",o),at(h,"CVER",22),this.D&&at(h,"X-HTTP-Session-Id",this.D),$r(this,h),P&&(this.O?c="headers="+encodeURIComponent(String(fh(P)))+"&"+c:this.m&&da(h,this.m,P)),ha(this.h,E),this.Ua&&at(h,"TYPE","init"),this.P?(at(h,"$req",c),at(h,"SID","null"),E.T=!0,aa(E,h,null)):aa(E,h,c),this.G=2}}else this.G==3&&(o?Ih(this,o):this.i.length==0||eh(this.h)||Ih(this))};function Ih(o,c){var h;c?h=c.l:h=o.U++;let m=we(o.I);at(m,"SID",o.K),at(m,"RID",h),at(m,"AID",o.T),$r(o,m),o.m&&o.o&&da(m,o.m,o.o),h=new Ve(o,o.j,h,o.B+1),o.m===null&&(h.H=o.o),c&&(o.i=c.D.concat(o.i)),c=Th(o,h,1e3),h.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),ha(o.h,h),aa(h,m,c)}function $r(o,c){o.H&&K(o.H,function(h,m){at(c,m,h)}),o.l&&sh({},function(h,m){at(c,m,h)})}function Th(o,c,h){h=Math.min(o.i.length,h);var m=o.l?_(o.l.Na,o.l,o):null;t:{var E=o.i;let P=-1;for(;;){let M=["count="+h];P==-1?0<h?(P=E[0].g,M.push("ofs="+P)):P=0:M.push("ofs="+P);let nt=!0;for(let St=0;St<h;St++){let Z=E[St].g,Dt=E[St].map;if(Z-=P,0>Z)P=Math.max(0,E[St].g-100),nt=!1;else try{Fp(Dt,M,"req"+Z+"_")}catch{m&&m(Dt)}}if(nt){m=M.join("&");break t}}}return o=o.i.splice(0,h),c.D=o,m}function Eh(o){if(!o.g&&!o.u){o.Y=1;var c=o.Fa;Rr||Vl(),xr||(Rr(),xr=!0),$o.add(c,o),o.v=0}}function ma(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=Or(_(o.Fa,o),Sh(o,o.v)),o.v++,!0)}r.Fa=function(){if(this.u=null,Ah(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=Or(_(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Lt(10),ts(this),Ah(this))};function ga(o){o.A!=null&&(u.clearTimeout(o.A),o.A=null)}function Ah(o){o.g=new Ve(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var c=we(o.qa);at(c,"RID","rpc"),at(c,"SID",o.K),at(c,"AID",o.T),at(c,"CI",o.F?"0":"1"),!o.F&&o.ja&&at(c,"TO",o.ja),at(c,"TYPE","xmlhttp"),$r(o,c),o.m&&o.o&&da(c,o.m,o.o),o.L&&(o.g.I=o.L);var h=o.g;o=o.ia,h.L=1,h.v=Yi(we(c)),h.m=null,h.P=!0,Yl(h,o)}r.Za=function(){this.C!=null&&(this.C=null,ts(this),ma(this),Lt(19))};function ns(o){o.C!=null&&(u.clearTimeout(o.C),o.C=null)}function bh(o,c){var h=null;if(o.g==c){ns(o),ga(o),o.g=null;var m=2}else if(la(o.h,c))h=c.D,rh(o.h,c),m=1;else return;if(o.G!=0){if(c.o)if(m==1){h=c.m?c.m.length:0,c=Date.now()-c.F;var E=o.B;m=Ki(),Ft(m,new Ql(m,h)),es(o)}else Eh(o);else if(E=c.s,E==3||E==0&&0<c.X||!(m==1&&Up(o,c)||m==2&&ma(o)))switch(h&&0<h.length&&(c=o.h,c.i=c.i.concat(h)),E){case 1:cn(o,5);break;case 4:cn(o,10);break;case 3:cn(o,6);break;default:cn(o,2)}}}function Sh(o,c){let h=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(h*=2),h*c}function cn(o,c){if(o.j.info("Error code "+c),c==2){var h=_(o.fb,o),m=o.Xa;let E=!m;m=new un(m||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||Hi(m,"https"),Yi(m),E?kp(m.toString(),h):Mp(m.toString(),h)}else Lt(2);o.G=0,o.l&&o.l.sa(c),Ph(o),wh(o)}r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Lt(2)):(this.j.info("Failed to ping google.com"),Lt(1))};function Ph(o){if(o.G=0,o.ka=[],o.l){let c=ih(o.h);(c.length!=0||o.i.length!=0)&&(V(o.ka,c),V(o.ka,o.i),o.h.i.length=0,k(o.i),o.i.length=0),o.l.ra()}}function Ch(o,c,h){var m=h instanceof un?we(h):new un(h);if(m.g!="")c&&(m.g=c+"."+m.g),Ji(m,m.s);else{var E=u.location;m=E.protocol,c=c?c+"."+E.hostname:E.hostname,E=+E.port;var P=new un(null);m&&Hi(P,m),c&&(P.g=c),E&&Ji(P,E),h&&(P.l=h),m=P}return h=o.D,c=o.ya,h&&c&&at(m,h,c),at(m,"VER",o.la),$r(o,m),m}function Rh(o,c,h){if(c&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Ca&&!o.pa?new dt(new jr({eb:h})):new dt(o.pa),c.Ha(o.J),c}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function xh(){}r=xh.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function rs(){}rs.prototype.g=function(o,c){return new zt(o,c)};function zt(o,c){xt.call(this),this.g=new vh(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(o?o["X-WebChannel-Client-Profile"]=c.va:o={"X-WebChannel-Client-Profile":c.va}),this.g.S=o,(o=c&&c.Sb)&&!G(o)&&(this.g.m=o),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!G(c)&&(this.g.D=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new Ln(this)}N(zt,xt),zt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},zt.prototype.close=function(){fa(this.g)},zt.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.u&&(h={},h.__data__=ea(o),o=h);c.i.push(new Ap(c.Ya++,o)),c.G==3&&es(c)},zt.prototype.N=function(){this.g.l=null,delete this.j,fa(this.g),delete this.g,zt.aa.N.call(this)};function Dh(o){ra.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){t:{for(let h in c){o=h;break t}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}N(Dh,ra);function Vh(){ia.call(this),this.status=1}N(Vh,ia);function Ln(o){this.g=o}N(Ln,xh),Ln.prototype.ua=function(){Ft(this.g,"a")},Ln.prototype.ta=function(o){Ft(this.g,new Dh(o))},Ln.prototype.sa=function(o){Ft(this.g,new Vh)},Ln.prototype.ra=function(){Ft(this.g,"b")},rs.prototype.createWebChannel=rs.prototype.g,zt.prototype.send=zt.prototype.o,zt.prototype.open=zt.prototype.m,zt.prototype.close=zt.prototype.close,Da=Te.createWebChannelTransport=function(){return new rs},xa=Te.getStatEventTarget=function(){return Ki()},Ra=Te.Event=on,gs=Te.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},$i.NO_ERROR=0,$i.TIMEOUT=8,$i.HTTP_ERROR=6,ti=Te.ErrorCode=$i,Wl.COMPLETE="complete",Ca=Te.EventType=Wl,Gl.EventType=kr,kr.OPEN="a",kr.CLOSE="b",kr.ERROR="c",kr.MESSAGE="d",xt.prototype.listen=xt.prototype.K,Un=Te.WebChannel=Gl,jp=Te.FetchXmlHttpFactory=jr,dt.prototype.listenOnce=dt.prototype.L,dt.prototype.getLastError=dt.prototype.Ka,dt.prototype.getLastErrorCode=dt.prototype.Ba,dt.prototype.getStatus=dt.prototype.Z,dt.prototype.getResponseJson=dt.prototype.Oa,dt.prototype.getResponseText=dt.prototype.oa,dt.prototype.send=dt.prototype.ea,dt.prototype.setWithCredentials=dt.prototype.Ha,Pa=Te.XhrIo=dt}).apply(typeof ms<"u"?ms:typeof self<"u"?self:typeof window<"u"?window:{});var Pd="@firebase/firestore";var Tt=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};Tt.UNAUTHENTICATED=new Tt(null),Tt.GOOGLE_CREDENTIALS=new Tt("google-credentials-uid"),Tt.FIRST_PARTY=new Tt("first-party-uid"),Tt.MOCK_USER=new Tt("mock-user");var yr="10.14.0";var Ke=new id("@firebase/firestore");function $n(){return Ke.logLevel}function Df(r){Ke.setLogLevel(r)}function D(r,...t){if(Ke.logLevel<=ue.DEBUG){let e=t.map(Oc);Ke.debug(`Firestore (${yr}): ${r}`,...e)}}function pt(r,...t){if(Ke.logLevel<=ue.ERROR){let e=t.map(Oc);Ke.error(`Firestore (${yr}): ${r}`,...e)}}function te(r,...t){if(Ke.logLevel<=ue.WARN){let e=t.map(Oc);Ke.warn(`Firestore (${yr}): ${r}`,...e)}}function Oc(r){if(typeof r=="string")return r;try{return function(e){return JSON.stringify(e)}(r)}catch{return r}}function L(r="Unexpected state"){let t=`FIRESTORE (${yr}) INTERNAL ASSERTION FAILED: `+r;throw pt(t),new Error(t)}function q(r,t){r||L()}function Vf(r,t){r||L()}function O(r,t){return r}var C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},x=class extends rd{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var At=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var bs=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},Fa=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(Tt.UNAUTHENTICATED))}shutdown(){}},La=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},qa=class{constructor(t){this.t=t,this.currentUser=Tt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){q(this.o===void 0);let n=this.i,i=l=>this.i!==n?(n=this.i,e(l)):Promise.resolve(),s=new At;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new At,t.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let l=s;t.enqueueRetryable(()=>R(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},u=l=>{D("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>u(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?u(l):(D("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new At)}},0),a()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(n=>this.i!==t?(D("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(q(typeof n.accessToken=="string"),new bs(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return q(t===null||typeof t=="string"),new Tt(t)}},Ba=class{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=Tt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Ua=class{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new Ba(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(Tt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},ja=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Ga=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){q(this.o===void 0);let n=s=>{s.error!=null&&D("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.R;return this.R=s.token,D("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>n(s))};let i=s=>{D("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):D("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(q(typeof e.token=="string"),this.R=e.token,new ja(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function Gp(r){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}var Ss=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";for(;n.length<20;){let i=Gp(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<e&&(n+=t.charAt(i[s]%t.length))}return n}};function z(r,t){return r<t?-1:r>t?1:0}function er(r,t,e){return r.length===t.length&&r.every((n,i)=>e(n,t[i]))}function Nf(r){return r+"\0"}var lt=class r{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new x(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new x(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new x(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new x(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return r.fromMillis(Date.now())}static fromDate(t){return r.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new r(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?z(this.nanoseconds,t.nanoseconds):z(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var U=class r{constructor(t){this.timestamp=t}static fromTimestamp(t){return new r(t)}static min(){return new r(new lt(0,0))}static max(){return new r(new lt(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Ps=class r{constructor(t,e,n){e===void 0?e=0:e>t.length&&L(),n===void 0?n=t.length-e:n>t.length-e&&L(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return r.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof r?t.forEach(n=>{e.push(n)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let n=Math.min(t.length,e.length);for(let i=0;i<n;i++){let s=t.get(i),a=e.get(i);if(s<a)return-1;if(s>a)return 1}return t.length<e.length?-1:t.length>e.length?1:0}},Y=class r extends Ps{construct(t,e,n){return new r(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let n of t){if(n.indexOf("//")>=0)throw new x(C.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(i=>i.length>0))}return new r(e)}static emptyPath(){return new r([])}},zp=/^[_a-zA-Z][_a-zA-Z0-9]*$/,_t=class r extends Ps{construct(t,e,n){return new r(t,e,n)}static isValidIdentifier(t){return zp.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new r(["__name__"])}static fromServerFormat(t){let e=[],n="",i=0,s=()=>{if(n.length===0)throw new x(C.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""},a=!1;for(;i<t.length;){let u=t[i];if(u==="\\"){if(i+1===t.length)throw new x(C.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let l=t[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new x(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=l,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(n+=u,i++):(s(),i++)}if(s(),a)throw new x(C.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new r(e)}static emptyPath(){return new r([])}};var F=class r{constructor(t){this.path=t}static fromPath(t){return new r(Y.fromString(t))}static fromName(t){return new r(Y.fromString(t).popFirst(5))}static empty(){return new r(Y.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Y.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return Y.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new r(new Y(t.slice()))}};var nr=class{constructor(t,e,n,i){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=i}};function za(r){return r.fields.find(t=>t.kind===2)}function hn(r){return r.fields.filter(t=>t.kind!==2)}nr.UNKNOWN_ID=-1;var Xn=class{constructor(t,e){this.fieldPath=t,this.kind=e}};var di=class r{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new r(0,Ht.min())}};function kf(r,t){let e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=U.fromTimestamp(n===1e9?new lt(e+1,0):new lt(e,n));return new Ht(i,F.empty(),t)}function Mf(r){return new Ht(r.readTime,r.key,-1)}var Ht=class r{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new r(U.min(),F.empty(),-1)}static max(){return new r(U.max(),F.empty(),-1)}};function Fc(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=F.comparator(r.documentKey,t.documentKey),e!==0?e:z(r.largestBatchId,t.largestBatchId))}var Of="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Cs=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function en(r){return R(this,null,function*(){if(r.code!==C.FAILED_PRECONDITION||r.message!==Of)throw r;D("LocalStore","Unexpectedly lost primary lease")})}var S=class r{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&L(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new r((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(e,s).next(n,i)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof r?e:r.resolve(e)}catch(e){return r.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):r.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):r.reject(e)}static resolve(t){return new r((e,n)=>{e(t)})}static reject(t){return new r((e,n)=>{n(t)})}static waitFor(t){return new r((e,n)=>{let i=0,s=0,a=!1;t.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&e()},l=>n(l))}),a=!0,s===i&&e()})}static or(t){let e=r.resolve(!1);for(let n of t)e=e.next(i=>i?r.resolve(i):n());return e}static forEach(t,e){let n=[];return t.forEach((i,s)=>{n.push(e.call(this,i,s))}),this.waitFor(n)}static mapArray(t,e){return new r((n,i)=>{let s=t.length,a=new Array(s),u=0;for(let l=0;l<s;l++){let d=l;e(t[d]).next(f=>{a[d]=f,++u,u===s&&n(a)},f=>i(f))}})}static doWhile(t,e){return new r((n,i)=>{let s=()=>{t()===!0?e().next(()=>{s()},i):n()};s()})}};var Rs=class r{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new At,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new _n(t,e.error)):this.V.resolve()},this.transaction.onerror=n=>{let i=Lc(n.target.error);this.V.reject(new _n(t,i))}}static open(t,e,n,i){try{return new r(e,t.transaction(i,n))}catch(s){throw new _n(e,s)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(D("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new $a(e)}},$e=class r{constructor(t,e,n){this.name=t,this.version=e,this.p=n,r.S(Xr())===12.2&&pt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return D("SimpleDb","Removing database:",t),dn(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!nd())return!1;if(r.v())return!0;let t=Xr(),e=r.S(t),n=0<e&&e<10,i=Ff(t),s=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)}static v(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.C)==="YES"}static F(t,e){return t.store(e)}static S(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(t){return R(this,null,function*(){return this.db||(D("SimpleDb","Opening database:",this.name),this.db=yield new Promise((e,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let a=s.target.result;e(a)},i.onblocked=()=>{n(new _n(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let a=s.target.error;a.name==="VersionError"?n(new x(C.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new x(C.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new _n(t,a))},i.onupgradeneeded=s=>{D("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let a=s.target.result;this.p.O(a,i.transaction,s.oldVersion,this.version).next(()=>{D("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=e=>this.N(e)),this.db})}L(t){this.N=t,this.db&&(this.db.onversionchange=e=>t(e))}runTransaction(t,e,n,i){return R(this,null,function*(){let s=e==="readonly",a=0;for(;;){++a;try{this.db=yield this.M(t);let u=Rs.open(this.db,t,s?"readonly":"readwrite",n),l=i(u).next(d=>(u.g(),d)).catch(d=>(u.abort(d),S.reject(d))).toPromise();return l.catch(()=>{}),yield u.m,l}catch(u){let l=u,d=l.name!=="FirebaseError"&&a<3;if(D("SimpleDb","Transaction failed with error:",l.message,"Retrying:",d),this.close(),!d)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function Ff(r){let t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}var Ka=class{constructor(t){this.B=t,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(t){this.B=t}done(){this.k=!0}$(t){this.q=t}delete(){return dn(this.B.delete())}},_n=class extends x{constructor(t,e){super(C.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function nn(r){return r.name==="IndexedDbTransactionError"}var $a=class{constructor(t){this.store=t}put(t,e){let n;return e!==void 0?(D("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(D("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),dn(n)}add(t){return D("SimpleDb","ADD",this.store.name,t,t),dn(this.store.add(t))}get(t){return dn(this.store.get(t)).next(e=>(e===void 0&&(e=null),D("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return D("SimpleDb","DELETE",this.store.name,t),dn(this.store.delete(t))}count(){return D("SimpleDb","COUNT",this.store.name),dn(this.store.count())}U(t,e){let n=this.options(t,e),i=n.index?this.store.index(n.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(n.range);return new S((a,u)=>{s.onerror=l=>{u(l.target.error)},s.onsuccess=l=>{a(l.target.result)}})}{let s=this.cursor(n),a=[];return this.W(s,(u,l)=>{a.push(l)}).next(()=>a)}}G(t,e){let n=this.store.getAll(t,e===null?void 0:e);return new S((i,s)=>{n.onerror=a=>{s(a.target.error)},n.onsuccess=a=>{i(a.target.result)}})}j(t,e){D("SimpleDb","DELETE ALL",this.store.name);let n=this.options(t,e);n.H=!1;let i=this.cursor(n);return this.W(i,(s,a,u)=>u.delete())}J(t,e){let n;e?n=t:(n={},e=t);let i=this.cursor(n);return this.W(i,e)}Y(t){let e=this.cursor({});return new S((n,i)=>{e.onerror=s=>{let a=Lc(s.target.error);i(a)},e.onsuccess=s=>{let a=s.target.result;a?t(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}W(t,e){let n=[];return new S((i,s)=>{t.onerror=a=>{s(a.target.error)},t.onsuccess=a=>{let u=a.target.result;if(!u)return void i();let l=new Ka(u),d=e(u.primaryKey,u.value,l);if(d instanceof S){let f=d.catch(g=>(l.done(),S.reject(g)));n.push(f)}l.isDone?i():l.K===null?u.continue():u.continue(l.K)}}).next(()=>S.waitFor(n))}options(t,e){let n;return t!==void 0&&(typeof t=="string"?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let n=this.store.index(t.index);return t.H?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function dn(r){return new S((t,e)=>{r.onsuccess=n=>{let i=n.target.result;t(i)},r.onerror=n=>{let i=Lc(n.target.error);e(i)}})}var Cd=!1;function Lc(r){let t=$e.S(Xr());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(e)>=0){let n=new x("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Cd||(Cd=!0,setTimeout(()=>{throw n},0)),n}}return r}var Qa=class{constructor(t,e){this.asyncQueue=t,this.Z=e,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(t){D("IndexBackfiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,()=>R(this,null,function*(){this.task=null;try{D("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(e){nn(e)?D("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):yield en(e)}yield this.X(6e4)}))}},Wa=class{constructor(t,e){this.localStore=t,this.persistence=e}ee(t=50){return R(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.te(e,t))})}te(t,e){let n=new Set,i=e,s=!0;return S.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(a=>{if(a!==null&&!n.has(a))return D("IndexBackfiller",`Processing collection: ${a}`),this.ne(t,a,i).next(u=>{i-=u,n.add(a)});s=!1})).next(()=>e-i)}ne(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(i=>this.localStore.localDocuments.getNextDocuments(t,e,i,n).next(s=>{let a=s.changes;return this.localStore.indexManager.updateIndexEntries(t,a).next(()=>this.re(i,s)).next(u=>(D("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(t,e,u))).next(()=>a.size)}))}re(t,e){let n=t;return e.changes.forEach((i,s)=>{let a=Mf(s);Fc(a,n)>0&&(n=a)}),new Ht(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}};var Kt=(()=>{class r{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.se&&this.se(e),e}}return r.oe=-1,r})();function Ni(r){return r==null}function fi(r){return r===0&&1/r==-1/0}function Lf(r){return typeof r=="number"&&Number.isInteger(r)&&!fi(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function qt(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=Rd(t)),t=Kp(r.get(e),t);return Rd(t)}function Kp(r,t){let e=t,n=r.length;for(let i=0;i<n;i++){let s=r.charAt(i);switch(s){case"\0":e+="";break;case"":e+="";break;default:e+=s}}return e}function Rd(r){return r+""}function ce(r){let t=r.length;if(q(t>=2),t===2)return q(r.charAt(0)===""&&r.charAt(1)===""),Y.emptyPath();let e=t-2,n=[],i="";for(let s=0;s<t;){let a=r.indexOf("",s);switch((a<0||a>e)&&L(),r.charAt(a+1)){case"":let u=r.substring(s,a),l;i.length===0?l=u:(i+=u,l=i,i=""),n.push(l);break;case"":i+=r.substring(s,a),i+="\0";break;case"":i+=r.substring(s,a+1);break;default:L()}s=a+2}return new Y(n)}var xd=["userId","batchId"];function ws(r,t){return[r,qt(t)]}function qf(r,t,e){return[r,qt(t),e]}var $p={},Qp=["prefixPath","collectionGroup","readTime","documentId"],Wp=["prefixPath","collectionGroup","documentId"],Hp=["collectionGroup","readTime","prefixPath","documentId"],Jp=["canonicalId","targetId"],Yp=["targetId","path"],Xp=["path","targetId"],Zp=["collectionId","parent"],t_=["indexId","uid"],e_=["uid","sequenceNumber"],n_=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],r_=["indexId","uid","orderedDocumentKey"],i_=["userId","collectionPath","documentId"],s_=["userId","collectionPath","largestBatchId"],o_=["userId","collectionGroup","largestBatchId"],Bf=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],a_=[...Bf,"documentOverlays"],Uf=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],jf=Uf,qc=[...jf,"indexConfiguration","indexState","indexEntries"],u_=qc,c_=[...qc,"globals"];var mi=class extends Cs{constructor(t,e){super(),this._e=t,this.currentSequenceNumber=e}};function bt(r,t){let e=O(r);return $e.F(e._e,t)}function Dd(r){let t=0;for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function Rn(r,t){for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function Gf(r){for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}var ut=class r{constructor(t,e){this.comparator=t,this.root=e||he.EMPTY}insert(t,e){return new r(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,he.BLACK,null,null))}remove(t){return new r(this.comparator,this.root.remove(t,this.comparator).copy(null,null,he.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(t,n.key);if(i===0)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){let t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Yn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Yn(this.root,t,this.comparator,!1)}getReverseIterator(){return new Yn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Yn(this.root,t,this.comparator,!0)}},Yn=class{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},he=class r{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=n??r.RED,this.left=i??r.EMPTY,this.right=s??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,s){return new r(t??this.key,e??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this,s=n(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):s===0?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),e(t,i.key)===0){if(i.right.isEmpty())return r.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw L();let t=this.left.check();if(t!==this.right.check())throw L();return t+(this.isRed()?0:1)}};he.EMPTY=null,he.RED=!0,he.BLACK=!1;he.EMPTY=new class{constructor(){this.size=0}get key(){throw L()}get value(){throw L()}get color(){throw L()}get left(){throw L()}get right(){throw L()}copy(t,e,n,i,s){return this}insert(t,e,n){return new he(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var it=class r{constructor(t){this.comparator=t,this.data=new ut(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){let n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new xs(this.data.getIterator())}getIteratorFrom(t){return new xs(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(n=>{e=e.add(n)}),e}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new r(this.comparator);return e.data=t,e}},xs=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function jn(r){return r.hasNext()?r.getNext():void 0}var $t=class r{constructor(t){this.fields=t,t.sort(_t.comparator)}static empty(){return new r([])}unionWith(t){let e=new it(_t.comparator);for(let n of this.fields)e=e.add(n);for(let n of t)e=e.add(n);return new r(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return er(this.fields,t.fields,(e,n)=>e.isEqual(n))}};var Ds=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function zf(){return typeof atob<"u"}var vt=class r{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Ds("Invalid base64 string: "+s):s}}(t);return new r(e)}static fromUint8Array(t){let e=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(t);return new r(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let n=new Uint8Array(e.length);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return z(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};vt.EMPTY_BYTE_STRING=new vt("");var l_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function be(r){if(q(!!r),typeof r=="string"){let t=0,e=l_.exec(r);if(q(!!e),e[1]){let i=e[1];i=(i+"000000000").substr(0,9),t=Number(i)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:ct(r.seconds),nanos:ct(r.nanos)}}function ct(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Qe(r){return typeof r=="string"?vt.fromBase64String(r):vt.fromUint8Array(r)}function Eo(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function Bc(r){let t=r.mapValue.fields.__previous_value__;return Eo(t)?Bc(t):t}function gi(r){let t=be(r.mapValue.fields.__local_write_time__.timestampValue);return new lt(t.seconds,t.nanos)}var Ha=class{constructor(t,e,n,i,s,a,u,l,d){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=l,this.useFetchStreams=d}},We=class r{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new r("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof r&&t.projectId===this.projectId&&t.database===this.database}};var Ge={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Is={nullValue:"NULL_VALUE"};function yn(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Eo(r)?4:Kf(r)?9007199254740991:Ao(r)?10:11:L()}function me(r,t){if(r===t)return!0;let e=yn(r);if(e!==yn(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return gi(r).isEqual(gi(t));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let a=be(i.timestampValue),u=be(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(i,s){return Qe(i.bytesValue).isEqual(Qe(s.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(i,s){return ct(i.geoPointValue.latitude)===ct(s.geoPointValue.latitude)&&ct(i.geoPointValue.longitude)===ct(s.geoPointValue.longitude)}(r,t);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ct(i.integerValue)===ct(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let a=ct(i.doubleValue),u=ct(s.doubleValue);return a===u?fi(a)===fi(u):isNaN(a)&&isNaN(u)}return!1}(r,t);case 9:return er(r.arrayValue.values||[],t.arrayValue.values||[],me);case 10:case 11:return function(i,s){let a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(Dd(a)!==Dd(u))return!1;for(let l in a)if(a.hasOwnProperty(l)&&(u[l]===void 0||!me(a[l],u[l])))return!1;return!0}(r,t);default:return L()}}function pi(r,t){return(r.values||[]).find(e=>me(e,t))!==void 0}function He(r,t){if(r===t)return 0;let e=yn(r),n=yn(t);if(e!==n)return z(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return z(r.booleanValue,t.booleanValue);case 2:return function(s,a){let u=ct(s.integerValue||s.doubleValue),l=ct(a.integerValue||a.doubleValue);return u<l?-1:u>l?1:u===l?0:isNaN(u)?isNaN(l)?0:-1:1}(r,t);case 3:return Vd(r.timestampValue,t.timestampValue);case 4:return Vd(gi(r),gi(t));case 5:return z(r.stringValue,t.stringValue);case 6:return function(s,a){let u=Qe(s),l=Qe(a);return u.compareTo(l)}(r.bytesValue,t.bytesValue);case 7:return function(s,a){let u=s.split("/"),l=a.split("/");for(let d=0;d<u.length&&d<l.length;d++){let f=z(u[d],l[d]);if(f!==0)return f}return z(u.length,l.length)}(r.referenceValue,t.referenceValue);case 8:return function(s,a){let u=z(ct(s.latitude),ct(a.latitude));return u!==0?u:z(ct(s.longitude),ct(a.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return Nd(r.arrayValue,t.arrayValue);case 10:return function(s,a){var u,l,d,f;let g=s.fields||{},_=a.fields||{},b=(u=g.value)===null||u===void 0?void 0:u.arrayValue,N=(l=_.value)===null||l===void 0?void 0:l.arrayValue,k=z(((d=b?.values)===null||d===void 0?void 0:d.length)||0,((f=N?.values)===null||f===void 0?void 0:f.length)||0);return k!==0?k:Nd(b,N)}(r.mapValue,t.mapValue);case 11:return function(s,a){if(s===Ge.mapValue&&a===Ge.mapValue)return 0;if(s===Ge.mapValue)return 1;if(a===Ge.mapValue)return-1;let u=s.fields||{},l=Object.keys(u),d=a.fields||{},f=Object.keys(d);l.sort(),f.sort();for(let g=0;g<l.length&&g<f.length;++g){let _=z(l[g],f[g]);if(_!==0)return _;let b=He(u[l[g]],d[f[g]]);if(b!==0)return b}return z(l.length,f.length)}(r.mapValue,t.mapValue);default:throw L()}}function Vd(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return z(r,t);let e=be(r),n=be(t),i=z(e.seconds,n.seconds);return i!==0?i:z(e.nanos,n.nanos)}function Nd(r,t){let e=r.values||[],n=t.values||[];for(let i=0;i<e.length&&i<n.length;++i){let s=He(e[i],n[i]);if(s)return s}return z(e.length,n.length)}function rr(r){return Ja(r)}function Ja(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(e){let n=be(e);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(e){return Qe(e).toBase64()}(r.bytesValue):"referenceValue"in r?function(e){return F.fromName(e).toString()}(r.referenceValue):"geoPointValue"in r?function(e){return`geo(${e.latitude},${e.longitude})`}(r.geoPointValue):"arrayValue"in r?function(e){let n="[",i=!0;for(let s of e.values||[])i?i=!1:n+=",",n+=Ja(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(e){let n=Object.keys(e.fields||{}).sort(),i="{",s=!0;for(let a of n)s?s=!1:i+=",",i+=`${a}:${Ja(e.fields[a])}`;return i+"}"}(r.mapValue):L()}function vn(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function Ya(r){return!!r&&"integerValue"in r}function _i(r){return!!r&&"arrayValue"in r}function kd(r){return!!r&&"nullValue"in r}function Md(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Ts(r){return!!r&&"mapValue"in r}function Ao(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="__vector__"}function ai(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let t={mapValue:{fields:{}}};return Rn(r.mapValue.fields,(e,n)=>t.mapValue.fields[e]=ai(n)),t}if(r.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=ai(r.arrayValue.values[e]);return t}return Object.assign({},r)}function Kf(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var $f={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function h_(r){return"nullValue"in r?Is:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?vn(We.empty(),F.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?Ao(r)?$f:{mapValue:{}}:L()}function d_(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?vn(We.empty(),F.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?$f:"mapValue"in r?Ao(r)?{mapValue:{}}:Ge:L()}function Od(r,t){let e=He(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?-1:!r.inclusive&&t.inclusive?1:0}function Fd(r,t){let e=He(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?1:!r.inclusive&&t.inclusive?-1:0}var Ot=class r{constructor(t){this.value=t}static empty(){return new r({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Ts(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=ai(e)}setAll(t){let e=_t.emptyPath(),n={},i=[];t.forEach((a,u)=>{if(!e.isImmediateParentOf(u)){let l=this.getFieldsMap(e);this.applyChanges(l,n,i),n={},i=[],e=u.popLast()}a?n[u.lastSegment()]=ai(a):i.push(u.lastSegment())});let s=this.getFieldsMap(e);this.applyChanges(s,n,i)}delete(t){let e=this.field(t.popLast());Ts(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return me(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];Ts(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){Rn(e,(i,s)=>t[i]=s);for(let i of n)delete t[i]}clone(){return new r(ai(this.value))}};function Qf(r){let t=[];return Rn(r.fields,(e,n)=>{let i=new _t([e]);if(Ts(n)){let s=Qf(n.mapValue).fields;if(s.length===0)t.push(i);else for(let a of s)t.push(i.child(a))}else t.push(i)}),new $t(t)}var Et=class r{constructor(t,e,n,i,s,a,u){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(t){return new r(t,0,U.min(),U.min(),U.min(),Ot.empty(),0)}static newFoundDocument(t,e,n,i){return new r(t,1,e,U.min(),n,i,0)}static newNoDocument(t,e){return new r(t,2,e,U.min(),U.min(),Ot.empty(),0)}static newUnknownDocument(t,e){return new r(t,3,e,U.min(),U.min(),Ot.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(U.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Ot.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Ot.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=U.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof r&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var ge=class{constructor(t,e){this.position=t,this.inclusive=e}};function Ld(r,t,e){let n=0;for(let i=0;i<r.position.length;i++){let s=t[i],a=r.position[i];if(s.field.isKeyField()?n=F.comparator(F.fromName(a.referenceValue),e.key):n=He(a,e.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function qd(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!me(r.position[e],t.position[e]))return!1;return!0}var wn=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function f_(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}var Vs=class{},W=class r extends Vs{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new tu(t,e,n):e==="array-contains"?new ru(t,n):e==="in"?new Ns(t,n):e==="not-in"?new iu(t,n):e==="array-contains-any"?new su(t,n):new r(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new eu(t,n):new nu(t,n)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(He(e,this.value)):e!==null&&yn(this.value)===yn(e)&&this.matchesComparison(He(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return L()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},et=class r extends Vs{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new r(t,e)}matches(t){return ir(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function ir(r){return r.op==="and"}function Xa(r){return r.op==="or"}function Uc(r){return Wf(r)&&ir(r)}function Wf(r){for(let t of r.filters)if(t instanceof et)return!1;return!0}function Za(r){if(r instanceof W)return r.field.canonicalString()+r.op.toString()+rr(r.value);if(Uc(r))return r.filters.map(t=>Za(t)).join(",");{let t=r.filters.map(e=>Za(e)).join(",");return`${r.op}(${t})`}}function Hf(r,t){return r instanceof W?function(n,i){return i instanceof W&&n.op===i.op&&n.field.isEqual(i.field)&&me(n.value,i.value)}(r,t):r instanceof et?function(n,i){return i instanceof et&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((s,a,u)=>s&&Hf(a,i.filters[u]),!0):!1}(r,t):void L()}function Jf(r,t){let e=r.filters.concat(t);return et.create(e,r.op)}function Yf(r){return r instanceof W?function(e){return`${e.field.canonicalString()} ${e.op} ${rr(e.value)}`}(r):r instanceof et?function(e){return e.op.toString()+" {"+e.getFilters().map(Yf).join(" ,")+"}"}(r):"Filter"}var tu=class extends W{constructor(t,e,n){super(t,e,n),this.key=F.fromName(n.referenceValue)}matches(t){let e=F.comparator(t.key,this.key);return this.matchesComparison(e)}},eu=class extends W{constructor(t,e){super(t,"in",e),this.keys=Xf("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},nu=class extends W{constructor(t,e){super(t,"not-in",e),this.keys=Xf("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function Xf(r,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(n=>F.fromName(n.referenceValue))}var ru=class extends W{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return _i(e)&&pi(e.arrayValue,this.value)}},Ns=class extends W{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&pi(this.value.arrayValue,e)}},iu=class extends W{constructor(t,e){super(t,"not-in",e)}matches(t){if(pi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&!pi(this.value.arrayValue,e)}},su=class extends W{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!_i(e)||!e.arrayValue.values)&&e.arrayValue.values.some(n=>pi(this.value.arrayValue,n))}};var ou=class{constructor(t,e=null,n=[],i=[],s=null,a=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.ue=null}};function au(r,t=null,e=[],n=[],i=null,s=null,a=null){return new ou(r,t,e,n,i,s,a)}function In(r){let t=O(r);if(t.ue===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(n=>Za(n)).join(","),e+="|ob:",e+=t.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),Ni(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(n=>rr(n)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(n=>rr(n)).join(",")),t.ue=e}return t.ue}function ki(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!f_(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!Hf(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!qd(r.startAt,t.startAt)&&qd(r.endAt,t.endAt)}function ks(r){return F.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function Ms(r,t){return r.filters.filter(e=>e instanceof W&&e.field.isEqual(t))}function Bd(r,t,e){let n=Is,i=!0;for(let s of Ms(r,t)){let a=Is,u=!0;switch(s.op){case"<":case"<=":a=h_(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,u=!1;break;case"!=":case"not-in":a=Is}Od({value:n,inclusive:i},{value:a,inclusive:u})<0&&(n=a,i=u)}if(e!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(t)){let a=e.position[s];Od({value:n,inclusive:i},{value:a,inclusive:e.inclusive})<0&&(n=a,i=e.inclusive);break}}return{value:n,inclusive:i}}function Ud(r,t,e){let n=Ge,i=!0;for(let s of Ms(r,t)){let a=Ge,u=!0;switch(s.op){case">=":case">":a=d_(s.value),u=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,u=!1;break;case"!=":case"not-in":a=Ge}Fd({value:n,inclusive:i},{value:a,inclusive:u})>0&&(n=a,i=u)}if(e!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(t)){let a=e.position[s];Fd({value:n,inclusive:i},{value:a,inclusive:e.inclusive})>0&&(n=a,i=e.inclusive);break}}return{value:n,inclusive:i}}var ee=class{constructor(t,e=null,n=[],i=[],s=null,a="F",u=null,l=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function Zf(r,t,e,n,i,s,a,u){return new ee(r,t,e,n,i,s,a,u)}function vr(r){return new ee(r)}function jd(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function jc(r){return r.collectionGroup!==null}function Zn(r){let t=O(r);if(t.ce===null){t.ce=[];let e=new Set;for(let s of t.explicitOrderBy)t.ce.push(s),e.add(s.field.canonicalString());let n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new it(_t.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.ce.push(new wn(s,n))}),e.has(_t.keyField().canonicalString())||t.ce.push(new wn(_t.keyField(),n))}return t.ce}function Bt(r){let t=O(r);return t.le||(t.le=m_(t,Zn(r))),t.le}function m_(r,t){if(r.limitType==="F")return au(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new wn(i.field,s)});let e=r.endAt?new ge(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new ge(r.startAt.position,r.startAt.inclusive):null;return au(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}function uu(r,t){let e=r.filters.concat([t]);return new ee(r.path,r.collectionGroup,r.explicitOrderBy.slice(),e,r.limit,r.limitType,r.startAt,r.endAt)}function Os(r,t,e){return new ee(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function Mi(r,t){return ki(Bt(r),Bt(t))&&r.limitType===t.limitType}function tm(r){return`${In(Bt(r))}|lt:${r.limitType}`}function Qn(r){return`Query(target=${function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(i=>Yf(i)).join(", ")}]`),Ni(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(i=>rr(i)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(i=>rr(i)).join(",")),`Target(${n})`}(Bt(r))}; limitType=${r.limitType})`}function Oi(r,t){return t.isFoundDocument()&&function(n,i){let s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):F.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,t)&&function(n,i){for(let s of Zn(n))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(r,t)&&function(n,i){for(let s of n.filters)if(!s.matches(i))return!1;return!0}(r,t)&&function(n,i){return!(n.startAt&&!function(a,u,l){let d=Ld(a,u,l);return a.inclusive?d<=0:d<0}(n.startAt,Zn(n),i)||n.endAt&&!function(a,u,l){let d=Ld(a,u,l);return a.inclusive?d>=0:d>0}(n.endAt,Zn(n),i))}(r,t)}function em(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function nm(r){return(t,e)=>{let n=!1;for(let i of Zn(r)){let s=g_(i,t,e);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}function g_(r,t,e){let n=r.field.isKeyField()?F.comparator(t.key,e.key):function(s,a,u){let l=a.data.field(s),d=u.data.field(s);return l!==null&&d!==null?He(l,d):L()}(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return L()}}var pe=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(let[i,s]of n)if(this.equalsFn(i,t))return s}}has(t){return this.get(t)!==void 0}set(t,e){let n=this.mapKeyFn(t),i=this.inner[n];if(i===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return void(i[s]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return n.length===1?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){Rn(this.inner,(e,n)=>{for(let[i,s]of n)t(i,s)})}isEmpty(){return Gf(this.inner)}size(){return this.innerSize}};var p_=new ut(F.comparator);function Gt(){return p_}var rm=new ut(F.comparator);function si(...r){let t=rm;for(let e of r)t=t.insert(e.key,e);return t}function im(r){let t=rm;return r.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function le(){return ui()}function sm(){return ui()}function ui(){return new pe(r=>r.toString(),(r,t)=>r.isEqual(t))}var __=new ut(F.comparator),y_=new it(F.comparator);function $(...r){let t=y_;for(let e of r)t=t.add(e);return t}var v_=new it(z);function Gc(){return v_}function zc(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:fi(t)?"-0":t}}function om(r){return{integerValue:""+r}}function am(r,t){return Lf(t)?om(t):zc(r,t)}var sr=class{constructor(){this._=void 0}};function w_(r,t,e){return r instanceof Je?function(i,s){let a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Eo(s)&&(s=Bc(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(e,t):r instanceof Se?cm(r,t):r instanceof Pe?lm(r,t):function(i,s){let a=um(i,s),u=Gd(a)+Gd(i.Pe);return Ya(a)&&Ya(i.Pe)?om(u):zc(i.serializer,u)}(r,t)}function I_(r,t,e){return r instanceof Se?cm(r,t):r instanceof Pe?lm(r,t):e}function um(r,t){return r instanceof Ye?function(n){return Ya(n)||function(s){return!!s&&"doubleValue"in s}(n)}(t)?t:{integerValue:0}:null}var Je=class extends sr{},Se=class extends sr{constructor(t){super(),this.elements=t}};function cm(r,t){let e=hm(t);for(let n of r.elements)e.some(i=>me(i,n))||e.push(n);return{arrayValue:{values:e}}}var Pe=class extends sr{constructor(t){super(),this.elements=t}};function lm(r,t){let e=hm(t);for(let n of r.elements)e=e.filter(i=>!me(i,n));return{arrayValue:{values:e}}}var Ye=class extends sr{constructor(t,e){super(),this.serializer=t,this.Pe=e}};function Gd(r){return ct(r.integerValue||r.doubleValue)}function hm(r){return _i(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}var Tn=class{constructor(t,e){this.field=t,this.transform=e}};function T_(r,t){return r.field.isEqual(t.field)&&function(n,i){return n instanceof Se&&i instanceof Se||n instanceof Pe&&i instanceof Pe?er(n.elements,i.elements,me):n instanceof Ye&&i instanceof Ye?me(n.Pe,i.Pe):n instanceof Je&&i instanceof Je}(r.transform,t.transform)}var cu=class{constructor(t,e){this.version=t,this.transformResults=e}},mt=class r{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new r}static exists(t){return new r(void 0,t)}static updateTime(t){return new r(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function Es(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}var or=class{};function dm(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new Ze(r.key,mt.none()):new Xe(r.key,r.data,mt.none());{let e=r.data,n=Ot.empty(),i=new it(_t.comparator);for(let s of t.fields)if(!i.has(s)){let a=e.field(s);a===null&&s.length>1&&(s=s.popLast(),a=e.field(s)),a===null?n.delete(s):n.set(s,a),i=i.add(s)}return new ne(r.key,n,new $t(i.toArray()),mt.none())}}function E_(r,t,e){r instanceof Xe?function(i,s,a){let u=i.value.clone(),l=Kd(i.fieldTransforms,s,a.transformResults);u.setAll(l),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,t,e):r instanceof ne?function(i,s,a){if(!Es(i.precondition,s))return void s.convertToUnknownDocument(a.version);let u=Kd(i.fieldTransforms,s,a.transformResults),l=s.data;l.setAll(fm(i)),l.setAll(u),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(r,t,e):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,t,e)}function ci(r,t,e,n){return r instanceof Xe?function(s,a,u,l){if(!Es(s.precondition,a))return u;let d=s.value.clone(),f=$d(s.fieldTransforms,l,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(r,t,e,n):r instanceof ne?function(s,a,u,l){if(!Es(s.precondition,a))return u;let d=$d(s.fieldTransforms,l,a),f=a.data;return f.setAll(fm(s)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(g=>g.field))}(r,t,e,n):function(s,a,u){return Es(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(r,t,e)}function A_(r,t){let e=null;for(let n of r.fieldTransforms){let i=t.data.field(n.field),s=um(n.transform,i||null);s!=null&&(e===null&&(e=Ot.empty()),e.set(n.field,s))}return e||null}function zd(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&er(n,i,(s,a)=>T_(s,a))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}var Xe=class extends or{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},ne=class extends or{constructor(t,e,n,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function fm(r){let t=new Map;return r.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let n=r.data.field(e);t.set(e,n)}}),t}function Kd(r,t,e){let n=new Map;q(r.length===e.length);for(let i=0;i<e.length;i++){let s=r[i],a=s.transform,u=t.data.field(s.field);n.set(s.field,I_(a,u,e[i]))}return n}function $d(r,t,e){let n=new Map;for(let i of r){let s=i.transform,a=e.data.field(i.field);n.set(i.field,w_(s,a,t))}return n}var Ze=class extends or{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},yi=class extends or{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var vi=class{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){let n=e.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(t.key)&&E_(s,t,n[i])}}applyToLocalView(t,e){for(let n of this.baseMutations)n.key.isEqual(t.key)&&(e=ci(n,t,e,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(t.key)&&(e=ci(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let n=sm();return this.mutations.forEach(i=>{let s=t.get(i.key),a=s.overlayedDocument,u=this.applyToLocalView(a,s.mutatedFields);u=e.has(i.key)?null:u;let l=dm(a,u);l!==null&&n.set(i.key,l),a.isValidDocument()||a.convertToNoDocument(U.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),$())}isEqual(t){return this.batchId===t.batchId&&er(this.mutations,t.mutations,(e,n)=>zd(e,n))&&er(this.baseMutations,t.baseMutations,(e,n)=>zd(e,n))}},lu=class r{constructor(t,e,n,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=i}static from(t,e,n){q(t.mutations.length===n.length);let i=function(){return __}(),s=t.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new r(t,e,n,i)}};var wi=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var hu=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var wt,J;function mm(r){switch(r){default:return L();case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0}}function gm(r){if(r===void 0)return pt("GRPC error has no .code"),C.UNKNOWN;switch(r){case wt.OK:return C.OK;case wt.CANCELLED:return C.CANCELLED;case wt.UNKNOWN:return C.UNKNOWN;case wt.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case wt.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case wt.INTERNAL:return C.INTERNAL;case wt.UNAVAILABLE:return C.UNAVAILABLE;case wt.UNAUTHENTICATED:return C.UNAUTHENTICATED;case wt.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case wt.NOT_FOUND:return C.NOT_FOUND;case wt.ALREADY_EXISTS:return C.ALREADY_EXISTS;case wt.PERMISSION_DENIED:return C.PERMISSION_DENIED;case wt.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case wt.ABORTED:return C.ABORTED;case wt.OUT_OF_RANGE:return C.OUT_OF_RANGE;case wt.UNIMPLEMENTED:return C.UNIMPLEMENTED;case wt.DATA_LOSS:return C.DATA_LOSS;default:return L()}}(J=wt||(wt={}))[J.OK=0]="OK",J[J.CANCELLED=1]="CANCELLED",J[J.UNKNOWN=2]="UNKNOWN",J[J.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",J[J.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",J[J.NOT_FOUND=5]="NOT_FOUND",J[J.ALREADY_EXISTS=6]="ALREADY_EXISTS",J[J.PERMISSION_DENIED=7]="PERMISSION_DENIED",J[J.UNAUTHENTICATED=16]="UNAUTHENTICATED",J[J.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",J[J.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",J[J.ABORTED=10]="ABORTED",J[J.OUT_OF_RANGE=11]="OUT_OF_RANGE",J[J.UNIMPLEMENTED=12]="UNIMPLEMENTED",J[J.INTERNAL=13]="INTERNAL",J[J.UNAVAILABLE=14]="UNAVAILABLE",J[J.DATA_LOSS=15]="DATA_LOSS";var Qd=null;function pm(){return new TextEncoder}var b_=new Le([4294967295,4294967295],0);function Wd(r){let t=pm().encode(r),e=new Sa;return e.update(t),new Uint8Array(e.digest())}function Hd(r){let t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Le([e,n],0),new Le([i,s],0)]}var du=class r{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new pn(`Invalid padding: ${e}`);if(n<0)throw new pn(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new pn(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new pn(`Invalid padding when bitmap length is 0: ${e}`);this.Ie=8*t.length-e,this.Te=Le.fromNumber(this.Ie)}Ee(t,e,n){let i=t.add(e.multiply(Le.fromNumber(n)));return i.compare(b_)===1&&(i=new Le([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Ie===0)return!1;let e=Wd(t),[n,i]=Hd(e);for(let s=0;s<this.hashCount;s++){let a=this.Ee(n,i,s);if(!this.de(a))return!1}return!0}static create(t,e,n){let i=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),a=new r(s,i,e);return n.forEach(u=>a.insert(u)),a}insert(t){if(this.Ie===0)return;let e=Wd(t),[n,i]=Hd(e);for(let s=0;s<this.hashCount;s++){let a=this.Ee(n,i,s);this.Ae(a)}}Ae(t){let e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}},pn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Ii=class r{constructor(t,e,n,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){let i=new Map;return i.set(t,Ti.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new r(U.min(),i,new ut(z),Gt(),$())}},Ti=class r{constructor(t,e,n,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new r(n,e,$(),$(),$())}};var tr=class{constructor(t,e,n,i){this.Re=t,this.removedTargetIds=e,this.key=n,this.Ve=i}},Fs=class{constructor(t,e){this.targetId=t,this.me=e}},Ls=class{constructor(t,e,n=vt.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}},qs=class{constructor(){this.fe=0,this.ge=Yd(),this.pe=vt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}ve(){let t=$(),e=$(),n=$();return this.ge.forEach((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:n=n.add(i);break;default:L()}}),new Ti(this.pe,this.ye,t,e,n)}Ce(){this.we=!1,this.ge=Yd()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,q(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},fu=class{constructor(t){this.Le=t,this.Be=new Map,this.ke=Gt(),this.qe=Jd(),this.Qe=new ut(z)}Ke(t){for(let e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.$e(e,t.Ve):this.Ue(e,t.key,t.Ve);for(let e of t.removedTargetIds)this.Ue(e,t.key,t.Ve)}We(t){this.forEachTarget(t,e=>{let n=this.Ge(e);switch(t.state){case 0:this.ze(e)&&n.De(t.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(t.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(e);break;case 3:this.ze(e)&&(n.Ne(),n.De(t.resumeToken));break;case 4:this.ze(e)&&(this.je(e),n.De(t.resumeToken));break;default:L()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Be.forEach((n,i)=>{this.ze(i)&&e(i)})}He(t){let e=t.targetId,n=t.me.count,i=this.Je(e);if(i){let s=i.target;if(ks(s))if(n===0){let a=new F(s.path);this.Ue(e,a,Et.newNoDocument(a,U.min()))}else q(n===1);else{let a=this.Ye(e);if(a!==n){let u=this.Ze(t),l=u?this.Xe(u,t,a):1;if(l!==0){this.je(e);let d=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(e,d)}Qd?.et(function(f,g,_,b,N){var k,V,j,G,B,Q;let H={localCacheCount:f,existenceFilterCount:g.count,databaseId:_.database,projectId:_.projectId},K=g.unchangedNames;return K&&(H.bloomFilter={applied:N===0,hashCount:(k=K?.hashCount)!==null&&k!==void 0?k:0,bitmapLength:(G=(j=(V=K?.bits)===null||V===void 0?void 0:V.bitmap)===null||j===void 0?void 0:j.length)!==null&&G!==void 0?G:0,padding:(Q=(B=K?.bits)===null||B===void 0?void 0:B.padding)!==null&&Q!==void 0?Q:0,mightContain:w=>{var p;return(p=b?.mightContain(w))!==null&&p!==void 0&&p}}),H}(a,t.me,this.Le.tt(),u,l))}}}}Ze(t){let e=t.me.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=e,a,u;try{a=Qe(n).toUint8Array()}catch(l){if(l instanceof Ds)return te("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{u=new du(a,i,s)}catch(l){return te(l instanceof pn?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return u.Ie===0?null:u}Xe(t,e,n){return e.me.count===n-this.nt(t,e.targetId)?0:2}nt(t,e){let n=this.Le.getRemoteKeysForTarget(e),i=0;return n.forEach(s=>{let a=this.Le.tt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;t.mightContain(u)||(this.Ue(e,s,null),i++)}),i}rt(t){let e=new Map;this.Be.forEach((s,a)=>{let u=this.Je(a);if(u){if(s.current&&ks(u.target)){let l=new F(u.target.path);this.ke.get(l)!==null||this.it(a,l)||this.Ue(a,l,Et.newNoDocument(l,t))}s.be&&(e.set(a,s.ve()),s.Ce())}});let n=$();this.qe.forEach((s,a)=>{let u=!0;a.forEachWhile(l=>{let d=this.Je(l);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(n=n.add(s))}),this.ke.forEach((s,a)=>a.setReadTime(t));let i=new Ii(t,e,this.Qe,this.ke,n);return this.ke=Gt(),this.qe=Jd(),this.Qe=new ut(z),i}$e(t,e){if(!this.ze(t))return;let n=this.it(t,e.key)?2:0;this.Ge(t).Fe(e.key,n),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t))}Ue(t,e,n){if(!this.ze(t))return;let i=this.Ge(t);this.it(t,e)?i.Fe(e,1):i.Me(e),this.qe=this.qe.insert(e,this.st(e).delete(t)),n&&(this.ke=this.ke.insert(e,n))}removeTarget(t){this.Be.delete(t)}Ye(t){let e=this.Ge(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.Ge(t).xe()}Ge(t){let e=this.Be.get(t);return e||(e=new qs,this.Be.set(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new it(z),this.qe=this.qe.insert(t,e)),e}ze(t){let e=this.Je(t)!==null;return e||D("WatchChangeAggregator","Detected inactive target",t),e}Je(t){let e=this.Be.get(t);return e&&e.Se?null:this.Le.ot(t)}je(t){this.Be.set(t,new qs),this.Le.getRemoteKeysForTarget(t).forEach(e=>{this.Ue(t,e,null)})}it(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}};function Jd(){return new ut(F.comparator)}function Yd(){return new ut(F.comparator)}var S_={asc:"ASCENDING",desc:"DESCENDING"},P_={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},C_={and:"AND",or:"OR"},mu=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function gu(r,t){return r.useProto3Json||Ni(t)?t:{value:t}}function ar(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function _m(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function R_(r,t){return ar(r,t.toTimestamp())}function yt(r){return q(!!r),U.fromTimestamp(function(e){let n=be(e);return new lt(n.seconds,n.nanos)}(r))}function Kc(r,t){return pu(r,t).canonicalString()}function pu(r,t){let e=function(i){return new Y(["projects",i.projectId,"databases",i.database])}(r).child("documents");return t===void 0?e:e.child(t)}function ym(r){let t=Y.fromString(r);return q(Cm(t)),t}function Ei(r,t){return Kc(r.databaseId,t.path)}function de(r,t){let e=ym(t);if(e.get(1)!==r.databaseId.projectId)throw new x(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new x(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new F(Im(e))}function vm(r,t){return Kc(r.databaseId,t)}function wm(r){let t=ym(r);return t.length===4?Y.emptyPath():Im(t)}function _u(r){return new Y(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Im(r){return q(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function Xd(r,t,e){return{name:Ei(r,t),fields:e.value.mapValue.fields}}function Tm(r,t,e){let n=de(r,t.name),i=yt(t.updateTime),s=t.createTime?yt(t.createTime):U.min(),a=new Ot({mapValue:{fields:t.fields}}),u=Et.newFoundDocument(n,i,s,a);return e&&u.setHasCommittedMutations(),e?u.setHasCommittedMutations():u}function x_(r,t){return"found"in t?function(n,i){q(!!i.found),i.found.name,i.found.updateTime;let s=de(n,i.found.name),a=yt(i.found.updateTime),u=i.found.createTime?yt(i.found.createTime):U.min(),l=new Ot({mapValue:{fields:i.found.fields}});return Et.newFoundDocument(s,a,u,l)}(r,t):"missing"in t?function(n,i){q(!!i.missing),q(!!i.readTime);let s=de(n,i.missing),a=yt(i.readTime);return Et.newNoDocument(s,a)}(r,t):L()}function D_(r,t){let e;if("targetChange"in t){t.targetChange;let n=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:L()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(d,f){return d.useProto3Json?(q(f===void 0||typeof f=="string"),vt.fromBase64String(f||"")):(q(f===void 0||f instanceof Buffer||f instanceof Uint8Array),vt.fromUint8Array(f||new Uint8Array))}(r,t.targetChange.resumeToken),a=t.targetChange.cause,u=a&&function(d){let f=d.code===void 0?C.UNKNOWN:gm(d.code);return new x(f,d.message||"")}(a);e=new Ls(n,i,s,u||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=de(r,n.document.name),s=yt(n.document.updateTime),a=n.document.createTime?yt(n.document.createTime):U.min(),u=new Ot({mapValue:{fields:n.document.fields}}),l=Et.newFoundDocument(i,s,a,u),d=n.targetIds||[],f=n.removedTargetIds||[];e=new tr(d,f,l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=de(r,n.document),s=n.readTime?yt(n.readTime):U.min(),a=Et.newNoDocument(i,s),u=n.removedTargetIds||[];e=new tr([],u,a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=de(r,n.document),s=n.removedTargetIds||[];e=new tr([],s,i,null)}else{if(!("filter"in t))return L();{t.filter;let n=t.filter;n.targetId;let{count:i=0,unchangedNames:s}=n,a=new hu(i,s),u=n.targetId;e=new Fs(u,a)}}return e}function Ai(r,t){let e;if(t instanceof Xe)e={update:Xd(r,t.key,t.value)};else if(t instanceof Ze)e={delete:Ei(r,t.key)};else if(t instanceof ne)e={update:Xd(r,t.key,t.data),updateMask:F_(t.fieldMask)};else{if(!(t instanceof yi))return L();e={verify:Ei(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(n=>function(s,a){let u=a.transform;if(u instanceof Je)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Se)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Pe)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Ye)return{fieldPath:a.field.canonicalString(),increment:u.Pe};throw L()}(0,n))),t.precondition.isNone||(e.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:R_(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:L()}(r,t.precondition)),e}function yu(r,t){let e=t.currentDocument?function(s){return s.updateTime!==void 0?mt.updateTime(yt(s.updateTime)):s.exists!==void 0?mt.exists(s.exists):mt.none()}(t.currentDocument):mt.none(),n=t.updateTransforms?t.updateTransforms.map(i=>function(a,u){let l=null;if("setToServerValue"in u)q(u.setToServerValue==="REQUEST_TIME"),l=new Je;else if("appendMissingElements"in u){let f=u.appendMissingElements.values||[];l=new Se(f)}else if("removeAllFromArray"in u){let f=u.removeAllFromArray.values||[];l=new Pe(f)}else"increment"in u?l=new Ye(a,u.increment):L();let d=_t.fromServerFormat(u.fieldPath);return new Tn(d,l)}(r,i)):[];if(t.update){t.update.name;let i=de(r,t.update.name),s=new Ot({mapValue:{fields:t.update.fields}});if(t.updateMask){let a=function(l){let d=l.fieldPaths||[];return new $t(d.map(f=>_t.fromServerFormat(f)))}(t.updateMask);return new ne(i,s,a,e,n)}return new Xe(i,s,e,n)}if(t.delete){let i=de(r,t.delete);return new Ze(i,e)}if(t.verify){let i=de(r,t.verify);return new yi(i,e)}return L()}function V_(r,t){return r&&r.length>0?(q(t!==void 0),r.map(e=>function(i,s){let a=i.updateTime?yt(i.updateTime):yt(s);return a.isEqual(U.min())&&(a=yt(s)),new cu(a,i.transformResults||[])}(e,t))):[]}function Em(r,t){return{documents:[vm(r,t.path)]}}function Am(r,t){let e={structuredQuery:{}},n=t.path,i;t.collectionGroup!==null?(i=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=vm(r,i);let s=function(d){if(d.length!==0)return Pm(et.create(d,"and"))}(t.filters);s&&(e.structuredQuery.where=s);let a=function(d){if(d.length!==0)return d.map(f=>function(_){return{field:Wn(_.field),direction:k_(_.dir)}}(f))}(t.orderBy);a&&(e.structuredQuery.orderBy=a);let u=gu(r,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(t.endAt)),{_t:e,parent:i}}function bm(r){let t=wm(r.parent),e=r.structuredQuery,n=e.from?e.from.length:0,i=null;if(n>0){q(n===1);let f=e.from[0];f.allDescendants?i=f.collectionId:t=t.child(f.collectionId)}let s=[];e.where&&(s=function(g){let _=Sm(g);return _ instanceof et&&Uc(_)?_.getFilters():[_]}(e.where));let a=[];e.orderBy&&(a=function(g){return g.map(_=>function(N){return new wn(Hn(N.field),function(V){switch(V){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(N.direction))}(_))}(e.orderBy));let u=null;e.limit&&(u=function(g){let _;return _=typeof g=="object"?g.value:g,Ni(_)?null:_}(e.limit));let l=null;e.startAt&&(l=function(g){let _=!!g.before,b=g.values||[];return new ge(b,_)}(e.startAt));let d=null;return e.endAt&&(d=function(g){let _=!g.before,b=g.values||[];return new ge(b,_)}(e.endAt)),Zf(t,i,a,s,u,"F",l,d)}function N_(r,t){let e=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L()}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Sm(r){return r.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let n=Hn(e.unaryFilter.field);return W.create(n,"==",{doubleValue:NaN});case"IS_NULL":let i=Hn(e.unaryFilter.field);return W.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Hn(e.unaryFilter.field);return W.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=Hn(e.unaryFilter.field);return W.create(a,"!=",{nullValue:"NULL_VALUE"});default:return L()}}(r):r.fieldFilter!==void 0?function(e){return W.create(Hn(e.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return L()}}(e.fieldFilter.op),e.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(e){return et.create(e.compositeFilter.filters.map(n=>Sm(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return L()}}(e.compositeFilter.op))}(r):L()}function k_(r){return S_[r]}function M_(r){return P_[r]}function O_(r){return C_[r]}function Wn(r){return{fieldPath:r.canonicalString()}}function Hn(r){return _t.fromServerFormat(r.fieldPath)}function Pm(r){return r instanceof W?function(e){if(e.op==="=="){if(Md(e.value))return{unaryFilter:{field:Wn(e.field),op:"IS_NAN"}};if(kd(e.value))return{unaryFilter:{field:Wn(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Md(e.value))return{unaryFilter:{field:Wn(e.field),op:"IS_NOT_NAN"}};if(kd(e.value))return{unaryFilter:{field:Wn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Wn(e.field),op:M_(e.op),value:e.value}}}(r):r instanceof et?function(e){let n=e.getFilters().map(i=>Pm(i));return n.length===1?n[0]:{compositeFilter:{op:O_(e.op),filters:n}}}(r):L()}function F_(r){let t=[];return r.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Cm(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var ur=class r{constructor(t,e,n,i,s=U.min(),a=U.min(),u=vt.EMPTY_BYTE_STRING,l=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=l}withSequenceNumber(t){return new r(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var Bs=class{constructor(t){this.ct=t}};function L_(r,t){let e;if(t.document)e=Tm(r.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let n=F.fromSegments(t.noDocument.path),i=An(t.noDocument.readTime);e=Et.newNoDocument(n,i),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return L();{let n=F.fromSegments(t.unknownDocument.path),i=An(t.unknownDocument.version);e=Et.newUnknownDocument(n,i)}}return t.readTime&&e.setReadTime(function(i){let s=new lt(i[0],i[1]);return U.fromTimestamp(s)}(t.readTime)),e}function Zd(r,t){let e=t.key,n={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:Us(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=function(s,a){return{name:Ei(s,a.key),fields:a.data.value.mapValue.fields,updateTime:ar(s,a.version.toTimestamp()),createTime:ar(s,a.createTime.toTimestamp())}}(r.ct,t);else if(t.isNoDocument())n.noDocument={path:e.path.toArray(),readTime:En(t.version)};else{if(!t.isUnknownDocument())return L();n.unknownDocument={path:e.path.toArray(),version:En(t.version)}}return n}function Us(r){let t=r.toTimestamp();return[t.seconds,t.nanoseconds]}function En(r){let t=r.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function An(r){let t=new lt(r.seconds,r.nanoseconds);return U.fromTimestamp(t)}function fn(r,t){let e=(t.baseMutations||[]).map(s=>yu(r.ct,s));for(let s=0;s<t.mutations.length-1;++s){let a=t.mutations[s];if(s+1<t.mutations.length&&t.mutations[s+1].transform!==void 0){let u=t.mutations[s+1];a.updateTransforms=u.transform.fieldTransforms,t.mutations.splice(s+1,1),++s}}let n=t.mutations.map(s=>yu(r.ct,s)),i=lt.fromMillis(t.localWriteTimeMs);return new vi(t.batchId,i,e,n)}function oi(r){let t=An(r.readTime),e=r.lastLimboFreeSnapshotVersion!==void 0?An(r.lastLimboFreeSnapshotVersion):U.min(),n;return n=function(s){return s.documents!==void 0}(r.query)?function(s){return q(s.documents.length===1),Bt(vr(wm(s.documents[0])))}(r.query):function(s){return Bt(bm(s))}(r.query),new ur(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,t,e,vt.fromBase64String(r.resumeToken))}function Rm(r,t){let e=En(t.snapshotVersion),n=En(t.lastLimboFreeSnapshotVersion),i;i=ks(t.target)?Em(r.ct,t.target):Am(r.ct,t.target)._t;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:In(t.target),readTime:e,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function $c(r){let t=bm({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Os(t,t.limit,"L"):t}function Va(r,t){return new wi(t.largestBatchId,yu(r.ct,t.overlayMutation))}function tf(r,t){let e=t.path.lastSegment();return[r,qt(t.path.popLast()),e]}function ef(r,t,e,n){return{indexId:r,uid:t,sequenceNumber:e,readTime:En(n.readTime),documentKey:qt(n.documentKey.path),largestBatchId:n.largestBatchId}}var vu=class{getBundleMetadata(t,e){return nf(t).get(e).next(n=>{if(n)return function(s){return{id:s.bundleId,createTime:An(s.createTime),version:s.version}}(n)})}saveBundleMetadata(t,e){return nf(t).put(function(i){return{bundleId:i.id,createTime:En(yt(i.createTime)),version:i.version}}(e))}getNamedQuery(t,e){return rf(t).get(e).next(n=>{if(n)return function(s){return{name:s.name,query:$c(s.bundledQuery),readTime:An(s.readTime)}}(n)})}saveNamedQuery(t,e){return rf(t).put(function(i){return{name:i.name,readTime:En(yt(i.readTime)),bundledQuery:i.bundledQuery}}(e))}};function nf(r){return bt(r,"bundles")}function rf(r){return bt(r,"namedQueries")}var js=class r{constructor(t,e){this.serializer=t,this.userId=e}static lt(t,e){let n=e.uid||"";return new r(t,n)}getOverlay(t,e){return ei(t).get(tf(this.userId,e)).next(n=>n?Va(this.serializer,n):null)}getOverlays(t,e){let n=le();return S.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(t,e,n){let i=[];return n.forEach((s,a)=>{let u=new wi(e,a);i.push(this.ht(t,u))}),S.waitFor(i)}removeOverlaysForBatchId(t,e,n){let i=new Set;e.forEach(a=>i.add(qt(a.getCollectionPath())));let s=[];return i.forEach(a=>{let u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);s.push(ei(t).j("collectionPathOverlayIndex",u))}),S.waitFor(s)}getOverlaysForCollection(t,e,n){let i=le(),s=qt(e),a=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return ei(t).U("collectionPathOverlayIndex",a).next(u=>{for(let l of u){let d=Va(this.serializer,l);i.set(d.getKey(),d)}return i})}getOverlaysForCollectionGroup(t,e,n,i){let s=le(),a,u=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return ei(t).J({index:"collectionGroupOverlayIndex",range:u},(l,d,f)=>{let g=Va(this.serializer,d);s.size()<i||g.largestBatchId===a?(s.set(g.getKey(),g),a=g.largestBatchId):f.done()}).next(()=>s)}ht(t,e){return ei(t).put(function(i,s,a){let[u,l,d]=tf(s,a.mutation.key);return{userId:s,collectionPath:l,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Ai(i.ct,a.mutation)}}(this.serializer,this.userId,e))}};function ei(r){return bt(r,"documentOverlays")}var wu=class{Pt(t){return bt(t,"globals")}getSessionToken(t){return this.Pt(t).get("sessionToken").next(e=>{let n=e?.value;return n?vt.fromUint8Array(n):vt.EMPTY_BYTE_STRING})}setSessionToken(t,e){return this.Pt(t).put({name:"sessionToken",value:e.toUint8Array()})}};var Ee=class{constructor(){}It(t,e){this.Tt(t,e),e.Et()}Tt(t,e){if("nullValue"in t)this.dt(e,5);else if("booleanValue"in t)this.dt(e,10),e.At(t.booleanValue?1:0);else if("integerValue"in t)this.dt(e,15),e.At(ct(t.integerValue));else if("doubleValue"in t){let n=ct(t.doubleValue);isNaN(n)?this.dt(e,13):(this.dt(e,15),fi(n)?e.At(0):e.At(n))}else if("timestampValue"in t){let n=t.timestampValue;this.dt(e,20),typeof n=="string"&&(n=be(n)),e.Rt(`${n.seconds||""}`),e.At(n.nanos||0)}else if("stringValue"in t)this.Vt(t.stringValue,e),this.ft(e);else if("bytesValue"in t)this.dt(e,30),e.gt(Qe(t.bytesValue)),this.ft(e);else if("referenceValue"in t)this.yt(t.referenceValue,e);else if("geoPointValue"in t){let n=t.geoPointValue;this.dt(e,45),e.At(n.latitude||0),e.At(n.longitude||0)}else"mapValue"in t?Kf(t)?this.dt(e,Number.MAX_SAFE_INTEGER):Ao(t)?this.wt(t.mapValue,e):(this.St(t.mapValue,e),this.ft(e)):"arrayValue"in t?(this.bt(t.arrayValue,e),this.ft(e)):L()}Vt(t,e){this.dt(e,25),this.Dt(t,e)}Dt(t,e){e.Rt(t)}St(t,e){let n=t.fields||{};this.dt(e,55);for(let i of Object.keys(n))this.Vt(i,e),this.Tt(n[i],e)}wt(t,e){var n,i;let s=t.fields||{};this.dt(e,53);let a="value",u=((i=(n=s[a].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.length)||0;this.dt(e,15),e.At(ct(u)),this.Vt(a,e),this.Tt(s[a],e)}bt(t,e){let n=t.values||[];this.dt(e,50);for(let i of n)this.Tt(i,e)}yt(t,e){this.dt(e,37),F.fromName(t).path.forEach(n=>{this.dt(e,60),this.Dt(n,e)})}dt(t,e){t.At(e)}ft(t){t.At(2)}};Ee.vt=new Ee;function q_(r){if(r===0)return 8;let t=0;return!(r>>4)&&(t+=4,r<<=4),!(r>>6)&&(t+=2,r<<=2),!(r>>7)&&(t+=1),t}function sf(r){let t=64-function(n){let i=0;for(let s=0;s<8;++s){let a=q_(255&n[s]);if(i+=a,a!==8)break}return i}(r);return Math.ceil(t/8)}var Iu=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Ft(n.value),n=e.next();this.Mt()}xt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Ot(n.value),n=e.next();this.Nt()}Lt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Ft(n);else if(n<2048)this.Ft(960|n>>>6),this.Ft(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Ft(480|n>>>12),this.Ft(128|63&n>>>6),this.Ft(128|63&n);else{let i=e.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Ot(n);else if(n<2048)this.Ot(960|n>>>6),this.Ot(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Ot(480|n>>>12),this.Ot(128|63&n>>>6),this.Ot(128|63&n);else{let i=e.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(t){let e=this.qt(t),n=sf(e);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let i=e.length-n;i<e.length;++i)this.buffer[this.position++]=255&e[i]}Kt(t){let e=this.qt(t),n=sf(e);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let i=e.length-n;i<e.length;++i)this.buffer[this.position++]=~(255&e[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(t){this.Qt(t.length),this.buffer.set(t,this.position),this.position+=t.length}zt(){return this.buffer.slice(0,this.position)}qt(t){let e=function(s){let a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(t),n=(128&e[0])!=0;e[0]^=n?255:128;for(let i=1;i<e.length;++i)e[i]^=n?255:0;return e}Ft(t){let e=255&t;e===0?(this.Ut(0),this.Ut(255)):e===255?(this.Ut(255),this.Ut(0)):this.Ut(e)}Ot(t){let e=255&t;e===0?(this.Gt(0),this.Gt(255)):e===255?(this.Gt(255),this.Gt(0)):this.Gt(t)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(t){this.Qt(1),this.buffer[this.position++]=t}Gt(t){this.Qt(1),this.buffer[this.position++]=~t}Qt(t){let e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);let i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}},Tu=class{constructor(t){this.jt=t}gt(t){this.jt.Ct(t)}Rt(t){this.jt.Lt(t)}At(t){this.jt.kt(t)}Et(){this.jt.$t()}},Eu=class{constructor(t){this.jt=t}gt(t){this.jt.xt(t)}Rt(t){this.jt.Bt(t)}At(t){this.jt.Kt(t)}Et(){this.jt.Wt()}},mn=class{constructor(){this.jt=new Iu,this.Ht=new Tu(this.jt),this.Jt=new Eu(this.jt)}seed(t){this.jt.seed(t)}Yt(t){return t===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}};var gn=class r{constructor(t,e,n,i){this.indexId=t,this.documentKey=e,this.arrayValue=n,this.directionalValue=i}Zt(){let t=this.directionalValue.length,e=t===0||this.directionalValue[t-1]===255?t+1:t,n=new Uint8Array(e);return n.set(this.directionalValue,0),e!==t?n.set([0],this.directionalValue.length):++n[n.length-1],new r(this.indexId,this.documentKey,this.arrayValue,n)}};function qe(r,t){let e=r.indexId-t.indexId;return e!==0?e:(e=of(r.arrayValue,t.arrayValue),e!==0?e:(e=of(r.directionalValue,t.directionalValue),e!==0?e:F.comparator(r.documentKey,t.documentKey)))}function of(r,t){for(let e=0;e<r.length&&e<t.length;++e){let n=r[e]-t[e];if(n!==0)return n}return r.length-t.length}var Gs=class{constructor(t){this.Xt=new it((e,n)=>_t.comparator(e.field,n.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.en=t.orderBy,this.tn=[];for(let e of t.filters){let n=e;n.isInequality()?this.Xt=this.Xt.add(n):this.tn.push(n)}}get nn(){return this.Xt.size>1}rn(t){if(q(t.collectionGroup===this.collectionId),this.nn)return!1;let e=za(t);if(e!==void 0&&!this.sn(e))return!1;let n=hn(t),i=new Set,s=0,a=0;for(;s<n.length&&this.sn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Xt.size>0){let u=this.Xt.getIterator().getNext();if(!i.has(u.field.canonicalString())){let l=n[s];if(!this.on(u,l)||!this._n(this.en[a++],l))return!1}++s}for(;s<n.length;++s){let u=n[s];if(a>=this.en.length||!this._n(this.en[a++],u))return!1}return!0}an(){if(this.nn)return null;let t=new it(_t.comparator),e=[];for(let n of this.tn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")e.push(new Xn(n.field,2));else{if(t.has(n.field))continue;t=t.add(n.field),e.push(new Xn(n.field,0))}for(let n of this.en)n.field.isKeyField()||t.has(n.field)||(t=t.add(n.field),e.push(new Xn(n.field,n.dir==="asc"?0:1)));return new nr(nr.UNKNOWN_ID,this.collectionId,e,di.empty())}sn(t){for(let e of this.tn)if(this.on(e,t))return!0;return!1}on(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let n=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===n}_n(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};function xm(r){var t,e;if(q(r instanceof W||r instanceof et),r instanceof W){if(r instanceof Ns){let i=((e=(t=r.value.arrayValue)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.map(s=>W.create(r.field,"==",s)))||[];return et.create(i,"or")}return r}let n=r.filters.map(i=>xm(i));return et.create(n,r.op)}function B_(r){if(r.getFilters().length===0)return[];let t=Su(xm(r));return q(Dm(t)),Au(t)||bu(t)?[t]:t.getFilters()}function Au(r){return r instanceof W}function bu(r){return r instanceof et&&Uc(r)}function Dm(r){return Au(r)||bu(r)||function(e){if(e instanceof et&&Xa(e)){for(let n of e.getFilters())if(!Au(n)&&!bu(n))return!1;return!0}return!1}(r)}function Su(r){if(q(r instanceof W||r instanceof et),r instanceof W)return r;if(r.filters.length===1)return Su(r.filters[0]);let t=r.filters.map(n=>Su(n)),e=et.create(t,r.op);return e=zs(e),Dm(e)?e:(q(e instanceof et),q(ir(e)),q(e.filters.length>1),e.filters.reduce((n,i)=>Qc(n,i)))}function Qc(r,t){let e;return q(r instanceof W||r instanceof et),q(t instanceof W||t instanceof et),e=r instanceof W?t instanceof W?function(i,s){return et.create([i,s],"and")}(r,t):af(r,t):t instanceof W?af(t,r):function(i,s){if(q(i.filters.length>0&&s.filters.length>0),ir(i)&&ir(s))return Jf(i,s.getFilters());let a=Xa(i)?i:s,u=Xa(i)?s:i,l=a.filters.map(d=>Qc(d,u));return et.create(l,"or")}(r,t),zs(e)}function af(r,t){if(ir(t))return Jf(t,r.getFilters());{let e=t.filters.map(n=>Qc(r,n));return et.create(e,"or")}}function zs(r){if(q(r instanceof W||r instanceof et),r instanceof W)return r;let t=r.getFilters();if(t.length===1)return zs(t[0]);if(Wf(r))return r;let e=t.map(i=>zs(i)),n=[];return e.forEach(i=>{i instanceof W?n.push(i):i instanceof et&&(i.op===r.op?n.push(...i.filters):n.push(i))}),n.length===1?n[0]:et.create(n,r.op)}var Pu=class{constructor(){this.un=new bi}addToCollectionParentIndex(t,e){return this.un.add(e),S.resolve()}getCollectionParents(t,e){return S.resolve(this.un.getEntries(e))}addFieldIndex(t,e){return S.resolve()}deleteFieldIndex(t,e){return S.resolve()}deleteAllFieldIndexes(t){return S.resolve()}createTargetIndexes(t,e){return S.resolve()}getDocumentsMatchingTarget(t,e){return S.resolve(null)}getIndexType(t,e){return S.resolve(0)}getFieldIndexes(t,e){return S.resolve([])}getNextCollectionGroupToUpdate(t){return S.resolve(null)}getMinOffset(t,e){return S.resolve(Ht.min())}getMinOffsetFromCollectionGroup(t,e){return S.resolve(Ht.min())}updateCollectionGroup(t,e,n){return S.resolve()}updateIndexEntries(t,e){return S.resolve()}},bi=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new it(Y.comparator),s=!i.has(n);return this.index[e]=i.add(n),s}has(t){let e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new it(Y.comparator)).toArray()}};var ps=new Uint8Array(0),Cu=class{constructor(t,e){this.databaseId=e,this.cn=new bi,this.ln=new pe(n=>In(n),(n,i)=>ki(n,i)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.cn.has(e)){let n=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(()=>{this.cn.add(e)});let s={collectionId:n,parent:qt(i)};return uf(t).put(s)}return S.resolve()}getCollectionParents(t,e){let n=[],i=IDBKeyRange.bound([e,""],[Nf(e),""],!1,!0);return uf(t).U(i).next(s=>{for(let a of s){if(a.collectionId!==e)break;n.push(ce(a.parent))}return n})}addFieldIndex(t,e){let n=ni(t),i=function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(e);delete i.indexId;let s=n.add(i);if(e.indexState){let a=zn(t);return s.next(u=>{a.put(ef(u,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return s.next()}deleteFieldIndex(t,e){let n=ni(t),i=zn(t),s=Gn(t);return n.delete(e.indexId).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=ni(t),n=Gn(t),i=zn(t);return e.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(t,e){return S.forEach(this.hn(e),n=>this.getIndexType(t,n).next(i=>{if(i===0||i===1){let s=new Gs(n).an();if(s!=null)return this.addFieldIndex(t,s)}}))}getDocumentsMatchingTarget(t,e){let n=Gn(t),i=!0,s=new Map;return S.forEach(this.hn(e),a=>this.Pn(t,a).next(u=>{i&&(i=!!u),s.set(a,u)})).next(()=>{if(i){let a=$(),u=[];return S.forEach(s,(l,d)=>{D("IndexedDbIndexManager",`Using index ${function(B){return`id=${B.indexId}|cg=${B.collectionGroup}|f=${B.fields.map(Q=>`${Q.fieldPath}:${Q.kind}`).join(",")}`}(l)} to execute ${In(e)}`);let f=function(B,Q){let H=za(Q);if(H===void 0)return null;for(let K of Ms(B,H.fieldPath))switch(K.op){case"array-contains-any":return K.value.arrayValue.values||[];case"array-contains":return[K.value]}return null}(d,l),g=function(B,Q){let H=new Map;for(let K of hn(Q))for(let w of Ms(B,K.fieldPath))switch(w.op){case"==":case"in":H.set(K.fieldPath.canonicalString(),w.value);break;case"not-in":case"!=":return H.set(K.fieldPath.canonicalString(),w.value),Array.from(H.values())}return null}(d,l),_=function(B,Q){let H=[],K=!0;for(let w of hn(Q)){let p=w.kind===0?Bd(B,w.fieldPath,B.startAt):Ud(B,w.fieldPath,B.startAt);H.push(p.value),K&&(K=p.inclusive)}return new ge(H,K)}(d,l),b=function(B,Q){let H=[],K=!0;for(let w of hn(Q)){let p=w.kind===0?Ud(B,w.fieldPath,B.endAt):Bd(B,w.fieldPath,B.endAt);H.push(p.value),K&&(K=p.inclusive)}return new ge(H,K)}(d,l),N=this.In(l,d,_),k=this.In(l,d,b),V=this.Tn(l,d,g),j=this.En(l.indexId,f,N,_.inclusive,k,b.inclusive,V);return S.forEach(j,G=>n.G(G,e.limit).next(B=>{B.forEach(Q=>{let H=F.fromSegments(Q.documentKey);a.has(H)||(a=a.add(H),u.push(H))})}))}).next(()=>u)}return S.resolve(null)})}hn(t){let e=this.ln.get(t);return e||(t.filters.length===0?e=[t]:e=B_(et.create(t.filters,"and")).map(n=>au(t.path,t.collectionGroup,t.orderBy,n.getFilters(),t.limit,t.startAt,t.endAt)),this.ln.set(t,e),e)}En(t,e,n,i,s,a,u){let l=(e!=null?e.length:1)*Math.max(n.length,s.length),d=l/(e!=null?e.length:1),f=[];for(let g=0;g<l;++g){let _=e?this.dn(e[g/d]):ps,b=this.An(t,_,n[g%d],i),N=this.Rn(t,_,s[g%d],a),k=u.map(V=>this.An(t,_,V,!0));f.push(...this.createRange(b,N,k))}return f}An(t,e,n,i){let s=new gn(t,F.empty(),e,n);return i?s:s.Zt()}Rn(t,e,n,i){let s=new gn(t,F.empty(),e,n);return i?s.Zt():s}Pn(t,e){let n=new Gs(e),i=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,i).next(s=>{let a=null;for(let u of s)n.rn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(t,e){let n=2,i=this.hn(e);return S.forEach(i,s=>this.Pn(t,s).next(a=>{a?n!==0&&a.fields.length<function(l){let d=new it(_t.comparator),f=!1;for(let g of l.filters)for(let _ of g.getFlattenedFilters())_.field.isKeyField()||(_.op==="array-contains"||_.op==="array-contains-any"?f=!0:d=d.add(_.field));for(let g of l.orderBy)g.field.isKeyField()||(d=d.add(g.field));return d.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>function(a){return a.limit!==null}(e)&&i.length>1&&n===2?1:n)}Vn(t,e){let n=new mn;for(let i of hn(t)){let s=e.data.field(i.fieldPath);if(s==null)return null;let a=n.Yt(i.kind);Ee.vt.It(s,a)}return n.zt()}dn(t){let e=new mn;return Ee.vt.It(t,e.Yt(0)),e.zt()}mn(t,e){let n=new mn;return Ee.vt.It(vn(this.databaseId,e),n.Yt(function(s){let a=hn(s);return a.length===0?0:a[a.length-1].kind}(t))),n.zt()}Tn(t,e,n){if(n===null)return[];let i=[];i.push(new mn);let s=0;for(let a of hn(t)){let u=n[s++];for(let l of i)if(this.fn(e,a.fieldPath)&&_i(u))i=this.gn(i,a,u);else{let d=l.Yt(a.kind);Ee.vt.It(u,d)}}return this.pn(i)}In(t,e,n){return this.Tn(t,e,n.position)}pn(t){let e=[];for(let n=0;n<t.length;++n)e[n]=t[n].zt();return e}gn(t,e,n){let i=[...t],s=[];for(let a of n.arrayValue.values||[])for(let u of i){let l=new mn;l.seed(u.zt()),Ee.vt.It(a,l.Yt(e.kind)),s.push(l)}return s}fn(t,e){return!!t.filters.find(n=>n instanceof W&&n.field.isEqual(e)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(t,e){let n=ni(t),i=zn(t);return(e?n.U("collectionGroupIndex",IDBKeyRange.bound(e,e)):n.U()).next(s=>{let a=[];return S.forEach(s,u=>i.get([u.indexId,this.uid]).next(l=>{a.push(function(f,g){let _=g?new di(g.sequenceNumber,new Ht(An(g.readTime),new F(ce(g.documentKey)),g.largestBatchId)):di.empty(),b=f.fields.map(([N,k])=>new Xn(_t.fromServerFormat(N),k));return new nr(f.indexId,f.collectionGroup,b,_)}(u,l))})).next(()=>a)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((n,i)=>{let s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:z(n.collectionGroup,i.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,n){let i=ni(t),s=zn(t);return this.yn(t).next(a=>i.U("collectionGroupIndex",IDBKeyRange.bound(e,e)).next(u=>S.forEach(u,l=>s.put(ef(l.indexId,this.uid,a,n)))))}updateIndexEntries(t,e){let n=new Map;return S.forEach(e,(i,s)=>{let a=n.get(i.collectionGroup);return(a?S.resolve(a):this.getFieldIndexes(t,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),S.forEach(u,l=>this.wn(t,i,l).next(d=>{let f=this.Sn(s,l);return d.isEqual(f)?S.resolve():this.bn(t,s,l,d,f)}))))})}Dn(t,e,n,i){return Gn(t).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(n,e.key),documentKey:e.key.path.toArray()})}vn(t,e,n,i){return Gn(t).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(n,e.key),e.key.path.toArray()])}wn(t,e,n){let i=Gn(t),s=new it(qe);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,e)])},(a,u)=>{s=s.add(new gn(n.indexId,e,u.arrayValue,u.directionalValue))}).next(()=>s)}Sn(t,e){let n=new it(qe),i=this.Vn(e,t);if(i==null)return n;let s=za(e);if(s!=null){let a=t.data.field(s.fieldPath);if(_i(a))for(let u of a.arrayValue.values||[])n=n.add(new gn(e.indexId,t.key,this.dn(u),i))}else n=n.add(new gn(e.indexId,t.key,ps,i));return n}bn(t,e,n,i,s){D("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);let a=[];return function(l,d,f,g,_){let b=l.getIterator(),N=d.getIterator(),k=jn(b),V=jn(N);for(;k||V;){let j=!1,G=!1;if(k&&V){let B=f(k,V);B<0?G=!0:B>0&&(j=!0)}else k!=null?G=!0:j=!0;j?(g(V),V=jn(N)):G?(_(k),k=jn(b)):(k=jn(b),V=jn(N))}}(i,s,qe,u=>{a.push(this.Dn(t,e,n,u))},u=>{a.push(this.vn(t,e,n,u))}),S.waitFor(a)}yn(t){let e=1;return zn(t).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),e=i.sequenceNumber+1}).next(()=>e)}createRange(t,e,n){n=n.sort((a,u)=>qe(a,u)).filter((a,u,l)=>!u||qe(a,l[u-1])!==0);let i=[];i.push(t);for(let a of n){let u=qe(a,t),l=qe(a,e);if(u===0)i[0]=t.Zt();else if(u>0&&l<0)i.push(a),i.push(a.Zt());else if(l>0)break}i.push(e);let s=[];for(let a=0;a<i.length;a+=2){if(this.Cn(i[a],i[a+1]))return[];let u=[i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,ps,[]],l=[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,ps,[]];s.push(IDBKeyRange.bound(u,l))}return s}Cn(t,e){return qe(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(cf)}getMinOffset(t,e){return S.mapArray(this.hn(e),n=>this.Pn(t,n).next(i=>i||L())).next(cf)}};function uf(r){return bt(r,"collectionParents")}function Gn(r){return bt(r,"indexEntries")}function ni(r){return bt(r,"indexConfiguration")}function zn(r){return bt(r,"indexState")}function cf(r){q(r.length!==0);let t=r[0].indexState.offset,e=t.largestBatchId;for(let n=1;n<r.length;n++){let i=r[n].indexState.offset;Fc(i,t)<0&&(t=i),e<i.largestBatchId&&(e=i.largestBatchId)}return new Ht(t.readTime,t.documentKey,e)}var lf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Wt=class r{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new r(t,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function Vm(r,t,e){let n=r.store("mutations"),i=r.store("documentMutations"),s=[],a=IDBKeyRange.only(e.batchId),u=0,l=n.J({range:a},(f,g,_)=>(u++,_.delete()));s.push(l.next(()=>{q(u===1)}));let d=[];for(let f of e.mutations){let g=qf(t,f.key.path,e.batchId);s.push(i.delete(g)),d.push(f.key)}return S.waitFor(s).next(()=>d)}function Ks(r){if(!r)return 0;let t;if(r.document)t=r.document;else if(r.unknownDocument)t=r.unknownDocument;else{if(!r.noDocument)throw L();t=r.noDocument}return JSON.stringify(t).length}Wt.DEFAULT_COLLECTION_PERCENTILE=10,Wt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Wt.DEFAULT=new Wt(41943040,Wt.DEFAULT_COLLECTION_PERCENTILE,Wt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Wt.DISABLED=new Wt(-1,0,0);var $s=class r{constructor(t,e,n,i){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=i,this.Fn={}}static lt(t,e,n,i){q(t.uid!=="");let s=t.isAuthenticated()?t.uid:"";return new r(s,e,n,i)}checkEmpty(t){let e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Be(t).J({index:"userMutationsIndex",range:n},(i,s,a)=>{e=!1,a.done()}).next(()=>e)}addMutationBatch(t,e,n,i){let s=Jn(t),a=Be(t);return a.add({}).next(u=>{q(typeof u=="number");let l=new vi(u,e,n,i),d=function(b,N,k){let V=k.baseMutations.map(G=>Ai(b.ct,G)),j=k.mutations.map(G=>Ai(b.ct,G));return{userId:N,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:V,mutations:j}}(this.serializer,this.userId,l),f=[],g=new it((_,b)=>z(_.canonicalString(),b.canonicalString()));for(let _ of i){let b=qf(this.userId,_.key.path,u);g=g.add(_.key.path.popLast()),f.push(a.put(d)),f.push(s.put(b,$p))}return g.forEach(_=>{f.push(this.indexManager.addToCollectionParentIndex(t,_))}),t.addOnCommittedListener(()=>{this.Fn[u]=l.keys()}),S.waitFor(f).next(()=>l)})}lookupMutationBatch(t,e){return Be(t).get(e).next(n=>n?(q(n.userId===this.userId),fn(this.serializer,n)):null)}Mn(t,e){return this.Fn[e]?S.resolve(this.Fn[e]):this.lookupMutationBatch(t,e).next(n=>{if(n){let i=n.keys();return this.Fn[e]=i,i}return null})}getNextMutationBatchAfterBatchId(t,e){let n=e+1,i=IDBKeyRange.lowerBound([this.userId,n]),s=null;return Be(t).J({index:"userMutationsIndex",range:i},(a,u,l)=>{u.userId===this.userId&&(q(u.batchId>=n),s=fn(this.serializer,u)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Be(t).J({index:"userMutationsIndex",range:e,reverse:!0},(i,s,a)=>{n=s.batchId,a.done()}).next(()=>n)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Be(t).U("userMutationsIndex",e).next(n=>n.map(i=>fn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(t,e){let n=ws(this.userId,e.path),i=IDBKeyRange.lowerBound(n),s=[];return Jn(t).J({range:i},(a,u,l)=>{let[d,f,g]=a,_=ce(f);if(d===this.userId&&e.path.isEqual(_))return Be(t).get(g).next(b=>{if(!b)throw L();q(b.userId===this.userId),s.push(fn(this.serializer,b))});l.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new it(z),i=[];return e.forEach(s=>{let a=ws(this.userId,s.path),u=IDBKeyRange.lowerBound(a),l=Jn(t).J({range:u},(d,f,g)=>{let[_,b,N]=d,k=ce(b);_===this.userId&&s.path.isEqual(k)?n=n.add(N):g.done()});i.push(l)}),S.waitFor(i).next(()=>this.xn(t,n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,i=n.length+1,s=ws(this.userId,n),a=IDBKeyRange.lowerBound(s),u=new it(z);return Jn(t).J({range:a},(l,d,f)=>{let[g,_,b]=l,N=ce(_);g===this.userId&&n.isPrefixOf(N)?N.length===i&&(u=u.add(b)):f.done()}).next(()=>this.xn(t,u))}xn(t,e){let n=[],i=[];return e.forEach(s=>{i.push(Be(t).get(s).next(a=>{if(a===null)throw L();q(a.userId===this.userId),n.push(fn(this.serializer,a))}))}),S.waitFor(i).next(()=>n)}removeMutationBatch(t,e){return Vm(t._e,this.userId,e).next(n=>(t.addOnCommittedListener(()=>{this.On(e.batchId)}),S.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(t,i))))}On(t){delete this.Fn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return S.resolve();let n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return Jn(t).J({range:n},(s,a,u)=>{if(s[0]===this.userId){let l=ce(s[1]);i.push(l)}else u.done()}).next(()=>{q(i.length===0)})})}containsKey(t,e){return Nm(t,this.userId,e)}Nn(t){return km(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function Nm(r,t,e){let n=ws(t,e.path),i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return Jn(r).J({range:s,H:!0},(u,l,d)=>{let[f,g,_]=u;f===t&&g===i&&(a=!0),d.done()}).next(()=>a)}function Be(r){return bt(r,"mutations")}function Jn(r){return bt(r,"documentMutations")}function km(r){return bt(r,"mutationQueues")}var cr=class r{constructor(t){this.Ln=t}next(){return this.Ln+=2,this.Ln}static Bn(){return new r(0)}static kn(){return new r(-1)}};var Ru=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.qn(t).next(e=>{let n=new cr(e.highestTargetId);return e.highestTargetId=n.next(),this.Qn(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.qn(t).next(e=>U.fromTimestamp(new lt(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.qn(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,n){return this.qn(t).next(i=>(i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),this.Qn(t,i)))}addTargetData(t,e){return this.Kn(t,e).next(()=>this.qn(t).next(n=>(n.targetCount+=1,this.$n(e,n),this.Qn(t,n))))}updateTargetData(t,e){return this.Kn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Kn(t).delete(e.targetId)).next(()=>this.qn(t)).next(n=>(q(n.targetCount>0),n.targetCount-=1,this.Qn(t,n)))}removeTargets(t,e,n){let i=0,s=[];return Kn(t).J((a,u)=>{let l=oi(u);l.sequenceNumber<=e&&n.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(t,l)))}).next(()=>S.waitFor(s)).next(()=>i)}forEachTarget(t,e){return Kn(t).J((n,i)=>{let s=oi(i);e(s)})}qn(t){return hf(t).get("targetGlobalKey").next(e=>(q(e!==null),e))}Qn(t,e){return hf(t).put("targetGlobalKey",e)}Kn(t,e){return Kn(t).put(Rm(this.serializer,e))}$n(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.qn(t).next(e=>e.targetCount)}getTargetData(t,e){let n=In(e),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),s=null;return Kn(t).J({range:i,index:"queryTargetsIndex"},(a,u,l)=>{let d=oi(u);ki(e,d.target)&&(s=d,l.done())}).next(()=>s)}addMatchingKeys(t,e,n){let i=[],s=Ue(t);return e.forEach(a=>{let u=qt(a.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(t,n,a))}),S.waitFor(i)}removeMatchingKeys(t,e,n){let i=Ue(t);return S.forEach(e,s=>{let a=qt(s.path);return S.waitFor([i.delete([n,a]),this.referenceDelegate.removeReference(t,n,s)])})}removeMatchingKeysForTargetId(t,e){let n=Ue(t),i=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(t,e){let n=IDBKeyRange.bound([e],[e+1],!1,!0),i=Ue(t),s=$();return i.J({range:n,H:!0},(a,u,l)=>{let d=ce(a[1]),f=new F(d);s=s.add(f)}).next(()=>s)}containsKey(t,e){let n=qt(e.path),i=IDBKeyRange.bound([n],[Nf(n)],!1,!0),s=0;return Ue(t).J({index:"documentTargetsIndex",H:!0,range:i},([a,u],l,d)=>{a!==0&&(s++,d.done())}).next(()=>s>0)}ot(t,e){return Kn(t).get(e).next(n=>n?oi(n):null)}};function Kn(r){return bt(r,"targets")}function hf(r){return bt(r,"targetGlobal")}function Ue(r){return bt(r,"targetDocuments")}function df([r,t],[e,n]){let i=z(r,e);return i===0?z(t,n):i}var xu=class{constructor(t){this.Un=t,this.buffer=new it(df),this.Wn=0}Gn(){return++this.Wn}zn(t){let e=[t,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(e);else{let n=this.buffer.last();df(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}},Du=class{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(t){D("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>R(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){nn(e)?D("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):yield en(e)}yield this.Hn(3e5)}))}},Vu=class{constructor(t,e){this.Jn=t,this.params=e}calculateTargetCount(t,e){return this.Jn.Yn(t).next(n=>Math.floor(e/100*n))}nthSequenceNumber(t,e){if(e===0)return S.resolve(Kt.oe);let n=new xu(e);return this.Jn.forEachTarget(t,i=>n.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(t,i=>n.zn(i))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.Jn.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.Jn.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(D("LruGarbageCollector","Garbage collection skipped; disabled"),S.resolve(lf)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),lf):this.Xn(t,e))}getCacheSize(t){return this.Jn.getCacheSize(t)}Xn(t,e){let n,i,s,a,u,l,d,f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,a=Date.now(),this.nthSequenceNumber(t,i))).next(g=>(n=g,u=Date.now(),this.removeTargets(t,n,e))).next(g=>(s=g,l=Date.now(),this.removeOrphanedDocuments(t,n))).next(g=>(d=Date.now(),$n()<=ue.DEBUG&&D("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${s} targets in `+(l-u)+`ms
	Removed ${g} documents in `+(d-l)+`ms
Total Duration: ${d-f}ms`),S.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:g})))}};function U_(r,t){return new Vu(r,t)}var Nu=class{constructor(t,e){this.db=t,this.garbageCollector=U_(this,e)}Yn(t){let e=this.er(t);return this.db.getTargetCache().getTargetCount(t).next(n=>e.next(i=>n+i))}er(t){let e=0;return this.Zn(t,n=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}Zn(t,e){return this.tr(t,(n,i)=>e(i))}addReference(t,e,n){return _s(t,n)}removeReference(t,e,n){return _s(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return _s(t,e)}nr(t,e){return function(i,s){let a=!1;return km(i).Y(u=>Nm(i,u,s).next(l=>(l&&(a=!0),S.resolve(!l)))).next(()=>a)}(t,e)}removeOrphanedDocuments(t,e){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.tr(t,(a,u)=>{if(u<=e){let l=this.nr(t,a).next(d=>{if(!d)return s++,n.getEntry(t,a).next(()=>(n.removeEntry(a,U.min()),Ue(t).delete(function(g){return[0,qt(g.path)]}(a))))});i.push(l)}}).next(()=>S.waitFor(i)).next(()=>n.apply(t)).next(()=>s)}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return _s(t,e)}tr(t,e){let n=Ue(t),i,s=Kt.oe;return n.J({index:"documentTargetsIndex"},([a,u],{path:l,sequenceNumber:d})=>{a===0?(s!==Kt.oe&&e(new F(ce(i)),s),s=d,i=l):s=Kt.oe}).next(()=>{s!==Kt.oe&&e(new F(ce(i)),s)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};function _s(r,t){return Ue(r).put(function(n,i){return{targetId:0,path:qt(n.path),sequenceNumber:i}}(t,r.currentSequenceNumber))}var Qs=class{constructor(){this.changes=new pe(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Et.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let n=this.changes.get(e);return n!==void 0?S.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var ku=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return ln(t).put(n)}removeEntry(t,e,n){return ln(t).delete(function(s,a){let u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Us(a),u[u.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.rr(t,n)))}getEntry(t,e){let n=Et.newInvalidDocument(e);return ln(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(ri(e))},(i,s)=>{n=this.ir(e,s)}).next(()=>n)}sr(t,e){let n={size:0,document:Et.newInvalidDocument(e)};return ln(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(ri(e))},(i,s)=>{n={document:this.ir(e,s),size:Ks(s)}}).next(()=>n)}getEntries(t,e){let n=Gt();return this._r(t,e,(i,s)=>{let a=this.ir(i,s);n=n.insert(i,a)}).next(()=>n)}ar(t,e){let n=Gt(),i=new ut(F.comparator);return this._r(t,e,(s,a)=>{let u=this.ir(s,a);n=n.insert(s,u),i=i.insert(s,Ks(a))}).next(()=>({documents:n,ur:i}))}_r(t,e,n){if(e.isEmpty())return S.resolve();let i=new it(gf);e.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound(ri(i.first()),ri(i.last())),a=i.getIterator(),u=a.getNext();return ln(t).J({index:"documentKeyIndex",range:s},(l,d,f)=>{let g=F.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;u&&gf(u,g)<0;)n(u,null),u=a.getNext();u&&u.isEqual(g)&&(n(u,d),u=a.hasNext()?a.getNext():null),u?f.$(ri(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(t,e,n,i,s){let a=e.path,u=[a.popLast().toArray(),a.lastSegment(),Us(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],l=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ln(t).U(IDBKeyRange.bound(u,l,!0)).next(d=>{s?.incrementDocumentReadCount(d.length);let f=Gt();for(let g of d){let _=this.ir(F.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);_.isFoundDocument()&&(Oi(e,_)||i.has(_.key))&&(f=f.insert(_.key,_))}return f})}getAllFromCollectionGroup(t,e,n,i){let s=Gt(),a=mf(e,n),u=mf(e,Ht.max());return ln(t).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,u,!0)},(l,d,f)=>{let g=this.ir(F.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);s=s.insert(g.key,g),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(t){return new Mu(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return ff(t).get("remoteDocumentGlobalKey").next(e=>(q(!!e),e))}rr(t,e){return ff(t).put("remoteDocumentGlobalKey",e)}ir(t,e){if(e){let n=L_(this.serializer,e);if(!(n.isNoDocument()&&n.version.isEqual(U.min())))return n}return Et.newInvalidDocument(t)}};function Mm(r){return new ku(r)}var Mu=class extends Qs{constructor(t,e){super(),this.cr=t,this.trackRemovals=e,this.lr=new pe(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(t){let e=[],n=0,i=new it((s,a)=>z(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{let u=this.lr.get(s);if(e.push(this.cr.removeEntry(t,s,u.readTime)),a.isValidDocument()){let l=Zd(this.cr.serializer,a);i=i.add(s.path.popLast());let d=Ks(l);n+=d-u.size,e.push(this.cr.addEntry(t,s,l))}else if(n-=u.size,this.trackRemovals){let l=Zd(this.cr.serializer,a.convertToNoDocument(U.min()));e.push(this.cr.addEntry(t,s,l))}}),i.forEach(s=>{e.push(this.cr.indexManager.addToCollectionParentIndex(t,s))}),e.push(this.cr.updateMetadata(t,n)),S.waitFor(e)}getFromCache(t,e){return this.cr.sr(t,e).next(n=>(this.lr.set(e,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(t,e){return this.cr.ar(t,e).next(({documents:n,ur:i})=>(i.forEach((s,a)=>{this.lr.set(s,{size:a,readTime:n.get(s).readTime})}),n))}};function ff(r){return bt(r,"remoteDocumentGlobal")}function ln(r){return bt(r,"remoteDocumentsV14")}function ri(r){let t=r.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function mf(r,t){let e=t.documentKey.path.toArray();return[r,Us(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function gf(r,t){let e=r.path.toArray(),n=t.path.toArray(),i=0;for(let s=0;s<e.length-2&&s<n.length-2;++s)if(i=z(e[s],n[s]),i)return i;return i=z(e.length,n.length),i||(i=z(e[e.length-2],n[n.length-2]),i||z(e[e.length-1],n[n.length-1]))}var Ou=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var Ws=class{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(i=>(n=i,this.remoteDocumentCache.getEntry(t,e))).next(i=>(n!==null&&ci(n.mutation,i,$t.empty(),lt.now()),i))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.getLocalViewOfDocuments(t,n,$()).next(()=>n))}getLocalViewOfDocuments(t,e,n=$()){let i=le();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,n).next(s=>{let a=si();return s.forEach((u,l)=>{a=a.insert(u,l.overlayedDocument)}),a}))}getOverlayedDocuments(t,e){let n=le();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,$()))}populateOverlays(t,e,n){let i=[];return n.forEach(s=>{e.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(t,i).next(s=>{s.forEach((a,u)=>{e.set(a,u)})})}computeViews(t,e,n,i){let s=Gt(),a=ui(),u=function(){return ui()}();return e.forEach((l,d)=>{let f=n.get(d.key);i.has(d.key)&&(f===void 0||f.mutation instanceof ne)?s=s.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),ci(f.mutation,d,f.mutation.getFieldMask(),lt.now())):a.set(d.key,$t.empty())}),this.recalculateAndSaveOverlays(t,s).next(l=>(l.forEach((d,f)=>a.set(d,f)),e.forEach((d,f)=>{var g;return u.set(d,new Ou(f,(g=a.get(d))!==null&&g!==void 0?g:null))}),u))}recalculateAndSaveOverlays(t,e){let n=ui(),i=new ut((a,u)=>a-u),s=$();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(a=>{for(let u of a)u.keys().forEach(l=>{let d=e.get(l);if(d===null)return;let f=n.get(l)||$t.empty();f=u.applyToLocalView(d,f),n.set(l,f);let g=(i.get(u.batchId)||$()).add(l);i=i.insert(u.batchId,g)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let l=u.getNext(),d=l.key,f=l.value,g=sm();f.forEach(_=>{if(!s.has(_)){let b=dm(e.get(_),n.get(_));b!==null&&g.set(_,b),s=s.add(_)}}),a.push(this.documentOverlayCache.saveOverlays(t,d,g))}return S.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.recalculateAndSaveOverlays(t,n))}getDocumentsMatchingQuery(t,e,n,i){return function(a){return F.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):jc(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,i):this.getDocumentsMatchingCollectionQuery(t,e,n,i)}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-s.size):S.resolve(le()),u=-1,l=s;return a.next(d=>S.forEach(d,(f,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),s.get(f)?S.resolve():this.remoteDocumentCache.getEntry(t,f).next(_=>{l=l.insert(f,_)}))).next(()=>this.populateOverlays(t,d,s)).next(()=>this.computeViews(t,l,d,$())).next(f=>({batchId:u,changes:im(f)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new F(e)).next(n=>{let i=si();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(t,e,n,i){let s=e.collectionGroup,a=si();return this.indexManager.getCollectionParents(t,s).next(u=>S.forEach(u,l=>{let d=function(g,_){return new ee(_,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)}(e,l.child(s));return this.getDocumentsMatchingCollectionQuery(t,d,n,i).next(f=>{f.forEach((g,_)=>{a=a.insert(g,_)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s,i))).next(a=>{s.forEach((l,d)=>{let f=d.getKey();a.get(f)===null&&(a=a.insert(f,Et.newInvalidDocument(f)))});let u=si();return a.forEach((l,d)=>{let f=s.get(l);f!==void 0&&ci(f.mutation,d,$t.empty(),lt.now()),Oi(e,d)&&(u=u.insert(l,d))}),u})}};var Fu=class{constructor(t){this.serializer=t,this.hr=new Map,this.Pr=new Map}getBundleMetadata(t,e){return S.resolve(this.hr.get(e))}saveBundleMetadata(t,e){return this.hr.set(e.id,function(i){return{id:i.id,version:i.version,createTime:yt(i.createTime)}}(e)),S.resolve()}getNamedQuery(t,e){return S.resolve(this.Pr.get(e))}saveNamedQuery(t,e){return this.Pr.set(e.name,function(i){return{name:i.name,query:$c(i.bundledQuery),readTime:yt(i.readTime)}}(e)),S.resolve()}};var Lu=class{constructor(){this.overlays=new ut(F.comparator),this.Ir=new Map}getOverlay(t,e){return S.resolve(this.overlays.get(e))}getOverlays(t,e){let n=le();return S.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((i,s)=>{this.ht(t,e,s)}),S.resolve()}removeOverlaysForBatchId(t,e,n){let i=this.Ir.get(n);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(n)),S.resolve()}getOverlaysForCollection(t,e,n){let i=le(),s=e.length+1,a=new F(e.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let l=u.getNext().value,d=l.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===s&&l.largestBatchId>n&&i.set(l.getKey(),l)}return S.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let s=new ut((d,f)=>d-f),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>n){let f=s.get(d.largestBatchId);f===null&&(f=le(),s=s.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}let u=le(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,f)=>u.set(d,f)),!(u.size()>=i)););return S.resolve(u)}ht(t,e,n){let i=this.overlays.get(n.key);if(i!==null){let a=this.Ir.get(i.largestBatchId).delete(n.key);this.Ir.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new wi(e,n));let s=this.Ir.get(e);s===void 0&&(s=$(),this.Ir.set(e,s)),this.Ir.set(e,s.add(n.key))}};var qu=class{constructor(){this.sessionToken=vt.EMPTY_BYTE_STRING}getSessionToken(t){return S.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,S.resolve()}};var Si=class{constructor(){this.Tr=new it(It.Er),this.dr=new it(It.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(t,e){let n=new It(t,e);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(t,e){t.forEach(n=>this.addReference(n,e))}removeReference(t,e){this.Vr(new It(t,e))}mr(t,e){t.forEach(n=>this.removeReference(n,e))}gr(t){let e=new F(new Y([])),n=new It(e,t),i=new It(e,t+1),s=[];return this.dr.forEachInRange([n,i],a=>{this.Vr(a),s.push(a.key)}),s}pr(){this.Tr.forEach(t=>this.Vr(t))}Vr(t){this.Tr=this.Tr.delete(t),this.dr=this.dr.delete(t)}yr(t){let e=new F(new Y([])),n=new It(e,t),i=new It(e,t+1),s=$();return this.dr.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(t){let e=new It(t,0),n=this.Tr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}},It=class{constructor(t,e){this.key=t,this.wr=e}static Er(t,e){return F.comparator(t.key,e.key)||z(t.wr,e.wr)}static Ar(t,e){return z(t.wr,e.wr)||F.comparator(t.key,e.key)}};var Bu=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.Sr=1,this.br=new it(It.Er)}checkEmpty(t){return S.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,i){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new vi(s,e,n,i);this.mutationQueue.push(a);for(let u of i)this.br=this.br.add(new It(u.key,s)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return S.resolve(a)}lookupMutationBatch(t,e){return S.resolve(this.Dr(e))}getNextMutationBatchAfterBatchId(t,e){let n=e+1,i=this.vr(n),s=i<0?0:i;return S.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return S.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(t){return S.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let n=new It(e,0),i=new It(e,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([n,i],a=>{let u=this.Dr(a.wr);s.push(u)}),S.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new it(z);return e.forEach(i=>{let s=new It(i,0),a=new It(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,a],u=>{n=n.add(u.wr)})}),S.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,i=n.length+1,s=n;F.isDocumentKey(s)||(s=s.child(""));let a=new It(new F(s),0),u=new it(z);return this.br.forEachWhile(l=>{let d=l.key.path;return!!n.isPrefixOf(d)&&(d.length===i&&(u=u.add(l.wr)),!0)},a),S.resolve(this.Cr(u))}Cr(t){let e=[];return t.forEach(n=>{let i=this.Dr(n);i!==null&&e.push(i)}),e}removeMutationBatch(t,e){q(this.Fr(e.batchId,"removed")===0),this.mutationQueue.shift();let n=this.br;return S.forEach(e.mutations,i=>{let s=new It(i.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.br=n})}On(t){}containsKey(t,e){let n=new It(e,0),i=this.br.firstAfterOrEqual(n);return S.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,S.resolve()}Fr(t,e){return this.vr(t)}vr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Dr(t){let e=this.vr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var Uu=class{constructor(t){this.Mr=t,this.docs=function(){return new ut(F.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let n=e.key,i=this.docs.get(n),s=i?i.size:0,a=this.Mr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let n=this.docs.get(e);return S.resolve(n?n.document.mutableCopy():Et.newInvalidDocument(e))}getEntries(t,e){let n=Gt();return e.forEach(i=>{let s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():Et.newInvalidDocument(i))}),S.resolve(n)}getDocumentsMatchingQuery(t,e,n,i){let s=Gt(),a=e.path,u=new F(a.child("")),l=this.docs.getIteratorFrom(u);for(;l.hasNext();){let{key:d,value:{document:f}}=l.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Fc(Mf(f),n)<=0||(i.has(f.key)||Oi(e,f))&&(s=s.insert(f.key,f.mutableCopy()))}return S.resolve(s)}getAllFromCollectionGroup(t,e,n,i){L()}Or(t,e){return S.forEach(this.docs,n=>e(n))}newChangeBuffer(t){return new ju(this)}getSize(t){return S.resolve(this.size)}},ju=class extends Qs{constructor(t){super(),this.cr=t}applyChanges(t){let e=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?e.push(this.cr.addEntry(t,i)):this.cr.removeEntry(n)}),S.waitFor(e)}getFromCache(t,e){return this.cr.getEntry(t,e)}getAllFromCache(t,e){return this.cr.getEntries(t,e)}};var Gu=class{constructor(t){this.persistence=t,this.Nr=new pe(e=>In(e),ki),this.lastRemoteSnapshotVersion=U.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Si,this.targetCount=0,this.kr=cr.Bn()}forEachTarget(t,e){return this.Nr.forEach((n,i)=>e(i)),S.resolve()}getLastRemoteSnapshotVersion(t){return S.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return S.resolve(this.Lr)}allocateTargetId(t){return this.highestTargetId=this.kr.next(),S.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Lr&&(this.Lr=e),S.resolve()}Kn(t){this.Nr.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.kr=new cr(e),this.highestTargetId=e),t.sequenceNumber>this.Lr&&(this.Lr=t.sequenceNumber)}addTargetData(t,e){return this.Kn(e),this.targetCount+=1,S.resolve()}updateTargetData(t,e){return this.Kn(e),S.resolve()}removeTargetData(t,e){return this.Nr.delete(e.target),this.Br.gr(e.targetId),this.targetCount-=1,S.resolve()}removeTargets(t,e,n){let i=0,s=[];return this.Nr.forEach((a,u)=>{u.sequenceNumber<=e&&n.get(u.targetId)===null&&(this.Nr.delete(a),s.push(this.removeMatchingKeysForTargetId(t,u.targetId)),i++)}),S.waitFor(s).next(()=>i)}getTargetCount(t){return S.resolve(this.targetCount)}getTargetData(t,e){let n=this.Nr.get(e)||null;return S.resolve(n)}addMatchingKeys(t,e,n){return this.Br.Rr(e,n),S.resolve()}removeMatchingKeys(t,e,n){this.Br.mr(e,n);let i=this.persistence.referenceDelegate,s=[];return i&&e.forEach(a=>{s.push(i.markPotentiallyOrphaned(t,a))}),S.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Br.gr(e),S.resolve()}getMatchingKeysForTargetId(t,e){let n=this.Br.yr(e);return S.resolve(n)}containsKey(t,e){return S.resolve(this.Br.containsKey(e))}};var Hs=class{constructor(t,e){this.qr={},this.overlays={},this.Qr=new Kt(0),this.Kr=!1,this.Kr=!0,this.$r=new qu,this.referenceDelegate=t(this),this.Ur=new Gu(this),this.indexManager=new Pu,this.remoteDocumentCache=function(i){return new Uu(i)}(n=>this.referenceDelegate.Wr(n)),this.serializer=new Bs(e),this.Gr=new Fu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Lu,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.qr[t.toKey()];return n||(n=new Bu(e,this.referenceDelegate),this.qr[t.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(t,e,n){D("MemoryPersistence","Starting transaction:",t);let i=new zu(this.Qr.next());return this.referenceDelegate.zr(),n(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(t,e){return S.or(Object.values(this.qr).map(n=>()=>n.containsKey(t,e)))}},zu=class extends Cs{constructor(t){super(),this.currentSequenceNumber=t}},Js=class r{constructor(t){this.persistence=t,this.Jr=new Si,this.Yr=null}static Zr(t){return new r(t)}get Xr(){if(this.Yr)return this.Yr;throw L()}addReference(t,e,n){return this.Jr.addReference(n,e),this.Xr.delete(n.toString()),S.resolve()}removeReference(t,e,n){return this.Jr.removeReference(n,e),this.Xr.add(n.toString()),S.resolve()}markPotentiallyOrphaned(t,e){return this.Xr.add(e.toString()),S.resolve()}removeTarget(t,e){this.Jr.gr(e.targetId).forEach(i=>this.Xr.add(i.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>n.removeTargetData(t,e))}zr(){this.Yr=new Set}jr(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return S.forEach(this.Xr,n=>{let i=F.fromPath(n);return this.ei(t,i).next(s=>{s||e.removeEntry(i,U.min())})}).next(()=>(this.Yr=null,e.apply(t)))}updateLimboDocument(t,e){return this.ei(t,e).next(n=>{n?this.Xr.delete(e.toString()):this.Xr.add(e.toString())})}Wr(t){return 0}ei(t,e){return S.or([()=>S.resolve(this.Jr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Hr(t,e)])}};var Ku=class{constructor(t){this.serializer=t}O(t,e,n,i){let s=new Rs("createOrUpgrade",e);n<1&&i>=1&&(function(l){l.createObjectStore("owner")}(t),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",xd,{unique:!0}),l.createObjectStore("documentMutations")}(t),pf(t),function(l){l.createObjectStore("remoteDocuments")}(t));let a=S.resolve();return n<3&&i>=3&&(n!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(t),pf(t)),a=a.next(()=>function(l){let d=l.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:U.min().toTimestamp(),targetCount:0};return d.put("targetGlobalKey",f)}(s))),n<4&&i>=4&&(n!==0&&(a=a.next(()=>function(l,d){return d.store("mutations").U().next(f=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",xd,{unique:!0});let g=d.store("mutations"),_=f.map(b=>g.put(b));return S.waitFor(_)})}(t,s))),a=a.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(t)})),n<5&&i>=5&&(a=a.next(()=>this.ni(s))),n<6&&i>=6&&(a=a.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(t),this.ri(s)))),n<7&&i>=7&&(a=a.next(()=>this.ii(s))),n<8&&i>=8&&(a=a.next(()=>this.si(t,s))),n<9&&i>=9&&(a=a.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(t)})),n<10&&i>=10&&(a=a.next(()=>this.oi(s))),n<11&&i>=11&&(a=a.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(t),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(t)})),n<12&&i>=12&&(a=a.next(()=>{(function(l){let d=l.createObjectStore("documentOverlays",{keyPath:i_});d.createIndex("collectionPathOverlayIndex",s_,{unique:!1}),d.createIndex("collectionGroupOverlayIndex",o_,{unique:!1})})(t)})),n<13&&i>=13&&(a=a.next(()=>function(l){let d=l.createObjectStore("remoteDocumentsV14",{keyPath:Qp});d.createIndex("documentKeyIndex",Wp),d.createIndex("collectionGroupIndex",Hp)}(t)).next(()=>this._i(t,s)).next(()=>t.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(a=a.next(()=>this.ai(t,s))),n<15&&i>=15&&(a=a.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:t_}).createIndex("sequenceNumberIndex",e_,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:n_}).createIndex("documentKeyIndex",r_,{unique:!1})}(t))),n<16&&i>=16&&(a=a.next(()=>{e.objectStore("indexState").clear()}).next(()=>{e.objectStore("indexEntries").clear()})),n<17&&i>=17&&(a=a.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(t)})),a}ri(t){let e=0;return t.store("remoteDocuments").J((n,i)=>{e+=Ks(i)}).next(()=>{let n={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ni(t){let e=t.store("mutationQueues"),n=t.store("mutations");return e.U().next(i=>S.forEach(i,s=>{let a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",a).next(u=>S.forEach(u,l=>{q(l.userId===s.userId);let d=fn(this.serializer,l);return Vm(t,s.userId,d).next(()=>{})}))}))}ii(t){let e=t.store("targetDocuments"),n=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return n.J((a,u)=>{let l=new Y(a),d=function(g){return[0,qt(g)]}(l);s.push(e.get(d).next(f=>f?S.resolve():(g=>e.put({targetId:0,path:qt(g),sequenceNumber:i.highestListenSequenceNumber}))(l)))}).next(()=>S.waitFor(s))})}si(t,e){t.createObjectStore("collectionParents",{keyPath:Zp});let n=e.store("collectionParents"),i=new bi,s=a=>{if(i.add(a)){let u=a.lastSegment(),l=a.popLast();return n.put({collectionId:u,parent:qt(l)})}};return e.store("remoteDocuments").J({H:!0},(a,u)=>{let l=new Y(a);return s(l.popLast())}).next(()=>e.store("documentMutations").J({H:!0},([a,u,l],d)=>{let f=ce(u);return s(f.popLast())}))}oi(t){let e=t.store("targets");return e.J((n,i)=>{let s=oi(i),a=Rm(this.serializer,s);return e.put(a)})}_i(t,e){let n=e.store("remoteDocuments"),i=[];return n.J((s,a)=>{let u=e.store("remoteDocumentsV14"),l=function(g){return g.document?new F(Y.fromString(g.document.name).popFirst(5)):g.noDocument?F.fromSegments(g.noDocument.path):g.unknownDocument?F.fromSegments(g.unknownDocument.path):L()}(a).path.toArray(),d={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};i.push(u.put(d))}).next(()=>S.waitFor(i))}ai(t,e){let n=e.store("mutations"),i=Mm(this.serializer),s=new Hs(Js.Zr,this.serializer.ct);return n.U().next(a=>{let u=new Map;return a.forEach(l=>{var d;let f=(d=u.get(l.userId))!==null&&d!==void 0?d:$();fn(this.serializer,l).keys().forEach(g=>f=f.add(g)),u.set(l.userId,f)}),S.forEach(u,(l,d)=>{let f=new Tt(d),g=js.lt(this.serializer,f),_=s.getIndexManager(f),b=$s.lt(f,this.serializer,_,s.referenceDelegate);return new Ws(i,b,g,_).recalculateAndSaveOverlaysForDocumentKeys(new mi(e,Kt.oe),l).next()})})}};function pf(r){r.createObjectStore("targetDocuments",{keyPath:Yp}).createIndex("documentTargetsIndex",Xp,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Jp,{unique:!0}),r.createObjectStore("targetGlobal")}var Na="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",$u=class r{constructor(t,e,n,i,s,a,u,l,d,f,g=17){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.ui=s,this.window=a,this.document=u,this.ci=d,this.li=f,this.hi=g,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=_=>Promise.resolve(),!r.D())throw new x(C.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Nu(this,i),this.Ai=e+"main",this.serializer=new Bs(l),this.Ri=new $e(this.Ai,this.hi,new Ku(this.serializer)),this.$r=new wu,this.Ur=new Ru(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Mm(this.serializer),this.Gr=new vu,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,f===!1&&pt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new x(C.FAILED_PRECONDITION,Na);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Ur.getHighestSequenceNumber(t))}).then(t=>{this.Qr=new Kt(t,this.ci)}).then(()=>{this.Kr=!0}).catch(t=>(this.Ri&&this.Ri.close(),Promise.reject(t)))}yi(t){return this.di=e=>R(this,null,function*(){if(this.started)return t(e)}),t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ri.L(e=>R(this,null,function*(){e.newVersion===null&&(yield t())}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.ui.enqueueAndForget(()=>R(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>ys(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(t).next(e=>{e||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(t)).next(e=>this.isPrimary&&!e?this.bi(t).next(()=>!1):!!e&&this.Di(t).next(()=>!0))).catch(t=>{if(nn(t))return D("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return D("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.ui.enqueueRetryable(()=>this.di(t)),this.isPrimary=t})}wi(t){return ii(t).get("owner").next(e=>S.resolve(this.vi(e)))}Ci(t){return ys(t).delete(this.clientId)}Fi(){return R(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let t=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let n=bt(e,"clientMetadata");return n.U().next(i=>{let s=this.xi(i,18e5),a=i.filter(u=>s.indexOf(u)===-1);return S.forEach(a,u=>n.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Vi)for(let e of t)this.Vi.removeItem(this.Oi(e.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(t){return!!t&&t.ownerId===this.clientId}Si(t){return this.li?S.resolve(!0):ii(t).get("owner").next(e=>{if(e!==null&&this.Mi(e.leaseTimestampMs,5e3)&&!this.Ni(e.ownerId)){if(this.vi(e)&&this.networkEnabled)return!0;if(!this.vi(e)){if(!e.allowTabSynchronization)throw new x(C.FAILED_PRECONDITION,Na);return!1}}return!(!this.networkEnabled||!this.inForeground)||ys(t).U().next(n=>this.xi(n,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,a=!this.inForeground&&i.inForeground,u=this.networkEnabled===i.networkEnabled;if(s||a&&u)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&D("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return R(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{let e=new mi(t,Kt.oe);return this.bi(e).next(()=>this.Ci(e))}),this.Ri.close(),this.qi()})}xi(t,e){return t.filter(n=>this.Mi(n.updateTimeMs,e)&&!this.Ni(n.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",t=>ys(t).U().next(e=>this.xi(e,18e5).map(n=>n.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(t,e){return $s.lt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new Cu(t,this.serializer.ct.databaseId)}getDocumentOverlayCache(t){return js.lt(this.serializer,t)}getBundleCache(){return this.Gr}runTransaction(t,e,n){D("IndexedDbPersistence","Starting transaction:",t);let i=e==="readonly"?"readonly":"readwrite",s=function(l){return l===17?c_:l===16?u_:l===15?qc:l===14?jf:l===13?Uf:l===12?a_:l===11?Bf:void L()}(this.hi),a;return this.Ri.runTransaction(t,i,s,u=>(a=new mi(u,this.Qr?this.Qr.next():Kt.oe),e==="readwrite-primary"?this.wi(a).next(l=>!!l||this.Si(a)).next(l=>{if(!l)throw pt(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new x(C.FAILED_PRECONDITION,Of);return n(a)}).next(l=>this.Di(a).next(()=>l)):this.Ki(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Ki(t){return ii(t).get("owner").next(e=>{if(e!==null&&this.Mi(e.leaseTimestampMs,5e3)&&!this.Ni(e.ownerId)&&!this.vi(e)&&!(this.li||this.allowTabSynchronization&&e.allowTabSynchronization))throw new x(C.FAILED_PRECONDITION,Na)})}Di(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ii(t).put("owner",e)}static D(){return $e.D()}bi(t){let e=ii(t);return e.get("owner").next(n=>this.vi(n)?(D("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):S.resolve())}Mi(t,e){let n=Date.now();return!(t<n-e)&&(!(t>n)||(pt(`Detected an update time that is in the future: ${t} > ${n}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var t;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.Pi=()=>{this.Li();let e=/(?:Version|Mobile)\/1[456]/;Ea()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(t){var e;try{let n=((e=this.Vi)===null||e===void 0?void 0:e.getItem(this.Oi(t)))!==null;return D("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return pt("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(t){pt("Failed to set zombie client id.",t)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};function ii(r){return bt(r,"owner")}function ys(r){return bt(r,"clientMetadata")}function Wc(r,t){let e=r.projectId;return r.isDefaultDatabase||(e+="."+r.database),"firestore/"+t+"/"+e+"/"}var Qu=class r{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.$i=n,this.Ui=i}static Wi(t,e){let n=$(),i=$();for(let s of e.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new r(t,e.fromCache,n,i)}};var Wu=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var Ys=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Ea()?8:Ff(Xr())>0?6:4}()}initialize(t,e){this.Ji=t,this.indexManager=e,this.Gi=!0}getDocumentsMatchingQuery(t,e,n,i){let s={result:null};return this.Yi(t,e).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.Zi(t,e,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new Wu;return this.Xi(t,e,a).next(u=>{if(s.result=u,this.zi)return this.es(t,e,a,u.size)})}).next(()=>s.result)}es(t,e,n,i){return n.documentReadCount<this.ji?($n()<=ue.DEBUG&&D("QueryEngine","SDK will not create cache indexes for query:",Qn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),S.resolve()):($n()<=ue.DEBUG&&D("QueryEngine","Query:",Qn(e),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Hi*i?($n()<=ue.DEBUG&&D("QueryEngine","The SDK decides to create cache indexes for query:",Qn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Bt(e))):S.resolve())}Yi(t,e){if(jd(e))return S.resolve(null);let n=Bt(e);return this.indexManager.getIndexType(t,n).next(i=>i===0?null:(e.limit!==null&&i===1&&(e=Os(e,null,"F"),n=Bt(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(s=>{let a=$(...s);return this.Ji.getDocuments(t,a).next(u=>this.indexManager.getMinOffset(t,n).next(l=>{let d=this.ts(e,u);return this.ns(e,d,a,l.readTime)?this.Yi(t,Os(e,null,"F")):this.rs(t,d,e,l)}))})))}Zi(t,e,n,i){return jd(e)||i.isEqual(U.min())?S.resolve(null):this.Ji.getDocuments(t,n).next(s=>{let a=this.ts(e,s);return this.ns(e,a,n,i)?S.resolve(null):($n()<=ue.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Qn(e)),this.rs(t,a,e,kf(i,-1)).next(u=>u))})}ts(t,e){let n=new it(nm(t));return e.forEach((i,s)=>{Oi(t,s)&&(n=n.add(s))}),n}ns(t,e,n,i){if(t.limit===null)return!1;if(n.size!==e.size)return!0;let s=t.limitType==="F"?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(t,e,n){return $n()<=ue.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",Qn(e)),this.Ji.getDocumentsMatchingQuery(t,e,Ht.min(),n)}rs(t,e,n,i){return this.Ji.getDocumentsMatchingQuery(t,n,i).next(s=>(e.forEach(a=>{s=s.insert(a.key,a)}),s))}};var Hu=class{constructor(t,e,n,i){this.persistence=t,this.ss=e,this.serializer=i,this.os=new ut(z),this._s=new pe(s=>In(s),ki),this.us=new Map,this.cs=t.getRemoteDocumentCache(),this.Ur=t.getTargetCache(),this.Gr=t.getBundleCache(),this.ls(n)}ls(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Ws(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.os))}};function Om(r,t,e,n){return new Hu(r,t,e,n)}function Fm(r,t){return R(this,null,function*(){let e=O(r);return yield e.persistence.runTransaction("Handle user change","readonly",n=>{let i;return e.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,e.ls(t),e.mutationQueue.getAllMutationBatches(n))).next(s=>{let a=[],u=[],l=$();for(let d of i){a.push(d.batchId);for(let f of d.mutations)l=l.add(f.key)}for(let d of s){u.push(d.batchId);for(let f of d.mutations)l=l.add(f.key)}return e.localDocuments.getDocuments(n,l).next(d=>({hs:d,removedBatchIds:a,addedBatchIds:u}))})})})}function j_(r,t){let e=O(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let i=t.batch.keys(),s=e.cs.newChangeBuffer({trackRemovals:!0});return function(u,l,d,f){let g=d.batch,_=g.keys(),b=S.resolve();return _.forEach(N=>{b=b.next(()=>f.getEntry(l,N)).next(k=>{let V=d.docVersions.get(N);q(V!==null),k.version.compareTo(V)<0&&(g.applyToRemoteDocument(k,d),k.isValidDocument()&&(k.setReadTime(d.commitVersion),f.addEntry(k)))})}),b.next(()=>u.mutationQueue.removeMutationBatch(l,g))}(e,n,t,s).next(()=>s.apply(n)).next(()=>e.mutationQueue.performConsistencyCheck(n)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(n,i,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let l=$();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(l=l.add(u.batch.mutations[d].key));return l}(t))).next(()=>e.localDocuments.getDocuments(n,i))})}function Lm(r){let t=O(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Ur.getLastRemoteSnapshotVersion(e))}function G_(r,t){let e=O(r),n=t.snapshotVersion,i=e.os;return e.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=e.cs.newChangeBuffer({trackRemovals:!0});i=e.os;let u=[];t.targetChanges.forEach((f,g)=>{let _=i.get(g);if(!_)return;u.push(e.Ur.removeMatchingKeys(s,f.removedDocuments,g).next(()=>e.Ur.addMatchingKeys(s,f.addedDocuments,g)));let b=_.withSequenceNumber(s.currentSequenceNumber);t.targetMismatches.get(g)!==null?b=b.withResumeToken(vt.EMPTY_BYTE_STRING,U.min()).withLastLimboFreeSnapshotVersion(U.min()):f.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(f.resumeToken,n)),i=i.insert(g,b),function(k,V,j){return k.resumeToken.approximateByteSize()===0||V.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=3e8?!0:j.addedDocuments.size+j.modifiedDocuments.size+j.removedDocuments.size>0}(_,b,f)&&u.push(e.Ur.updateTargetData(s,b))});let l=Gt(),d=$();if(t.documentUpdates.forEach(f=>{t.resolvedLimboDocuments.has(f)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(qm(s,a,t.documentUpdates).next(f=>{l=f.Ps,d=f.Is})),!n.isEqual(U.min())){let f=e.Ur.getLastRemoteSnapshotVersion(s).next(g=>e.Ur.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return S.waitFor(u).next(()=>a.apply(s)).next(()=>e.localDocuments.getLocalViewOfDocuments(s,l,d)).next(()=>l)}).then(s=>(e.os=i,s))}function qm(r,t,e){let n=$(),i=$();return e.forEach(s=>n=n.add(s)),t.getEntries(r,n).next(s=>{let a=Gt();return e.forEach((u,l)=>{let d=s.get(u);l.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(u)),l.isNoDocument()&&l.version.isEqual(U.min())?(t.removeEntry(u,l.readTime),a=a.insert(u,l)):!d.isValidDocument()||l.version.compareTo(d.version)>0||l.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(l),a=a.insert(u,l)):D("LocalStore","Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",l.version)}),{Ps:a,Is:i}})}function z_(r,t){let e=O(r);return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}function lr(r,t){let e=O(r);return e.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return e.Ur.getTargetData(n,t).next(s=>s?(i=s,S.resolve(i)):e.Ur.allocateTargetId(n).next(a=>(i=new ur(t,a,"TargetPurposeListen",n.currentSequenceNumber),e.Ur.addTargetData(n,i).next(()=>i))))}).then(n=>{let i=e.os.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(e.os=e.os.insert(n.targetId,n),e._s.set(t,n.targetId)),n})}function hr(r,t,e){return R(this,null,function*(){let n=O(r),i=n.os.get(t),s=e?"readwrite":"readwrite-primary";try{e||(yield n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!nn(a))throw a;D("LocalStore",`Failed to update sequence numbers for target ${t}: ${a}`)}n.os=n.os.remove(t),n._s.delete(i.target)})}function Xs(r,t,e){let n=O(r),i=U.min(),s=$();return n.persistence.runTransaction("Execute query","readwrite",a=>function(l,d,f){let g=O(l),_=g._s.get(f);return _!==void 0?S.resolve(g.os.get(_)):g.Ur.getTargetData(d,f)}(n,a,Bt(t)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(a,u.targetId).next(l=>{s=l})}).next(()=>n.ss.getDocumentsMatchingQuery(a,t,e?i:U.min(),e?s:$())).next(u=>(jm(n,em(t),u),{documents:u,Ts:s})))}function Bm(r,t){let e=O(r),n=O(e.Ur),i=e.os.get(t);return i?Promise.resolve(i.target):e.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,t).next(a=>a?a.target:null))}function Um(r,t){let e=O(r),n=e.us.get(t)||U.min();return e.persistence.runTransaction("Get new document changes","readonly",i=>e.cs.getAllFromCollectionGroup(i,t,kf(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(jm(e,t,i),i))}function jm(r,t,e){let n=r.us.get(t)||U.min();e.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.us.set(t,n)}function K_(r,t,e,n){return R(this,null,function*(){let i=O(r),s=$(),a=Gt();for(let d of e){let f=t.Es(d.metadata.name);d.document&&(s=s.add(f));let g=t.ds(d);g.setReadTime(t.As(d.metadata.readTime)),a=a.insert(f,g)}let u=i.cs.newChangeBuffer({trackRemovals:!0}),l=yield lr(i,function(f){return Bt(vr(Y.fromString(`__bundle__/docs/${f}`)))}(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",d=>qm(d,u,a).next(f=>(u.apply(d),f)).next(f=>i.Ur.removeMatchingKeysForTargetId(d,l.targetId).next(()=>i.Ur.addMatchingKeys(d,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(d,f.Ps,f.Is)).next(()=>f.Ps)))})}function $_(n,i){return R(this,arguments,function*(r,t,e=$()){let s=yield lr(r,Bt($c(t.bundledQuery))),a=O(r);return a.persistence.runTransaction("Save named query","readwrite",u=>{let l=yt(t.readTime);if(s.snapshotVersion.compareTo(l)>=0)return a.Gr.saveNamedQuery(u,t);let d=s.withResumeToken(vt.EMPTY_BYTE_STRING,l);return a.os=a.os.insert(d.targetId,d),a.Ur.updateTargetData(u,d).next(()=>a.Ur.removeMatchingKeysForTargetId(u,s.targetId)).next(()=>a.Ur.addMatchingKeys(u,e,s.targetId)).next(()=>a.Gr.saveNamedQuery(u,t))})})}function _f(r,t){return`firestore_clients_${r}_${t}`}function yf(r,t,e){let n=`firestore_mutations_${r}_${e}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}function ka(r,t){return`firestore_targets_${r}_${t}`}var Zs=class r{constructor(t,e,n,i){this.user=t,this.batchId=e,this.state=n,this.error=i}static Rs(t,e,n){let i=JSON.parse(n),s,a=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return a&&i.error&&(a=typeof i.error.message=="string"&&typeof i.error.code=="string",a&&(s=new x(i.error.code,i.error.message))),a?new r(t,e,i.state,s):(pt("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}Vs(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},li=class r{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Rs(t,e){let n=JSON.parse(e),i,s=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return s&&n.error&&(s=typeof n.error.message=="string"&&typeof n.error.code=="string",s&&(i=new x(n.error.code,n.error.message))),s?new r(t,n.state,i):(pt("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Vs(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},to=class r{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Rs(t,e){let n=JSON.parse(e),i=typeof n=="object"&&n.activeTargetIds instanceof Array,s=Gc();for(let a=0;i&&a<n.activeTargetIds.length;++a)i=Lf(n.activeTargetIds[a]),s=s.add(n.activeTargetIds[a]);return i?new r(t,s):(pt("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}},Ju=class r{constructor(t,e){this.clientId=t,this.onlineState=e}static Rs(t){let e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new r(e.clientId,e.onlineState):(pt("SharedClientState",`Failed to parse online state: ${t}`),null)}},Pi=class{constructor(){this.activeTargetIds=Gc()}fs(t){this.activeTargetIds=this.activeTargetIds.add(t)}gs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Vs(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}},hi=class{constructor(t,e,n,i,s){this.window=t,this.ui=e,this.persistenceKey=n,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new ut(z),this.started=!1,this.bs=[];let a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=_f(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Pi),this.Cs=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(t){return!(!t||!t.localStorage)}start(){return R(this,null,function*(){let t=yield this.syncEngine.Qi();for(let n of t){if(n===this.ps)continue;let i=this.getItem(_f(this.persistenceKey,n));if(i){let s=to.Rs(n,i);s&&(this.Ss=this.Ss.insert(s.clientId,s))}}this.Ns();let e=this.storage.getItem(this.xs);if(e){let n=this.Ls(e);n&&this.Bs(n)}for(let n of this.bs)this.ws(n);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(t){this.setItem(this.vs,JSON.stringify(t))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(t){let e=!1;return this.Ss.forEach((n,i)=>{i.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.qs(t,"pending")}updateMutationState(t,e,n){this.qs(t,e,n),this.Qs(t)}addLocalQueryTarget(t,e=!0){let n="not-current";if(this.isActiveQueryTarget(t)){let i=this.storage.getItem(ka(this.persistenceKey,t));if(i){let s=li.Rs(t,i);s&&(n=s.state)}}return e&&this.Ks.fs(t),this.Ns(),n}removeLocalQueryTarget(t){this.Ks.gs(t),this.Ns()}isLocalQueryTarget(t){return this.Ks.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(ka(this.persistenceKey,t))}updateQueryState(t,e,n){this.$s(t,e,n)}handleUserChange(t,e,n){e.forEach(i=>{this.Qs(i)}),this.currentUser=t,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(t){this.Us(t)}notifyBundleLoaded(t){this.Ws(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(t){let e=this.storage.getItem(t);return D("SharedClientState","READ",t,e),e}setItem(t,e){D("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){D("SharedClientState","REMOVE",t),this.storage.removeItem(t)}ws(t){let e=t;if(e.storageArea===this.storage){if(D("SharedClientState","EVENT",e.key,e.newValue),e.key===this.Ds)return void pt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(()=>R(this,null,function*(){if(this.started){if(e.key!==null){if(this.Cs.test(e.key)){if(e.newValue==null){let n=this.Gs(e.key);return this.zs(n,null)}{let n=this.js(e.key,e.newValue);if(n)return this.zs(n.clientId,n)}}else if(this.Fs.test(e.key)){if(e.newValue!==null){let n=this.Hs(e.key,e.newValue);if(n)return this.Js(n)}}else if(this.Ms.test(e.key)){if(e.newValue!==null){let n=this.Ys(e.key,e.newValue);if(n)return this.Zs(n)}}else if(e.key===this.xs){if(e.newValue!==null){let n=this.Ls(e.newValue);if(n)return this.Bs(n)}}else if(e.key===this.vs){let n=function(s){let a=Kt.oe;if(s!=null)try{let u=JSON.parse(s);q(typeof u=="number"),a=u}catch(u){pt("SharedClientState","Failed to read sequence number from WebStorage",u)}return a}(e.newValue);n!==Kt.oe&&this.sequenceNumberHandler(n)}else if(e.key===this.Os){let n=this.Xs(e.newValue);yield Promise.all(n.map(i=>this.syncEngine.eo(i)))}}}else this.bs.push(e)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(t,e,n){let i=new Zs(this.currentUser,t,e,n),s=yf(this.persistenceKey,this.currentUser,t);this.setItem(s,i.Vs())}Qs(t){let e=yf(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Us(t){let e={clientId:this.ps,onlineState:t};this.storage.setItem(this.xs,JSON.stringify(e))}$s(t,e,n){let i=ka(this.persistenceKey,t),s=new li(t,e,n);this.setItem(i,s.Vs())}Ws(t){let e=JSON.stringify(Array.from(t));this.setItem(this.Os,e)}Gs(t){let e=this.Cs.exec(t);return e?e[1]:null}js(t,e){let n=this.Gs(t);return to.Rs(n,e)}Hs(t,e){let n=this.Fs.exec(t),i=Number(n[1]),s=n[2]!==void 0?n[2]:null;return Zs.Rs(new Tt(s),i,e)}Ys(t,e){let n=this.Ms.exec(t),i=Number(n[1]);return li.Rs(i,e)}Ls(t){return Ju.Rs(t)}Xs(t){return JSON.parse(t)}Js(t){return R(this,null,function*(){if(t.user.uid===this.currentUser.uid)return this.syncEngine.no(t.batchId,t.state,t.error);D("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)})}Zs(t){return this.syncEngine.ro(t.targetId,t.state,t.error)}zs(t,e){let n=e?this.Ss.insert(t,e):this.Ss.remove(t),i=this.ks(this.Ss),s=this.ks(n),a=[],u=[];return s.forEach(l=>{i.has(l)||a.push(l)}),i.forEach(l=>{s.has(l)||u.push(l)}),this.syncEngine.io(a,u).then(()=>{this.Ss=n})}Bs(t){this.Ss.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}ks(t){let e=Gc();return t.forEach((n,i)=>{e=e.unionWith(i.activeTargetIds)}),e}},eo=class{constructor(){this.so=new Pi,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.so.fs(t),this.oo[t]||"not-current"}updateQueryState(t,e,n){this.oo[t]=e}removeLocalQueryTarget(t){this.so.gs(t)}isLocalQueryTarget(t){return this.so.activeTargetIds.has(t)}clearQueryState(t){delete this.oo[t]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(t){return this.so.activeTargetIds.has(t)}start(){return this.so=new Pi,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Yu=class{_o(t){}shutdown(){}};var no=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(t){this.ho.push(t)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){D("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.ho)t(0)}lo(){D("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.ho)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var vs=null;function Ma(){return vs===null?vs=function(){return 268435456+Math.round(2147483648*Math.random())}():vs++,"0x"+vs.toString(16)}var Q_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Xu=class{constructor(t){this.Io=t.Io,this.To=t.To}Eo(t){this.Ao=t}Ro(t){this.Vo=t}mo(t){this.fo=t}onMessage(t){this.po=t}close(){this.To()}send(t){this.Io(t)}yo(){this.Ao()}wo(){this.Vo()}So(t){this.fo(t)}bo(t){this.po(t)}};var Mt="WebChannelConnection",Zu=class extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let n=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+e.host,this.vo=`projects/${i}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(e,n,i,s,a){let u=Ma(),l=this.xo(e,n.toUriEncodedString());D("RestConnection",`Sending RPC '${e}' ${u}:`,l,i);let d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,s,a),this.No(e,l,d,i).then(f=>(D("RestConnection",`Received RPC '${e}' ${u}: `,f),f),f=>{throw te("RestConnection",`RPC '${e}' ${u} failed with error: `,f,"url: ",l,"request:",i),f})}Lo(e,n,i,s,a,u){return this.Mo(e,n,i,s,a)}Oo(e,n,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+yr}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,a)=>e[a]=s),i&&i.headers.forEach((s,a)=>e[a]=s)}xo(e,n){let i=Q_[e];return`${this.Do}/v1/${n}:${i}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}No(t,e,n,i){let s=Ma();return new Promise((a,u)=>{let l=new Pa;l.setWithCredentials(!0),l.listenOnce(Ca.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case ti.NO_ERROR:let f=l.getResponseJson();D(Mt,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(f)),a(f);break;case ti.TIMEOUT:D(Mt,`RPC '${t}' ${s} timed out`),u(new x(C.DEADLINE_EXCEEDED,"Request time out"));break;case ti.HTTP_ERROR:let g=l.getStatus();if(D(Mt,`RPC '${t}' ${s} failed with status:`,g,"response text:",l.getResponseText()),g>0){let _=l.getResponseJson();Array.isArray(_)&&(_=_[0]);let b=_?.error;if(b&&b.status&&b.message){let N=function(V){let j=V.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf(j)>=0?j:C.UNKNOWN}(b.status);u(new x(N,b.message))}else u(new x(C.UNKNOWN,"Server responded with status "+l.getStatus()))}else u(new x(C.UNAVAILABLE,"Connection failed."));break;default:L()}}finally{D(Mt,`RPC '${t}' ${s} completed.`)}});let d=JSON.stringify(i);D(Mt,`RPC '${t}' ${s} sending request:`,i),l.send(e,"POST",d,n,15)})}Bo(t,e,n){let i=Ma(),s=[this.Do,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Da(),u=xa(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(l.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,e,n),l.encodeInitMessageHeaders=!0;let f=s.join("");D(Mt,`Creating RPC '${t}' stream ${i}: ${f}`,l);let g=a.createWebChannel(f,l),_=!1,b=!1,N=new Xu({Io:V=>{b?D(Mt,`Not sending because RPC '${t}' stream ${i} is closed:`,V):(_||(D(Mt,`Opening RPC '${t}' stream ${i} transport.`),g.open(),_=!0),D(Mt,`RPC '${t}' stream ${i} sending:`,V),g.send(V))},To:()=>g.close()}),k=(V,j,G)=>{V.listen(j,B=>{try{G(B)}catch(Q){setTimeout(()=>{throw Q},0)}})};return k(g,Un.EventType.OPEN,()=>{b||(D(Mt,`RPC '${t}' stream ${i} transport opened.`),N.yo())}),k(g,Un.EventType.CLOSE,()=>{b||(b=!0,D(Mt,`RPC '${t}' stream ${i} transport closed`),N.So())}),k(g,Un.EventType.ERROR,V=>{b||(b=!0,te(Mt,`RPC '${t}' stream ${i} transport errored:`,V),N.So(new x(C.UNAVAILABLE,"The operation could not be completed")))}),k(g,Un.EventType.MESSAGE,V=>{var j;if(!b){let G=V.data[0];q(!!G);let B=G,Q=B.error||((j=B[0])===null||j===void 0?void 0:j.error);if(Q){D(Mt,`RPC '${t}' stream ${i} received error:`,Q);let H=Q.status,K=function(v){let I=wt[v];if(I!==void 0)return gm(I)}(H),w=Q.message;K===void 0&&(K=C.INTERNAL,w="Unknown error status: "+H+" with message "+Q.message),b=!0,N.So(new x(K,w)),g.close()}else D(Mt,`RPC '${t}' stream ${i} received:`,G),N.bo(G)}}),k(u,Ra.STAT_EVENT,V=>{V.stat===gs.PROXY?D(Mt,`RPC '${t}' stream ${i} detected buffering proxy`):V.stat===gs.NOPROXY&&D(Mt,`RPC '${t}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{N.wo()},0),N}};function Gm(){return typeof window<"u"?window:null}function As(){return typeof document<"u"?document:null}function Fi(r){return new mu(r,!0)}var Ci=class{constructor(t,e,n=1e3,i=1.5,s=6e4){this.ui=t,this.timerId=e,this.ko=n,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(t){this.cancel();let e=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),i=Math.max(0,e-n);i>0&&D("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),t())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var ro=class{constructor(t,e,n,i,s,a,u,l){this.ui=t,this.Ho=n,this.Jo=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Ci(t,e)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return R(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(t){this.u_(),this.stream.send(t)}__(){return R(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(t,e){return R(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,t!==4?this.t_.reset():e&&e.code===C.RESOURCE_EXHAUSTED?(pt(e.toString()),pt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):e&&e.code===C.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.mo(e)})}l_(){}auth(){this.state=1;let t=this.h_(this.Yo),e=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Yo===e&&this.P_(n,i)},n=>{t(()=>{let i=new x(C.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(i)})})}P_(t,e){let n=this.h_(this.Yo);this.stream=this.T_(t,e),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{n(()=>this.I_(i))}),this.stream.onMessage(i=>{n(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(()=>R(this,null,function*(){this.state=0,this.start()}))}I_(t){return D("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}h_(t){return e=>{this.ui.enqueueAndForget(()=>this.Yo===t?e():(D("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},tc=class extends ro{constructor(t,e,n,i,s,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,i,a),this.serializer=s}T_(t,e){return this.connection.Bo("Listen",t,e)}E_(t){return this.onNext(t)}onNext(t){this.t_.reset();let e=D_(this.serializer,t),n=function(s){if(!("targetChange"in s))return U.min();let a=s.targetChange;return a.targetIds&&a.targetIds.length?U.min():a.readTime?yt(a.readTime):U.min()}(t);return this.listener.d_(e,n)}A_(t){let e={};e.database=_u(this.serializer),e.addTarget=function(s,a){let u,l=a.target;if(u=ks(l)?{documents:Em(s,l)}:{query:Am(s,l)._t},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=_m(s,a.resumeToken);let d=gu(s,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(U.min())>0){u.readTime=ar(s,a.snapshotVersion.toTimestamp());let d=gu(s,a.expectedCount);d!==null&&(u.expectedCount=d)}return u}(this.serializer,t);let n=N_(this.serializer,t);n&&(e.labels=n),this.a_(e)}R_(t){let e={};e.database=_u(this.serializer),e.removeTarget=t,this.a_(e)}},ec=class extends ro{constructor(t,e,n,i,s,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,i,a),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(t,e){return this.connection.Bo("Write",t,e)}E_(t){return q(!!t.streamToken),this.lastStreamToken=t.streamToken,q(!t.writeResults||t.writeResults.length===0),this.listener.f_()}onNext(t){q(!!t.streamToken),this.lastStreamToken=t.streamToken,this.t_.reset();let e=V_(t.writeResults,t.commitTime),n=yt(t.commitTime);return this.listener.g_(n,e)}p_(){let t={};t.database=_u(this.serializer),this.a_(t)}m_(t){let e={streamToken:this.lastStreamToken,writes:t.map(n=>Ai(this.serializer,n))};this.a_(e)}};var nc=class extends class{}{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new x(C.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(t,e,n,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Mo(t,pu(e,n),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new x(C.UNKNOWN,s.toString())})}Lo(t,e,n,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Lo(t,pu(e,n),i,a,u,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new x(C.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},rc=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(t){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.C_("Offline")))}set(t){this.x_(),this.S_=0,t==="Online"&&(this.D_=!1),this.C_(t)}C_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}F_(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(pt(e),this.D_=!1):D("OnlineStateTracker",e)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var ic=class{constructor(t,e,n,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(a=>{n.enqueueAndForget(()=>R(this,null,function*(){rn(this)&&(D("RemoteStore","Restarting streams for network reachability change."),yield function(l){return R(this,null,function*(){let d=O(l);d.L_.add(4),yield wr(d),d.q_.set("Unknown"),d.L_.delete(4),yield Li(d)})}(this))}))}),this.q_=new rc(n,i)}};function Li(r){return R(this,null,function*(){if(rn(r))for(let t of r.B_)yield t(!0)})}function wr(r){return R(this,null,function*(){for(let t of r.B_)yield t(!1)})}function bo(r,t){let e=O(r);e.N_.has(t.targetId)||(e.N_.set(t.targetId,t),Yc(e)?Jc(e):Tr(e).r_()&&Hc(e,t))}function dr(r,t){let e=O(r),n=Tr(e);e.N_.delete(t),n.r_()&&zm(e,t),e.N_.size===0&&(n.r_()?n.o_():rn(e)&&e.q_.set("Unknown"))}function Hc(r,t){if(r.Q_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(U.min())>0){let e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Tr(r).A_(t)}function zm(r,t){r.Q_.xe(t),Tr(r).R_(t)}function Jc(r){r.Q_=new fu({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>r.N_.get(t)||null,tt:()=>r.datastore.serializer.databaseId}),Tr(r).start(),r.q_.v_()}function Yc(r){return rn(r)&&!Tr(r).n_()&&r.N_.size>0}function rn(r){return O(r).L_.size===0}function Km(r){r.Q_=void 0}function W_(r){return R(this,null,function*(){r.q_.set("Online")})}function H_(r){return R(this,null,function*(){r.N_.forEach((t,e)=>{Hc(r,t)})})}function J_(r,t){return R(this,null,function*(){Km(r),Yc(r)?(r.q_.M_(t),Jc(r)):r.q_.set("Unknown")})}function Y_(r,t,e){return R(this,null,function*(){if(r.q_.set("Online"),t instanceof Ls&&t.state===2&&t.cause)try{yield function(i,s){return R(this,null,function*(){let a=s.cause;for(let u of s.targetIds)i.N_.has(u)&&(yield i.remoteSyncer.rejectListen(u,a),i.N_.delete(u),i.Q_.removeTarget(u))})}(r,t)}catch(n){D("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),yield io(r,n)}else if(t instanceof tr?r.Q_.Ke(t):t instanceof Fs?r.Q_.He(t):r.Q_.We(t),!e.isEqual(U.min()))try{let n=yield Lm(r.localStore);e.compareTo(n)>=0&&(yield function(s,a){let u=s.Q_.rt(a);return u.targetChanges.forEach((l,d)=>{if(l.resumeToken.approximateByteSize()>0){let f=s.N_.get(d);f&&s.N_.set(d,f.withResumeToken(l.resumeToken,a))}}),u.targetMismatches.forEach((l,d)=>{let f=s.N_.get(l);if(!f)return;s.N_.set(l,f.withResumeToken(vt.EMPTY_BYTE_STRING,f.snapshotVersion)),zm(s,l);let g=new ur(f.target,l,d,f.sequenceNumber);Hc(s,g)}),s.remoteSyncer.applyRemoteEvent(u)}(r,e))}catch(n){D("RemoteStore","Failed to raise snapshot:",n),yield io(r,n)}})}function io(r,t,e){return R(this,null,function*(){if(!nn(t))throw t;r.L_.add(1),yield wr(r),r.q_.set("Offline"),e||(e=()=>Lm(r.localStore)),r.asyncQueue.enqueueRetryable(()=>R(this,null,function*(){D("RemoteStore","Retrying IndexedDB access"),yield e(),r.L_.delete(1),yield Li(r)}))})}function $m(r,t){return t().catch(e=>io(r,e,t))}function Ir(r){return R(this,null,function*(){let t=O(r),e=tn(t),n=t.O_.length>0?t.O_[t.O_.length-1].batchId:-1;for(;X_(t);)try{let i=yield z_(t.localStore,n);if(i===null){t.O_.length===0&&e.o_();break}n=i.batchId,Z_(t,i)}catch(i){yield io(t,i)}Qm(t)&&Wm(t)})}function X_(r){return rn(r)&&r.O_.length<10}function Z_(r,t){r.O_.push(t);let e=tn(r);e.r_()&&e.V_&&e.m_(t.mutations)}function Qm(r){return rn(r)&&!tn(r).n_()&&r.O_.length>0}function Wm(r){tn(r).start()}function ty(r){return R(this,null,function*(){tn(r).p_()})}function ey(r){return R(this,null,function*(){let t=tn(r);for(let e of r.O_)t.m_(e.mutations)})}function ny(r,t,e){return R(this,null,function*(){let n=r.O_.shift(),i=lu.from(n,t,e);yield $m(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield Ir(r)})}function ry(r,t){return R(this,null,function*(){t&&tn(r).V_&&(yield function(n,i){return R(this,null,function*(){if(function(a){return mm(a)&&a!==C.ABORTED}(i.code)){let s=n.O_.shift();tn(n).s_(),yield $m(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Ir(n)}})}(r,t)),Qm(r)&&Wm(r)})}function vf(r,t){return R(this,null,function*(){let e=O(r);e.asyncQueue.verifyOperationInProgress(),D("RemoteStore","RemoteStore received new credentials");let n=rn(e);e.L_.add(3),yield wr(e),n&&e.q_.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.L_.delete(3),yield Li(e)})}function sc(r,t){return R(this,null,function*(){let e=O(r);t?(e.L_.delete(2),yield Li(e)):t||(e.L_.add(2),yield wr(e),e.q_.set("Unknown"))})}function Tr(r){return r.K_||(r.K_=function(e,n,i){let s=O(e);return s.w_(),new tc(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:W_.bind(null,r),Ro:H_.bind(null,r),mo:J_.bind(null,r),d_:Y_.bind(null,r)}),r.B_.push(t=>R(this,null,function*(){t?(r.K_.s_(),Yc(r)?Jc(r):r.q_.set("Unknown")):(yield r.K_.stop(),Km(r))}))),r.K_}function tn(r){return r.U_||(r.U_=function(e,n,i){let s=O(e);return s.w_(),new ec(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:ty.bind(null,r),mo:ry.bind(null,r),f_:ey.bind(null,r),g_:ny.bind(null,r)}),r.B_.push(t=>R(this,null,function*(){t?(r.U_.s_(),yield Ir(r)):(yield r.U_.stop(),r.O_.length>0&&(D("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))}))),r.U_}var oc=class r{constructor(t,e,n,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new At,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,i,s){let a=Date.now()+n,u=new r(t,e,a,i,s);return u.start(n),u}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(C.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Er(r,t){if(pt("AsyncQueue",`${t}: ${r}`),nn(r))return new x(C.UNAVAILABLE,`${t}: ${r}`);throw r}var so=class r{constructor(t){this.comparator=t?(e,n)=>t(e,n)||F.comparator(e.key,n.key):(e,n)=>F.comparator(e.key,n.key),this.keyedMap=si(),this.sortedSet=new ut(this.comparator)}static emptySet(t){return new r(t.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let n=new r;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}};var oo=class{constructor(){this.W_=new ut(F.comparator)}track(t){let e=t.doc.key,n=this.W_.get(e);n?t.type!==0&&n.type===3?this.W_=this.W_.insert(e,t):t.type===3&&n.type!==1?this.W_=this.W_.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.W_=this.W_.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.W_=this.W_.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.W_=this.W_.remove(e):t.type===1&&n.type===2?this.W_=this.W_.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.W_=this.W_.insert(e,{type:2,doc:t.doc}):L():this.W_=this.W_.insert(e,t)}G_(){let t=[];return this.W_.inorderTraversal((e,n)=>{t.push(n)}),t}},fr=class r{constructor(t,e,n,i,s,a,u,l,d){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=l,this.hasCachedResults=d}static fromInitialDocuments(t,e,n,i,s){let a=[];return e.forEach(u=>{a.push({type:0,doc:u})}),new r(t,e,so.emptySet(e),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Mi(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i].type!==n[i].type||!e[i].doc.isEqual(n[i].doc))return!1;return!0}};var ac=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(t=>t.J_())}},uc=class{constructor(){this.queries=wf(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(e,n){let i=O(e),s=i.queries;i.queries=wf(),s.forEach((a,u)=>{for(let l of u.j_)l.onError(n)})})(this,new x(C.ABORTED,"Firestore shutting down"))}};function wf(){return new pe(r=>tm(r),Mi)}function Xc(r,t){return R(this,null,function*(){let e=O(r),n=3,i=t.query,s=e.queries.get(i);s?!s.H_()&&t.J_()&&(n=2):(s=new ac,n=t.J_()?0:1);try{switch(n){case 0:s.z_=yield e.onListen(i,!0);break;case 1:s.z_=yield e.onListen(i,!1);break;case 2:yield e.onFirstRemoteStoreListen(i)}}catch(a){let u=Er(a,`Initialization of query '${Qn(t.query)}' failed`);return void t.onError(u)}e.queries.set(i,s),s.j_.push(t),t.Z_(e.onlineState),s.z_&&t.X_(s.z_)&&tl(e)})}function Zc(r,t){return R(this,null,function*(){let e=O(r),n=t.query,i=3,s=e.queries.get(n);if(s){let a=s.j_.indexOf(t);a>=0&&(s.j_.splice(a,1),s.j_.length===0?i=t.J_()?0:1:!s.H_()&&t.J_()&&(i=2))}switch(i){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}})}function iy(r,t){let e=O(r),n=!1;for(let i of t){let s=i.query,a=e.queries.get(s);if(a){for(let u of a.j_)u.X_(i)&&(n=!0);a.z_=i}}n&&tl(e)}function sy(r,t,e){let n=O(r),i=n.queries.get(t);if(i)for(let s of i.j_)s.onError(e);n.queries.delete(t)}function tl(r){r.Y_.forEach(t=>{t.next()})}var cc,If;(If=cc||(cc={})).ea="default",If.Cache="cache";var Ri=class{constructor(t,e,n){this.query=t,this.ta=e,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(t){if(!this.options.includeMetadataChanges){let n=[];for(let i of t.docChanges)i.type!==3&&n.push(i);t=new fr(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.na?this.ia(t)&&(this.ta.next(t),e=!0):this.sa(t,this.onlineState)&&(this.oa(t),e=!0),this.ra=t,e}onError(t){this.ta.error(t)}Z_(t){this.onlineState=t;let e=!1;return this.ra&&!this.na&&this.sa(this.ra,t)&&(this.oa(this.ra),e=!0),e}sa(t,e){if(!t.fromCache||!this.J_())return!0;let n=e!=="Offline";return(!this.options._a||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}ia(t){if(t.docChanges.length>0)return!0;let e=this.ra&&this.ra.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}oa(t){t=fr.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.na=!0,this.ta.next(t)}J_(){return this.options.source!==cc.Cache}};var lc=class{constructor(t,e){this.aa=t,this.byteLength=e}ua(){return"metadata"in this.aa}};var ao=class{constructor(t){this.serializer=t}Es(t){return de(this.serializer,t)}ds(t){return t.metadata.exists?Tm(this.serializer,t.document,!1):Et.newNoDocument(this.Es(t.metadata.name),this.As(t.metadata.readTime))}As(t){return yt(t)}},hc=class{constructor(t,e,n){this.ca=t,this.localStore=e,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Hm(t)}la(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.aa.namedQuery)this.queries.push(t.aa.namedQuery);else if(t.aa.documentMetadata){this.documents.push({metadata:t.aa.documentMetadata}),t.aa.documentMetadata.exists||++e;let n=Y.fromString(t.aa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else t.aa.document&&(this.documents[this.documents.length-1].document=t.aa.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}ha(t){let e=new Map,n=new ao(this.serializer);for(let i of t)if(i.metadata.queries){let s=n.Es(i.metadata.name);for(let a of i.metadata.queries){let u=(e.get(a)||$()).add(s);e.set(a,u)}}return e}complete(){return R(this,null,function*(){let t=yield K_(this.localStore,new ao(this.serializer),this.documents,this.ca.id),e=this.ha(this.documents);for(let n of this.queries)yield $_(this.localStore,n,e.get(n.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:t}})}};function Hm(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}var uo=class{constructor(t){this.key=t}},co=class{constructor(t){this.key=t}},lo=class{constructor(t,e){this.query=t,this.Ta=e,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=$(),this.mutatedKeys=$(),this.Aa=nm(t),this.Ra=new so(this.Aa)}get Va(){return this.Ta}ma(t,e){let n=e?e.fa:new oo,i=e?e.Ra:this.Ra,s=e?e.mutatedKeys:this.mutatedKeys,a=i,u=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((f,g)=>{let _=i.get(f),b=Oi(this.query,g)?g:null,N=!!_&&this.mutatedKeys.has(_.key),k=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations),V=!1;_&&b?_.data.isEqual(b.data)?N!==k&&(n.track({type:3,doc:b}),V=!0):this.ga(_,b)||(n.track({type:2,doc:b}),V=!0,(l&&this.Aa(b,l)>0||d&&this.Aa(b,d)<0)&&(u=!0)):!_&&b?(n.track({type:0,doc:b}),V=!0):_&&!b&&(n.track({type:1,doc:_}),V=!0,(l||d)&&(u=!0)),V&&(b?(a=a.add(b),s=k?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{Ra:a,fa:n,ns:u,mutatedKeys:s}}ga(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,i){let s=this.Ra;this.Ra=t.Ra,this.mutatedKeys=t.mutatedKeys;let a=t.fa.G_();a.sort((f,g)=>function(b,N){let k=V=>{switch(V){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L()}};return k(b)-k(N)}(f.type,g.type)||this.Aa(f.doc,g.doc)),this.pa(n),i=i!=null&&i;let u=e&&!i?this.ya():[],l=this.da.size===0&&this.current&&!i?1:0,d=l!==this.Ea;return this.Ea=l,a.length!==0||d?{snapshot:new fr(this.query,t.Ra,s,a,t.mutatedKeys,l===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:u}:{wa:u}}Z_(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new oo,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(t){return!this.Ta.has(t)&&!!this.Ra.has(t)&&!this.Ra.get(t).hasLocalMutations}pa(t){t&&(t.addedDocuments.forEach(e=>this.Ta=this.Ta.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ta=this.Ta.delete(e)),this.current=t.current)}ya(){if(!this.current)return[];let t=this.da;this.da=$(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});let e=[];return t.forEach(n=>{this.da.has(n)||e.push(new co(n))}),this.da.forEach(n=>{t.has(n)||e.push(new uo(n))}),e}ba(t){this.Ta=t.Ts,this.da=$();let e=this.ma(t.documents);return this.applyChanges(e,!0)}Da(){return fr.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},dc=class{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}},fc=class{constructor(t){this.key=t,this.va=!1}},mc=class{constructor(t,e,n,i,s,a){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new pe(u=>tm(u),Mi),this.Ma=new Map,this.xa=new Set,this.Oa=new ut(F.comparator),this.Na=new Map,this.La=new Si,this.Ba={},this.ka=new Map,this.qa=cr.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function oy(r,t,e=!0){return R(this,null,function*(){let n=So(r),i,s=n.Fa.get(t);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield Jm(n,t,e,!0),i})}function ay(r,t){return R(this,null,function*(){let e=So(r);yield Jm(e,t,!0,!1)})}function Jm(r,t,e,n){return R(this,null,function*(){let i=yield lr(r.localStore,Bt(t)),s=i.targetId,a=r.sharedClientState.addLocalQueryTarget(s,e),u;return n&&(u=yield el(r,t,s,a==="current",i.resumeToken)),r.isPrimaryClient&&e&&bo(r.remoteStore,i),u})}function el(r,t,e,n,i){return R(this,null,function*(){r.Ka=(g,_,b)=>function(k,V,j,G){return R(this,null,function*(){let B=V.view.ma(j);B.ns&&(B=yield Xs(k.localStore,V.query,!1).then(({documents:w})=>V.view.ma(w,B)));let Q=G&&G.targetChanges.get(V.targetId),H=G&&G.targetMismatches.get(V.targetId)!=null,K=V.view.applyChanges(B,k.isPrimaryClient,Q,H);return gc(k,V.targetId,K.wa),K.snapshot})}(r,g,_,b);let s=yield Xs(r.localStore,t,!0),a=new lo(t,s.Ts),u=a.ma(s.documents),l=Ti.createSynthesizedTargetChangeForCurrentChange(e,n&&r.onlineState!=="Offline",i),d=a.applyChanges(u,r.isPrimaryClient,l);gc(r,e,d.wa);let f=new dc(t,e,a);return r.Fa.set(t,f),r.Ma.has(e)?r.Ma.get(e).push(t):r.Ma.set(e,[t]),d.snapshot})}function uy(r,t,e){return R(this,null,function*(){let n=O(r),i=n.Fa.get(t),s=n.Ma.get(i.targetId);if(s.length>1)return n.Ma.set(i.targetId,s.filter(a=>!Mi(a,t))),void n.Fa.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield hr(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),e&&dr(n.remoteStore,i.targetId),mr(n,i.targetId)}).catch(en))):(mr(n,i.targetId),yield hr(n.localStore,i.targetId,!0))})}function cy(r,t){return R(this,null,function*(){let e=O(r),n=e.Fa.get(t),i=e.Ma.get(n.targetId);e.isPrimaryClient&&i.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),dr(e.remoteStore,n.targetId))})}function ly(r,t,e){return R(this,null,function*(){let n=sl(r);try{let i=yield function(a,u){let l=O(a),d=lt.now(),f=u.reduce((b,N)=>b.add(N.key),$()),g,_;return l.persistence.runTransaction("Locally write mutations","readwrite",b=>{let N=Gt(),k=$();return l.cs.getEntries(b,f).next(V=>{N=V,N.forEach((j,G)=>{G.isValidDocument()||(k=k.add(j))})}).next(()=>l.localDocuments.getOverlayedDocuments(b,N)).next(V=>{g=V;let j=[];for(let G of u){let B=A_(G,g.get(G.key).overlayedDocument);B!=null&&j.push(new ne(G.key,B,Qf(B.value.mapValue),mt.exists(!0)))}return l.mutationQueue.addMutationBatch(b,d,j,u)}).next(V=>{_=V;let j=V.applyToLocalDocumentSet(g,k);return l.documentOverlayCache.saveOverlays(b,V.batchId,j)})}).then(()=>({batchId:_.batchId,changes:im(g)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(i.batchId),function(a,u,l){let d=a.Ba[a.currentUser.toKey()];d||(d=new ut(z)),d=d.insert(u,l),a.Ba[a.currentUser.toKey()]=d}(n,i.batchId,e),yield xe(n,i.changes),yield Ir(n.remoteStore)}catch(i){let s=Er(i,"Failed to persist write");e.reject(s)}})}function Ym(r,t){return R(this,null,function*(){let e=O(r);try{let n=yield G_(e.localStore,t);t.targetChanges.forEach((i,s)=>{let a=e.Na.get(s);a&&(q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.va=!0:i.modifiedDocuments.size>0?q(a.va):i.removedDocuments.size>0&&(q(a.va),a.va=!1))}),yield xe(e,n,t)}catch(n){yield en(n)}})}function Tf(r,t,e){let n=O(r);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){let i=[];n.Fa.forEach((s,a)=>{let u=a.view.Z_(t);u.snapshot&&i.push(u.snapshot)}),function(a,u){let l=O(a);l.onlineState=u;let d=!1;l.queries.forEach((f,g)=>{for(let _ of g.j_)_.Z_(u)&&(d=!0)}),d&&tl(l)}(n.eventManager,t),i.length&&n.Ca.d_(i),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}function hy(r,t,e){return R(this,null,function*(){let n=O(r);n.sharedClientState.updateQueryState(t,"rejected",e);let i=n.Na.get(t),s=i&&i.key;if(s){let a=new ut(F.comparator);a=a.insert(s,Et.newNoDocument(s,U.min()));let u=$().add(s),l=new Ii(U.min(),new Map,new ut(z),a,u);yield Ym(n,l),n.Oa=n.Oa.remove(s),n.Na.delete(t),il(n)}else yield hr(n.localStore,t,!1).then(()=>mr(n,t,e)).catch(en)})}function dy(r,t){return R(this,null,function*(){let e=O(r),n=t.batch.batchId;try{let i=yield j_(e.localStore,t);rl(e,n,null),nl(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),yield xe(e,i)}catch(i){yield en(i)}})}function fy(r,t,e){return R(this,null,function*(){let n=O(r);try{let i=yield function(a,u){let l=O(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return l.mutationQueue.lookupMutationBatch(d,u).next(g=>(q(g!==null),f=g.keys(),l.mutationQueue.removeMutationBatch(d,g))).next(()=>l.mutationQueue.performConsistencyCheck(d)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(d,f,u)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>l.localDocuments.getDocuments(d,f))})}(n.localStore,t);rl(n,t,e),nl(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),yield xe(n,i)}catch(i){yield en(i)}})}function my(r,t){return R(this,null,function*(){let e=O(r);rn(e.remoteStore)||D("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=yield function(a){let u=O(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>u.mutationQueue.getHighestUnacknowledgedBatchId(l))}(e.localStore);if(n===-1)return void t.resolve();let i=e.ka.get(n)||[];i.push(t),e.ka.set(n,i)}catch(n){let i=Er(n,"Initialization of waitForPendingWrites() operation failed");t.reject(i)}})}function nl(r,t){(r.ka.get(t)||[]).forEach(e=>{e.resolve()}),r.ka.delete(t)}function rl(r,t,e){let n=O(r),i=n.Ba[n.currentUser.toKey()];if(i){let s=i.get(t);s&&(e?s.reject(e):s.resolve(),i=i.remove(t)),n.Ba[n.currentUser.toKey()]=i}}function mr(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(let n of r.Ma.get(t))r.Fa.delete(n),e&&r.Ca.$a(n,e);r.Ma.delete(t),r.isPrimaryClient&&r.La.gr(t).forEach(n=>{r.La.containsKey(n)||Xm(r,n)})}function Xm(r,t){r.xa.delete(t.path.canonicalString());let e=r.Oa.get(t);e!==null&&(dr(r.remoteStore,e),r.Oa=r.Oa.remove(t),r.Na.delete(e),il(r))}function gc(r,t,e){for(let n of e)n instanceof uo?(r.La.addReference(n.key,t),gy(r,n)):n instanceof co?(D("SyncEngine","Document no longer in limbo: "+n.key),r.La.removeReference(n.key,t),r.La.containsKey(n.key)||Xm(r,n.key)):L()}function gy(r,t){let e=t.key,n=e.path.canonicalString();r.Oa.get(e)||r.xa.has(n)||(D("SyncEngine","New document in limbo: "+e),r.xa.add(n),il(r))}function il(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){let t=r.xa.values().next().value;r.xa.delete(t);let e=new F(Y.fromString(t)),n=r.qa.next();r.Na.set(n,new fc(e)),r.Oa=r.Oa.insert(e,n),bo(r.remoteStore,new ur(Bt(vr(e.path)),n,"TargetPurposeLimboResolution",Kt.oe))}}function xe(r,t,e){return R(this,null,function*(){let n=O(r),i=[],s=[],a=[];n.Fa.isEmpty()||(n.Fa.forEach((u,l)=>{a.push(n.Ka(l,t,e).then(d=>{var f;if((d||e)&&n.isPrimaryClient){let g=d?!d.fromCache:(f=e?.targetChanges.get(l.targetId))===null||f===void 0?void 0:f.current;n.sharedClientState.updateQueryState(l.targetId,g?"current":"not-current")}if(d){i.push(d);let g=Qu.Wi(l.targetId,d);s.push(g)}}))}),yield Promise.all(a),n.Ca.d_(i),yield function(l,d){return R(this,null,function*(){let f=O(l);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>S.forEach(d,_=>S.forEach(_.$i,b=>f.persistence.referenceDelegate.addReference(g,_.targetId,b)).next(()=>S.forEach(_.Ui,b=>f.persistence.referenceDelegate.removeReference(g,_.targetId,b)))))}catch(g){if(!nn(g))throw g;D("LocalStore","Failed to update sequence numbers: "+g)}for(let g of d){let _=g.targetId;if(!g.fromCache){let b=f.os.get(_),N=b.snapshotVersion,k=b.withLastLimboFreeSnapshotVersion(N);f.os=f.os.insert(_,k)}}})}(n.localStore,s))})}function py(r,t){return R(this,null,function*(){let e=O(r);if(!e.currentUser.isEqual(t)){D("SyncEngine","User change. New user:",t.toKey());let n=yield Fm(e.localStore,t);e.currentUser=t,function(s,a){s.ka.forEach(u=>{u.forEach(l=>{l.reject(new x(C.CANCELLED,a))})}),s.ka.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),yield xe(e,n.hs)}})}function _y(r,t){let e=O(r),n=e.Na.get(t);if(n&&n.va)return $().add(n.key);{let i=$(),s=e.Ma.get(t);if(!s)return i;for(let a of s){let u=e.Fa.get(a);i=i.unionWith(u.view.Va)}return i}}function yy(r,t){return R(this,null,function*(){let e=O(r),n=yield Xs(e.localStore,t.query,!0),i=t.view.ba(n);return e.isPrimaryClient&&gc(e,t.targetId,i.wa),i})}function vy(r,t){return R(this,null,function*(){let e=O(r);return Um(e.localStore,t).then(n=>xe(e,n))})}function wy(r,t,e,n){return R(this,null,function*(){let i=O(r),s=yield function(u,l){let d=O(u),f=O(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",g=>f.Mn(g,l).next(_=>_?d.localDocuments.getDocuments(g,_):S.resolve(null)))}(i.localStore,t);s!==null?(e==="pending"?yield Ir(i.remoteStore):e==="acknowledged"||e==="rejected"?(rl(i,t,n||null),nl(i,t),function(u,l){O(O(u).mutationQueue).On(l)}(i.localStore,t)):L(),yield xe(i,s)):D("SyncEngine","Cannot apply mutation batch with id: "+t)})}function Iy(r,t){return R(this,null,function*(){let e=O(r);if(So(e),sl(e),t===!0&&e.Qa!==!0){let n=e.sharedClientState.getAllActiveQueryTargets(),i=yield Ef(e,n.toArray());e.Qa=!0,yield sc(e.remoteStore,!0);for(let s of i)bo(e.remoteStore,s)}else if(t===!1&&e.Qa!==!1){let n=[],i=Promise.resolve();e.Ma.forEach((s,a)=>{e.sharedClientState.isLocalQueryTarget(a)?n.push(a):i=i.then(()=>(mr(e,a),hr(e.localStore,a,!0))),dr(e.remoteStore,a)}),yield i,yield Ef(e,n),function(a){let u=O(a);u.Na.forEach((l,d)=>{dr(u.remoteStore,d)}),u.La.pr(),u.Na=new Map,u.Oa=new ut(F.comparator)}(e),e.Qa=!1,yield sc(e.remoteStore,!1)}})}function Ef(r,t,e){return R(this,null,function*(){let n=O(r),i=[],s=[];for(let a of t){let u,l=n.Ma.get(a);if(l&&l.length!==0){u=yield lr(n.localStore,Bt(l[0]));for(let d of l){let f=n.Fa.get(d),g=yield yy(n,f);g.snapshot&&s.push(g.snapshot)}}else{let d=yield Bm(n.localStore,a);u=yield lr(n.localStore,d),yield el(n,Zm(d),a,!1,u.resumeToken)}i.push(u)}return n.Ca.d_(s),i})}function Zm(r){return Zf(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function Ty(r){return function(e){return O(O(e).persistence).Qi()}(O(r).localStore)}function Ey(r,t,e,n){return R(this,null,function*(){let i=O(r);if(i.Qa)return void D("SyncEngine","Ignoring unexpected query state notification.");let s=i.Ma.get(t);if(s&&s.length>0)switch(e){case"current":case"not-current":{let a=yield Um(i.localStore,em(s[0])),u=Ii.createSynthesizedRemoteEventForCurrentChange(t,e==="current",vt.EMPTY_BYTE_STRING);yield xe(i,a,u);break}case"rejected":yield hr(i.localStore,t,!0),mr(i,t,n);break;default:L()}})}function Ay(r,t,e){return R(this,null,function*(){let n=So(r);if(n.Qa){for(let i of t){if(n.Ma.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){D("SyncEngine","Adding an already active target "+i);continue}let s=yield Bm(n.localStore,i),a=yield lr(n.localStore,s);yield el(n,Zm(s),a.targetId,!1,a.resumeToken),bo(n.remoteStore,a)}for(let i of e)n.Ma.has(i)&&(yield hr(n.localStore,i,!1).then(()=>{dr(n.remoteStore,i),mr(n,i)}).catch(en))}})}function So(r){let t=O(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=Ym.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=_y.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=hy.bind(null,t),t.Ca.d_=iy.bind(null,t.eventManager),t.Ca.$a=sy.bind(null,t.eventManager),t}function sl(r){let t=O(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=dy.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=fy.bind(null,t),t}function by(r,t,e){let n=O(r);(function(s,a,u){return R(this,null,function*(){try{let l=yield a.getMetadata();if(yield function(b,N){let k=O(b),V=yt(N.createTime);return k.persistence.runTransaction("hasNewerBundle","readonly",j=>k.Gr.getBundleMetadata(j,N.id)).then(j=>!!j&&j.createTime.compareTo(V)>=0)}(s.localStore,l))return yield a.close(),u._completeWith(function(b){return{taskState:"Success",documentsLoaded:b.totalDocuments,bytesLoaded:b.totalBytes,totalDocuments:b.totalDocuments,totalBytes:b.totalBytes}}(l)),Promise.resolve(new Set);u._updateProgress(Hm(l));let d=new hc(l,s.localStore,a.serializer),f=yield a.Ua();for(;f;){let _=yield d.la(f);_&&u._updateProgress(_),f=yield a.Ua()}let g=yield d.complete();return yield xe(s,g.Ia,void 0),yield function(b,N){let k=O(b);return k.persistence.runTransaction("Save bundle","readwrite",V=>k.Gr.saveBundleMetadata(V,N))}(s.localStore,l),u._completeWith(g.progress),Promise.resolve(g.Pa)}catch(l){return te("SyncEngine",`Loading bundle failed with ${l}`),u._failWith(l),Promise.resolve(new Set)}})})(n,t,e).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}var pc=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return R(this,null,function*(){this.serializer=Fi(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),yield this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)})}ja(e,n){return null}Ha(e,n){return null}za(e){return Om(this.persistence,new Ys,e.initialUser,this.serializer)}Ga(e){return new Hs(Js.Zr,this.serializer)}Wa(e){return new eo}terminate(){return R(this,null,function*(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return r.provider={build:()=>new r},r})();var ho=class r extends pc{constructor(t,e,n){super(),this.Ja=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(t){return R(this,null,function*(){yield _a(r.prototype,this,"initialize").call(this,t),yield this.Ja.initialize(this,t),yield sl(this.Ja.syncEngine),yield Ir(this.Ja.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}za(t){return Om(this.persistence,new Ys,t.initialUser,this.serializer)}ja(t,e){let n=this.persistence.referenceDelegate.garbageCollector;return new Du(n,t.asyncQueue,e)}Ha(t,e){let n=new Wa(e,this.persistence);return new Qa(t.asyncQueue,n)}Ga(t){let e=Wc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Wt.withCacheSize(this.cacheSizeBytes):Wt.DEFAULT;return new $u(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Gm(),As(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(t){return new eo}},_c=class r extends ho{constructor(t,e){super(t,e,!1),this.Ja=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}initialize(t){return R(this,null,function*(){yield _a(r.prototype,this,"initialize").call(this,t);let e=this.Ja.syncEngine;this.sharedClientState instanceof hi&&(this.sharedClientState.syncEngine={no:wy.bind(null,e),ro:Ey.bind(null,e),io:Ay.bind(null,e),Qi:Ty.bind(null,e),eo:vy.bind(null,e)},yield this.sharedClientState.start()),yield this.persistence.yi(n=>R(this,null,function*(){yield Iy(this.Ja.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}Wa(t){let e=Gm();if(!hi.D(e))throw new x(C.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=Wc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new hi(e,t.asyncQueue,n,t.clientId,t.initialUser)}},ol=(()=>{class r{initialize(e,n){return R(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Tf(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=py.bind(null,this.syncEngine),yield sc(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new uc}()}createDatastore(e){let n=Fi(e.databaseInfo.databaseId),i=function(a){return new Zu(a)}(e.databaseInfo);return function(a,u,l,d){return new nc(a,u,l,d)}(e.authCredentials,e.appCheckCredentials,i,n)}createRemoteStore(e){return function(i,s,a,u,l){return new ic(i,s,a,u,l)}(this.localStore,this.datastore,e.asyncQueue,n=>Tf(this.syncEngine,n,0),function(){return no.D()?new no:new Yu}())}createSyncEngine(e,n){return function(s,a,u,l,d,f,g){let _=new mc(s,a,u,l,d,f);return g&&(_.Qa=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return R(this,null,function*(){var e,n;yield function(s){return R(this,null,function*(){let a=O(s);D("RemoteStore","RemoteStore shutting down."),a.L_.add(5),yield wr(a),a.k_.shutdown(),a.q_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()})}}return r.provider={build:()=>new r},r})();function Af(r,t=10240){let e=0;return{read(){return R(this,null,function*(){if(e<r.byteLength){let i={value:r.slice(e,e+t),done:!1};return e+=t,i}return{done:!0}})},cancel(){return R(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var gr=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ya(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ya(this.observer.error,t):pt("Uncaught Error in snapshot listener:",t.toString()))}Za(){this.muted=!0}Ya(t,e){setTimeout(()=>{this.muted||t(e)},0)}};var yc=class{constructor(t,e){this.Xa=t,this.serializer=e,this.metadata=new At,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(n=>{n&&n.ua()?this.metadata.resolve(n.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.aa)}`))},n=>this.metadata.reject(n))}close(){return this.Xa.cancel()}getMetadata(){return R(this,null,function*(){return this.metadata.promise})}Ua(){return R(this,null,function*(){return yield this.getMetadata(),this.tu()})}tu(){return R(this,null,function*(){let t=yield this.nu();if(t===null)return null;let e=this.eu.decode(t),n=Number(e);isNaN(n)&&this.ru(`length string (${e}) is not valid number`);let i=yield this.iu(n);return new lc(JSON.parse(i),t.length+n)})}su(){return this.buffer.findIndex(t=>t===123)}nu(){return R(this,null,function*(){for(;this.su()<0&&!(yield this.ou()););if(this.buffer.length===0)return null;let t=this.su();t<0&&this.ru("Reached the end of bundle when a length string is expected.");let e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e})}iu(t){return R(this,null,function*(){for(;this.buffer.length<t;)(yield this.ou())&&this.ru("Reached the end of bundle when more is expected.");let e=this.eu.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e})}ru(t){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${t}`)}ou(){return R(this,null,function*(){let t=yield this.Xa.read();if(!t.done){let e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done})}};var vc=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(t){return R(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new x(C.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let e=yield function(i,s){return R(this,null,function*(){let a=O(i),u={documents:s.map(g=>Ei(a.serializer,g))},l=yield a.Lo("BatchGetDocuments",a.serializer.databaseId,Y.emptyPath(),u,s.length),d=new Map;l.forEach(g=>{let _=x_(a.serializer,g);d.set(_.key.toString(),_)});let f=[];return s.forEach(g=>{let _=d.get(g.toString());q(!!_),f.push(_)}),f})}(this.datastore,t);return e.forEach(n=>this.recordVersion(n)),e})}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(t.toString())}delete(t){this.write(new Ze(t,this.precondition(t))),this.writtenDocs.add(t.toString())}commit(){return R(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,n)=>{let i=F.fromPath(n);this.mutations.push(new yi(i,this.precondition(i)))}),yield function(n,i){return R(this,null,function*(){let s=O(n),a={writes:i.map(u=>Ai(s.serializer,u))};yield s.Mo("Commit",s.serializer.databaseId,Y.emptyPath(),a)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw L();e=U.min()}let n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new x(C.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(U.min())?mt.exists(!1):mt.updateTime(e):mt.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(U.min()))throw new x(C.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return mt.updateTime(e)}return mt.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};var wc=class{constructor(t,e,n,i,s){this.asyncQueue=t,this.datastore=e,this.options=n,this.updateFunction=i,this.deferred=s,this._u=n.maxAttempts,this.t_=new Ci(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(()=>R(this,null,function*(){let t=new vc(this.datastore),e=this.cu(t);e&&e.then(n=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(n)}).catch(i=>{this.lu(i)}))}).catch(n=>{this.lu(n)})}))}cu(t){try{let e=this.updateFunction(t);return!Ni(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}lu(t){this._u>0&&this.hu(t)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(t)}hu(t){if(t.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!mm(e)}return!1}};var Ic=class{constructor(t,e,n,i,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=Tt.UNAUTHENTICATED,this.clientId=Ss.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,a=>R(this,null,function*(){D("FirestoreClient","Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(n,a=>(D("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new At;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>R(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let n=Er(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}};function Oa(r,t){return R(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),D("FirestoreClient","Initializing OfflineComponentProvider");let e=r.configuration;yield t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener(i=>R(this,null,function*(){n.isEqual(i)||(yield Fm(t.localStore,i),n=i)})),t.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=t})}function bf(r,t){return R(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let e=yield al(r);D("FirestoreClient","Initializing OnlineComponentProvider"),yield t.initialize(e,r.configuration),r.setCredentialChangeListener(n=>vf(t.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>vf(t.remoteStore,i)),r._onlineComponents=t})}function al(r){return R(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){D("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Oa(r,r._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!function(i){return i.name==="FirebaseError"?i.code===C.FAILED_PRECONDITION||i.code===C.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(e))throw e;te("Error using user provided cache. Falling back to memory cache: "+e),yield Oa(r,new pc)}}else D("FirestoreClient","Using default OfflineComponentProvider"),yield Oa(r,new pc);return r._offlineComponents})}function Po(r){return R(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(D("FirestoreClient","Using user provided OnlineComponentProvider"),yield bf(r,r._uninitializedComponentsProvider._online)):(D("FirestoreClient","Using default OnlineComponentProvider"),yield bf(r,new ol))),r._onlineComponents})}function tg(r){return al(r).then(t=>t.persistence)}function ul(r){return al(r).then(t=>t.localStore)}function eg(r){return Po(r).then(t=>t.remoteStore)}function cl(r){return Po(r).then(t=>t.syncEngine)}function Sy(r){return Po(r).then(t=>t.datastore)}function pr(r){return R(this,null,function*(){let t=yield Po(r),e=t.eventManager;return e.onListen=oy.bind(null,t.syncEngine),e.onUnlisten=uy.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=ay.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=cy.bind(null,t.syncEngine),e})}function Py(r){return r.asyncQueue.enqueue(()=>R(this,null,function*(){let t=yield tg(r),e=yield eg(r);return t.setNetworkEnabled(!0),function(i){let s=O(i);return s.L_.delete(0),Li(s)}(e)}))}function Cy(r){return r.asyncQueue.enqueue(()=>R(this,null,function*(){let t=yield tg(r),e=yield eg(r);return t.setNetworkEnabled(!1),function(i){return R(this,null,function*(){let s=O(i);s.L_.add(0),yield wr(s),s.q_.set("Offline")})}(e)}))}function Ry(r,t){let e=new At;return r.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return function(i,s,a){return R(this,null,function*(){try{let u=yield function(d,f){let g=O(d);return g.persistence.runTransaction("read document","readonly",_=>g.localDocuments.getDocument(_,f))}(i,s);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new x(C.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){let l=Er(u,`Failed to get document '${s} from cache`);a.reject(l)}})}(yield ul(r),t,e)})),e.promise}function ng(r,t,e={}){let n=new At;return r.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return function(s,a,u,l,d){let f=new gr({next:_=>{f.Za(),a.enqueueAndForget(()=>Zc(s,g));let b=_.docs.has(u);!b&&_.fromCache?d.reject(new x(C.UNAVAILABLE,"Failed to get document because the client is offline.")):b&&_.fromCache&&l&&l.source==="server"?d.reject(new x(C.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(_)},error:_=>d.reject(_)}),g=new Ri(vr(u.path),f,{includeMetadataChanges:!0,_a:!0});return Xc(s,g)}(yield pr(r),r.asyncQueue,t,e,n)})),n.promise}function xy(r,t){let e=new At;return r.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return function(i,s,a){return R(this,null,function*(){try{let u=yield Xs(i,s,!0),l=new lo(s,u.Ts),d=l.ma(u.documents),f=l.applyChanges(d,!1);a.resolve(f.snapshot)}catch(u){let l=Er(u,`Failed to execute query '${s} against cache`);a.reject(l)}})}(yield ul(r),t,e)})),e.promise}function rg(r,t,e={}){let n=new At;return r.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return function(s,a,u,l,d){let f=new gr({next:_=>{f.Za(),a.enqueueAndForget(()=>Zc(s,g)),_.fromCache&&l.source==="server"?d.reject(new x(C.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(_)},error:_=>d.reject(_)}),g=new Ri(u,f,{includeMetadataChanges:!0,_a:!0});return Xc(s,g)}(yield pr(r),r.asyncQueue,t,e,n)})),n.promise}function Dy(r,t){let e=new gr(t);return r.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return function(i,s){O(i).Y_.add(s),s.next()}(yield pr(r),e)})),()=>{e.Za(),r.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return function(i,s){O(i).Y_.delete(s)}(yield pr(r),e)}))}}function Vy(r,t,e,n){let i=function(a,u){let l;return l=typeof a=="string"?pm().encode(a):a,function(f,g){return new yc(f,g)}(function(f,g){if(f instanceof Uint8Array)return Af(f,g);if(f instanceof ArrayBuffer)return Af(new Uint8Array(f),g);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),u)}(e,Fi(t));r.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){by(yield cl(r),i,n)}))}function Ny(r,t){return r.asyncQueue.enqueue(()=>R(this,null,function*(){return function(n,i){let s=O(n);return s.persistence.runTransaction("Get named query","readonly",a=>s.Gr.getNamedQuery(a,i))}(yield ul(r),t)}))}function ig(r){let t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}var Sf=new Map;function ll(r,t,e){if(!e)throw new x(C.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function hl(r,t,e,n){if(t===!0&&n===!0)throw new x(C.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function Pf(r){if(!F.isDocumentKey(r))throw new x(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Cf(r){if(F.isDocumentKey(r))throw new x(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Co(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let t=function(n){return n.constructor?n.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":L()}function X(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new x(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=Co(r);throw new x(C.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}function sg(r,t){if(t<=0)throw new x(C.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${t}.`)}var fo=class{constructor(t){var e,n;if(t.host===void 0){if(t.ssl!==void 0)throw new x(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new x(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}hl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ig((n=t.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new x(C.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new x(C.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new x(C.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},bn=class{constructor(t,e,n,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new fo({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new x(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new x(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new fo(t),t.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new Fa;switch(n.type){case"firstParty":return new Ua(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new x(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return R(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let n=Sf.get(e);n&&(D("ComponentProvider","Removing Datastore"),Sf.delete(e),n.terminate())}(this),Promise.resolve()}};function og(r,t,e,n={}){var i;let s=(r=X(r,bn))._getSettings(),a=`${t}:${e}`;if(s.host!=="firestore.googleapis.com"&&s.host!==a&&te("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let u,l;if(typeof n.mockUserToken=="string")u=n.mockUserToken,l=Tt.MOCK_USER;else{u=ed(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);let d=n.mockUserToken.sub||n.mockUserToken.user_id;if(!d)throw new x(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Tt(d)}r._authCredentials=new La(new bs(u,l))}}var Pt=class r{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new r(this.firestore,t,this._query)}},ot=class r{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new fe(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new r(this.firestore,t,this._key)}},fe=class r extends Pt{constructor(t,e,n){super(t,e,vr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new ot(this.firestore,null,new F(t))}withConverter(t){return new r(this.firestore,t,this._path)}};function qi(r,t,...e){if(r=ft(r),ll("collection","path",t),r instanceof bn){let n=Y.fromString(t,...e);return Cf(n),new fe(r,null,n)}{if(!(r instanceof ot||r instanceof fe))throw new x(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(Y.fromString(t,...e));return Cf(n),new fe(r.firestore,null,n)}}function ag(r,t){if(r=X(r,bn),ll("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new x(C.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Pt(r,null,function(n){return new ee(Y.emptyPath(),n)}(t))}function Bi(r,t,...e){if(r=ft(r),arguments.length===1&&(t=Ss.newId()),ll("doc","path",t),r instanceof bn){let n=Y.fromString(t,...e);return Pf(n),new ot(r,null,new F(n))}{if(!(r instanceof ot||r instanceof fe))throw new x(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(Y.fromString(t,...e));return Pf(n),new ot(r.firestore,r instanceof fe?r.converter:null,new F(n))}}function dl(r,t){return r=ft(r),t=ft(t),(r instanceof ot||r instanceof fe)&&(t instanceof ot||t instanceof fe)&&r.firestore===t.firestore&&r.path===t.path&&r.converter===t.converter}function fl(r,t){return r=ft(r),t=ft(t),r instanceof Pt&&t instanceof Pt&&r.firestore===t.firestore&&Mi(r._query,t._query)&&r.converter===t.converter}var mo=class{constructor(t=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Ci(this,"async_queue_retry"),this.Vu=()=>{let n=As();n&&D("AsyncQueue","Visibility state changed to "+n.visibilityState),this.t_.jo()},this.mu=t;let e=As();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.fu(),this.gu(t)}enterRestrictedMode(t){if(!this.Iu){this.Iu=!0,this.Au=t||!1;let e=As();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.Vu)}}enqueue(t){if(this.fu(),this.Iu)return new Promise(()=>{});let e=new At;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Pu.push(t),this.pu()))}pu(){return R(this,null,function*(){if(this.Pu.length!==0){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(t){if(!nn(t))throw t;D("AsyncQueue","Operation failed with retryable error: "+t)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(t){let e=this.mu.then(()=>(this.du=!0,t().catch(n=>{this.Eu=n,this.du=!1;let i=function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),u}(n);throw pt("INTERNAL UNHANDLED ERROR: ",i),n}).then(n=>(this.du=!1,n))));return this.mu=e,e}enqueueAfterDelay(t,e,n){this.fu(),this.Ru.indexOf(t)>-1&&(e=0);let i=oc.createAndSchedule(this,t,e,n,s=>this.yu(s));return this.Tu.push(i),i}fu(){this.Eu&&L()}verifyOperationInProgress(){}wu(){return R(this,null,function*(){let t;do t=this.mu,yield t;while(t!==this.mu)})}Su(t){for(let e of this.Tu)if(e.timerId===t)return!0;return!1}bu(t){return this.wu().then(()=>{this.Tu.sort((e,n)=>e.targetTimeMs-n.targetTimeMs);for(let e of this.Tu)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.wu()})}Du(t){this.Ru.push(t)}yu(t){let e=this.Tu.indexOf(t);this.Tu.splice(e,1)}};function Tc(r){return function(e,n){if(typeof e!="object"||e===null)return!1;let i=e;for(let s of n)if(s in i&&typeof i[s]=="function")return!0;return!1}(r,["next","error","complete"])}var Ec=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new At,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}};var ug=-1,ht=class extends bn{constructor(t,e,n,i){super(t,e,n,i),this.type="firestore",this._queue=new mo,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return R(this,null,function*(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new mo(t),this._firestoreClient=void 0,yield t}})}};function Ct(r){if(r._terminated)throw new x(C.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||cg(r),r._firestoreClient}function cg(r){var t,e,n;let i=r._freezeSettings(),s=function(u,l,d,f){return new Ha(u,l,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,ig(f.experimentalLongPollingOptions),f.useFetchStreams)}(r._databaseId,((t=r._app)===null||t===void 0?void 0:t.options.appId)||"",r._persistenceKey,i);r._componentsProvider||!((e=i.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new Ic(r._authCredentials,r._appCheckCredentials,r._queue,s,r._componentsProvider&&function(u){let l=u?._online.build();return{_offline:u?._offline.build(l),_online:l}}(r._componentsProvider))}function lg(r,t){te("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=r._freezeSettings();return dg(r,ol.provider,{build:n=>new ho(n,e.cacheSizeBytes,t?.forceOwnership)}),Promise.resolve()}function hg(r){return R(this,null,function*(){te("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=r._freezeSettings();dg(r,ol.provider,{build:e=>new _c(e,t.cacheSizeBytes)})})}function dg(r,t,e){if((r=X(r,ht))._firestoreClient||r._terminated)throw new x(C.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(r._componentsProvider||r._getSettings().localCache)throw new x(C.FAILED_PRECONDITION,"SDK cache is already specified.");r._componentsProvider={_online:t,_offline:e},cg(r)}function fg(r){if(r._initialized&&!r._terminated)throw new x(C.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new At;return r._queue.enqueueAndForgetEvenWhileRestricted(()=>R(this,null,function*(){try{yield function(n){return R(this,null,function*(){if(!$e.D())return Promise.resolve();let i=n+"main";yield $e.delete(i)})}(Wc(r._databaseId,r._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function mg(r){return function(e){let n=new At;return e.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return my(yield cl(e),n)})),n.promise}(Ct(r=X(r,ht)))}function gg(r){return Py(Ct(r=X(r,ht)))}function pg(r){return Cy(Ct(r=X(r,ht)))}function _g(r,t){let e=Ct(r=X(r,ht)),n=new Ec;return Vy(e,r._databaseId,t,n),n}function yg(r,t){return Ny(Ct(r=X(r,ht)),t).then(e=>e?new Pt(r,null,e.query):null)}var _e=class r{constructor(t){this._byteString=t}static fromBase64String(t){try{return new r(vt.fromBase64String(t))}catch(e){throw new x(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new r(vt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var re=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new x(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new _t(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var Ce=class{constructor(t){this._methodName=t}};var Sn=class{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new x(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new x(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return z(this._lat,t._lat)||z(this._long,t._long)}};var xi=class{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,t._values)}};var ky=/^__.*__$/,Ac=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new ne(t,this.data,this.fieldMask,e,this.fieldTransforms):new Xe(t,this.data,e,this.fieldTransforms)}},go=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new ne(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function vg(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L()}}var po=class r{constructor(t,e,n,i,s,a){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(t){return new r(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.Fu({path:n,xu:!1});return i.Ou(t),i}Nu(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.Fu({path:n,xu:!1});return i.vu(),i}Lu(t){return this.Fu({path:void 0,xu:!0})}Bu(t){return _o(t,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}vu(){if(this.path)for(let t=0;t<this.path.length;t++)this.Ou(this.path.get(t))}Ou(t){if(t.length===0)throw this.Bu("Document fields must not be empty");if(vg(this.Cu)&&ky.test(t))throw this.Bu('Document fields cannot begin and end with "__"')}},bc=class{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Fi(t)}Qu(t,e,n,i=!1){return new po({Cu:t,methodName:e,qu:n,path:_t.emptyPath(),xu:!1,ku:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function xn(r){let t=r._freezeSettings(),e=Fi(r._databaseId);return new bc(r._databaseId,!!t.ignoreUndefinedProperties,e)}function Ro(r,t,e,n,i,s={}){let a=r.Qu(s.merge||s.mergeFields?2:0,t,e,i);pl("Data must be an object, but it was:",a,n);let u=Tg(n,a),l,d;if(s.merge)l=new $t(a.fieldMask),d=a.fieldTransforms;else if(s.mergeFields){let f=[];for(let g of s.mergeFields){let _=xc(t,g,e);if(!a.contains(_))throw new x(C.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);Ag(f,_)||f.push(_)}l=new $t(f),d=a.fieldTransforms.filter(g=>l.covers(g.field))}else l=null,d=a.fieldTransforms;return new Ac(new Ot(u),l,d)}var Di=class r extends Ce{_toFieldTransform(t){if(t.Cu!==2)throw t.Cu===1?t.Bu(`${this._methodName}() can only appear at the top level of your update data`):t.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof r}};function wg(r,t,e){return new po({Cu:3,qu:t.settings.qu,methodName:r._methodName,xu:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var Sc=class r extends Ce{_toFieldTransform(t){return new Tn(t.path,new Je)}isEqual(t){return t instanceof r}},Pc=class r extends Ce{constructor(t,e){super(t),this.Ku=e}_toFieldTransform(t){let e=wg(this,t,!0),n=this.Ku.map(s=>Dn(s,e)),i=new Se(n);return new Tn(t.path,i)}isEqual(t){return t instanceof r&&Aa(this.Ku,t.Ku)}},Cc=class r extends Ce{constructor(t,e){super(t),this.Ku=e}_toFieldTransform(t){let e=wg(this,t,!0),n=this.Ku.map(s=>Dn(s,e)),i=new Pe(n);return new Tn(t.path,i)}isEqual(t){return t instanceof r&&Aa(this.Ku,t.Ku)}},Rc=class r extends Ce{constructor(t,e){super(t),this.$u=e}_toFieldTransform(t){let e=new Ye(t.serializer,am(t.serializer,this.$u));return new Tn(t.path,e)}isEqual(t){return t instanceof r&&this.$u===t.$u}};function ml(r,t,e,n){let i=r.Qu(1,t,e);pl("Data must be an object, but it was:",i,n);let s=[],a=Ot.empty();Rn(n,(l,d)=>{let f=_l(t,l,e);d=ft(d);let g=i.Nu(f);if(d instanceof Di)s.push(f);else{let _=Dn(d,g);_!=null&&(s.push(f),a.set(f,_))}});let u=new $t(s);return new go(a,u,i.fieldTransforms)}function gl(r,t,e,n,i,s){let a=r.Qu(1,t,e),u=[xc(t,n,e)],l=[i];if(s.length%2!=0)throw new x(C.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)u.push(xc(t,s[_])),l.push(s[_+1]);let d=[],f=Ot.empty();for(let _=u.length-1;_>=0;--_)if(!Ag(d,u[_])){let b=u[_],N=l[_];N=ft(N);let k=a.Nu(b);if(N instanceof Di)d.push(b);else{let V=Dn(N,k);V!=null&&(d.push(b),f.set(b,V))}}let g=new $t(d);return new go(f,g,a.fieldTransforms)}function Ig(r,t,e,n=!1){return Dn(e,r.Qu(n?4:3,t))}function Dn(r,t){if(Eg(r=ft(r)))return pl("Unsupported field value:",t,r),Tg(r,t);if(r instanceof Ce)return function(n,i){if(!vg(i.Cu))throw i.Bu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Bu(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.xu&&t.Cu!==4)throw t.Bu("Nested arrays are not supported");return function(n,i){let s=[],a=0;for(let u of n){let l=Dn(u,i.Lu(a));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),a++}return{arrayValue:{values:s}}}(r,t)}return function(n,i){if((n=ft(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return am(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=lt.fromDate(n);return{timestampValue:ar(i.serializer,s)}}if(n instanceof lt){let s=new lt(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:ar(i.serializer,s)}}if(n instanceof Sn)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof _e)return{bytesValue:_m(i.serializer,n._byteString)};if(n instanceof ot){let s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.Bu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Kc(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof xi)return function(a,u){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(l=>{if(typeof l!="number")throw u.Bu("VectorValues must only contain numeric values.");return zc(u.serializer,l)})}}}}}}(n,i);throw i.Bu(`Unsupported field value: ${Co(n)}`)}(r,t)}function Tg(r,t){let e={};return Gf(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Rn(r,(n,i)=>{let s=Dn(i,t.Mu(n));s!=null&&(e[n]=s)}),{mapValue:{fields:e}}}function Eg(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof lt||r instanceof Sn||r instanceof _e||r instanceof ot||r instanceof Ce||r instanceof xi)}function pl(r,t,e){if(!Eg(e)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(e)){let n=Co(e);throw n==="an object"?t.Bu(r+" a custom object"):t.Bu(r+" "+n)}}function xc(r,t,e){if((t=ft(t))instanceof re)return t._internalPath;if(typeof t=="string")return _l(r,t);throw _o("Field path arguments must be of type string or ",r,!1,void 0,e)}var My=new RegExp("[~\\*/\\[\\]]");function _l(r,t,e){if(t.search(My)>=0)throw _o(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new re(...t.split("."))._internalPath}catch{throw _o(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function _o(r,t,e,n,i){let s=n&&!n.isEmpty(),a=i!==void 0,u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new x(C.INVALID_ARGUMENT,u+r+l)}function Ag(r,t){return r.some(e=>e.isEqual(t))}var Pn=class{constructor(t,e,n,i,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ot(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new Dc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(xo("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},Dc=class extends Pn{data(){return super.data()}};function xo(r,t){return typeof t=="string"?_l(r,t):t instanceof re?t._internalPath:t._delegate._internalPath}function bg(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new x(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Vi=class{},Cn=class extends Vi{};function se(r,t,...e){let n=[];t instanceof Vi&&n.push(t),n=n.concat(e),function(s){let a=s.filter(l=>l instanceof Vc).length,u=s.filter(l=>l instanceof yo).length;if(a>1||a>0&&u>0)throw new x(C.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let i of n)r=i._apply(r);return r}var yo=class r extends Cn{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=this._parse(t);return kg(t._query,e),new Pt(t.firestore,t.converter,uu(t._query,e))}_parse(t){let e=xn(t.firestore);return function(s,a,u,l,d,f,g){let _;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new x(C.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){xf(g,f);let b=[];for(let N of g)b.push(Rf(l,s,N));_={arrayValue:{values:b}}}else _=Rf(l,s,g)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||xf(g,f),_=Ig(u,a,g,f==="in"||f==="not-in");return W.create(d,f,_)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function Do(r,t,e){let n=t,i=xo("where",r);return yo._create(i,n,e)}var Vc=class r extends Vi{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new r(t,e)}_parse(t){let e=this._queryConstraints.map(n=>n._parse(t)).filter(n=>n.getFilters().length>0);return e.length===1?e[0]:et.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(i,s){let a=i,u=s.getFlattenedFilters();for(let l of u)kg(a,l),a=uu(a,l)}(t._query,e),new Pt(t.firestore,t.converter,uu(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Nc=class r extends Cn{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new r(t,e)}_apply(t){let e=function(i,s,a){if(i.startAt!==null)throw new x(C.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new x(C.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new wn(s,a)}(t._query,this._field,this._direction);return new Pt(t.firestore,t.converter,function(i,s){let a=i.explicitOrderBy.concat([s]);return new ee(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(t._query,e))}};function Sg(r,t="asc"){let e=t,n=xo("orderBy",r);return Nc._create(n,e)}var vo=class r extends Cn{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){return new Pt(t.firestore,t.converter,Os(t._query,this._limit,this._limitType))}};function Pg(r){return sg("limit",r),vo._create("limit",r,"F")}function Cg(r){return sg("limitToLast",r),vo._create("limitToLast",r,"L")}var wo=class r extends Cn{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=Ng(t,this.type,this._docOrFields,this._inclusive);return new Pt(t.firestore,t.converter,function(i,s){return new ee(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(t._query,e))}};function Rg(...r){return wo._create("startAt",r,!0)}function xg(...r){return wo._create("startAfter",r,!1)}var Io=class r extends Cn{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=Ng(t,this.type,this._docOrFields,this._inclusive);return new Pt(t.firestore,t.converter,function(i,s){return new ee(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(t._query,e))}};function Dg(...r){return Io._create("endBefore",r,!1)}function Vg(...r){return Io._create("endAt",r,!0)}function Ng(r,t,e,n){if(e[0]=ft(e[0]),e[0]instanceof Pn)return function(s,a,u,l,d){if(!l)throw new x(C.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);let f=[];for(let g of Zn(s))if(g.field.isKeyField())f.push(vn(a,l.key));else{let _=l.data.field(g.field);if(Eo(_))throw new x(C.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(_===null){let b=g.field.canonicalString();throw new x(C.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${b}' (used as the orderBy) does not exist.`)}f.push(_)}return new ge(f,d)}(r._query,r.firestore._databaseId,t,e[0]._document,n);{let i=xn(r.firestore);return function(a,u,l,d,f,g){let _=a.explicitOrderBy;if(f.length>_.length)throw new x(C.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let b=[];for(let N=0;N<f.length;N++){let k=f[N];if(_[N].field.isKeyField()){if(typeof k!="string")throw new x(C.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof k}`);if(!jc(a)&&k.indexOf("/")!==-1)throw new x(C.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${k}' contains a slash.`);let V=a.path.child(Y.fromString(k));if(!F.isDocumentKey(V))throw new x(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${V}' is not because it contains an odd number of segments.`);let j=new F(V);b.push(vn(u,j))}else{let V=Ig(l,d,k);b.push(V)}}return new ge(b,g)}(r._query,r.firestore._databaseId,i,t,e,n)}}function Rf(r,t,e){if(typeof(e=ft(e))=="string"){if(e==="")throw new x(C.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!jc(t)&&e.indexOf("/")!==-1)throw new x(C.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let n=t.path.child(Y.fromString(e));if(!F.isDocumentKey(n))throw new x(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return vn(r,new F(n))}if(e instanceof ot)return vn(r,e._key);throw new x(C.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Co(e)}.`)}function xf(r,t){if(!Array.isArray(r)||r.length===0)throw new x(C.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function kg(r,t){let e=function(i,s){for(let a of i)for(let u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new x(C.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new x(C.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}var _r=class{convertValue(t,e="none"){switch(yn(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ct(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Qe(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw L()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let n={};return Rn(t,(i,s)=>{n[i]=this.convertValue(s,e)}),n}convertVectorValue(t){var e,n,i;let s=(i=(n=(e=t.fields)===null||e===void 0?void 0:e.value.arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.map(a=>ct(a.doubleValue));return new xi(s)}convertGeoPoint(t){return new Sn(ct(t.latitude),ct(t.longitude))}convertArray(t,e){return(t.values||[]).map(n=>this.convertValue(n,e))}convertServerTimestamp(t,e){switch(e){case"previous":let n=Bc(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(gi(t));default:return null}}convertTimestamp(t){let e=be(t);return new lt(e.seconds,e.nanos)}convertDocumentKey(t,e){let n=Y.fromString(t);q(Cm(n));let i=new We(n.get(1),n.get(3)),s=new F(n.popFirst(5));return i.isEqual(e)||pt(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}};function Vo(r,t,e){let n;return n=r?e&&(e.merge||e.mergeFields)?r.toFirestore(t,e):r.toFirestore(t):t,n}var kc=class extends _r{constructor(t){super(),this.firestore=t}convertBytes(t){return new _e(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new ot(this.firestore,null,e)}};var Ae=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},Jt=class extends Pn{constructor(t,e,n,i,s,a){super(t,e,n,i,a),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new ze(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let n=this._document.data.field(xo("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}},ze=class extends Jt{data(t={}){return super.data(t)}},ie=class{constructor(t,e,n,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new Ae(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new ze(this._firestore,this._userDataWriter,n.key,n,new Ae(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new x(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let l=new ze(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Ae(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||u.type!==3).map(u=>{let l=new ze(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Ae(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,f=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:Oy(u.type),doc:l,oldIndex:d,newIndex:f}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}};function Oy(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L()}}function yl(r,t){return r instanceof Jt&&t instanceof Jt?r._firestore===t._firestore&&r._key.isEqual(t._key)&&(r._document===null?t._document===null:r._document.isEqual(t._document))&&r._converter===t._converter:r instanceof ie&&t instanceof ie&&r._firestore===t._firestore&&fl(r.query,t.query)&&r.metadata.isEqual(t.metadata)&&r._snapshot.isEqual(t._snapshot)}function Mg(r){r=X(r,ot);let t=X(r.firestore,ht);return ng(Ct(t),r._key).then(e=>Tl(t,r,e))}var Re=class extends _r{constructor(t){super(),this.firestore=t}convertBytes(t){return new _e(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new ot(this.firestore,null,e)}};function Og(r){r=X(r,ot);let t=X(r.firestore,ht),e=Ct(t),n=new Re(t);return Ry(e,r._key).then(i=>new Jt(t,n,r._key,i,new Ae(i!==null&&i.hasLocalMutations,!0),r.converter))}function Fg(r){r=X(r,ot);let t=X(r.firestore,ht);return ng(Ct(t),r._key,{source:"server"}).then(e=>Tl(t,r,e))}function No(r){r=X(r,Pt);let t=X(r.firestore,ht),e=Ct(t),n=new Re(t);return bg(r._query),rg(e,r._query).then(i=>new ie(t,n,r,i))}function Lg(r){r=X(r,Pt);let t=X(r.firestore,ht),e=Ct(t),n=new Re(t);return xy(e,r._query).then(i=>new ie(t,n,r,i))}function qg(r){r=X(r,Pt);let t=X(r.firestore,ht),e=Ct(t),n=new Re(t);return rg(e,r._query,{source:"server"}).then(i=>new ie(t,n,r,i))}function vl(r,t,e){r=X(r,ot);let n=X(r.firestore,ht),i=Vo(r.converter,t,e);return Ar(n,[Ro(xn(n),"setDoc",r._key,i,r.converter!==null,e).toMutation(r._key,mt.none())])}function wl(r,t,e,...n){r=X(r,ot);let i=X(r.firestore,ht),s=xn(i),a;return a=typeof(t=ft(t))=="string"||t instanceof re?gl(s,"updateDoc",r._key,t,e,n):ml(s,"updateDoc",r._key,t),Ar(i,[a.toMutation(r._key,mt.exists(!0))])}function Bg(r){return Ar(X(r.firestore,ht),[new Ze(r._key,mt.none())])}function Ug(r,t){let e=X(r.firestore,ht),n=Bi(r),i=Vo(r.converter,t);return Ar(e,[Ro(xn(r.firestore),"addDoc",n._key,i,r.converter!==null,{}).toMutation(n._key,mt.exists(!1))]).then(()=>n)}function Il(r,...t){var e,n,i;r=ft(r);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof t[a]!="object"||Tc(t[a])||(s=t[a],a++);let u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Tc(t[a])){let g=t[a];t[a]=(e=g.next)===null||e===void 0?void 0:e.bind(g),t[a+1]=(n=g.error)===null||n===void 0?void 0:n.bind(g),t[a+2]=(i=g.complete)===null||i===void 0?void 0:i.bind(g)}let l,d,f;if(r instanceof ot)d=X(r.firestore,ht),f=vr(r._key.path),l={next:g=>{t[a]&&t[a](Tl(d,r,g))},error:t[a+1],complete:t[a+2]};else{let g=X(r,Pt);d=X(g.firestore,ht),f=g._query;let _=new Re(d);l={next:b=>{t[a]&&t[a](new ie(d,_,g,b))},error:t[a+1],complete:t[a+2]},bg(r._query)}return function(_,b,N,k){let V=new gr(k),j=new Ri(b,V,N);return _.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return Xc(yield pr(_),j)})),()=>{V.Za(),_.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return Zc(yield pr(_),j)}))}}(Ct(d),f,u,l)}function jg(r,t){return Dy(Ct(r=X(r,ht)),Tc(t)?t:{next:t})}function Ar(r,t){return function(n,i){let s=new At;return n.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return ly(yield cl(n),i,s)})),s.promise}(Ct(r),t)}function Tl(r,t,e){let n=e.docs.get(t._key),i=new Re(r);return new Jt(r,i,t._key,n,new Ae(e.hasPendingWrites,e.fromCache),t.converter)}var Fy={maxAttempts:5};var To=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=xn(t)}set(t,e,n){this._verifyNotCommitted();let i=je(t,this._firestore),s=Vo(i.converter,e,n),a=Ro(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,n);return this._mutations.push(a.toMutation(i._key,mt.none())),this}update(t,e,n,...i){this._verifyNotCommitted();let s=je(t,this._firestore),a;return a=typeof(e=ft(e))=="string"||e instanceof re?gl(this._dataReader,"WriteBatch.update",s._key,e,n,i):ml(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(a.toMutation(s._key,mt.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=je(t,this._firestore);return this._mutations=this._mutations.concat(new Ze(e._key,mt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new x(C.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function je(r,t){if((r=ft(r)).firestore!==t)throw new x(C.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}var Mc=class extends class{constructor(e,n){this._firestore=e,this._transaction=n,this._dataReader=xn(e)}get(e){let n=je(e,this._firestore),i=new kc(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||s.length!==1)return L();let a=s[0];if(a.isFoundDocument())return new Pn(this._firestore,i,a.key,a,n.converter);if(a.isNoDocument())return new Pn(this._firestore,i,n._key,null,n.converter);throw L()})}set(e,n,i){let s=je(e,this._firestore),a=Vo(s.converter,n,i),u=Ro(this._dataReader,"Transaction.set",s._key,a,s.converter!==null,i);return this._transaction.set(s._key,u),this}update(e,n,i,...s){let a=je(e,this._firestore),u;return u=typeof(n=ft(n))=="string"||n instanceof re?gl(this._dataReader,"Transaction.update",a._key,n,i,s):ml(this._dataReader,"Transaction.update",a._key,n),this._transaction.update(a._key,u),this}delete(e){let n=je(e,this._firestore);return this._transaction.delete(n._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=je(t,this._firestore),n=new Re(this._firestore);return super.get(t).then(i=>new Jt(this._firestore,n,e._key,i._document,new Ae(!1,!1),e.converter))}};function Gg(r,t,e){r=X(r,ht);let n=Object.assign(Object.assign({},Fy),e);return function(s){if(s.maxAttempts<1)throw new x(C.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,a,u){let l=new At;return s.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){let d=yield Sy(s);new wc(s.asyncQueue,d,u,a,l).au()})),l.promise}(Ct(r),i=>t(new Mc(r,i)),n)}function zg(){return new Di("deleteField")}function Kg(){return new Sc("serverTimestamp")}function $g(...r){return new Pc("arrayUnion",r)}function Qg(...r){return new Cc("arrayRemove",r)}function Wg(r){return new Rc("increment",r)}(function(t,e=!0){(function(i){yr=i})(od),sd(new hs("firestore",(n,{instanceIdentifier:i,options:s})=>{let a=n.getProvider("app").getImmediate(),u=new ht(new qa(n.getProvider("auth-internal")),new Ga(n.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new x(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new We(d.options.projectId,f)}(a,i),a);return s=Object.assign({useFetchStreams:e},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),ba(Pd,"4.7.3",t),ba(Pd,"4.7.3","esm2017")})();tt();tt();tt();var Ly="@firebase/firestore-compat",qy="0.3.38";function Cl(r,t){if(t===void 0)return{merge:!1};if(t.mergeFields!==void 0&&t.merge!==void 0)throw new x("invalid-argument",`Invalid options passed to function ${r}(): You cannot specify both "merge" and "mergeFields".`);return t}function Hg(){if(typeof Uint8Array>"u")throw new x("unimplemented","Uint8Arrays are not available in this environment.")}function Jg(){if(!zf())throw new x("unimplemented","Blobs are unavailable in Firestore in this environment.")}var ko=class r{constructor(t){this._delegate=t}static fromBase64String(t){return Jg(),new r(_e.fromBase64String(t))}static fromUint8Array(t){return Hg(),new r(_e.fromUint8Array(t))}toBase64(){return Jg(),this._delegate.toBase64()}toUint8Array(){return Hg(),this._delegate.toUint8Array()}isEqual(t){return this._delegate.isEqual(t._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function El(r){return By(r,["next","error","complete"])}function By(r,t){if(typeof r!="object"||r===null)return!1;let e=r;for(let n of t)if(n in e&&typeof e[n]=="function")return!0;return!1}var Al=class{enableIndexedDbPersistence(t,e){return lg(t._delegate,{forceOwnership:e})}enableMultiTabIndexedDbPersistence(t){return hg(t._delegate)}clearIndexedDbPersistence(t){return fg(t._delegate)}},Mo=class{constructor(t,e,n){this._delegate=e,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},t instanceof We||(this._appCompat=t)}get _databaseId(){return this._delegate._databaseId}settings(t){let e=this._delegate._getSettings();!t.merge&&e.host!==t.host&&te("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&(t=Object.assign(Object.assign({},e),t),delete t.merge),this._delegate._setSettings(t)}useEmulator(t,e,n={}){og(this._delegate,t,e,n)}enableNetwork(){return gg(this._delegate)}disableNetwork(){return pg(this._delegate)}enablePersistence(t){let e=!1,n=!1;return t&&(e=!!t.synchronizeTabs,n=!!t.experimentalForceOwningTab,hl("synchronizeTabs",e,"experimentalForceOwningTab",n)),e?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return mg(this._delegate)}onSnapshotsInSync(t){return jg(this._delegate,t)}get app(){if(!this._appCompat)throw new x("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(t){try{return new Pr(this,qi(this._delegate,t))}catch(e){throw Ut(e,"collection()","Firestore.collection()")}}doc(t){try{return new ye(this,Bi(this._delegate,t))}catch(e){throw Ut(e,"doc()","Firestore.doc()")}}collectionGroup(t){try{return new Mn(this,ag(this._delegate,t))}catch(e){throw Ut(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return Gg(this._delegate,e=>t(new Oo(this,e)))}batch(){return Ct(this._delegate),new Fo(new To(this._delegate,t=>Ar(this._delegate,t)))}loadBundle(t){return _g(this._delegate,t)}namedQuery(t){return yg(this._delegate,t).then(e=>e?new Mn(this,e):null)}},br=class extends _r{constructor(t){super(),this.firestore=t}convertBytes(t){return new ko(new _e(t))}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return ye.forKey(e,this.firestore,null)}};function Uy(r){Df(r)}var Oo=class{constructor(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new br(t)}get(t){let e=Vn(t);return this._delegate.get(e).then(n=>new Nn(this._firestore,new Jt(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,e.converter)))}set(t,e,n){let i=Vn(t);return n?(Cl("Transaction.set",n),this._delegate.set(i,e,n)):this._delegate.set(i,e),this}update(t,e,n,...i){let s=Vn(t);return arguments.length===2?this._delegate.update(s,e):this._delegate.update(s,e,n,...i),this}delete(t){let e=Vn(t);return this._delegate.delete(e),this}},Fo=class{constructor(t){this._delegate=t}set(t,e,n){let i=Vn(t);return n?(Cl("WriteBatch.set",n),this._delegate.set(i,e,n)):this._delegate.set(i,e),this}update(t,e,n,...i){let s=Vn(t);return arguments.length===2?this._delegate.update(s,e):this._delegate.update(s,e,n,...i),this}delete(t){let e=Vn(t);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}},Sr=class r{constructor(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}fromFirestore(t,e){let n=new ze(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new kn(this._firestore,n),e??{})}toFirestore(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)}static getInstance(t,e){let n=r.INSTANCES,i=n.get(t);i||(i=new WeakMap,n.set(t,i));let s=i.get(e);return s||(s=new r(t,new br(t),e),i.set(e,s)),s}};Sr.INSTANCES=new WeakMap;var ye=class r{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new br(t)}static forPath(t,e,n){if(t.length%2!==0)throw new x("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${t.canonicalString()} has ${t.length}`);return new r(e,new ot(e._delegate,n,new F(t)))}static forKey(t,e,n){return new r(e,new ot(e._delegate,n,t))}get id(){return this._delegate.id}get parent(){return new Pr(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(t){try{return new Pr(this.firestore,qi(this._delegate,t))}catch(e){throw Ut(e,"collection()","DocumentReference.collection()")}}isEqual(t){return t=ft(t),t instanceof ot?dl(this._delegate,t):!1}set(t,e){e=Cl("DocumentReference.set",e);try{return e?vl(this._delegate,t,e):vl(this._delegate,t)}catch(n){throw Ut(n,"setDoc()","DocumentReference.set()")}}update(t,e,...n){try{return arguments.length===1?wl(this._delegate,t):wl(this._delegate,t,e,...n)}catch(i){throw Ut(i,"updateDoc()","DocumentReference.update()")}}delete(){return Bg(this._delegate)}onSnapshot(...t){let e=Yg(t),n=Xg(t,i=>new Nn(this.firestore,new Jt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Il(this._delegate,e,n)}get(t){let e;return t?.source==="cache"?e=Og(this._delegate):t?.source==="server"?e=Fg(this._delegate):e=Mg(this._delegate),e.then(n=>new Nn(this.firestore,new Jt(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(t){return new r(this.firestore,t?this._delegate.withConverter(Sr.getInstance(this.firestore,t)):this._delegate.withConverter(null))}};function Ut(r,t,e){return r.message=r.message.replace(t,e),r}function Yg(r){for(let t of r)if(typeof t=="object"&&!El(t))return t;return{}}function Xg(r,t){var e,n;let i;return El(r[0])?i=r[0]:El(r[1])?i=r[1]:typeof r[0]=="function"?i={next:r[0],error:r[1],complete:r[2]}:i={next:r[1],error:r[2],complete:r[3]},{next:s=>{i.next&&i.next(t(s))},error:(e=i.error)===null||e===void 0?void 0:e.bind(i),complete:(n=i.complete)===null||n===void 0?void 0:n.bind(i)}}var Nn=class{constructor(t,e){this._firestore=t,this._delegate=e}get ref(){return new ye(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(t){return this._delegate.data(t)}get(t,e){return this._delegate.get(t,e)}isEqual(t){return yl(this._delegate,t._delegate)}},kn=class extends Nn{data(t){let e=this._delegate.data(t);return this._delegate._converter||Vf(e!==void 0,"Document in a QueryDocumentSnapshot should exist"),e}},Mn=class r{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new br(t)}where(t,e,n){try{return new r(this.firestore,se(this._delegate,Do(t,e,n)))}catch(i){throw Ut(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(t,e){try{return new r(this.firestore,se(this._delegate,Sg(t,e)))}catch(n){throw Ut(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(t){try{return new r(this.firestore,se(this._delegate,Pg(t)))}catch(e){throw Ut(e,"limit()","Query.limit()")}}limitToLast(t){try{return new r(this.firestore,se(this._delegate,Cg(t)))}catch(e){throw Ut(e,"limitToLast()","Query.limitToLast()")}}startAt(...t){try{return new r(this.firestore,se(this._delegate,Rg(...t)))}catch(e){throw Ut(e,"startAt()","Query.startAt()")}}startAfter(...t){try{return new r(this.firestore,se(this._delegate,xg(...t)))}catch(e){throw Ut(e,"startAfter()","Query.startAfter()")}}endBefore(...t){try{return new r(this.firestore,se(this._delegate,Dg(...t)))}catch(e){throw Ut(e,"endBefore()","Query.endBefore()")}}endAt(...t){try{return new r(this.firestore,se(this._delegate,Vg(...t)))}catch(e){throw Ut(e,"endAt()","Query.endAt()")}}isEqual(t){return fl(this._delegate,t._delegate)}get(t){let e;return t?.source==="cache"?e=Lg(this._delegate):t?.source==="server"?e=qg(this._delegate):e=No(this._delegate),e.then(n=>new Ui(this.firestore,new ie(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...t){let e=Yg(t),n=Xg(t,i=>new Ui(this.firestore,new ie(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Il(this._delegate,e,n)}withConverter(t){return new r(this.firestore,t?this._delegate.withConverter(Sr.getInstance(this.firestore,t)):this._delegate.withConverter(null))}},bl=class{constructor(t,e){this._firestore=t,this._delegate=e}get type(){return this._delegate.type}get doc(){return new kn(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Ui=class{constructor(t,e){this._firestore=t,this._delegate=e}get query(){return new Mn(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(t=>new kn(this._firestore,t))}docChanges(t){return this._delegate.docChanges(t).map(e=>new bl(this._firestore,e))}forEach(t,e){this._delegate.forEach(n=>{t.call(e,new kn(this._firestore,n))})}isEqual(t){return yl(this._delegate,t._delegate)}},Pr=class r extends Mn{constructor(t,e){super(t,e),this.firestore=t,this._delegate=e}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let t=this._delegate.parent;return t?new ye(this.firestore,t):null}doc(t){try{return t===void 0?new ye(this.firestore,Bi(this._delegate)):new ye(this.firestore,Bi(this._delegate,t))}catch(e){throw Ut(e,"doc()","CollectionReference.doc()")}}add(t){return Ug(this._delegate,t).then(e=>new ye(this.firestore,e))}isEqual(t){return dl(this._delegate,t._delegate)}withConverter(t){return new r(this.firestore,t?this._delegate.withConverter(Sr.getInstance(this.firestore,t)):this._delegate.withConverter(null))}};function Vn(r){return X(r,ot)}var Sl=class r{constructor(...t){this._delegate=new re(...t)}static documentId(){return new r(_t.keyField().canonicalString())}isEqual(t){return t=ft(t),t instanceof re?this._delegate._internalPath.isEqual(t._internalPath):!1}};var Pl=class r{constructor(t){this._delegate=t}static serverTimestamp(){let t=Kg();return t._methodName="FieldValue.serverTimestamp",new r(t)}static delete(){let t=zg();return t._methodName="FieldValue.delete",new r(t)}static arrayUnion(...t){let e=$g(...t);return e._methodName="FieldValue.arrayUnion",new r(e)}static arrayRemove(...t){let e=Qg(...t);return e._methodName="FieldValue.arrayRemove",new r(e)}static increment(t){let e=Wg(t);return e._methodName="FieldValue.increment",new r(e)}isEqual(t){return this._delegate.isEqual(t._delegate)}};var jy={Firestore:Mo,GeoPoint:Sn,Timestamp:lt,Blob:ko,Transaction:Oo,WriteBatch:Fo,DocumentReference:ye,DocumentSnapshot:Nn,Query:Mn,QueryDocumentSnapshot:kn,QuerySnapshot:Ui,CollectionReference:Pr,FieldPath:Sl,FieldValue:Pl,setLogLevel:Uy,CACHE_SIZE_UNLIMITED:ug};function Gy(r,t){r.INTERNAL.registerComponent(new hs("firestore-compat",e=>{let n=e.getProvider("app-compat").getImmediate(),i=e.getProvider("firestore").getImmediate();return t(n,i)},"PUBLIC").setServiceProps(Object.assign({},jy)))}function zy(r){Gy(r,(t,e)=>new Mo(t,e,new Al)),r.registerVersion(Ly,qy)}zy(Zr);function Ky(r,t=kh){return new Nh(e=>{let n;return t!=null?t.schedule(()=>{n=r.onSnapshot({includeMetadataChanges:!0},e)}):n=r.onSnapshot({includeMetadataChanges:!0},e),()=>{n?.()}})}function Zg(r,t){return Ky(r,t)}function $y(r,t){return Zg(r,t).pipe(as(void 0),ss(),Xt(e=>{let[n,i]=e;return i.exists?n?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function Dl(r,t){return Zg(r,t).pipe(Xt(e=>({payload:e,type:"query"})))}var Lo=class{ref;afs;constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){let n=this.ref.collection(t),{ref:i,query:s}=np(n,e);return new Bo(i,s,this.afs)}snapshotChanges(){return $y(this.ref,this.afs.schedulers.outsideAngular).pipe(Qt)}valueChanges(t={}){return this.snapshotChanges().pipe(Xt(({payload:e})=>t.idField?Qr(Me({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return Wr(this.ref.get(t)).pipe(Qt)}};function qo(r,t){return Dl(r,t).pipe(as(void 0),ss(),Xt(e=>{let[n,i]=e,s=i.payload.docChanges(),a=s.map(u=>({type:u.type,payload:u}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((u,l)=>{let d=s.find(g=>g.doc.ref.isEqual(u.ref)),f=n?.payload.docs.find(g=>g.ref.isEqual(u.ref));d&&JSON.stringify(d.doc.metadata)===JSON.stringify(u.metadata)||!d&&f&&JSON.stringify(f.metadata)===JSON.stringify(u.metadata)||a.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:u}})}),a}))}function tp(r,t,e){return qo(r,e).pipe(os((n,i)=>Qy(n,i.map(s=>s.payload),t),[]),Mh(),Xt(n=>n.map(i=>({type:i.type,payload:i}))))}function Qy(r,t,e){return t.forEach(n=>{e.indexOf(n.type)>-1&&(r=Wy(r,n))}),r}function Rl(r,t,e,...n){let i=r.slice();return i.splice(t,e,...n),i}function Wy(r,t){switch(t.type){case"added":if(!(r[t.newIndex]&&r[t.newIndex].doc.ref.isEqual(t.doc.ref)))return Rl(r,t.newIndex,0,t);break;case"modified":if(r[t.oldIndex]==null||r[t.oldIndex].doc.ref.isEqual(t.doc.ref))if(t.oldIndex!==t.newIndex){let e=r.slice();return e.splice(t.oldIndex,1),e.splice(t.newIndex,0,t),e}else return Rl(r,t.newIndex,1,t);break;case"removed":if(r[t.oldIndex]&&r[t.oldIndex].doc.ref.isEqual(t.doc.ref))return Rl(r,t.oldIndex,1);break}return r}function ep(r){return(!r||r.length===0)&&(r=["added","removed","modified"]),r}var Bo=class{ref;query;afs;constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=qo(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Xt(n=>n.filter(i=>t.indexOf(i.type)>-1)))),e.pipe(as(void 0),ss(),va(([n,i])=>i.length>0||!n),Xt(([,n])=>n),Qt)}auditTrail(t){return this.stateChanges(t).pipe(os((e,n)=>[...e,...n],[]))}snapshotChanges(t){let e=ep(t);return tp(this.query,e,this.afs.schedulers.outsideAngular).pipe(Qt)}valueChanges(t={}){return Dl(this.query,this.afs.schedulers.outsideAngular).pipe(Xt(e=>e.payload.docs.map(n=>t.idField?Qr(Me({},n.data()),{[t.idField]:n.id}):n.data())),Qt)}get(t){return Wr(this.query.get(t)).pipe(Qt)}add(t){return this.ref.add(t)}doc(t){return new Lo(this.ref.doc(t),this.afs)}},xl=class{query;afs;constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return!t||t.length===0?qo(this.query,this.afs.schedulers.outsideAngular).pipe(Qt):qo(this.query,this.afs.schedulers.outsideAngular).pipe(Xt(e=>e.filter(n=>t.indexOf(n.type)>-1)),va(e=>e.length>0),Qt)}auditTrail(t){return this.stateChanges(t).pipe(os((e,n)=>[...e,...n],[]))}snapshotChanges(t){let e=ep(t);return tp(this.query,e,this.afs.schedulers.outsideAngular).pipe(Qt)}valueChanges(t={}){return Dl(this.query,this.afs.schedulers.outsideAngular).pipe(Xt(n=>n.payload.docs.map(i=>t.idField?Me({[t.idField]:i.id},i.data()):i.data())),Qt)}get(t){return Wr(this.query.get(t)).pipe(Qt)}},Hy=new Jr("angularfire2.enableFirestorePersistence"),Jy=new Jr("angularfire2.firestore.persistenceSettings"),Yy=new Jr("angularfire2.firestore.settings"),Xy=new Jr("angularfire2.firestore.use-emulator");function np(r,t=e=>e){return{query:t(r),ref:r}}var rp=(()=>{class r{schedulers;firestore;persistenceEnabled$;constructor(e,n,i,s,a,u,l,d,f,g,_,b,N,k,V,j,G){this.schedulers=l;let B=hd(e,u,n),Q=f;g&&wd(B,u,_,N,k,V,b,j),[this.firestore,this.persistenceEnabled$]=fd(`${B.name}.firestore`,"AngularFirestore",B.name,()=>{let H=u.runOutsideAngular(()=>B.firestore());if(s&&H.settings(s),Q&&H.useEmulator(...Q),i&&!Kh(a)){let K=()=>{try{return Wr(H.enablePersistence(d||void 0).then(()=>!0,()=>!1))}catch(w){return typeof console<"u"&&console.warn(w),ya(!1)}};return[H,u.runOutsideAngular(K)]}else return[H,ya(!1)]},[s,Q,i])}collection(e,n){let i;typeof e=="string"?i=this.firestore.collection(e):i=e;let{ref:s,query:a}=np(i,n),u=this.schedulers.ngZone.run(()=>s);return new Bo(u,a,this)}collectionGroup(e,n){let i=n||(a=>a),s=this.firestore.collectionGroup(e);return new xl(i(s),this)}doc(e){let n;typeof e=="string"?n=this.firestore.doc(e):n=e;let i=this.schedulers.ngZone.run(()=>n);return new Lo(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(n){return new(n||r)(gt(cd),gt(ld,8),gt(Hy,8),gt(Yy,8),gt(Fh),gt(Oh),gt(ud),gt(Jy,8),gt(Xy,8),gt(Id,8),gt(md,8),gt(gd,8),gt(pd,8),gt(_d,8),gt(yd,8),gt(vd,8),gt(ad,8))};static \u0275prov=us({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})();var sn=class r{constructor(t,e){this.localstorageService=t;this.firestore=e;this.userId=this.localstorageService.uid}userId;saveDream(t){return R(this,null,function*(){return(yield this.firestore.collection("Dreams").add(t).catch(n=>{throw new Error(n.message)})).id})}loadDreams(t){return R(this,null,function*(){let e=Zr.firestore(),n=qi(e,"Dreams"),i=se(n,Do("user.uid","==",t.uid));return(yield No(i)).docs.map(u=>Me({id:u.id},u.data()))})}static \u0275fac=function(e){return new(e||r)(gt(Bn),gt(rp))};static \u0275prov=us({token:r,factory:r.\u0275fac,providedIn:"root"})};var Uo=class r{constructor(t,e,n,i){this.dreamsData=t;this.formBuilder=e;this.router=n;this.localStorageService=i;this.initForm()}formGroup;initForm(){this.formGroup=this.formBuilder.group({title:["",Ta.required],content:["",Ta.required],date:[new Date]})}saveDream(){return R(this,null,function*(){if(this.formGroup.invalid)throw Error("Invalid form");let t=Qr(Me({},this.formGroup.value),{user:this.localStorageService.userLogged});(yield this.dreamsData.saveDream(t))&&(alert("Sucess!"),this.router.navigate(["app"]))})}static \u0275fac=function(e){return new(e||r)(Oe(sn),Oe(td),Oe(Qh),Oe(Bn))};static \u0275cmp=oe({type:r,selectors:[["app-dream-edit"]],decls:14,vars:1,consts:[[1,"card",3,"formGroup"],[1,"inputWrapper"],["type","text","formControlName","title"],["formControlName","content",1,"scrollbar"],["id","ButtonsFooter"],[1,"button",3,"click"]],template:function(e,n){e&1&&(rt(0,"section",0)(1,"h3"),kt(2,"New Dream"),st(),rt(3,"div",1)(4,"label"),kt(5,"Title"),st(),Nt(6,"input",2),st(),rt(7,"div",1)(8,"label"),kt(9,"Content"),st(),Nt(10,"textarea",3),st(),rt(11,"div",4)(12,"button",5),qh("click",function(){return n.saveDream()}),kt(13,"Save"),st()()()),e&2&&ae("formGroup",n.formGroup)},dependencies:[Hh,Jh,Yh,Xh,Zh],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding:24px;height:100%}section[_ngcontent-%COMP%]{max-width:700px;flex:1;max-height:700px;display:flex;flex-direction:column;padding:12px;gap:8px}.inputWrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.inputWrapper[_ngcontent-%COMP%]:has(textarea){flex:1}.inputWrapper[_ngcontent-%COMP%]:has(textarea)   textarea[_ngcontent-%COMP%]{height:100%}#ButtonsFooter[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}#ButtonsFooter[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px}"]})};tt();function ev(r,t){if(r&1&&(rt(0,"div")(1,"h4"),kt(2),st()()),r&2){let e=t.$implicit;Zt(2),ls(e.title)}}var jo=class r{constructor(t,e){this.dreamsDataService=t;this.localStorageService=e;this.loadDreams()}dreams=[];loadDreams(){return R(this,null,function*(){let t=yield this.dreamsDataService.loadDreams({uid:this.localStorageService.uid});this.dreams=t})}static \u0275fac=function(e){return new(e||r)(Oe(sn),Oe(Bn))};static \u0275cmp=oe({type:r,selectors:[["app-dream-list"]],decls:24,vars:1,consts:[["id","DreamListHeader"],["id","SearchInput"],[1,"bi","bi-search"],["type","input","placeholder","Search"],["for","search"],["id","DreamList"],[4,"ngFor","ngForOf"],["id","DreamCard",1,"card"],["id","Core"],["id","Options"],["id","MoreOptionsBtn"],[1,"bi","bi-three-dots-vertical"],["id","BottomBar"],[1,"iconBtn"],[1,"bi","bi-share-fill"],[1,"bi","bi-pencil-fill"]],template:function(e,n){e&1&&(rt(0,"head",0)(1,"div",1),Nt(2,"i",2),rt(3,"div"),Nt(4,"input",3),rt(5,"label",4),kt(6,"Search"),st()()()(),rt(7,"main",5)(8,"div"),cs(9,ev,3,1,"div",6),st(),rt(10,"div",7)(11,"div",8)(12,"h3"),kt(13," Title "),st(),rt(14,"p"),kt(15," Lorem ipsum dolor sit amet, consectetur adipisicing elit. Assumenda aspernatur, numqm fugiat repellat inventore id eligendi asperiores nostrum eaque qui doloribus obcaecati cupiditate dignissimos. Mollitia incidunt eligendi porro atque repellat. "),st()(),rt(16,"div",9)(17,"button",10),Nt(18,"i",11),st(),rt(19,"div",12)(20,"button",13),Nt(21,"i",14),st(),rt(22,"button",13),Nt(23,"i",15),st()()()()()),e&2&&(Zt(9),ae("ngForOf",n.dreams))},dependencies:[jh],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;flex-direction:row;flex-wrap:wrap;padding:20px;box-sizing:border-box;align-content:start}#DreamList[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:flex-start}#DreamList[_ngcontent-%COMP%]   #DreamCard[_ngcontent-%COMP%]{flex:2 400px;height:250px;width:350px;display:flex;flex-direction:column;justify-content:flex-end;overflow:hidden}#DreamList[_ngcontent-%COMP%]   #DreamCard[_ngcontent-%COMP%]   #Core[_ngcontent-%COMP%]{background-color:var(--colorBackground1);color:var(--colorText1);height:60%;padding:15px;display:flex;flex-direction:row;flex-wrap:wrap;gap:20px}#DreamList[_ngcontent-%COMP%]   #DreamCard[_ngcontent-%COMP%]   #Core[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:20px}#DreamList[_ngcontent-%COMP%]   #DreamCard[_ngcontent-%COMP%]   #Core[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{height:100px;margin:0;color:var(--colorText2)}#DreamList[_ngcontent-%COMP%]   #DreamCard[_ngcontent-%COMP%]   #Options[_ngcontent-%COMP%]{display:none;flex-direction:row;flex-wrap:wrap;position:absolute;height:100%;width:100%;align-content:end}#DreamList[_ngcontent-%COMP%]   #DreamCard[_ngcontent-%COMP%]   #Options[_ngcontent-%COMP%]   #MoreOptionsBtn[_ngcontent-%COMP%]{position:absolute;right:10px;top:10px}#DreamList[_ngcontent-%COMP%]   #DreamCard[_ngcontent-%COMP%]   #Options[_ngcontent-%COMP%]   #BottomBar[_ngcontent-%COMP%]{padding:10px;gap:10px;display:flex;flex-direction:row;justify-content:end;flex-wrap:wrap;align-content:center;width:100%;height:50px;background:linear-gradient(to bottom,#2222224d,#222)}#DreamList[_ngcontent-%COMP%]   #DreamCard[_ngcontent-%COMP%]   #Options[_ngcontent-%COMP%]   #BottomBar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:35px;height:35px}#DreamList[_ngcontent-%COMP%]   #DreamCard[_ngcontent-%COMP%]:hover{cursor:pointer;border:solid 2px var(--colorTheme2)}#DreamList[_ngcontent-%COMP%]   #DreamCard[_ngcontent-%COMP%]:hover   #Options[_ngcontent-%COMP%]{display:flex}#DreamListHeader[_ngcontent-%COMP%]{flex:100%;display:flex;flex-direction:row;justify-content:start;padding:5px;width:100%;height:60px}#DreamListHeader[_ngcontent-%COMP%]   #SearchInput[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-content:end;flex-wrap:wrap}#DreamListHeader[_ngcontent-%COMP%]   #SearchInput[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{align-self:end;height:20px;font-size:20px;color:var(--colorTheme1)}#DreamListHeader[_ngcontent-%COMP%]   #SearchInput[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:20px 0 0;position:relative}#DreamListHeader[_ngcontent-%COMP%]   #SearchInput[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{font-family:inherit;font-weight:600;width:100%;border:none;border-bottom:2px solid #9b9b9b;outline:0;font-size:17px;color:#fff;padding:7px 0;background:transparent;transition:border-color .2s}#DreamListHeader[_ngcontent-%COMP%]   #SearchInput[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:transparent}#DreamListHeader[_ngcontent-%COMP%]   #SearchInput[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:placeholder-shown ~ label[_ngcontent-%COMP%]{font-size:17px;cursor:text;top:20px}#DreamListHeader[_ngcontent-%COMP%]   #SearchInput[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{padding-bottom:6px;border-width:3px;border-image:var(--colorTheme2);border-image-slice:1}#DreamListHeader[_ngcontent-%COMP%]   #SearchInput[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus ~ label[_ngcontent-%COMP%]{position:absolute;margin-top:8px;top:0;display:block;transition:.2s;font-size:18px;color:var(--colorTheme1)}#DreamListHeader[_ngcontent-%COMP%]   #SearchInput[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{position:absolute;top:0;margin-top:8px;display:block;transition:.2s;font-size:17px;color:var(--colorTheme1);pointer-events:none}"]})};tt();tt();function nv(r,t){if(r&1&&Nt(0,"i"),r&2){let e=Bh();Lh("bi ",e.icon,"")}}var Go=class r{title;link;icon;static \u0275fac=function(e){return new(e||r)};static \u0275cmp=oe({type:r,selectors:[["app-topbar-button"]],inputs:{title:"title",link:"link",icon:"icon"},decls:4,vars:3,consts:[[1,"navBtn",3,"routerLink"],[3,"class",4,"ngIf"]],template:function(e,n){e&1&&(rt(0,"a",0),cs(1,nv,1,3,"i",1),rt(2,"span"),kt(3),st()()),e&2&&(ae("routerLink",n.link),Zt(),ae("ngIf",n.icon),Zt(2),ls(n.title))},dependencies:[Gh,Wh],styles:[".navBtn[_ngcontent-%COMP%]{cursor:pointer;text-decoration:none;padding:10px;transition:color var(--timeHoverAnimation),background-color var(--timeHoverAnimation)}.navBtn[_ngcontent-%COMP%]:hover{background-color:var(--colorBackground2);color:var(--colorText1)}.navBtn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;gap:4px}"]})};var iv=()=>["list"],sv=()=>["edit"],zo=class r{static \u0275fac=function(e){return new(e||r)};static \u0275cmp=oe({type:r,selectors:[["app-core"]],decls:7,vars:4,consts:[["title","My Dreams","icon","",3,"link"],["title","New Dream","icon","",3,"link"],["id","ContentWrapper"]],template:function(e,n){e&1&&(rt(0,"header")(1,"app-topbar"),Nt(2,"app-topbar-button",0)(3,"app-topbar-button",1),st()(),rt(4,"div",2)(5,"main"),Nt(6,"router-outlet"),st()()),e&2&&(Zt(2),ae("link",wa(2,iv)),Zt(),ae("link",wa(3,sv)))},dependencies:[$h,Ed,Go],styles:["[_nghost-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column;background-color:var(--colorBackground1);-webkit-backdrop-filter:blur 12px;backdrop-filter:blur 12px;background-image:var(--imgBgCore);background-size:cover}[_nghost-%COMP%]   header[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   #ContentWrapper[_ngcontent-%COMP%]{height:100%;display:flex;position:relative;overflow:hidden}[_nghost-%COMP%]   #ContentWrapper[_ngcontent-%COMP%]   aside[_ngcontent-%COMP%]{position:absolute;width:40px;left:0;height:100%}[_nghost-%COMP%]   #ContentWrapper[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{margin-left:40px;width:100%;height:100%}"]})};var ov=[{path:"",component:zo,children:[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:jo},{path:"view",component:ds},{path:"edit",component:Uo}]}],Ko=class r{static \u0275fac=function(e){return new(e||r)};static \u0275mod=Yr({type:r});static \u0275inj=Hr({imports:[Ia.forChild(ov),Ia]})};var ap=class r{static \u0275fac=function(e){return new(e||r)};static \u0275mod=Yr({type:r});static \u0275inj=Hr({providers:[sn],imports:[zh,Ko,Ad,dd.initializeApp(Td.firebaseConfig,{})]})};export{ap as CoreModule};
